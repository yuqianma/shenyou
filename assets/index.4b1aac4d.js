function Xw(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var Jw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function SM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ee={exports:{}},qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hl=Symbol.for("react.element"),PM=Symbol.for("react.portal"),MM=Symbol.for("react.fragment"),IM=Symbol.for("react.strict_mode"),BM=Symbol.for("react.profiler"),LM=Symbol.for("react.provider"),RM=Symbol.for("react.context"),OM=Symbol.for("react.forward_ref"),FM=Symbol.for("react.suspense"),DM=Symbol.for("react.memo"),kM=Symbol.for("react.lazy"),F_=Symbol.iterator;function NM(t){return t===null||typeof t!="object"?null:(t=F_&&t[F_]||t["@@iterator"],typeof t=="function"?t:null)}var Yw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kw=Object.assign,Zw={};function Ua(t,e,n){this.props=t,this.context=e,this.refs=Zw,this.updater=n||Yw}Ua.prototype.isReactComponent={};Ua.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ua.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function qw(){}qw.prototype=Ua.prototype;function Hp(t,e,n){this.props=t,this.context=e,this.refs=Zw,this.updater=n||Yw}var jp=Hp.prototype=new qw;jp.constructor=Hp;Kw(jp,Ua.prototype);jp.isPureReactComponent=!0;var D_=Array.isArray,$w=Object.prototype.hasOwnProperty,Wp={current:null},eT={key:!0,ref:!0,__self:!0,__source:!0};function tT(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)$w.call(e,i)&&!eT.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),h=0;h<a;h++)l[h]=arguments[h+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Hl,type:t,key:s,ref:o,props:r,_owner:Wp.current}}function UM(t,e){return{$$typeof:Hl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Qp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Hl}function GM(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var k_=/\/+/g;function cd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?GM(""+t.key):e.toString(36)}function Lu(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Hl:case PM:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+cd(o,0):i,D_(r)?(n="",t!=null&&(n=t.replace(k_,"$&/")+"/"),Lu(r,e,n,"",function(h){return h})):r!=null&&(Qp(r)&&(r=UM(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(k_,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",D_(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+cd(s,a);o+=Lu(s,e,n,l,r)}else if(l=NM(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+cd(s,a++),o+=Lu(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Lc(t,e,n){if(t==null)return t;var i=[],r=0;return Lu(t,i,"","",function(s){return e.call(n,s,r++)}),i}function zM(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ln={current:null},Ru={transition:null},VM={ReactCurrentDispatcher:Ln,ReactCurrentBatchConfig:Ru,ReactCurrentOwner:Wp};qe.Children={map:Lc,forEach:function(t,e,n){Lc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Lc(t,function(){e++}),e},toArray:function(t){return Lc(t,function(e){return e})||[]},only:function(t){if(!Qp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};qe.Component=Ua;qe.Fragment=MM;qe.Profiler=BM;qe.PureComponent=Hp;qe.StrictMode=IM;qe.Suspense=FM;qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VM;qe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Kw({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Wp.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)$w.call(e,l)&&!eT.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var h=0;h<l;h++)a[h]=arguments[h+2];i.children=a}return{$$typeof:Hl,type:t.type,key:r,ref:s,props:i,_owner:o}};qe.createContext=function(t){return t={$$typeof:RM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:LM,_context:t},t.Consumer=t};qe.createElement=tT;qe.createFactory=function(t){var e=tT.bind(null,t);return e.type=t,e};qe.createRef=function(){return{current:null}};qe.forwardRef=function(t){return{$$typeof:OM,render:t}};qe.isValidElement=Qp;qe.lazy=function(t){return{$$typeof:kM,_payload:{_status:-1,_result:t},_init:zM}};qe.memo=function(t,e){return{$$typeof:DM,type:t,compare:e===void 0?null:e}};qe.startTransition=function(t){var e=Ru.transition;Ru.transition={};try{t()}finally{Ru.transition=e}};qe.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};qe.useCallback=function(t,e){return Ln.current.useCallback(t,e)};qe.useContext=function(t){return Ln.current.useContext(t)};qe.useDebugValue=function(){};qe.useDeferredValue=function(t){return Ln.current.useDeferredValue(t)};qe.useEffect=function(t,e){return Ln.current.useEffect(t,e)};qe.useId=function(){return Ln.current.useId()};qe.useImperativeHandle=function(t,e,n){return Ln.current.useImperativeHandle(t,e,n)};qe.useInsertionEffect=function(t,e){return Ln.current.useInsertionEffect(t,e)};qe.useLayoutEffect=function(t,e){return Ln.current.useLayoutEffect(t,e)};qe.useMemo=function(t,e){return Ln.current.useMemo(t,e)};qe.useReducer=function(t,e,n){return Ln.current.useReducer(t,e,n)};qe.useRef=function(t){return Ln.current.useRef(t)};qe.useState=function(t){return Ln.current.useState(t)};qe.useSyncExternalStore=function(t,e,n){return Ln.current.useSyncExternalStore(t,e,n)};qe.useTransition=function(){return Ln.current.useTransition()};qe.version="18.2.0";(function(t){t.exports=qe})(Ee);const HM=SM(Ee.exports);var $0={},nh={exports:{}},ai={},nT={exports:{}},iT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ne,le){var he=ne.length;ne.push(le);e:for(;0<he;){var xe=he-1>>>1,Ie=ne[xe];if(0<r(Ie,le))ne[xe]=le,ne[he]=Ie,he=xe;else break e}}function n(ne){return ne.length===0?null:ne[0]}function i(ne){if(ne.length===0)return null;var le=ne[0],he=ne.pop();if(he!==le){ne[0]=he;e:for(var xe=0,Ie=ne.length,Ze=Ie>>>1;xe<Ze;){var Ft=2*(xe+1)-1,An=ne[Ft],tn=Ft+1,dt=ne[tn];if(0>r(An,he))tn<Ie&&0>r(dt,An)?(ne[xe]=dt,ne[tn]=he,xe=tn):(ne[xe]=An,ne[Ft]=he,xe=Ft);else if(tn<Ie&&0>r(dt,he))ne[xe]=dt,ne[tn]=he,xe=tn;else break e}}return le}function r(ne,le){var he=ne.sortIndex-le.sortIndex;return he!==0?he:ne.id-le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],h=[],g=1,m=null,v=3,w=!1,C=!1,b=!1,R=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(ne){for(var le=n(h);le!==null;){if(le.callback===null)i(h);else if(le.startTime<=ne)i(h),le.sortIndex=le.expirationTime,e(l,le);else break;le=n(h)}}function F(ne){if(b=!1,M(ne),!C)if(n(l)!==null)C=!0,ve(H);else{var le=n(h);le!==null&&ce(F,le.startTime-ne)}}function H(ne,le){C=!1,b&&(b=!1,S(ee),ee=-1),w=!0;var he=v;try{for(M(le),m=n(l);m!==null&&(!(m.expirationTime>le)||ne&&!D());){var xe=m.callback;if(typeof xe=="function"){m.callback=null,v=m.priorityLevel;var Ie=xe(m.expirationTime<=le);le=t.unstable_now(),typeof Ie=="function"?m.callback=Ie:m===n(l)&&i(l),M(le)}else i(l);m=n(l)}if(m!==null)var Ze=!0;else{var Ft=n(h);Ft!==null&&ce(F,Ft.startTime-le),Ze=!1}return Ze}finally{m=null,v=he,w=!1}}var j=!1,K=null,ee=-1,X=5,U=-1;function D(){return!(t.unstable_now()-U<X)}function ae(){if(K!==null){var ne=t.unstable_now();U=ne;var le=!0;try{le=K(!0,ne)}finally{le?re():(j=!1,K=null)}}else j=!1}var re;if(typeof P=="function")re=function(){P(ae)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,oe=te.port2;te.port1.onmessage=ae,re=function(){oe.postMessage(null)}}else re=function(){R(ae,0)};function ve(ne){K=ne,j||(j=!0,re())}function ce(ne,le){ee=R(function(){ne(t.unstable_now())},le)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ne){ne.callback=null},t.unstable_continueExecution=function(){C||w||(C=!0,ve(H))},t.unstable_forceFrameRate=function(ne){0>ne||125<ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<ne?Math.floor(1e3/ne):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(ne){switch(v){case 1:case 2:case 3:var le=3;break;default:le=v}var he=v;v=le;try{return ne()}finally{v=he}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ne,le){switch(ne){case 1:case 2:case 3:case 4:case 5:break;default:ne=3}var he=v;v=ne;try{return le()}finally{v=he}},t.unstable_scheduleCallback=function(ne,le,he){var xe=t.unstable_now();switch(typeof he=="object"&&he!==null?(he=he.delay,he=typeof he=="number"&&0<he?xe+he:xe):he=xe,ne){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=he+Ie,ne={id:g++,callback:le,priorityLevel:ne,startTime:he,expirationTime:Ie,sortIndex:-1},he>xe?(ne.sortIndex=he,e(h,ne),n(l)===null&&ne===n(h)&&(b?(S(ee),ee=-1):b=!0,ce(F,he-xe))):(ne.sortIndex=Ie,e(l,ne),C||w||(C=!0,ve(H))),ne},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(ne){var le=v;return function(){var he=v;v=le;try{return ne.apply(this,arguments)}finally{v=he}}}})(iT);(function(t){t.exports=iT})(nT);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rT=Ee.exports,si=nT.exports;function de(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sT=new Set,Al={};function fo(t,e){Ca(t,e),Ca(t+"Capture",e)}function Ca(t,e){for(Al[t]=e,t=0;t<e.length;t++)sT.add(e[t])}var Tr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eg=Object.prototype.hasOwnProperty,jM=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,N_={},U_={};function WM(t){return eg.call(U_,t)?!0:eg.call(N_,t)?!1:jM.test(t)?U_[t]=!0:(N_[t]=!0,!1)}function QM(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function XM(t,e,n,i){if(e===null||typeof e>"u"||QM(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rn(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var fn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){fn[t]=new Rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];fn[e]=new Rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){fn[t]=new Rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){fn[t]=new Rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){fn[t]=new Rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){fn[t]=new Rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){fn[t]=new Rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){fn[t]=new Rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){fn[t]=new Rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Xp=/[\-:]([a-z])/g;function Jp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Xp,Jp);fn[e]=new Rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Xp,Jp);fn[e]=new Rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Xp,Jp);fn[e]=new Rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){fn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!1,!1)});fn.xlinkHref=new Rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){fn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Yp(t,e,n,i){var r=fn.hasOwnProperty(e)?fn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(XM(e,n,r,i)&&(n=null),i||r===null?WM(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Br=rT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Rc=Symbol.for("react.element"),Wo=Symbol.for("react.portal"),Qo=Symbol.for("react.fragment"),Kp=Symbol.for("react.strict_mode"),tg=Symbol.for("react.profiler"),oT=Symbol.for("react.provider"),aT=Symbol.for("react.context"),Zp=Symbol.for("react.forward_ref"),ng=Symbol.for("react.suspense"),ig=Symbol.for("react.suspense_list"),qp=Symbol.for("react.memo"),Kr=Symbol.for("react.lazy"),AT=Symbol.for("react.offscreen"),G_=Symbol.iterator;function hA(t){return t===null||typeof t!="object"?null:(t=G_&&t[G_]||t["@@iterator"],typeof t=="function"?t:null)}var Ot=Object.assign,ud;function FA(t){if(ud===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ud=e&&e[1]||""}return`
`+ud+t}var fd=!1;function hd(t,e){if(!t||fd)return"";fd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var i=h}Reflect.construct(t,[],e)}else{try{e.call()}catch(h){i=h}t.call(e.prototype)}else{try{throw Error()}catch(h){i=h}t()}}catch(h){if(h&&i&&typeof h.stack=="string"){for(var r=h.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{fd=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?FA(t):""}function JM(t){switch(t.tag){case 5:return FA(t.type);case 16:return FA("Lazy");case 13:return FA("Suspense");case 19:return FA("SuspenseList");case 0:case 2:case 15:return t=hd(t.type,!1),t;case 11:return t=hd(t.type.render,!1),t;case 1:return t=hd(t.type,!0),t;default:return""}}function rg(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Qo:return"Fragment";case Wo:return"Portal";case tg:return"Profiler";case Kp:return"StrictMode";case ng:return"Suspense";case ig:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case aT:return(t.displayName||"Context")+".Consumer";case oT:return(t._context.displayName||"Context")+".Provider";case Zp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case qp:return e=t.displayName||null,e!==null?e:rg(t.type)||"Memo";case Kr:e=t._payload,t=t._init;try{return rg(t(e))}catch{}}return null}function YM(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rg(e);case 8:return e===Kp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ds(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function lT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function KM(t){var e=lT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Oc(t){t._valueTracker||(t._valueTracker=KM(t))}function cT(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=lT(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function af(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function sg(t,e){var n=e.checked;return Ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function z_(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ds(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function uT(t,e){e=e.checked,e!=null&&Yp(t,"checked",e,!1)}function og(t,e){uT(t,e);var n=ds(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ag(t,e.type,n):e.hasOwnProperty("defaultValue")&&ag(t,e.type,ds(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function V_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ag(t,e,n){(e!=="number"||af(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var DA=Array.isArray;function ha(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ds(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Ag(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(de(91));return Ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function H_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(de(92));if(DA(n)){if(1<n.length)throw Error(de(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ds(n)}}function fT(t,e){var n=ds(e.value),i=ds(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function j_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lg(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Fc,dT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Fc=Fc||document.createElement("div"),Fc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ll(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var WA={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ZM=["Webkit","ms","Moz","O"];Object.keys(WA).forEach(function(t){ZM.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),WA[e]=WA[t]})});function gT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||WA.hasOwnProperty(t)&&WA[t]?(""+e).trim():e+"px"}function pT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=gT(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var qM=Ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cg(t,e){if(e){if(qM[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(de(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(de(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(de(61))}if(e.style!=null&&typeof e.style!="object")throw Error(de(62))}}function ug(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fg=null;function $p(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var hg=null,da=null,ga=null;function W_(t){if(t=Ql(t)){if(typeof hg!="function")throw Error(de(280));var e=t.stateNode;e&&(e=ah(e),hg(t.stateNode,t.type,e))}}function mT(t){da?ga?ga.push(t):ga=[t]:da=t}function _T(){if(da){var t=da,e=ga;if(ga=da=null,W_(t),e)for(t=0;t<e.length;t++)W_(e[t])}}function yT(t,e){return t(e)}function vT(){}var dd=!1;function ET(t,e,n){if(dd)return t(e,n);dd=!0;try{return yT(t,e,n)}finally{dd=!1,(da!==null||ga!==null)&&(vT(),_T())}}function cl(t,e){var n=t.stateNode;if(n===null)return null;var i=ah(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(de(231,e,typeof n));return n}var dg=!1;if(Tr)try{var dA={};Object.defineProperty(dA,"passive",{get:function(){dg=!0}}),window.addEventListener("test",dA,dA),window.removeEventListener("test",dA,dA)}catch{dg=!1}function $M(t,e,n,i,r,s,o,a,l){var h=Array.prototype.slice.call(arguments,3);try{e.apply(n,h)}catch(g){this.onError(g)}}var QA=!1,Af=null,lf=!1,gg=null,eI={onError:function(t){QA=!0,Af=t}};function tI(t,e,n,i,r,s,o,a,l){QA=!1,Af=null,$M.apply(eI,arguments)}function nI(t,e,n,i,r,s,o,a,l){if(tI.apply(this,arguments),QA){if(QA){var h=Af;QA=!1,Af=null}else throw Error(de(198));lf||(lf=!0,gg=h)}}function ho(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function wT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Q_(t){if(ho(t)!==t)throw Error(de(188))}function iI(t){var e=t.alternate;if(!e){if(e=ho(t),e===null)throw Error(de(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Q_(r),t;if(s===i)return Q_(r),e;s=s.sibling}throw Error(de(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(de(189))}}if(n.alternate!==i)throw Error(de(190))}if(n.tag!==3)throw Error(de(188));return n.stateNode.current===n?t:e}function TT(t){return t=iI(t),t!==null?CT(t):null}function CT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=CT(t);if(e!==null)return e;t=t.sibling}return null}var xT=si.unstable_scheduleCallback,X_=si.unstable_cancelCallback,rI=si.unstable_shouldYield,sI=si.unstable_requestPaint,Gt=si.unstable_now,oI=si.unstable_getCurrentPriorityLevel,em=si.unstable_ImmediatePriority,bT=si.unstable_UserBlockingPriority,cf=si.unstable_NormalPriority,aI=si.unstable_LowPriority,ST=si.unstable_IdlePriority,ih=null,Ar=null;function AI(t){if(Ar&&typeof Ar.onCommitFiberRoot=="function")try{Ar.onCommitFiberRoot(ih,t,void 0,(t.current.flags&128)===128)}catch{}}var Gi=Math.clz32?Math.clz32:uI,lI=Math.log,cI=Math.LN2;function uI(t){return t>>>=0,t===0?32:31-(lI(t)/cI|0)|0}var Dc=64,kc=4194304;function kA(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function uf(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=kA(a):(s&=o,s!==0&&(i=kA(s)))}else o=n&~r,o!==0?i=kA(o):s!==0&&(i=kA(s));if(i===0)return 0;if(e!==0&&e!==i&&(e&r)===0&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if((i&4)!==0&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Gi(e),r=1<<n,i|=t[n],e&=~r;return i}function fI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hI(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Gi(s),a=1<<o,l=r[o];l===-1?((a&n)===0||(a&i)!==0)&&(r[o]=fI(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function pg(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function PT(){var t=Dc;return Dc<<=1,(Dc&4194240)===0&&(Dc=64),t}function gd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function jl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gi(e),t[e]=n}function dI(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Gi(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function tm(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Gi(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ht=0;function MT(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var IT,nm,BT,LT,RT,mg=!1,Nc=[],ss=null,os=null,as=null,ul=new Map,fl=new Map,qr=[],gI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function J_(t,e){switch(t){case"focusin":case"focusout":ss=null;break;case"dragenter":case"dragleave":os=null;break;case"mouseover":case"mouseout":as=null;break;case"pointerover":case"pointerout":ul.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":fl.delete(e.pointerId)}}function gA(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Ql(e),e!==null&&nm(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function pI(t,e,n,i,r){switch(e){case"focusin":return ss=gA(ss,t,e,n,i,r),!0;case"dragenter":return os=gA(os,t,e,n,i,r),!0;case"mouseover":return as=gA(as,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return ul.set(s,gA(ul.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,fl.set(s,gA(fl.get(s)||null,t,e,n,i,r)),!0}return!1}function OT(t){var e=js(t.target);if(e!==null){var n=ho(e);if(n!==null){if(e=n.tag,e===13){if(e=wT(n),e!==null){t.blockedOn=e,RT(t.priority,function(){BT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ou(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=_g(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);fg=i,n.target.dispatchEvent(i),fg=null}else return e=Ql(n),e!==null&&nm(e),t.blockedOn=n,!1;e.shift()}return!0}function Y_(t,e,n){Ou(t)&&n.delete(e)}function mI(){mg=!1,ss!==null&&Ou(ss)&&(ss=null),os!==null&&Ou(os)&&(os=null),as!==null&&Ou(as)&&(as=null),ul.forEach(Y_),fl.forEach(Y_)}function pA(t,e){t.blockedOn===e&&(t.blockedOn=null,mg||(mg=!0,si.unstable_scheduleCallback(si.unstable_NormalPriority,mI)))}function hl(t){function e(r){return pA(r,t)}if(0<Nc.length){pA(Nc[0],t);for(var n=1;n<Nc.length;n++){var i=Nc[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ss!==null&&pA(ss,t),os!==null&&pA(os,t),as!==null&&pA(as,t),ul.forEach(e),fl.forEach(e),n=0;n<qr.length;n++)i=qr[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<qr.length&&(n=qr[0],n.blockedOn===null);)OT(n),n.blockedOn===null&&qr.shift()}var pa=Br.ReactCurrentBatchConfig,ff=!0;function _I(t,e,n,i){var r=ht,s=pa.transition;pa.transition=null;try{ht=1,im(t,e,n,i)}finally{ht=r,pa.transition=s}}function yI(t,e,n,i){var r=ht,s=pa.transition;pa.transition=null;try{ht=4,im(t,e,n,i)}finally{ht=r,pa.transition=s}}function im(t,e,n,i){if(ff){var r=_g(t,e,n,i);if(r===null)xd(t,e,i,hf,n),J_(t,i);else if(pI(r,t,e,n,i))i.stopPropagation();else if(J_(t,i),e&4&&-1<gI.indexOf(t)){for(;r!==null;){var s=Ql(r);if(s!==null&&IT(s),s=_g(t,e,n,i),s===null&&xd(t,e,i,hf,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else xd(t,e,i,null,n)}}var hf=null;function _g(t,e,n,i){if(hf=null,t=$p(i),t=js(t),t!==null)if(e=ho(t),e===null)t=null;else if(n=e.tag,n===13){if(t=wT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return hf=t,null}function FT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oI()){case em:return 1;case bT:return 4;case cf:case aI:return 16;case ST:return 536870912;default:return 16}default:return 16}}var ts=null,rm=null,Fu=null;function DT(){if(Fu)return Fu;var t,e=rm,n=e.length,i,r="value"in ts?ts.value:ts.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Fu=r.slice(t,1<i?1-i:void 0)}function Du(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Uc(){return!0}function K_(){return!1}function Ai(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Uc:K_,this.isPropagationStopped=K_,this}return Ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Uc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Uc)},persist:function(){},isPersistent:Uc}),e}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sm=Ai(Ga),Wl=Ot({},Ga,{view:0,detail:0}),vI=Ai(Wl),pd,md,mA,rh=Ot({},Wl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:om,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==mA&&(mA&&t.type==="mousemove"?(pd=t.screenX-mA.screenX,md=t.screenY-mA.screenY):md=pd=0,mA=t),pd)},movementY:function(t){return"movementY"in t?t.movementY:md}}),Z_=Ai(rh),EI=Ot({},rh,{dataTransfer:0}),wI=Ai(EI),TI=Ot({},Wl,{relatedTarget:0}),_d=Ai(TI),CI=Ot({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),xI=Ai(CI),bI=Ot({},Ga,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),SI=Ai(bI),PI=Ot({},Ga,{data:0}),q_=Ai(PI),MI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},II={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=BI[t])?!!e[t]:!1}function om(){return LI}var RI=Ot({},Wl,{key:function(t){if(t.key){var e=MI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Du(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?II[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:om,charCode:function(t){return t.type==="keypress"?Du(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Du(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),OI=Ai(RI),FI=Ot({},rh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$_=Ai(FI),DI=Ot({},Wl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:om}),kI=Ai(DI),NI=Ot({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),UI=Ai(NI),GI=Ot({},rh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zI=Ai(GI),VI=[9,13,27,32],am=Tr&&"CompositionEvent"in window,XA=null;Tr&&"documentMode"in document&&(XA=document.documentMode);var HI=Tr&&"TextEvent"in window&&!XA,kT=Tr&&(!am||XA&&8<XA&&11>=XA),ey=String.fromCharCode(32),ty=!1;function NT(t,e){switch(t){case"keyup":return VI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function UT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Xo=!1;function jI(t,e){switch(t){case"compositionend":return UT(e);case"keypress":return e.which!==32?null:(ty=!0,ey);case"textInput":return t=e.data,t===ey&&ty?null:t;default:return null}}function WI(t,e){if(Xo)return t==="compositionend"||!am&&NT(t,e)?(t=DT(),Fu=rm=ts=null,Xo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return kT&&e.locale!=="ko"?null:e.data;default:return null}}var QI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ny(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!QI[t.type]:e==="textarea"}function GT(t,e,n,i){mT(i),e=df(e,"onChange"),0<e.length&&(n=new sm("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var JA=null,dl=null;function XI(t){ZT(t,0)}function sh(t){var e=Ko(t);if(cT(e))return t}function JI(t,e){if(t==="change")return e}var zT=!1;if(Tr){var yd;if(Tr){var vd="oninput"in document;if(!vd){var iy=document.createElement("div");iy.setAttribute("oninput","return;"),vd=typeof iy.oninput=="function"}yd=vd}else yd=!1;zT=yd&&(!document.documentMode||9<document.documentMode)}function ry(){JA&&(JA.detachEvent("onpropertychange",VT),dl=JA=null)}function VT(t){if(t.propertyName==="value"&&sh(dl)){var e=[];GT(e,dl,t,$p(t)),ET(XI,e)}}function YI(t,e,n){t==="focusin"?(ry(),JA=e,dl=n,JA.attachEvent("onpropertychange",VT)):t==="focusout"&&ry()}function KI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return sh(dl)}function ZI(t,e){if(t==="click")return sh(e)}function qI(t,e){if(t==="input"||t==="change")return sh(e)}function $I(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ji=typeof Object.is=="function"?Object.is:$I;function gl(t,e){if(ji(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!eg.call(e,r)||!ji(t[r],e[r]))return!1}return!0}function sy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function oy(t,e){var n=sy(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=sy(n)}}function HT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?HT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function jT(){for(var t=window,e=af();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=af(t.document)}return e}function Am(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function eB(t){var e=jT(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&HT(n.ownerDocument.documentElement,n)){if(i!==null&&Am(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=oy(n,s);var o=oy(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var tB=Tr&&"documentMode"in document&&11>=document.documentMode,Jo=null,yg=null,YA=null,vg=!1;function ay(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;vg||Jo==null||Jo!==af(i)||(i=Jo,"selectionStart"in i&&Am(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),YA&&gl(YA,i)||(YA=i,i=df(yg,"onSelect"),0<i.length&&(e=new sm("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Jo)))}function Gc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Yo={animationend:Gc("Animation","AnimationEnd"),animationiteration:Gc("Animation","AnimationIteration"),animationstart:Gc("Animation","AnimationStart"),transitionend:Gc("Transition","TransitionEnd")},Ed={},WT={};Tr&&(WT=document.createElement("div").style,"AnimationEvent"in window||(delete Yo.animationend.animation,delete Yo.animationiteration.animation,delete Yo.animationstart.animation),"TransitionEvent"in window||delete Yo.transitionend.transition);function oh(t){if(Ed[t])return Ed[t];if(!Yo[t])return t;var e=Yo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in WT)return Ed[t]=e[n];return t}var QT=oh("animationend"),XT=oh("animationiteration"),JT=oh("animationstart"),YT=oh("transitionend"),KT=new Map,Ay="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Es(t,e){KT.set(t,e),fo(e,[t])}for(var wd=0;wd<Ay.length;wd++){var Td=Ay[wd],nB=Td.toLowerCase(),iB=Td[0].toUpperCase()+Td.slice(1);Es(nB,"on"+iB)}Es(QT,"onAnimationEnd");Es(XT,"onAnimationIteration");Es(JT,"onAnimationStart");Es("dblclick","onDoubleClick");Es("focusin","onFocus");Es("focusout","onBlur");Es(YT,"onTransitionEnd");Ca("onMouseEnter",["mouseout","mouseover"]);Ca("onMouseLeave",["mouseout","mouseover"]);Ca("onPointerEnter",["pointerout","pointerover"]);Ca("onPointerLeave",["pointerout","pointerover"]);fo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fo("onBeforeInput",["compositionend","keypress","textInput","paste"]);fo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var NA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rB=new Set("cancel close invalid load scroll toggle".split(" ").concat(NA));function ly(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,nI(i,e,void 0,t),t.currentTarget=null}function ZT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,h=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;ly(r,a,h),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,h=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;ly(r,a,h),s=l}}}if(lf)throw t=gg,lf=!1,gg=null,t}function xt(t,e){var n=e[xg];n===void 0&&(n=e[xg]=new Set);var i=t+"__bubble";n.has(i)||(qT(e,t,2,!1),n.add(i))}function Cd(t,e,n){var i=0;e&&(i|=4),qT(n,t,i,e)}var zc="_reactListening"+Math.random().toString(36).slice(2);function pl(t){if(!t[zc]){t[zc]=!0,sT.forEach(function(n){n!=="selectionchange"&&(rB.has(n)||Cd(n,!1,t),Cd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[zc]||(e[zc]=!0,Cd("selectionchange",!1,e))}}function qT(t,e,n,i){switch(FT(e)){case 1:var r=_I;break;case 4:r=yI;break;default:r=im}n=r.bind(null,e,n,t),r=void 0,!dg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function xd(t,e,n,i,r){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=js(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}ET(function(){var h=s,g=$p(n),m=[];e:{var v=KT.get(t);if(v!==void 0){var w=sm,C=t;switch(t){case"keypress":if(Du(n)===0)break e;case"keydown":case"keyup":w=OI;break;case"focusin":C="focus",w=_d;break;case"focusout":C="blur",w=_d;break;case"beforeblur":case"afterblur":w=_d;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=Z_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=wI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=kI;break;case QT:case XT:case JT:w=xI;break;case YT:w=UI;break;case"scroll":w=vI;break;case"wheel":w=zI;break;case"copy":case"cut":case"paste":w=SI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=$_}var b=(e&4)!==0,R=!b&&t==="scroll",S=b?v!==null?v+"Capture":null:v;b=[];for(var P=h,M;P!==null;){M=P;var F=M.stateNode;if(M.tag===5&&F!==null&&(M=F,S!==null&&(F=cl(P,S),F!=null&&b.push(ml(P,F,M)))),R)break;P=P.return}0<b.length&&(v=new w(v,C,null,n,g),m.push({event:v,listeners:b}))}}if((e&7)===0){e:{if(v=t==="mouseover"||t==="pointerover",w=t==="mouseout"||t==="pointerout",v&&n!==fg&&(C=n.relatedTarget||n.fromElement)&&(js(C)||C[Cr]))break e;if((w||v)&&(v=g.window===g?g:(v=g.ownerDocument)?v.defaultView||v.parentWindow:window,w?(C=n.relatedTarget||n.toElement,w=h,C=C?js(C):null,C!==null&&(R=ho(C),C!==R||C.tag!==5&&C.tag!==6)&&(C=null)):(w=null,C=h),w!==C)){if(b=Z_,F="onMouseLeave",S="onMouseEnter",P="mouse",(t==="pointerout"||t==="pointerover")&&(b=$_,F="onPointerLeave",S="onPointerEnter",P="pointer"),R=w==null?v:Ko(w),M=C==null?v:Ko(C),v=new b(F,P+"leave",w,n,g),v.target=R,v.relatedTarget=M,F=null,js(g)===h&&(b=new b(S,P+"enter",C,n,g),b.target=M,b.relatedTarget=R,F=b),R=F,w&&C)t:{for(b=w,S=C,P=0,M=b;M;M=Bo(M))P++;for(M=0,F=S;F;F=Bo(F))M++;for(;0<P-M;)b=Bo(b),P--;for(;0<M-P;)S=Bo(S),M--;for(;P--;){if(b===S||S!==null&&b===S.alternate)break t;b=Bo(b),S=Bo(S)}b=null}else b=null;w!==null&&cy(m,v,w,b,!1),C!==null&&R!==null&&cy(m,R,C,b,!0)}}e:{if(v=h?Ko(h):window,w=v.nodeName&&v.nodeName.toLowerCase(),w==="select"||w==="input"&&v.type==="file")var H=JI;else if(ny(v))if(zT)H=qI;else{H=KI;var j=YI}else(w=v.nodeName)&&w.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&(H=ZI);if(H&&(H=H(t,h))){GT(m,H,n,g);break e}j&&j(t,v,h),t==="focusout"&&(j=v._wrapperState)&&j.controlled&&v.type==="number"&&ag(v,"number",v.value)}switch(j=h?Ko(h):window,t){case"focusin":(ny(j)||j.contentEditable==="true")&&(Jo=j,yg=h,YA=null);break;case"focusout":YA=yg=Jo=null;break;case"mousedown":vg=!0;break;case"contextmenu":case"mouseup":case"dragend":vg=!1,ay(m,n,g);break;case"selectionchange":if(tB)break;case"keydown":case"keyup":ay(m,n,g)}var K;if(am)e:{switch(t){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else Xo?NT(t,n)&&(ee="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ee="onCompositionStart");ee&&(kT&&n.locale!=="ko"&&(Xo||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&Xo&&(K=DT()):(ts=g,rm="value"in ts?ts.value:ts.textContent,Xo=!0)),j=df(h,ee),0<j.length&&(ee=new q_(ee,t,null,n,g),m.push({event:ee,listeners:j}),K?ee.data=K:(K=UT(n),K!==null&&(ee.data=K)))),(K=HI?jI(t,n):WI(t,n))&&(h=df(h,"onBeforeInput"),0<h.length&&(g=new q_("onBeforeInput","beforeinput",null,n,g),m.push({event:g,listeners:h}),g.data=K))}ZT(m,e)})}function ml(t,e,n){return{instance:t,listener:e,currentTarget:n}}function df(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=cl(t,n),s!=null&&i.unshift(ml(t,s,r)),s=cl(t,e),s!=null&&i.push(ml(t,s,r))),t=t.return}return i}function Bo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function cy(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,h=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&h!==null&&(a=h,r?(l=cl(n,s),l!=null&&o.unshift(ml(n,l,a))):r||(l=cl(n,s),l!=null&&o.push(ml(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var sB=/\r\n?/g,oB=/\u0000|\uFFFD/g;function uy(t){return(typeof t=="string"?t:""+t).replace(sB,`
`).replace(oB,"")}function Vc(t,e,n){if(e=uy(e),uy(t)!==e&&n)throw Error(de(425))}function gf(){}var Eg=null,wg=null;function Tg(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cg=typeof setTimeout=="function"?setTimeout:void 0,aB=typeof clearTimeout=="function"?clearTimeout:void 0,fy=typeof Promise=="function"?Promise:void 0,AB=typeof queueMicrotask=="function"?queueMicrotask:typeof fy<"u"?function(t){return fy.resolve(null).then(t).catch(lB)}:Cg;function lB(t){setTimeout(function(){throw t})}function bd(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),hl(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);hl(e)}function As(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function hy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var za=Math.random().toString(36).slice(2),rr="__reactFiber$"+za,_l="__reactProps$"+za,Cr="__reactContainer$"+za,xg="__reactEvents$"+za,cB="__reactListeners$"+za,uB="__reactHandles$"+za;function js(t){var e=t[rr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Cr]||n[rr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=hy(t);t!==null;){if(n=t[rr])return n;t=hy(t)}return e}t=n,n=t.parentNode}return null}function Ql(t){return t=t[rr]||t[Cr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ko(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(de(33))}function ah(t){return t[_l]||null}var bg=[],Zo=-1;function ws(t){return{current:t}}function bt(t){0>Zo||(t.current=bg[Zo],bg[Zo]=null,Zo--)}function vt(t,e){Zo++,bg[Zo]=t.current,t.current=e}var gs={},Tn=ws(gs),zn=ws(!1),eo=gs;function xa(t,e){var n=t.type.contextTypes;if(!n)return gs;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Vn(t){return t=t.childContextTypes,t!=null}function pf(){bt(zn),bt(Tn)}function dy(t,e,n){if(Tn.current!==gs)throw Error(de(168));vt(Tn,e),vt(zn,n)}function $T(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(de(108,YM(t)||"Unknown",r));return Ot({},n,i)}function mf(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||gs,eo=Tn.current,vt(Tn,t),vt(zn,zn.current),!0}function gy(t,e,n){var i=t.stateNode;if(!i)throw Error(de(169));n?(t=$T(t,e,eo),i.__reactInternalMemoizedMergedChildContext=t,bt(zn),bt(Tn),vt(Tn,t)):bt(zn),vt(zn,n)}var mr=null,Ah=!1,Sd=!1;function eC(t){mr===null?mr=[t]:mr.push(t)}function fB(t){Ah=!0,eC(t)}function Ts(){if(!Sd&&mr!==null){Sd=!0;var t=0,e=ht;try{var n=mr;for(ht=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}mr=null,Ah=!1}catch(r){throw mr!==null&&(mr=mr.slice(t+1)),xT(em,Ts),r}finally{ht=e,Sd=!1}}return null}var qo=[],$o=0,_f=null,yf=0,gi=[],pi=0,to=null,yr=1,vr="";function zs(t,e){qo[$o++]=yf,qo[$o++]=_f,_f=t,yf=e}function tC(t,e,n){gi[pi++]=yr,gi[pi++]=vr,gi[pi++]=to,to=t;var i=yr;t=vr;var r=32-Gi(i)-1;i&=~(1<<r),n+=1;var s=32-Gi(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,yr=1<<32-Gi(e)+r|n<<r|i,vr=s+t}else yr=1<<s|n<<r|i,vr=t}function lm(t){t.return!==null&&(zs(t,1),tC(t,1,0))}function cm(t){for(;t===_f;)_f=qo[--$o],qo[$o]=null,yf=qo[--$o],qo[$o]=null;for(;t===to;)to=gi[--pi],gi[pi]=null,vr=gi[--pi],gi[pi]=null,yr=gi[--pi],gi[pi]=null}var ni=null,$n=null,Pt=!1,Fi=null;function nC(t,e){var n=_i(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function py(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ni=t,$n=As(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ni=t,$n=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=to!==null?{id:yr,overflow:vr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_i(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ni=t,$n=null,!0):!1;default:return!1}}function Sg(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Pg(t){if(Pt){var e=$n;if(e){var n=e;if(!py(t,e)){if(Sg(t))throw Error(de(418));e=As(n.nextSibling);var i=ni;e&&py(t,e)?nC(i,n):(t.flags=t.flags&-4097|2,Pt=!1,ni=t)}}else{if(Sg(t))throw Error(de(418));t.flags=t.flags&-4097|2,Pt=!1,ni=t}}}function my(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ni=t}function Hc(t){if(t!==ni)return!1;if(!Pt)return my(t),Pt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Tg(t.type,t.memoizedProps)),e&&(e=$n)){if(Sg(t))throw iC(),Error(de(418));for(;e;)nC(t,e),e=As(e.nextSibling)}if(my(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(de(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){$n=As(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}$n=null}}else $n=ni?As(t.stateNode.nextSibling):null;return!0}function iC(){for(var t=$n;t;)t=As(t.nextSibling)}function ba(){$n=ni=null,Pt=!1}function um(t){Fi===null?Fi=[t]:Fi.push(t)}var hB=Br.ReactCurrentBatchConfig;function Ri(t,e){if(t&&t.defaultProps){e=Ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var vf=ws(null),Ef=null,ea=null,fm=null;function hm(){fm=ea=Ef=null}function dm(t){var e=vf.current;bt(vf),t._currentValue=e}function Mg(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function ma(t,e){Ef=t,fm=ea=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Gn=!0),t.firstContext=null)}function Ei(t){var e=t._currentValue;if(fm!==t)if(t={context:t,memoizedValue:e,next:null},ea===null){if(Ef===null)throw Error(de(308));ea=t,Ef.dependencies={lanes:0,firstContext:t}}else ea=ea.next=t;return e}var Ws=null;function gm(t){Ws===null?Ws=[t]:Ws.push(t)}function rC(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,gm(e)):(n.next=r.next,r.next=n),e.interleaved=n,xr(t,i)}function xr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Zr=!1;function pm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sC(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Er(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ls(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,(ot&2)!==0){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,xr(t,n)}return r=i.interleaved,r===null?(e.next=e,gm(i)):(e.next=r.next,r.next=e),i.interleaved=e,xr(t,n)}function ku(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,tm(t,n)}}function _y(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function wf(t,e,n,i){var r=t.updateQueue;Zr=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,h=l.next;l.next=null,o===null?s=h:o.next=h,o=l;var g=t.alternate;g!==null&&(g=g.updateQueue,a=g.lastBaseUpdate,a!==o&&(a===null?g.firstBaseUpdate=h:a.next=h,g.lastBaseUpdate=l))}if(s!==null){var m=r.baseState;o=0,g=h=l=null,a=s;do{var v=a.lane,w=a.eventTime;if((i&v)===v){g!==null&&(g=g.next={eventTime:w,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var C=t,b=a;switch(v=e,w=n,b.tag){case 1:if(C=b.payload,typeof C=="function"){m=C.call(w,m,v);break e}m=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=b.payload,v=typeof C=="function"?C.call(w,m,v):C,v==null)break e;m=Ot({},m,v);break e;case 2:Zr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,v=r.effects,v===null?r.effects=[a]:v.push(a))}else w={eventTime:w,lane:v,tag:a.tag,payload:a.payload,callback:a.callback,next:null},g===null?(h=g=w,l=m):g=g.next=w,o|=v;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;v=a,a=v.next,v.next=null,r.lastBaseUpdate=v,r.shared.pending=null}}while(1);if(g===null&&(l=m),r.baseState=l,r.firstBaseUpdate=h,r.lastBaseUpdate=g,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);io|=o,t.lanes=o,t.memoizedState=m}}function yy(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(de(191,r));r.call(i)}}}var oC=new rT.Component().refs;function Ig(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var lh={isMounted:function(t){return(t=t._reactInternals)?ho(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=In(),r=us(t),s=Er(i,r);s.payload=e,n!=null&&(s.callback=n),e=ls(t,s,r),e!==null&&(zi(e,t,r,i),ku(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=In(),r=us(t),s=Er(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=ls(t,s,r),e!==null&&(zi(e,t,r,i),ku(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),i=us(t),r=Er(n,i);r.tag=2,e!=null&&(r.callback=e),e=ls(t,r,i),e!==null&&(zi(e,t,i,n),ku(e,t,i))}};function vy(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!gl(n,i)||!gl(r,s):!0}function aC(t,e,n){var i=!1,r=gs,s=e.contextType;return typeof s=="object"&&s!==null?s=Ei(s):(r=Vn(e)?eo:Tn.current,i=e.contextTypes,s=(i=i!=null)?xa(t,r):gs),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=lh,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Ey(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&lh.enqueueReplaceState(e,e.state,null)}function Bg(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=oC,pm(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ei(s):(s=Vn(e)?eo:Tn.current,r.context=xa(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Ig(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&lh.enqueueReplaceState(r,r.state,null),wf(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function _A(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(de(309));var i=n.stateNode}if(!i)throw Error(de(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===oC&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(de(284));if(!n._owner)throw Error(de(290,t))}return t}function jc(t,e){throw t=Object.prototype.toString.call(e),Error(de(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function wy(t){var e=t._init;return e(t._payload)}function AC(t){function e(S,P){if(t){var M=S.deletions;M===null?(S.deletions=[P],S.flags|=16):M.push(P)}}function n(S,P){if(!t)return null;for(;P!==null;)e(S,P),P=P.sibling;return null}function i(S,P){for(S=new Map;P!==null;)P.key!==null?S.set(P.key,P):S.set(P.index,P),P=P.sibling;return S}function r(S,P){return S=fs(S,P),S.index=0,S.sibling=null,S}function s(S,P,M){return S.index=M,t?(M=S.alternate,M!==null?(M=M.index,M<P?(S.flags|=2,P):M):(S.flags|=2,P)):(S.flags|=1048576,P)}function o(S){return t&&S.alternate===null&&(S.flags|=2),S}function a(S,P,M,F){return P===null||P.tag!==6?(P=Od(M,S.mode,F),P.return=S,P):(P=r(P,M),P.return=S,P)}function l(S,P,M,F){var H=M.type;return H===Qo?g(S,P,M.props.children,F,M.key):P!==null&&(P.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Kr&&wy(H)===P.type)?(F=r(P,M.props),F.ref=_A(S,P,M),F.return=S,F):(F=Hu(M.type,M.key,M.props,null,S.mode,F),F.ref=_A(S,P,M),F.return=S,F)}function h(S,P,M,F){return P===null||P.tag!==4||P.stateNode.containerInfo!==M.containerInfo||P.stateNode.implementation!==M.implementation?(P=Fd(M,S.mode,F),P.return=S,P):(P=r(P,M.children||[]),P.return=S,P)}function g(S,P,M,F,H){return P===null||P.tag!==7?(P=Ks(M,S.mode,F,H),P.return=S,P):(P=r(P,M),P.return=S,P)}function m(S,P,M){if(typeof P=="string"&&P!==""||typeof P=="number")return P=Od(""+P,S.mode,M),P.return=S,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Rc:return M=Hu(P.type,P.key,P.props,null,S.mode,M),M.ref=_A(S,null,P),M.return=S,M;case Wo:return P=Fd(P,S.mode,M),P.return=S,P;case Kr:var F=P._init;return m(S,F(P._payload),M)}if(DA(P)||hA(P))return P=Ks(P,S.mode,M,null),P.return=S,P;jc(S,P)}return null}function v(S,P,M,F){var H=P!==null?P.key:null;if(typeof M=="string"&&M!==""||typeof M=="number")return H!==null?null:a(S,P,""+M,F);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Rc:return M.key===H?l(S,P,M,F):null;case Wo:return M.key===H?h(S,P,M,F):null;case Kr:return H=M._init,v(S,P,H(M._payload),F)}if(DA(M)||hA(M))return H!==null?null:g(S,P,M,F,null);jc(S,M)}return null}function w(S,P,M,F,H){if(typeof F=="string"&&F!==""||typeof F=="number")return S=S.get(M)||null,a(P,S,""+F,H);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Rc:return S=S.get(F.key===null?M:F.key)||null,l(P,S,F,H);case Wo:return S=S.get(F.key===null?M:F.key)||null,h(P,S,F,H);case Kr:var j=F._init;return w(S,P,M,j(F._payload),H)}if(DA(F)||hA(F))return S=S.get(M)||null,g(P,S,F,H,null);jc(P,F)}return null}function C(S,P,M,F){for(var H=null,j=null,K=P,ee=P=0,X=null;K!==null&&ee<M.length;ee++){K.index>ee?(X=K,K=null):X=K.sibling;var U=v(S,K,M[ee],F);if(U===null){K===null&&(K=X);break}t&&K&&U.alternate===null&&e(S,K),P=s(U,P,ee),j===null?H=U:j.sibling=U,j=U,K=X}if(ee===M.length)return n(S,K),Pt&&zs(S,ee),H;if(K===null){for(;ee<M.length;ee++)K=m(S,M[ee],F),K!==null&&(P=s(K,P,ee),j===null?H=K:j.sibling=K,j=K);return Pt&&zs(S,ee),H}for(K=i(S,K);ee<M.length;ee++)X=w(K,S,ee,M[ee],F),X!==null&&(t&&X.alternate!==null&&K.delete(X.key===null?ee:X.key),P=s(X,P,ee),j===null?H=X:j.sibling=X,j=X);return t&&K.forEach(function(D){return e(S,D)}),Pt&&zs(S,ee),H}function b(S,P,M,F){var H=hA(M);if(typeof H!="function")throw Error(de(150));if(M=H.call(M),M==null)throw Error(de(151));for(var j=H=null,K=P,ee=P=0,X=null,U=M.next();K!==null&&!U.done;ee++,U=M.next()){K.index>ee?(X=K,K=null):X=K.sibling;var D=v(S,K,U.value,F);if(D===null){K===null&&(K=X);break}t&&K&&D.alternate===null&&e(S,K),P=s(D,P,ee),j===null?H=D:j.sibling=D,j=D,K=X}if(U.done)return n(S,K),Pt&&zs(S,ee),H;if(K===null){for(;!U.done;ee++,U=M.next())U=m(S,U.value,F),U!==null&&(P=s(U,P,ee),j===null?H=U:j.sibling=U,j=U);return Pt&&zs(S,ee),H}for(K=i(S,K);!U.done;ee++,U=M.next())U=w(K,S,ee,U.value,F),U!==null&&(t&&U.alternate!==null&&K.delete(U.key===null?ee:U.key),P=s(U,P,ee),j===null?H=U:j.sibling=U,j=U);return t&&K.forEach(function(ae){return e(S,ae)}),Pt&&zs(S,ee),H}function R(S,P,M,F){if(typeof M=="object"&&M!==null&&M.type===Qo&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case Rc:e:{for(var H=M.key,j=P;j!==null;){if(j.key===H){if(H=M.type,H===Qo){if(j.tag===7){n(S,j.sibling),P=r(j,M.props.children),P.return=S,S=P;break e}}else if(j.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Kr&&wy(H)===j.type){n(S,j.sibling),P=r(j,M.props),P.ref=_A(S,j,M),P.return=S,S=P;break e}n(S,j);break}else e(S,j);j=j.sibling}M.type===Qo?(P=Ks(M.props.children,S.mode,F,M.key),P.return=S,S=P):(F=Hu(M.type,M.key,M.props,null,S.mode,F),F.ref=_A(S,P,M),F.return=S,S=F)}return o(S);case Wo:e:{for(j=M.key;P!==null;){if(P.key===j)if(P.tag===4&&P.stateNode.containerInfo===M.containerInfo&&P.stateNode.implementation===M.implementation){n(S,P.sibling),P=r(P,M.children||[]),P.return=S,S=P;break e}else{n(S,P);break}else e(S,P);P=P.sibling}P=Fd(M,S.mode,F),P.return=S,S=P}return o(S);case Kr:return j=M._init,R(S,P,j(M._payload),F)}if(DA(M))return C(S,P,M,F);if(hA(M))return b(S,P,M,F);jc(S,M)}return typeof M=="string"&&M!==""||typeof M=="number"?(M=""+M,P!==null&&P.tag===6?(n(S,P.sibling),P=r(P,M),P.return=S,S=P):(n(S,P),P=Od(M,S.mode,F),P.return=S,S=P),o(S)):n(S,P)}return R}var Sa=AC(!0),lC=AC(!1),Xl={},lr=ws(Xl),yl=ws(Xl),vl=ws(Xl);function Qs(t){if(t===Xl)throw Error(de(174));return t}function mm(t,e){switch(vt(vl,e),vt(yl,t),vt(lr,Xl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lg(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=lg(e,t)}bt(lr),vt(lr,e)}function Pa(){bt(lr),bt(yl),bt(vl)}function cC(t){Qs(vl.current);var e=Qs(lr.current),n=lg(e,t.type);e!==n&&(vt(yl,t),vt(lr,n))}function _m(t){yl.current===t&&(bt(lr),bt(yl))}var It=ws(0);function Tf(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Pd=[];function ym(){for(var t=0;t<Pd.length;t++)Pd[t]._workInProgressVersionPrimary=null;Pd.length=0}var Nu=Br.ReactCurrentDispatcher,Md=Br.ReactCurrentBatchConfig,no=0,Rt=null,Yt=null,rn=null,Cf=!1,KA=!1,El=0,dB=0;function pn(){throw Error(de(321))}function vm(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ji(t[n],e[n]))return!1;return!0}function Em(t,e,n,i,r,s){if(no=s,Rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Nu.current=t===null||t.memoizedState===null?_B:yB,t=n(i,r),KA){s=0;do{if(KA=!1,El=0,25<=s)throw Error(de(301));s+=1,rn=Yt=null,e.updateQueue=null,Nu.current=vB,t=n(i,r)}while(KA)}if(Nu.current=xf,e=Yt!==null&&Yt.next!==null,no=0,rn=Yt=Rt=null,Cf=!1,e)throw Error(de(300));return t}function wm(){var t=El!==0;return El=0,t}function nr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?Rt.memoizedState=rn=t:rn=rn.next=t,rn}function wi(){if(Yt===null){var t=Rt.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var e=rn===null?Rt.memoizedState:rn.next;if(e!==null)rn=e,Yt=t;else{if(t===null)throw Error(de(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},rn===null?Rt.memoizedState=rn=t:rn=rn.next=t}return rn}function wl(t,e){return typeof e=="function"?e(t):e}function Id(t){var e=wi(),n=e.queue;if(n===null)throw Error(de(311));n.lastRenderedReducer=t;var i=Yt,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,h=s;do{var g=h.lane;if((no&g)===g)l!==null&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),i=h.hasEagerState?h.eagerState:t(i,h.action);else{var m={lane:g,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};l===null?(a=l=m,o=i):l=l.next=m,Rt.lanes|=g,io|=g}h=h.next}while(h!==null&&h!==s);l===null?o=i:l.next=a,ji(i,e.memoizedState)||(Gn=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Rt.lanes|=s,io|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Bd(t){var e=wi(),n=e.queue;if(n===null)throw Error(de(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);ji(s,e.memoizedState)||(Gn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function uC(){}function fC(t,e){var n=Rt,i=wi(),r=e(),s=!ji(i.memoizedState,r);if(s&&(i.memoizedState=r,Gn=!0),i=i.queue,Tm(gC.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||rn!==null&&rn.memoizedState.tag&1){if(n.flags|=2048,Tl(9,dC.bind(null,n,i,r,e),void 0,null),an===null)throw Error(de(349));(no&30)!==0||hC(n,e,r)}return r}function hC(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function dC(t,e,n,i){e.value=n,e.getSnapshot=i,pC(e)&&mC(t)}function gC(t,e,n){return n(function(){pC(e)&&mC(t)})}function pC(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ji(t,n)}catch{return!0}}function mC(t){var e=xr(t,1);e!==null&&zi(e,t,1,-1)}function Ty(t){var e=nr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wl,lastRenderedState:t},e.queue=t,t=t.dispatch=mB.bind(null,Rt,t),[e.memoizedState,t]}function Tl(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Rt.updateQueue,e===null?(e={lastEffect:null,stores:null},Rt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function _C(){return wi().memoizedState}function Uu(t,e,n,i){var r=nr();Rt.flags|=t,r.memoizedState=Tl(1|e,n,void 0,i===void 0?null:i)}function ch(t,e,n,i){var r=wi();i=i===void 0?null:i;var s=void 0;if(Yt!==null){var o=Yt.memoizedState;if(s=o.destroy,i!==null&&vm(i,o.deps)){r.memoizedState=Tl(e,n,s,i);return}}Rt.flags|=t,r.memoizedState=Tl(1|e,n,s,i)}function Cy(t,e){return Uu(8390656,8,t,e)}function Tm(t,e){return ch(2048,8,t,e)}function yC(t,e){return ch(4,2,t,e)}function vC(t,e){return ch(4,4,t,e)}function EC(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wC(t,e,n){return n=n!=null?n.concat([t]):null,ch(4,4,EC.bind(null,e,t),n)}function Cm(){}function TC(t,e){var n=wi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&vm(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function CC(t,e){var n=wi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&vm(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function xC(t,e,n){return(no&21)===0?(t.baseState&&(t.baseState=!1,Gn=!0),t.memoizedState=n):(ji(n,e)||(n=PT(),Rt.lanes|=n,io|=n,t.baseState=!0),e)}function gB(t,e){var n=ht;ht=n!==0&&4>n?n:4,t(!0);var i=Md.transition;Md.transition={};try{t(!1),e()}finally{ht=n,Md.transition=i}}function bC(){return wi().memoizedState}function pB(t,e,n){var i=us(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},SC(t))PC(e,n);else if(n=rC(t,e,n,i),n!==null){var r=In();zi(n,t,i,r),MC(n,e,i)}}function mB(t,e,n){var i=us(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(SC(t))PC(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ji(a,o)){var l=e.interleaved;l===null?(r.next=r,gm(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=rC(t,e,r,i),n!==null&&(r=In(),zi(n,t,i,r),MC(n,e,i))}}function SC(t){var e=t.alternate;return t===Rt||e!==null&&e===Rt}function PC(t,e){KA=Cf=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function MC(t,e,n){if((n&4194240)!==0){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,tm(t,n)}}var xf={readContext:Ei,useCallback:pn,useContext:pn,useEffect:pn,useImperativeHandle:pn,useInsertionEffect:pn,useLayoutEffect:pn,useMemo:pn,useReducer:pn,useRef:pn,useState:pn,useDebugValue:pn,useDeferredValue:pn,useTransition:pn,useMutableSource:pn,useSyncExternalStore:pn,useId:pn,unstable_isNewReconciler:!1},_B={readContext:Ei,useCallback:function(t,e){return nr().memoizedState=[t,e===void 0?null:e],t},useContext:Ei,useEffect:Cy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Uu(4194308,4,EC.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Uu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Uu(4,2,t,e)},useMemo:function(t,e){var n=nr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=nr();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=pB.bind(null,Rt,t),[i.memoizedState,t]},useRef:function(t){var e=nr();return t={current:t},e.memoizedState=t},useState:Ty,useDebugValue:Cm,useDeferredValue:function(t){return nr().memoizedState=t},useTransition:function(){var t=Ty(!1),e=t[0];return t=gB.bind(null,t[1]),nr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Rt,r=nr();if(Pt){if(n===void 0)throw Error(de(407));n=n()}else{if(n=e(),an===null)throw Error(de(349));(no&30)!==0||hC(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Cy(gC.bind(null,i,s,t),[t]),i.flags|=2048,Tl(9,dC.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=nr(),e=an.identifierPrefix;if(Pt){var n=vr,i=yr;n=(i&~(1<<32-Gi(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=El++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=dB++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},yB={readContext:Ei,useCallback:TC,useContext:Ei,useEffect:Tm,useImperativeHandle:wC,useInsertionEffect:yC,useLayoutEffect:vC,useMemo:CC,useReducer:Id,useRef:_C,useState:function(){return Id(wl)},useDebugValue:Cm,useDeferredValue:function(t){var e=wi();return xC(e,Yt.memoizedState,t)},useTransition:function(){var t=Id(wl)[0],e=wi().memoizedState;return[t,e]},useMutableSource:uC,useSyncExternalStore:fC,useId:bC,unstable_isNewReconciler:!1},vB={readContext:Ei,useCallback:TC,useContext:Ei,useEffect:Tm,useImperativeHandle:wC,useInsertionEffect:yC,useLayoutEffect:vC,useMemo:CC,useReducer:Bd,useRef:_C,useState:function(){return Bd(wl)},useDebugValue:Cm,useDeferredValue:function(t){var e=wi();return Yt===null?e.memoizedState=t:xC(e,Yt.memoizedState,t)},useTransition:function(){var t=Bd(wl)[0],e=wi().memoizedState;return[t,e]},useMutableSource:uC,useSyncExternalStore:fC,useId:bC,unstable_isNewReconciler:!1};function Ma(t,e){try{var n="",i=e;do n+=JM(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Ld(t,e,n){return{value:t,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function Lg(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var EB=typeof WeakMap=="function"?WeakMap:Map;function IC(t,e,n){n=Er(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Sf||(Sf=!0,Vg=i),Lg(t,e)},n}function BC(t,e,n){n=Er(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Lg(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Lg(t,e),typeof i!="function"&&(cs===null?cs=new Set([this]):cs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function xy(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new EB;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=FB.bind(null,t,e,n),e.then(t,t))}function by(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Sy(t,e,n,i,r){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Er(-1,1),e.tag=2,ls(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var wB=Br.ReactCurrentOwner,Gn=!1;function Pn(t,e,n,i){e.child=t===null?lC(e,null,n,i):Sa(e,t.child,n,i)}function Py(t,e,n,i,r){n=n.render;var s=e.ref;return ma(e,r),i=Em(t,e,n,i,s,r),n=wm(),t!==null&&!Gn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,br(t,e,r)):(Pt&&n&&lm(e),e.flags|=1,Pn(t,e,i,r),e.child)}function My(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Lm(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,LC(t,e,s,i,r)):(t=Hu(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&r)===0){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:gl,n(o,i)&&t.ref===e.ref)return br(t,e,r)}return e.flags|=1,t=fs(s,i),t.ref=e.ref,t.return=e,e.child=t}function LC(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(gl(s,i)&&t.ref===e.ref)if(Gn=!1,e.pendingProps=i=s,(t.lanes&r)!==0)(t.flags&131072)!==0&&(Gn=!0);else return e.lanes=t.lanes,br(t,e,r)}return Rg(t,e,n,i,r)}function RC(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(na,qn),qn|=n;else{if((n&1073741824)===0)return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,vt(na,qn),qn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,vt(na,qn),qn|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,vt(na,qn),qn|=i;return Pn(t,e,r,n),e.child}function OC(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Rg(t,e,n,i,r){var s=Vn(n)?eo:Tn.current;return s=xa(e,s),ma(e,r),n=Em(t,e,n,i,s,r),i=wm(),t!==null&&!Gn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,br(t,e,r)):(Pt&&i&&lm(e),e.flags|=1,Pn(t,e,n,r),e.child)}function Iy(t,e,n,i,r){if(Vn(n)){var s=!0;mf(e)}else s=!1;if(ma(e,r),e.stateNode===null)Gu(t,e),aC(e,n,i),Bg(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,h=n.contextType;typeof h=="object"&&h!==null?h=Ei(h):(h=Vn(n)?eo:Tn.current,h=xa(e,h));var g=n.getDerivedStateFromProps,m=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==h)&&Ey(e,o,i,h),Zr=!1;var v=e.memoizedState;o.state=v,wf(e,i,o,r),l=e.memoizedState,a!==i||v!==l||zn.current||Zr?(typeof g=="function"&&(Ig(e,n,g,i),l=e.memoizedState),(a=Zr||vy(e,n,a,i,v,l,h))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=h,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,sC(t,e),a=e.memoizedProps,h=e.type===e.elementType?a:Ri(e.type,a),o.props=h,m=e.pendingProps,v=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Ei(l):(l=Vn(n)?eo:Tn.current,l=xa(e,l));var w=n.getDerivedStateFromProps;(g=typeof w=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==m||v!==l)&&Ey(e,o,i,l),Zr=!1,v=e.memoizedState,o.state=v,wf(e,i,o,r);var C=e.memoizedState;a!==m||v!==C||zn.current||Zr?(typeof w=="function"&&(Ig(e,n,w,i),C=e.memoizedState),(h=Zr||vy(e,n,h,i,v,C,l)||!1)?(g||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,C,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,C,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=C),o.props=i,o.state=C,o.context=l,i=h):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),i=!1)}return Og(t,e,n,i,s,r)}function Og(t,e,n,i,r,s){OC(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&gy(e,n,!1),br(t,e,s);i=e.stateNode,wB.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Sa(e,t.child,null,s),e.child=Sa(e,null,a,s)):Pn(t,e,a,s),e.memoizedState=i.state,r&&gy(e,n,!0),e.child}function FC(t){var e=t.stateNode;e.pendingContext?dy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&dy(t,e.context,!1),mm(t,e.containerInfo)}function By(t,e,n,i,r){return ba(),um(r),e.flags|=256,Pn(t,e,n,i),e.child}var Fg={dehydrated:null,treeContext:null,retryLane:0};function Dg(t){return{baseLanes:t,cachePool:null,transitions:null}}function DC(t,e,n){var i=e.pendingProps,r=It.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),vt(It,r&1),t===null)return Pg(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},(i&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=o):s=hh(o,i,0,null),t=Ks(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Dg(n),e.memoizedState=Fg,t):xm(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return TB(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=fs(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=fs(a,s):(s=Ks(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Dg(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Fg,i}return s=t.child,t=s.sibling,i=fs(s,{mode:"visible",children:i.children}),(e.mode&1)===0&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function xm(t,e){return e=hh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Wc(t,e,n,i){return i!==null&&um(i),Sa(e,t.child,null,n),t=xm(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function TB(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Ld(Error(de(422))),Wc(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=hh({mode:"visible",children:i.children},r,0,null),s=Ks(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,(e.mode&1)!==0&&Sa(e,t.child,null,o),e.child.memoizedState=Dg(o),e.memoizedState=Fg,s);if((e.mode&1)===0)return Wc(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(de(419)),i=Ld(s,i,void 0),Wc(t,e,o,i)}if(a=(o&t.childLanes)!==0,Gn||a){if(i=an,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=(r&(i.suspendedLanes|o))!==0?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,xr(t,r),zi(i,t,r,-1))}return Bm(),i=Ld(Error(de(421))),Wc(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=DB.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,$n=As(r.nextSibling),ni=e,Pt=!0,Fi=null,t!==null&&(gi[pi++]=yr,gi[pi++]=vr,gi[pi++]=to,yr=t.id,vr=t.overflow,to=e),e=xm(e,i.children),e.flags|=4096,e)}function Ly(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Mg(t.return,e,n)}function Rd(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function kC(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Pn(t,e,i.children,n),i=It.current,(i&2)!==0)i=i&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ly(t,n,e);else if(t.tag===19)Ly(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(vt(It,i),(e.mode&1)===0)e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Tf(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Rd(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Tf(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Rd(e,!0,n,null,s);break;case"together":Rd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gu(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function br(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),io|=e.lanes,(n&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(de(153));if(e.child!==null){for(t=e.child,n=fs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=fs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function CB(t,e,n){switch(e.tag){case 3:FC(e),ba();break;case 5:cC(e);break;case 1:Vn(e.type)&&mf(e);break;case 4:mm(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;vt(vf,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(vt(It,It.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?DC(t,e,n):(vt(It,It.current&1),t=br(t,e,n),t!==null?t.sibling:null);vt(It,It.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&128)!==0){if(i)return kC(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),vt(It,It.current),i)break;return null;case 22:case 23:return e.lanes=0,RC(t,e,n)}return br(t,e,n)}var NC,kg,UC,GC;NC=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};kg=function(){};UC=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Qs(lr.current);var s=null;switch(n){case"input":r=sg(t,r),i=sg(t,i),s=[];break;case"select":r=Ot({},r,{value:void 0}),i=Ot({},i,{value:void 0}),s=[];break;case"textarea":r=Ag(t,r),i=Ag(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=gf)}cg(n,i);var o;n=null;for(h in r)if(!i.hasOwnProperty(h)&&r.hasOwnProperty(h)&&r[h]!=null)if(h==="style"){var a=r[h];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Al.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in i){var l=i[h];if(a=r!=null?r[h]:void 0,i.hasOwnProperty(h)&&l!==a&&(l!=null||a!=null))if(h==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(h,n)),n=l;else h==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(h,l)):h==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(h,""+l):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(Al.hasOwnProperty(h)?(l!=null&&h==="onScroll"&&xt("scroll",t),s||a===l||(s=[])):(s=s||[]).push(h,l))}n&&(s=s||[]).push("style",n);var h=s;(e.updateQueue=h)&&(e.flags|=4)}};GC=function(t,e,n,i){n!==i&&(e.flags|=4)};function yA(t,e){if(!Pt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function mn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function xB(t,e,n){var i=e.pendingProps;switch(cm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mn(e),null;case 1:return Vn(e.type)&&pf(),mn(e),null;case 3:return i=e.stateNode,Pa(),bt(zn),bt(Tn),ym(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Hc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Fi!==null&&(Wg(Fi),Fi=null))),kg(t,e),mn(e),null;case 5:_m(e);var r=Qs(vl.current);if(n=e.type,t!==null&&e.stateNode!=null)UC(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(de(166));return mn(e),null}if(t=Qs(lr.current),Hc(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[rr]=e,i[_l]=s,t=(e.mode&1)!==0,n){case"dialog":xt("cancel",i),xt("close",i);break;case"iframe":case"object":case"embed":xt("load",i);break;case"video":case"audio":for(r=0;r<NA.length;r++)xt(NA[r],i);break;case"source":xt("error",i);break;case"img":case"image":case"link":xt("error",i),xt("load",i);break;case"details":xt("toggle",i);break;case"input":z_(i,s),xt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},xt("invalid",i);break;case"textarea":H_(i,s),xt("invalid",i)}cg(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Vc(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Vc(i.textContent,a,t),r=["children",""+a]):Al.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&xt("scroll",i)}switch(n){case"input":Oc(i),V_(i,s,!0);break;case"textarea":Oc(i),j_(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=gf)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[rr]=e,t[_l]=i,NC(t,e,!1,!1),e.stateNode=t;e:{switch(o=ug(n,i),n){case"dialog":xt("cancel",t),xt("close",t),r=i;break;case"iframe":case"object":case"embed":xt("load",t),r=i;break;case"video":case"audio":for(r=0;r<NA.length;r++)xt(NA[r],t);r=i;break;case"source":xt("error",t),r=i;break;case"img":case"image":case"link":xt("error",t),xt("load",t),r=i;break;case"details":xt("toggle",t),r=i;break;case"input":z_(t,i),r=sg(t,i),xt("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Ot({},i,{value:void 0}),xt("invalid",t);break;case"textarea":H_(t,i),r=Ag(t,i),xt("invalid",t);break;default:r=i}cg(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?pT(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&dT(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&ll(t,l):typeof l=="number"&&ll(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Al.hasOwnProperty(s)?l!=null&&s==="onScroll"&&xt("scroll",t):l!=null&&Yp(t,s,l,o))}switch(n){case"input":Oc(t),V_(t,i,!1);break;case"textarea":Oc(t),j_(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ds(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ha(t,!!i.multiple,s,!1):i.defaultValue!=null&&ha(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=gf)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return mn(e),null;case 6:if(t&&e.stateNode!=null)GC(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(de(166));if(n=Qs(vl.current),Qs(lr.current),Hc(e)){if(i=e.stateNode,n=e.memoizedProps,i[rr]=e,(s=i.nodeValue!==n)&&(t=ni,t!==null))switch(t.tag){case 3:Vc(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Vc(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[rr]=e,e.stateNode=i}return mn(e),null;case 13:if(bt(It),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pt&&$n!==null&&(e.mode&1)!==0&&(e.flags&128)===0)iC(),ba(),e.flags|=98560,s=!1;else if(s=Hc(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(de(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(de(317));s[rr]=e}else ba(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;mn(e),s=!1}else Fi!==null&&(Wg(Fi),Fi=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(It.current&1)!==0?Kt===0&&(Kt=3):Bm())),e.updateQueue!==null&&(e.flags|=4),mn(e),null);case 4:return Pa(),kg(t,e),t===null&&pl(e.stateNode.containerInfo),mn(e),null;case 10:return dm(e.type._context),mn(e),null;case 17:return Vn(e.type)&&pf(),mn(e),null;case 19:if(bt(It),s=e.memoizedState,s===null)return mn(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)yA(s,!1);else{if(Kt!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(o=Tf(t),o!==null){for(e.flags|=128,yA(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return vt(It,It.current&1|2),e.child}t=t.sibling}s.tail!==null&&Gt()>Ia&&(e.flags|=128,i=!0,yA(s,!1),e.lanes=4194304)}else{if(!i)if(t=Tf(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),yA(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Pt)return mn(e),null}else 2*Gt()-s.renderingStartTime>Ia&&n!==1073741824&&(e.flags|=128,i=!0,yA(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Gt(),e.sibling=null,n=It.current,vt(It,i?n&1|2:n&1),e):(mn(e),null);case 22:case 23:return Im(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&(e.mode&1)!==0?(qn&1073741824)!==0&&(mn(e),e.subtreeFlags&6&&(e.flags|=8192)):mn(e),null;case 24:return null;case 25:return null}throw Error(de(156,e.tag))}function bB(t,e){switch(cm(e),e.tag){case 1:return Vn(e.type)&&pf(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Pa(),bt(zn),bt(Tn),ym(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return _m(e),null;case 13:if(bt(It),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(de(340));ba()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return bt(It),null;case 4:return Pa(),null;case 10:return dm(e.type._context),null;case 22:case 23:return Im(),null;case 24:return null;default:return null}}var Qc=!1,En=!1,SB=typeof WeakSet=="function"?WeakSet:Set,Be=null;function ta(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Ut(t,e,i)}else n.current=null}function Ng(t,e,n){try{n()}catch(i){Ut(t,e,i)}}var Ry=!1;function PB(t,e){if(Eg=ff,t=jT(),Am(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,h=0,g=0,m=t,v=null;t:for(;;){for(var w;m!==n||r!==0&&m.nodeType!==3||(a=o+r),m!==s||i!==0&&m.nodeType!==3||(l=o+i),m.nodeType===3&&(o+=m.nodeValue.length),(w=m.firstChild)!==null;)v=m,m=w;for(;;){if(m===t)break t;if(v===n&&++h===r&&(a=o),v===s&&++g===i&&(l=o),(w=m.nextSibling)!==null)break;m=v,v=m.parentNode}m=w}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(wg={focusedElem:t,selectionRange:n},ff=!1,Be=e;Be!==null;)if(e=Be,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Be=t;else for(;Be!==null;){e=Be;try{var C=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var b=C.memoizedProps,R=C.memoizedState,S=e.stateNode,P=S.getSnapshotBeforeUpdate(e.elementType===e.type?b:Ri(e.type,b),R);S.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var M=e.stateNode.containerInfo;M.nodeType===1?M.textContent="":M.nodeType===9&&M.documentElement&&M.removeChild(M.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(F){Ut(e,e.return,F)}if(t=e.sibling,t!==null){t.return=e.return,Be=t;break}Be=e.return}return C=Ry,Ry=!1,C}function ZA(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Ng(e,n,s)}r=r.next}while(r!==i)}}function uh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Ug(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function zC(t){var e=t.alternate;e!==null&&(t.alternate=null,zC(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[rr],delete e[_l],delete e[xg],delete e[cB],delete e[uB])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function VC(t){return t.tag===5||t.tag===3||t.tag===4}function Oy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||VC(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Gg(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=gf));else if(i!==4&&(t=t.child,t!==null))for(Gg(t,e,n),t=t.sibling;t!==null;)Gg(t,e,n),t=t.sibling}function zg(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(zg(t,e,n),t=t.sibling;t!==null;)zg(t,e,n),t=t.sibling}var cn=null,Oi=!1;function Vr(t,e,n){for(n=n.child;n!==null;)HC(t,e,n),n=n.sibling}function HC(t,e,n){if(Ar&&typeof Ar.onCommitFiberUnmount=="function")try{Ar.onCommitFiberUnmount(ih,n)}catch{}switch(n.tag){case 5:En||ta(n,e);case 6:var i=cn,r=Oi;cn=null,Vr(t,e,n),cn=i,Oi=r,cn!==null&&(Oi?(t=cn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):cn.removeChild(n.stateNode));break;case 18:cn!==null&&(Oi?(t=cn,n=n.stateNode,t.nodeType===8?bd(t.parentNode,n):t.nodeType===1&&bd(t,n),hl(t)):bd(cn,n.stateNode));break;case 4:i=cn,r=Oi,cn=n.stateNode.containerInfo,Oi=!0,Vr(t,e,n),cn=i,Oi=r;break;case 0:case 11:case 14:case 15:if(!En&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&((s&2)!==0||(s&4)!==0)&&Ng(n,e,o),r=r.next}while(r!==i)}Vr(t,e,n);break;case 1:if(!En&&(ta(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Ut(n,e,a)}Vr(t,e,n);break;case 21:Vr(t,e,n);break;case 22:n.mode&1?(En=(i=En)||n.memoizedState!==null,Vr(t,e,n),En=i):Vr(t,e,n);break;default:Vr(t,e,n)}}function Fy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SB),e.forEach(function(i){var r=kB.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Bi(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:cn=a.stateNode,Oi=!1;break e;case 3:cn=a.stateNode.containerInfo,Oi=!0;break e;case 4:cn=a.stateNode.containerInfo,Oi=!0;break e}a=a.return}if(cn===null)throw Error(de(160));HC(s,o,r),cn=null,Oi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(h){Ut(r,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)jC(e,t),e=e.sibling}function jC(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Bi(e,t),Zi(t),i&4){try{ZA(3,t,t.return),uh(3,t)}catch(b){Ut(t,t.return,b)}try{ZA(5,t,t.return)}catch(b){Ut(t,t.return,b)}}break;case 1:Bi(e,t),Zi(t),i&512&&n!==null&&ta(n,n.return);break;case 5:if(Bi(e,t),Zi(t),i&512&&n!==null&&ta(n,n.return),t.flags&32){var r=t.stateNode;try{ll(r,"")}catch(b){Ut(t,t.return,b)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&uT(r,s),ug(a,o);var h=ug(a,s);for(o=0;o<l.length;o+=2){var g=l[o],m=l[o+1];g==="style"?pT(r,m):g==="dangerouslySetInnerHTML"?dT(r,m):g==="children"?ll(r,m):Yp(r,g,m,h)}switch(a){case"input":og(r,s);break;case"textarea":fT(r,s);break;case"select":var v=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var w=s.value;w!=null?ha(r,!!s.multiple,w,!1):v!==!!s.multiple&&(s.defaultValue!=null?ha(r,!!s.multiple,s.defaultValue,!0):ha(r,!!s.multiple,s.multiple?[]:"",!1))}r[_l]=s}catch(b){Ut(t,t.return,b)}}break;case 6:if(Bi(e,t),Zi(t),i&4){if(t.stateNode===null)throw Error(de(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(b){Ut(t,t.return,b)}}break;case 3:if(Bi(e,t),Zi(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{hl(e.containerInfo)}catch(b){Ut(t,t.return,b)}break;case 4:Bi(e,t),Zi(t);break;case 13:Bi(e,t),Zi(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Pm=Gt())),i&4&&Fy(t);break;case 22:if(g=n!==null&&n.memoizedState!==null,t.mode&1?(En=(h=En)||g,Bi(e,t),En=h):Bi(e,t),Zi(t),i&8192){if(h=t.memoizedState!==null,(t.stateNode.isHidden=h)&&!g&&(t.mode&1)!==0)for(Be=t,g=t.child;g!==null;){for(m=Be=g;Be!==null;){switch(v=Be,w=v.child,v.tag){case 0:case 11:case 14:case 15:ZA(4,v,v.return);break;case 1:ta(v,v.return);var C=v.stateNode;if(typeof C.componentWillUnmount=="function"){i=v,n=v.return;try{e=i,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(b){Ut(i,n,b)}}break;case 5:ta(v,v.return);break;case 22:if(v.memoizedState!==null){ky(m);continue}}w!==null?(w.return=v,Be=w):ky(m)}g=g.sibling}e:for(g=null,m=t;;){if(m.tag===5){if(g===null){g=m;try{r=m.stateNode,h?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=m.stateNode,l=m.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=gT("display",o))}catch(b){Ut(t,t.return,b)}}}else if(m.tag===6){if(g===null)try{m.stateNode.nodeValue=h?"":m.memoizedProps}catch(b){Ut(t,t.return,b)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;g===m&&(g=null),m=m.return}g===m&&(g=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Bi(e,t),Zi(t),i&4&&Fy(t);break;case 21:break;default:Bi(e,t),Zi(t)}}function Zi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(VC(n)){var i=n;break e}n=n.return}throw Error(de(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(ll(r,""),i.flags&=-33);var s=Oy(t);zg(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Oy(t);Gg(t,a,o);break;default:throw Error(de(161))}}catch(l){Ut(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function MB(t,e,n){Be=t,WC(t)}function WC(t,e,n){for(var i=(t.mode&1)!==0;Be!==null;){var r=Be,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Qc;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||En;a=Qc;var h=En;if(Qc=o,(En=l)&&!h)for(Be=r;Be!==null;)o=Be,l=o.child,o.tag===22&&o.memoizedState!==null?Ny(r):l!==null?(l.return=o,Be=l):Ny(r);for(;s!==null;)Be=s,WC(s),s=s.sibling;Be=r,Qc=a,En=h}Dy(t)}else(r.subtreeFlags&8772)!==0&&s!==null?(s.return=r,Be=s):Dy(t)}}function Dy(t){for(;Be!==null;){var e=Be;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:En||uh(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!En)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ri(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&yy(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}yy(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var g=h.memoizedState;if(g!==null){var m=g.dehydrated;m!==null&&hl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}En||e.flags&512&&Ug(e)}catch(v){Ut(e,e.return,v)}}if(e===t){Be=null;break}if(n=e.sibling,n!==null){n.return=e.return,Be=n;break}Be=e.return}}function ky(t){for(;Be!==null;){var e=Be;if(e===t){Be=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Be=n;break}Be=e.return}}function Ny(t){for(;Be!==null;){var e=Be;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{uh(4,e)}catch(l){Ut(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Ut(e,r,l)}}var s=e.return;try{Ug(e)}catch(l){Ut(e,s,l)}break;case 5:var o=e.return;try{Ug(e)}catch(l){Ut(e,o,l)}}}catch(l){Ut(e,e.return,l)}if(e===t){Be=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Be=a;break}Be=e.return}}var IB=Math.ceil,bf=Br.ReactCurrentDispatcher,bm=Br.ReactCurrentOwner,yi=Br.ReactCurrentBatchConfig,ot=0,an=null,jt=null,un=0,qn=0,na=ws(0),Kt=0,Cl=null,io=0,fh=0,Sm=0,qA=null,Nn=null,Pm=0,Ia=1/0,pr=null,Sf=!1,Vg=null,cs=null,Xc=!1,ns=null,Pf=0,$A=0,Hg=null,zu=-1,Vu=0;function In(){return(ot&6)!==0?Gt():zu!==-1?zu:zu=Gt()}function us(t){return(t.mode&1)===0?1:(ot&2)!==0&&un!==0?un&-un:hB.transition!==null?(Vu===0&&(Vu=PT()),Vu):(t=ht,t!==0||(t=window.event,t=t===void 0?16:FT(t.type)),t)}function zi(t,e,n,i){if(50<$A)throw $A=0,Hg=null,Error(de(185));jl(t,n,i),((ot&2)===0||t!==an)&&(t===an&&((ot&2)===0&&(fh|=n),Kt===4&&$r(t,un)),Hn(t,i),n===1&&ot===0&&(e.mode&1)===0&&(Ia=Gt()+500,Ah&&Ts()))}function Hn(t,e){var n=t.callbackNode;hI(t,e);var i=uf(t,t===an?un:0);if(i===0)n!==null&&X_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&X_(n),e===1)t.tag===0?fB(Uy.bind(null,t)):eC(Uy.bind(null,t)),AB(function(){(ot&6)===0&&Ts()}),n=null;else{switch(MT(i)){case 1:n=em;break;case 4:n=bT;break;case 16:n=cf;break;case 536870912:n=ST;break;default:n=cf}n=$C(n,QC.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function QC(t,e){if(zu=-1,Vu=0,(ot&6)!==0)throw Error(de(327));var n=t.callbackNode;if(_a()&&t.callbackNode!==n)return null;var i=uf(t,t===an?un:0);if(i===0)return null;if((i&30)!==0||(i&t.expiredLanes)!==0||e)e=Mf(t,i);else{e=i;var r=ot;ot|=2;var s=JC();(an!==t||un!==e)&&(pr=null,Ia=Gt()+500,Ys(t,e));do try{RB();break}catch(a){XC(t,a)}while(1);hm(),bf.current=s,ot=r,jt!==null?e=0:(an=null,un=0,e=Kt)}if(e!==0){if(e===2&&(r=pg(t),r!==0&&(i=r,e=jg(t,r))),e===1)throw n=Cl,Ys(t,0),$r(t,i),Hn(t,Gt()),n;if(e===6)$r(t,i);else{if(r=t.current.alternate,(i&30)===0&&!BB(r)&&(e=Mf(t,i),e===2&&(s=pg(t),s!==0&&(i=s,e=jg(t,s))),e===1))throw n=Cl,Ys(t,0),$r(t,i),Hn(t,Gt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(de(345));case 2:Vs(t,Nn,pr);break;case 3:if($r(t,i),(i&130023424)===i&&(e=Pm+500-Gt(),10<e)){if(uf(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){In(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Cg(Vs.bind(null,t,Nn,pr),e);break}Vs(t,Nn,pr);break;case 4:if($r(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Gi(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Gt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*IB(i/1960))-i,10<i){t.timeoutHandle=Cg(Vs.bind(null,t,Nn,pr),i);break}Vs(t,Nn,pr);break;case 5:Vs(t,Nn,pr);break;default:throw Error(de(329))}}}return Hn(t,Gt()),t.callbackNode===n?QC.bind(null,t):null}function jg(t,e){var n=qA;return t.current.memoizedState.isDehydrated&&(Ys(t,e).flags|=256),t=Mf(t,e),t!==2&&(e=Nn,Nn=n,e!==null&&Wg(e)),t}function Wg(t){Nn===null?Nn=t:Nn.push.apply(Nn,t)}function BB(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ji(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $r(t,e){for(e&=~Sm,e&=~fh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gi(e),i=1<<n;t[n]=-1,e&=~i}}function Uy(t){if((ot&6)!==0)throw Error(de(327));_a();var e=uf(t,0);if((e&1)===0)return Hn(t,Gt()),null;var n=Mf(t,e);if(t.tag!==0&&n===2){var i=pg(t);i!==0&&(e=i,n=jg(t,i))}if(n===1)throw n=Cl,Ys(t,0),$r(t,e),Hn(t,Gt()),n;if(n===6)throw Error(de(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vs(t,Nn,pr),Hn(t,Gt()),null}function Mm(t,e){var n=ot;ot|=1;try{return t(e)}finally{ot=n,ot===0&&(Ia=Gt()+500,Ah&&Ts())}}function ro(t){ns!==null&&ns.tag===0&&(ot&6)===0&&_a();var e=ot;ot|=1;var n=yi.transition,i=ht;try{if(yi.transition=null,ht=1,t)return t()}finally{ht=i,yi.transition=n,ot=e,(ot&6)===0&&Ts()}}function Im(){qn=na.current,bt(na)}function Ys(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,aB(n)),jt!==null)for(n=jt.return;n!==null;){var i=n;switch(cm(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&pf();break;case 3:Pa(),bt(zn),bt(Tn),ym();break;case 5:_m(i);break;case 4:Pa();break;case 13:bt(It);break;case 19:bt(It);break;case 10:dm(i.type._context);break;case 22:case 23:Im()}n=n.return}if(an=t,jt=t=fs(t.current,null),un=qn=e,Kt=0,Cl=null,Sm=fh=io=0,Nn=qA=null,Ws!==null){for(e=0;e<Ws.length;e++)if(n=Ws[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ws=null}return t}function XC(t,e){do{var n=jt;try{if(hm(),Nu.current=xf,Cf){for(var i=Rt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Cf=!1}if(no=0,rn=Yt=Rt=null,KA=!1,El=0,bm.current=null,n===null||n.return===null){Kt=1,Cl=e,jt=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=un,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var h=l,g=a,m=g.tag;if((g.mode&1)===0&&(m===0||m===11||m===15)){var v=g.alternate;v?(g.updateQueue=v.updateQueue,g.memoizedState=v.memoizedState,g.lanes=v.lanes):(g.updateQueue=null,g.memoizedState=null)}var w=by(o);if(w!==null){w.flags&=-257,Sy(w,o,a,s,e),w.mode&1&&xy(s,h,e),e=w,l=h;var C=e.updateQueue;if(C===null){var b=new Set;b.add(l),e.updateQueue=b}else C.add(l);break e}else{if((e&1)===0){xy(s,h,e),Bm();break e}l=Error(de(426))}}else if(Pt&&a.mode&1){var R=by(o);if(R!==null){(R.flags&65536)===0&&(R.flags|=256),Sy(R,o,a,s,e),um(Ma(l,a));break e}}s=l=Ma(l,a),Kt!==4&&(Kt=2),qA===null?qA=[s]:qA.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=IC(s,l,e);_y(s,S);break e;case 1:a=l;var P=s.type,M=s.stateNode;if((s.flags&128)===0&&(typeof P.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(cs===null||!cs.has(M)))){s.flags|=65536,e&=-e,s.lanes|=e;var F=BC(s,a,e);_y(s,F);break e}}s=s.return}while(s!==null)}KC(n)}catch(H){e=H,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(1)}function JC(){var t=bf.current;return bf.current=xf,t===null?xf:t}function Bm(){(Kt===0||Kt===3||Kt===2)&&(Kt=4),an===null||(io&268435455)===0&&(fh&268435455)===0||$r(an,un)}function Mf(t,e){var n=ot;ot|=2;var i=JC();(an!==t||un!==e)&&(pr=null,Ys(t,e));do try{LB();break}catch(r){XC(t,r)}while(1);if(hm(),ot=n,bf.current=i,jt!==null)throw Error(de(261));return an=null,un=0,Kt}function LB(){for(;jt!==null;)YC(jt)}function RB(){for(;jt!==null&&!rI();)YC(jt)}function YC(t){var e=qC(t.alternate,t,qn);t.memoizedProps=t.pendingProps,e===null?KC(t):jt=e,bm.current=null}function KC(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&32768)===0){if(n=xB(n,e,qn),n!==null){jt=n;return}}else{if(n=bB(n,e),n!==null){n.flags&=32767,jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Kt=6,jt=null;return}}if(e=e.sibling,e!==null){jt=e;return}jt=e=t}while(e!==null);Kt===0&&(Kt=5)}function Vs(t,e,n){var i=ht,r=yi.transition;try{yi.transition=null,ht=1,OB(t,e,n,i)}finally{yi.transition=r,ht=i}return null}function OB(t,e,n,i){do _a();while(ns!==null);if((ot&6)!==0)throw Error(de(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(de(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(dI(t,s),t===an&&(jt=an=null,un=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Xc||(Xc=!0,$C(cf,function(){return _a(),null})),s=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||s){s=yi.transition,yi.transition=null;var o=ht;ht=1;var a=ot;ot|=4,bm.current=null,PB(t,n),jC(n,t),eB(wg),ff=!!Eg,wg=Eg=null,t.current=n,MB(n),sI(),ot=a,ht=o,yi.transition=s}else t.current=n;if(Xc&&(Xc=!1,ns=t,Pf=r),s=t.pendingLanes,s===0&&(cs=null),AI(n.stateNode),Hn(t,Gt()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Sf)throw Sf=!1,t=Vg,Vg=null,t;return(Pf&1)!==0&&t.tag!==0&&_a(),s=t.pendingLanes,(s&1)!==0?t===Hg?$A++:($A=0,Hg=t):$A=0,Ts(),null}function _a(){if(ns!==null){var t=MT(Pf),e=yi.transition,n=ht;try{if(yi.transition=null,ht=16>t?16:t,ns===null)var i=!1;else{if(t=ns,ns=null,Pf=0,(ot&6)!==0)throw Error(de(331));var r=ot;for(ot|=4,Be=t.current;Be!==null;){var s=Be,o=s.child;if((Be.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var h=a[l];for(Be=h;Be!==null;){var g=Be;switch(g.tag){case 0:case 11:case 15:ZA(8,g,s)}var m=g.child;if(m!==null)m.return=g,Be=m;else for(;Be!==null;){g=Be;var v=g.sibling,w=g.return;if(zC(g),g===h){Be=null;break}if(v!==null){v.return=w,Be=v;break}Be=w}}}var C=s.alternate;if(C!==null){var b=C.child;if(b!==null){C.child=null;do{var R=b.sibling;b.sibling=null,b=R}while(b!==null)}}Be=s}}if((s.subtreeFlags&2064)!==0&&o!==null)o.return=s,Be=o;else e:for(;Be!==null;){if(s=Be,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:ZA(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,Be=S;break e}Be=s.return}}var P=t.current;for(Be=P;Be!==null;){o=Be;var M=o.child;if((o.subtreeFlags&2064)!==0&&M!==null)M.return=o,Be=M;else e:for(o=P;Be!==null;){if(a=Be,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:uh(9,a)}}catch(H){Ut(a,a.return,H)}if(a===o){Be=null;break e}var F=a.sibling;if(F!==null){F.return=a.return,Be=F;break e}Be=a.return}}if(ot=r,Ts(),Ar&&typeof Ar.onPostCommitFiberRoot=="function")try{Ar.onPostCommitFiberRoot(ih,t)}catch{}i=!0}return i}finally{ht=n,yi.transition=e}}return!1}function Gy(t,e,n){e=Ma(n,e),e=IC(t,e,1),t=ls(t,e,1),e=In(),t!==null&&(jl(t,1,e),Hn(t,e))}function Ut(t,e,n){if(t.tag===3)Gy(t,t,n);else for(;e!==null;){if(e.tag===3){Gy(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(cs===null||!cs.has(i))){t=Ma(n,t),t=BC(e,t,1),e=ls(e,t,1),t=In(),e!==null&&(jl(e,1,t),Hn(e,t));break}}e=e.return}}function FB(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,an===t&&(un&n)===n&&(Kt===4||Kt===3&&(un&130023424)===un&&500>Gt()-Pm?Ys(t,0):Sm|=n),Hn(t,e)}function ZC(t,e){e===0&&((t.mode&1)===0?e=1:(e=kc,kc<<=1,(kc&130023424)===0&&(kc=4194304)));var n=In();t=xr(t,e),t!==null&&(jl(t,e,n),Hn(t,n))}function DB(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ZC(t,n)}function kB(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(de(314))}i!==null&&i.delete(e),ZC(t,n)}var qC;qC=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||zn.current)Gn=!0;else{if((t.lanes&n)===0&&(e.flags&128)===0)return Gn=!1,CB(t,e,n);Gn=(t.flags&131072)!==0}else Gn=!1,Pt&&(e.flags&1048576)!==0&&tC(e,yf,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Gu(t,e),t=e.pendingProps;var r=xa(e,Tn.current);ma(e,n),r=Em(null,e,i,t,r,n);var s=wm();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Vn(i)?(s=!0,mf(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,pm(e),r.updater=lh,e.stateNode=r,r._reactInternals=e,Bg(e,i,t,n),e=Og(null,e,i,!0,s,n)):(e.tag=0,Pt&&s&&lm(e),Pn(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Gu(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=UB(i),t=Ri(i,t),r){case 0:e=Rg(null,e,i,t,n);break e;case 1:e=Iy(null,e,i,t,n);break e;case 11:e=Py(null,e,i,t,n);break e;case 14:e=My(null,e,i,Ri(i.type,t),n);break e}throw Error(de(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ri(i,r),Rg(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ri(i,r),Iy(t,e,i,r,n);case 3:e:{if(FC(e),t===null)throw Error(de(387));i=e.pendingProps,s=e.memoizedState,r=s.element,sC(t,e),wf(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Ma(Error(de(423)),e),e=By(t,e,i,n,r);break e}else if(i!==r){r=Ma(Error(de(424)),e),e=By(t,e,i,n,r);break e}else for($n=As(e.stateNode.containerInfo.firstChild),ni=e,Pt=!0,Fi=null,n=lC(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ba(),i===r){e=br(t,e,n);break e}Pn(t,e,i,n)}e=e.child}return e;case 5:return cC(e),t===null&&Pg(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Tg(i,r)?o=null:s!==null&&Tg(i,s)&&(e.flags|=32),OC(t,e),Pn(t,e,o,n),e.child;case 6:return t===null&&Pg(e),null;case 13:return DC(t,e,n);case 4:return mm(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Sa(e,null,i,n):Pn(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ri(i,r),Py(t,e,i,r,n);case 7:return Pn(t,e,e.pendingProps,n),e.child;case 8:return Pn(t,e,e.pendingProps.children,n),e.child;case 12:return Pn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,vt(vf,i._currentValue),i._currentValue=o,s!==null)if(ji(s.value,o)){if(s.children===r.children&&!zn.current){e=br(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Er(-1,n&-n),l.tag=2;var h=s.updateQueue;if(h!==null){h=h.shared;var g=h.pending;g===null?l.next=l:(l.next=g.next,g.next=l),h.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Mg(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(de(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Mg(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Pn(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,ma(e,n),r=Ei(r),i=i(r),e.flags|=1,Pn(t,e,i,n),e.child;case 14:return i=e.type,r=Ri(i,e.pendingProps),r=Ri(i.type,r),My(t,e,i,r,n);case 15:return LC(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ri(i,r),Gu(t,e),e.tag=1,Vn(i)?(t=!0,mf(e)):t=!1,ma(e,n),aC(e,i,r),Bg(e,i,r,n),Og(null,e,i,!0,t,n);case 19:return kC(t,e,n);case 22:return RC(t,e,n)}throw Error(de(156,e.tag))};function $C(t,e){return xT(t,e)}function NB(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _i(t,e,n,i){return new NB(t,e,n,i)}function Lm(t){return t=t.prototype,!(!t||!t.isReactComponent)}function UB(t){if(typeof t=="function")return Lm(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Zp)return 11;if(t===qp)return 14}return 2}function fs(t,e){var n=t.alternate;return n===null?(n=_i(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Hu(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Lm(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Qo:return Ks(n.children,r,s,e);case Kp:o=8,r|=8;break;case tg:return t=_i(12,n,e,r|2),t.elementType=tg,t.lanes=s,t;case ng:return t=_i(13,n,e,r),t.elementType=ng,t.lanes=s,t;case ig:return t=_i(19,n,e,r),t.elementType=ig,t.lanes=s,t;case AT:return hh(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case oT:o=10;break e;case aT:o=9;break e;case Zp:o=11;break e;case qp:o=14;break e;case Kr:o=16,i=null;break e}throw Error(de(130,t==null?t:typeof t,""))}return e=_i(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Ks(t,e,n,i){return t=_i(7,t,i,e),t.lanes=n,t}function hh(t,e,n,i){return t=_i(22,t,i,e),t.elementType=AT,t.lanes=n,t.stateNode={isHidden:!1},t}function Od(t,e,n){return t=_i(6,t,null,e),t.lanes=n,t}function Fd(t,e,n){return e=_i(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function GB(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gd(0),this.expirationTimes=gd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gd(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Rm(t,e,n,i,r,s,o,a,l){return t=new GB(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_i(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},pm(s),t}function zB(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wo,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function ex(t){if(!t)return gs;t=t._reactInternals;e:{if(ho(t)!==t||t.tag!==1)throw Error(de(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Vn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(de(171))}if(t.tag===1){var n=t.type;if(Vn(n))return $T(t,n,e)}return e}function tx(t,e,n,i,r,s,o,a,l){return t=Rm(n,i,!0,t,r,s,o,a,l),t.context=ex(null),n=t.current,i=In(),r=us(n),s=Er(i,r),s.callback=e!=null?e:null,ls(n,s,r),t.current.lanes=r,jl(t,r,i),Hn(t,i),t}function dh(t,e,n,i){var r=e.current,s=In(),o=us(r);return n=ex(n),e.context===null?e.context=n:e.pendingContext=n,e=Er(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=ls(r,e,o),t!==null&&(zi(t,r,o,s),ku(t,r,o)),o}function If(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function zy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Om(t,e){zy(t,e),(t=t.alternate)&&zy(t,e)}function VB(){return null}var nx=typeof reportError=="function"?reportError:function(t){console.error(t)};function Fm(t){this._internalRoot=t}gh.prototype.render=Fm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(de(409));dh(t,e,null,null)};gh.prototype.unmount=Fm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ro(function(){dh(null,t,null,null)}),e[Cr]=null}};function gh(t){this._internalRoot=t}gh.prototype.unstable_scheduleHydration=function(t){if(t){var e=LT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<qr.length&&e!==0&&e<qr[n].priority;n++);qr.splice(n,0,t),n===0&&OT(t)}};function Dm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ph(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Vy(){}function HB(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var h=If(o);s.call(h)}}var o=tx(e,i,t,0,null,!1,!1,"",Vy);return t._reactRootContainer=o,t[Cr]=o.current,pl(t.nodeType===8?t.parentNode:t),ro(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var h=If(l);a.call(h)}}var l=Rm(t,0,!1,null,null,!1,!1,"",Vy);return t._reactRootContainer=l,t[Cr]=l.current,pl(t.nodeType===8?t.parentNode:t),ro(function(){dh(e,l,n,i)}),l}function mh(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=If(o);a.call(l)}}dh(e,o,t,r)}else o=HB(n,e,t,r,i);return If(o)}IT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=kA(e.pendingLanes);n!==0&&(tm(e,n|1),Hn(e,Gt()),(ot&6)===0&&(Ia=Gt()+500,Ts()))}break;case 13:ro(function(){var i=xr(t,1);if(i!==null){var r=In();zi(i,t,1,r)}}),Om(t,1)}};nm=function(t){if(t.tag===13){var e=xr(t,134217728);if(e!==null){var n=In();zi(e,t,134217728,n)}Om(t,134217728)}};BT=function(t){if(t.tag===13){var e=us(t),n=xr(t,e);if(n!==null){var i=In();zi(n,t,e,i)}Om(t,e)}};LT=function(){return ht};RT=function(t,e){var n=ht;try{return ht=t,e()}finally{ht=n}};hg=function(t,e,n){switch(e){case"input":if(og(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=ah(i);if(!r)throw Error(de(90));cT(i),og(i,r)}}}break;case"textarea":fT(t,n);break;case"select":e=n.value,e!=null&&ha(t,!!n.multiple,e,!1)}};yT=Mm;vT=ro;var jB={usingClientEntryPoint:!1,Events:[Ql,Ko,ah,mT,_T,Mm]},vA={findFiberByHostInstance:js,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},WB={bundleType:vA.bundleType,version:vA.version,rendererPackageName:vA.rendererPackageName,rendererConfig:vA.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Br.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=TT(t),t===null?null:t.stateNode},findFiberByHostInstance:vA.findFiberByHostInstance||VB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jc.isDisabled&&Jc.supportsFiber)try{ih=Jc.inject(WB),Ar=Jc}catch{}}ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jB;ai.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Dm(e))throw Error(de(200));return zB(t,e,null,n)};ai.createRoot=function(t,e){if(!Dm(t))throw Error(de(299));var n=!1,i="",r=nx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Rm(t,1,!1,null,null,n,!1,i,r),t[Cr]=e.current,pl(t.nodeType===8?t.parentNode:t),new Fm(e)};ai.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(de(188)):(t=Object.keys(t).join(","),Error(de(268,t)));return t=TT(e),t=t===null?null:t.stateNode,t};ai.flushSync=function(t){return ro(t)};ai.hydrate=function(t,e,n){if(!ph(e))throw Error(de(200));return mh(null,t,e,!0,n)};ai.hydrateRoot=function(t,e,n){if(!Dm(t))throw Error(de(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=nx;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=tx(e,null,t,1,n!=null?n:null,r,!1,s,o),t[Cr]=e.current,pl(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new gh(e)};ai.render=function(t,e,n){if(!ph(e))throw Error(de(200));return mh(null,t,e,!1,n)};ai.unmountComponentAtNode=function(t){if(!ph(t))throw Error(de(40));return t._reactRootContainer?(ro(function(){mh(null,null,t,!1,function(){t._reactRootContainer=null,t[Cr]=null})}),!0):!1};ai.unstable_batchedUpdates=Mm;ai.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!ph(n))throw Error(de(200));if(t==null||t._reactInternals===void 0)throw Error(de(38));return mh(t,e,n,!1,i)};ai.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=ai})(nh);var Hy=nh.exports;$0.createRoot=Hy.createRoot,$0.hydrateRoot=Hy.hydrateRoot;const QB="modulepreload",XB=function(t,e){return new URL(t,e).href},jy={},JB=function(e,n,i){return!n||n.length===0?e():Promise.all(n.map(r=>{if(r=XB(r,i),r in jy)return;jy[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":QB,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,h)=>{a.addEventListener("load",l),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())};var ix={exports:{}},_h={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YB=Ee.exports,KB=Symbol.for("react.element"),ZB=Symbol.for("react.fragment"),qB=Object.prototype.hasOwnProperty,$B=YB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eL={key:!0,ref:!0,__self:!0,__source:!0};function rx(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)qB.call(e,i)&&!eL.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:KB,type:t,key:s,ref:o,props:r,_owner:$B.current}}_h.Fragment=ZB;_h.jsx=rx;_h.jsxs=rx;(function(t){t.exports=_h})(ix);const ps=ix.exports.jsx,tL=Ee.exports.createContext(null);function nL(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Wy(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Qy(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const iL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xy(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let s=null;if("interactive"in i&&(s={...i},delete s.interactive),r){s=s||{...i},delete s.ref;for(const o of iL)o in r&&(s[o]=r[o])}return s||i});return{...t,layers:n}}function rL(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function es(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!es(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!es(t[r],e[r]))return!1;return!0}return!1}const Jy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Dd={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Yy={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},sL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],oL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ba{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[Yy[r.type]];s&&s(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[Jy[r.type]];if(s){if(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"){const o=this._hoveredFeatures||this._map.queryRenderedFeatures(r.point,{layers:this.props.interactiveLayerIds});r.features=o}s(r),delete r.features}},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[Dd[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Ba.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n,i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:o}=e;return o&&(o.bounds?r.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):i._updateViewState(o,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||aL()||null,container:e,style:Xy(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,n.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),this._createShadowTransform(s);const o=s._render;s._render=h=>{this._inRender=!0,o.call(s,h),this._inRender=!1};const a=s._renderTaskQueue.run;s._renderTaskQueue.run=h=>{a.call(s._renderTaskQueue,h),this._onBeforeRepaint()},s.on("render",()=>this._onAfterRepaint());const l=s.fire;s.fire=this._fireEvent.bind(this,l),s.on("resize",()=>{this._renderTransform.resize(s.transform.width,s.transform.height)}),s.on("styledata",()=>this._updateStyleComponents(this.props,{})),s.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const h in Jy)s.on(h,this._onPointerEvent);for(const h in Dd)s.on(h,this._onCameraEvent);for(const h in Yy)s.on(h,this._onEvent);this._map=s}recycle(){Ba.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=nL(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,l=i.isMoving();l&&(r.cameraElevationReference="sea");const h=Qy(r,{...Wy(i.transform),...e});if(l&&(r.cameraElevationReference="ground"),h&&n){const g=this._deferredEvents;g.move=!0,g.zoom||(g.zoom=s!==r.zoom),g.rotate||(g.rotate=a!==r.bearing),g.pitch||(g.pitch=o!==r.pitch)}return l||Qy(i.transform,e),h}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of sL)s in e&&!es(e[s],n[s])&&(r=!0,i[`set${s[0].toUpperCase()}${s.slice(1)}`](e[s]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Xy(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!es(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!es(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!es(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const s of oL){const o=e[s];es(o,n[s])||(r=!0,o?i[s].enable(o):i[s].disable())}return r}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let a;if(s==="mousemove")try{a=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{a=[]}else a=[];const l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Dd&&(typeof n=="object"&&(n.viewState=Wy(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}Ba.savedMaps=[];function aL(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||process.env.MapboxAccessToken}catch{}try{t=t||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const AL=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function lL(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,s)=>{const o=n.transform;n.transform=t.transform;const a=n.queryTerrainElevation(r,s);return n.transform=o,a}};for(const r of cL(n))!(r in i)&&!AL.includes(r)&&(i[r]=n[r].bind(n));return i}function cL(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const uL=typeof document<"u"?Ee.exports.useLayoutEffect:Ee.exports.useEffect,fL=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function hL(t,e){for(const n of fL)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const yh=Ee.exports.createContext(null),dL={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},km=Ee.exports.forwardRef((t,e)=>{const n=Ee.exports.useContext(tL),[i,r]=Ee.exports.useState(null),s=Ee.exports.useRef(),{current:o}=Ee.exports.useRef({mapLib:null,map:null});Ee.exports.useEffect(()=>{const l=t.mapLib;let h=!0,g;return Promise.resolve(l||JB(()=>import("./mapbox-gl.763890e3.js").then(m=>m.m),[],import.meta.url)).then(m=>{if(!!h){if(m.Map||(m=m.default),!m||!m.Map)throw new Error("Invalid mapLib");if(m.supported(t))hL(m,t),t.reuseMaps&&(g=Ba.reuse(t,s.current)),g||(g=new Ba(m.Map,t,s.current)),o.map=lL(g,m),o.mapLib=m,r(g),n==null||n.onMapMount(o.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(m=>{t.onError({type:"error",target:null,originalEvent:null,error:m})}),()=>{h=!1,g&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?g.recycle():g.destroy())}},[]),uL(()=>{i&&i.setProps(t)}),Ee.exports.useImperativeHandle(e,()=>o.map,[i]);const a=Ee.exports.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return ps("div",{id:t.id,ref:s,style:a,children:i&&ps(yh.Provider,{value:o,children:t.children})})});km.displayName="Map";km.defaultProps=dL;const gL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function go(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!gL.test(i)?n[i]=`${r}px`:n[i]=r}}const pL={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function sx(t){const{map:e,mapLib:n}=Ee.exports.useContext(yh),i=Ee.exports.useRef({props:t});i.current.props=t;const r=Ee.exports.useMemo(()=>{let s=!1;Ee.exports.Children.forEach(t.children,l=>{l&&(s=!0)});const o={...t,element:s?document.createElement("div"):null},a=new n.Marker(o).setLngLat([t.longitude,t.latitude]);return a.getElement().addEventListener("click",l=>{var h,g;(g=(h=i.current.props).onClick)===null||g===void 0||g.call(h,{type:"click",target:a,originalEvent:l})}),a.on("dragstart",l=>{var h,g;const m=l;m.lngLat=r.getLngLat(),(g=(h=i.current.props).onDragStart)===null||g===void 0||g.call(h,m)}),a.on("drag",l=>{var h,g;const m=l;m.lngLat=r.getLngLat(),(g=(h=i.current.props).onDrag)===null||g===void 0||g.call(h,m)}),a.on("dragend",l=>{var h,g;const m=l;m.lngLat=r.getLngLat(),(g=(h=i.current.props).onDragEnd)===null||g===void 0||g.call(h,m)}),a},[]);return Ee.exports.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),Ee.exports.useEffect(()=>{go(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!rL(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),nh.exports.createPortal(t.children,r.getElement())}sx.defaultProps=pL;Ee.exports.memo(sx);function Ky(t){return new Set(t?t.trim().split(/\s+/):[])}function mL(t){const{map:e,mapLib:n}=Ee.exports.useContext(yh),i=Ee.exports.useMemo(()=>document.createElement("div"),[]),r=Ee.exports.useRef({props:t});r.current.props=t;const s=Ee.exports.useMemo(()=>{const o={...t},a=new n.Popup(o).setLngLat([t.longitude,t.latitude]);return a.once("open",l=>{var h,g;(g=(h=r.current.props).onOpen)===null||g===void 0||g.call(h,l)}),a},[]);if(Ee.exports.useEffect(()=>{const o=a=>{var l,h;(h=(l=r.current.props).onClose)===null||h===void 0||h.call(l,a)};return s.on("close",o),s.setDOMContent(i).addTo(e.getMap()),()=>{s.off("close",o),s.isOpen()&&s.remove()}},[]),Ee.exports.useEffect(()=>{go(s.getElement(),t.style)},[t.style]),s.isOpen()&&((s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!es(s.options.offset,t.offset)&&s.setOffset(t.offset),(s.options.anchor!==t.anchor||s.options.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth)),s.options.className!==t.className)){const o=Ky(s.options.className),a=Ky(t.className);for(const l of o)a.has(l)||s.removeClassName(l);for(const l of a)o.has(l)||s.addClassName(l);s.options.className=t.className}return nh.exports.createPortal(t.children,i)}Ee.exports.memo(mL);function Jl(t,e,n,i){const r=Ee.exports.useContext(yh),s=Ee.exports.useMemo(()=>t(r),[]);return Ee.exports.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:h}=r;return h.hasControl(s)||(h.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{l&&l(r),h.hasControl(s)&&h.removeControl(s)}},[]),s}function _L(t){const e=Jl(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Ee.exports.useEffect(()=>{go(e._container,t.style)},[t.style]),null}Ee.exports.memo(_L);function yL(t){const e=Jl(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Ee.exports.useEffect(()=>{go(e._controlContainer,t.style)},[t.style]),null}Ee.exports.memo(yL);const ox=Ee.exports.forwardRef((t,e)=>{const n=Ee.exports.useRef({props:t}),i=Jl(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,h;(h=(l=n.current.props).onGeolocate)===null||h===void 0||h.call(l,a)}),s.on("error",a=>{var l,h;(h=(l=n.current.props).onError)===null||h===void 0||h.call(l,a)}),s.on("outofmaxbounds",a=>{var l,h;(h=(l=n.current.props).onOutOfMaxBounds)===null||h===void 0||h.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,h;(h=(l=n.current.props).onTrackUserLocationStart)===null||h===void 0||h.call(l,a)}),s.on("trackuserlocationend",a=>{var l,h;(h=(l=n.current.props).onTrackUserLocationEnd)===null||h===void 0||h.call(l,a)}),s},{position:t.position});return n.current.props=t,Ee.exports.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),Ee.exports.useEffect(()=>{go(i._container,t.style)},[t.style]),null});ox.displayName="GeolocateControl";Ee.exports.memo(ox);function vL(t){const e=Jl(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Ee.exports.useEffect(()=>{go(e._container,t.style)},[t.style]),null}Ee.exports.memo(vL);const EL={unit:"metric",maxWidth:100};function ax(t){const e=Jl(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),Ee.exports.useEffect(()=>{go(e._container,t.style)},[t.style]),null}ax.defaultProps=EL;Ee.exports.memo(ax);function ut(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const La=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),Zy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Zy&&parseFloat(Zy[1]);const wL="3.2.9";function cr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const kd={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},TL=kd.global||kd.self||kd.window||{},Zs=typeof process!="object"||String(process)!=="[object process]"||process.browser,Nm=typeof importScripts=="function",CL=typeof window<"u"&&typeof window.orientation<"u",qy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qy&&parseFloat(qy[1]);function T(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class xL{constructor(e,n){T(this,"name",void 0),T(this,"workerThread",void 0),T(this,"isRunning",!0),T(this,"result",void 0),T(this,"_resolve",()=>{}),T(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){cr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){cr(this.isRunning),this.isRunning=!1,this._reject(e)}}class Nd{}const Ud=new Map;function bL(t){cr(t.source&&!t.url||!t.source&&t.url);let e=Ud.get(t.source||t.url);return e||(t.url&&(e=SL(t.url),Ud.set(t.url,e)),t.source&&(e=Ax(t.source),Ud.set(t.source,e))),cr(e),e}function SL(t){if(!t.startsWith("http"))return t;const e=PL(t);return Ax(e)}function Ax(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function PL(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function lx(t,e=!0,n){const i=n||new Set;if(t){if($y(t))i.add(t);else if($y(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)lx(t[r],e,i)}}return n===void 0?Array.from(i):[]}function $y(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Gd=()=>{};class Qg{static isSupported(){return typeof Worker<"u"&&Zs||typeof Nd<"u"&&!Zs}constructor(e){T(this,"name",void 0),T(this,"source",void 0),T(this,"url",void 0),T(this,"terminated",!1),T(this,"worker",void 0),T(this,"onMessage",void 0),T(this,"onError",void 0),T(this,"_loadableURL","");const{name:n,source:i,url:r}=e;cr(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Gd,this.onError=s=>console.log(s),this.worker=Zs?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Gd,this.onError=Gd,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||lx(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=bL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Nd(i,{eval:!1})}else if(this.source)e=new Nd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class ML{static isSupported(){return Qg.isSupported()}constructor(e){T(this,"name","unnamed"),T(this,"source",void 0),T(this,"url",void 0),T(this,"maxConcurrency",1),T(this,"maxMobileConcurrency",1),T(this,"onDebug",()=>{}),T(this,"reuseWorkers",!0),T(this,"props",{}),T(this,"jobQueue",[]),T(this,"idleQueue",[]),T(this,"count",0),T(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new xL(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Qg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return CL?this.maxMobileConcurrency:this.maxConcurrency}}const IL={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class _r{static isSupported(){return Qg.isSupported()}static getWorkerFarm(e={}){return _r._workerFarm=_r._workerFarm||new _r({}),_r._workerFarm.setProps(e),_r._workerFarm}constructor(e){T(this,"props",void 0),T(this,"workerPools",new Map),this.props={...IL},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new ML({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}T(_r,"_workerFarm",void 0);const BL="latest";function LL(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=BL);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return cr(r),r}function RL(t,e=wL){cr(t,"no worker provided");const n=t.version;return!(!e||!n)}const OL={},FL=Object.freeze(Object.defineProperty({__proto__:null,default:OL},Symbol.toStringTag,{value:"Module"})),DL="3.2.9",zd={};async function qs(t,e=null,n={}){return e&&(t=kL(t,e,n)),zd[t]=zd[t]||NL(t),await zd[t]}function kL(t,e,n){if(t.startsWith("http"))return t;const i=n.modules||{};return i[t]?i[t]:Zs?n.CDN?(cr(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(DL,"/dist/libs/").concat(t)):Nm?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function NL(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Zs)try{return FL&&void 0}catch{return null}if(Nm)return importScripts(t);const n=await(await fetch(t)).text();return UL(n,t)}function UL(t,e){if(!Zs)return;if(Nm)return eval.call(TL,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function zL(t,e){return!_r.isSupported()||!Zs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function VL(t,e,n,i,r){const s=t.id,o=LL(t,n),l=_r.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const h=await l.startJob("process-on-worker",HL.bind(null,r));return h.postMessage("process",{input:e,options:n,context:i}),await(await h.result).result}async function HL(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function jL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?ev(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?ev(t,0,e):""}function ev(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}function WL(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(jL(t),'"'))}}function cx(t){return t&&typeof t=="object"&&t.isBuffer}function QL(t){return cx(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function ux(t){if(cx(t))return QL(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function XL(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function JL(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}function Vd(...t){const e=t,n=e&&e.length>1&&e[0].constructor||null;if(!n)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const i=e.reduce((o,a)=>o+a.length,0),r=new n(i);let s=0;for(const o of e)r.set(o,s),s+=o.length;return r}function Um(t,e,n){const i=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function Yl(t,e){return ut(t>=0),ut(e>0),t+(e-1)&~(e-1)}function YL(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const r=t.byteOffset,s=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,r,s)}return e.set(i,n),n+Yl(i.byteLength,4)}async function KL(t){const e=[];for await(const n of t)e.push(n);return JL(...e)}function tv(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class nv{constructor(e,n){T(this,"name",void 0),T(this,"type",void 0),T(this,"sampleSize",1),T(this,"time",void 0),T(this,"count",void 0),T(this,"samples",void 0),T(this,"lastTiming",void 0),T(this,"lastSampleTime",void 0),T(this,"lastSampleCount",void 0),T(this,"_count",0),T(this,"_time",0),T(this,"_samples",0),T(this,"_startTime",0),T(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tv(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tv()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Kl{constructor(e){T(this,"id",void 0),T(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof nv?this.stats[n]=e:this.stats[n]=new nv(n,i)),this.stats[n]}}const ZL="Queued Requests",qL="Active Requests",$L="Cancelled Requests",eR="Queued Requests Ever",tR="Active Requests Ever",nR={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class fx{constructor(e={}){T(this,"props",void 0),T(this,"stats",void 0),T(this,"activeRequestCount",0),T(this,"requestQueue",[]),T(this,"requestMap",new Map),T(this,"deferredUpdate",null),this.props={...nR,...e},this.stats=new Kl({id:this.props.id}),this.stats.get(ZL),this.stats.get(qL),this.stats.get($L),this.stats.get(eR),this.stats.get(tR)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let iR="";const iv={};function rR(t){for(const e in iv)if(t.startsWith(e)){const n=iv[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(iR).concat(t)),t}function sR(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}function hx(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const oR=t=>typeof t=="boolean",el=t=>typeof t=="function",Zl=t=>t!==null&&typeof t=="object",rv=t=>Zl(t)&&t.constructor==={}.constructor,aR=t=>t&&typeof t[Symbol.iterator]=="function",AR=t=>t&&typeof t[Symbol.asyncIterator]=="function",Va=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ha=t=>typeof Blob<"u"&&t instanceof Blob,lR=t=>t&&typeof t=="object"&&t.isBuffer,cR=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Zl(t)&&el(t.tee)&&el(t.cancel)&&el(t.getReader),uR=t=>Zl(t)&&el(t.read)&&el(t.pipe)&&oR(t.readable),dx=t=>cR(t)||uR(t),fR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,hR=/^([-\w.]+\/[-\w.+]+)/;function dR(t){const e=hR.exec(t);return e?e[1]:t}function sv(t){const e=fR.exec(t);return e?e[1]:""}const gR=/\?.*/;function vh(t){if(Va(t)){const e=Hd(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:dR(n)||sv(e)}}return Ha(t)?{url:Hd(t.name||""),type:t.type||""}:typeof t=="string"?{url:Hd(t),type:sv(t)}:{url:"",type:""}}function pR(t){return Va(t)?t.headers["content-length"]||-1:Ha(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Hd(t){return t.replace(gR,"")}async function gx(t){if(Va(t))return t;const e={},n=pR(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=vh(t);r&&(e["content-type"]=r);const s=await yR(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function mR(t){if(!t.ok){const e=await _R(t);throw new Error(e)}}async function _R(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function yR(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=vR(n);return"data:base64,".concat(i)}return null}function vR(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Xg(t,e){if(typeof t=="string"){t=rR(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await gx(t)}function px(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Lr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||px()}const ju={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Yc=ju.window||ju.self||ju.global,EA=ju.process||{},mx=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Lr();const jd=globalThis;function _x(t){if(!t&&!Lr())return"Node";if(px(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":jd.chrome?"Chrome":jd.safari?"Safari":jd.mozInnerScreenX?"Firefox":"Unknown"}function ER(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class wR{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";T(this,"storage",void 0),T(this,"id",void 0),T(this,"config",{}),this.storage=ER(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function TR(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function CR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Wd(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Bf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Bf||(Bf={}));function ov(t){return typeof t=="string"?Bf[t.toUpperCase()]||Bf.WHITE:t}function xR(t,e,n){return!Lr&&typeof t=="string"&&(e&&(e=ov(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=ov(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function bR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function Lf(t,e){if(!t)throw new Error(e||"Assertion failed")}function Lo(){let t;if(Lr&&"performance"in Yc){var e,n;t=Yc==null||(e=Yc.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in EA){var i;const r=EA==null||(i=EA.hrtime)===null||i===void 0?void 0:i.call(EA);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Ro={debug:Lr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},SR={enabled:!0,level:0};function di(){}const av={},Av={once:!0};class ql{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};T(this,"id",void 0),T(this,"VERSION",mx),T(this,"_startTs",Lo()),T(this,"_deltaTs",Lo()),T(this,"_storage",void 0),T(this,"userData",{}),T(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new wR("__probe-".concat(this.id,"__"),SR),this.userData={},this.timeStamp("".concat(this.id," started")),bR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Lo()-this._startTs).toPrecision(10))}getDelta(){return Number((Lo()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Lf(e,n)}warn(e){return this._getLogFunction(0,e,Ro.warn,arguments,Av)}error(e){return this._getLogFunction(0,e,Ro.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ro.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ro.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,Ro.debug||Ro.info,arguments,Av)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||di,i&&[i],{tag:BR(n)}):di}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?Lr?IR({image:r,message:s,scale:o}):MR({image:r,message:s,scale:o}):di}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||di)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=lv({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||di)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=yx(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=lv({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,Lf(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Lo();const o=s.tag||s.message;if(s.once)if(!av[o])av[o]=Lo();else return di;return n=PR(this.id,s.message,s),i.bind(console,n,...s.args)}return di}}T(ql,"VERSION",mx);function yx(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Lf(Number.isFinite(e)&&e>=0),e}function lv(t){const{logLevel:e,message:n}=t;t.logLevel=yx(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Lf(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function PR(t,e,n){if(typeof e=="string"){const i=n.time?CR(TR(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=xR(e,n.color,n.background)}return e}function MR(t){let{image:e,message:n="",scale:i=1}=t;return(void 0)({image:e,message:n,scale:i}),di}function IR(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Wd(s,n,i);console.log(...o)},s.src=e,di}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Wd(e,n,i)),di;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Wd(s,n,i)),s.src=e.toDataURL(),di}return di}function BR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const cv=new ql({id:"loaders.gl"});class LR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class RR{constructor(){T(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const vx={fetch:null,mimeType:void 0,nothrow:!1,log:new RR,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:La,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},OR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ex(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const wx=()=>{const t=Ex();return t.globalOptions=t.globalOptions||{...vx},t.globalOptions};function FR(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],DR(t,n),NR(e,t,i)}function Tx(t,e){const n=wx(),i=t||n;return typeof i.fetch=="function"?i.fetch:Zl(i.fetch)?r=>Xg(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Xg}function DR(t,e){uv(t,null,vx,OR,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};uv(i,n.id,r,s,e)}}function uv(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&Zl(t[a]),h=a==="baseUri"&&!e,g=a==="workerUrl"&&e;if(!(a in n)&&!h&&!g){if(a in i)cv.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const m=kR(a,r);cv.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(m))()}}}}function kR(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function NR(t,e,n){const r={...t.options||{}};return UR(r,n),r.log===null&&(r.log=new LR),fv(r,wx()),fv(r,e),r}function fv(t,e){for(const n in e)if(n in e){const i=e[n];rv(i)&&rv(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function UR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Gm(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function zm(t){var e,n;ut(t,"null loader"),ut(Gm(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Cx=()=>{const t=Ex();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function GR(t){const e=Cx();t=Array.isArray(t)?t:[t];for(const n of t){const i=zm(n);e.find(r=>i===r)||e.unshift(i)}}function zR(){return Cx()}const VR=new ql({id:"loaders.gl"}),HR=/\.([^.]+)$/;async function jR(t,e=[],n,i){if(!xx(t))return null;let r=hv(t,e,{...n,nothrow:!0},i);if(r)return r;if(Ha(t)&&(t=await t.slice(0,10).arrayBuffer(),r=hv(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(bx(t));return r}function hv(t,e=[],n,i){if(!xx(t))return null;if(e&&!Array.isArray(e))return zm(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...zR()),QR(r);const s=WR(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(bx(t));return s}function WR(t,e,n,i){const{url:r,type:s}=vh(t),o=r||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Qd(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||XR(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Qd(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||YR(e,t),l=l||(a?"matched initial data ".concat(Sx(t)):""),a=a||Qd(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var h;VR.log(1,"selectLoader selected ".concat((h=a)===null||h===void 0?void 0:h.name,": ").concat(l,"."))}return a}function xx(t){return!(t instanceof Response&&t.status===204)}function bx(t){const{url:e,type:n}=vh(t);let i="No valid loader found (";i+=e?"".concat(sR(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Sx(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function QR(t){for(const e of t)zm(e)}function XR(t,e){const n=e&&HR.exec(e),i=n&&n[1];return i?JR(t,i):null}function JR(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Qd(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function YR(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(KR(e,n))return n}else if(ArrayBuffer.isView(e)){if(dv(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&dv(e,0,n))return n;return null}function KR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function dv(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>ZR(t,e,n,r))}function ZR(t,e,n,i){if(i instanceof ArrayBuffer)return XL(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=Jg(t,e,i.length);return i===r;default:return!1}}function Sx(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Jg(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Jg(t,0,e):""}function Jg(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const qR=256*1024;function*$R(t,e){const n=(e==null?void 0:e.chunkSize)||qR;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const eO=256*1024;function*tO(t,e={}){const{chunkSize:n=eO}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const nO=1024*1024;async function*iO(t,e){const n=(e==null?void 0:e.chunkSize)||nO;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function gv(t,e){return La?rO(t,e):sO(t)}async function*rO(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield ux(o)}}catch{n.releaseLock()}}async function*sO(t,e){for await(const n of t)yield ux(n)}function oO(t,e){if(typeof t=="string")return $R(t,e);if(t instanceof ArrayBuffer)return tO(t,e);if(Ha(t))return iO(t,e);if(dx(t))return gv(t,e);if(Va(t))return gv(t.body,e);throw new Error("makeIterator")}const Px="Cannot convert supplied data type";function aO(t,e,n){if(e.text&&typeof t=="string")return t;if(lR(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(Px)}async function AO(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return aO(t,e);if(Ha(t)&&(t=await gx(t)),Va(t)){const r=t;return await mR(r),e.binary?await r.arrayBuffer():await r.text()}if(dx(t)&&(t=oO(t,n)),aR(t)||AR(t))return KL(t);throw new Error(Px)}function lO(t,e,n=null){if(n)return n;const i={fetch:Tx(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function cO(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Vm(t,e,n,i){cr(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Gm(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=vh(t),o=cO(e,i),a=await jR(t,o,n);return a?(n=FR(n,a,o,r),i=lO({url:r,parse:Vm,loaders:o},n,i),await uO(a,t,n,i)):null}async function uO(t,e,n,i){if(RL(t),Va(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:h,url:g}=r,m=Object.fromEntries(r.headers.entries());i.response={headers:m,ok:s,redirected:o,status:a,statusText:l,type:h,url:g}}if(e=await AO(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(zL(t,n))return await VL(t,e,n,i,Vm);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw cr(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Sr(t,e,n,i){!Array.isArray(e)&&!Gm(e)&&(n=e,e=void 0);const r=Tx(n);let s=t;return typeof t=="string"&&(s=await r(t)),Ha(t)&&(s=await r(t)),await Vm(s,e,n)}const fO="3.2.9",{_parseImageNode:hO}=globalThis,Yg=typeof Image<"u",Kg=typeof ImageBitmap<"u",dO=Boolean(hO),Zg=La?!0:dO;function gO(t){switch(t){case"auto":return Kg||Yg||Zg;case"imagebitmap":return Kg;case"image":return Yg;case"data":return Zg;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function pO(){if(Kg)return"imagebitmap";if(Yg)return"image";if(Zg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function mO(t){const e=yO(t);if(!e)throw new Error("Not an image");return e}function _O(t){switch(mO(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function yO(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const vO=/^data:image\/svg\+xml/,EO=/\.svg((\?|#).*)?$/;function Hm(t){return t&&(vO.test(t)||EO.test(t))}function wO(t,e){if(Hm(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Mx(t,e)}function Mx(t,e){if(Hm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Ix(t,e,n){const i=wO(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await TO(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function TO(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const CO={};let pv=!0;async function xO(t,e,n){let i;Hm(n)?i=await Ix(t,e,n):i=Mx(t,n);const r=e&&e.imagebitmap;return await bO(i,r)}async function bO(t,e=null){if((SO(e)||!pv)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),pv=!1}return await createImageBitmap(t)}function SO(t){for(const e in t||CO)return!1;return!0}const sr=!1,tl=!0;function jm(t){const e=$l(t);return PO(e)||BO(e)||MO(e)||IO(e)}function PO(t){const e=$l(t);return e.byteLength>=24&&e.getUint32(0,sr)===2303741511?{mimeType:"image/png",width:e.getUint32(16,sr),height:e.getUint32(20,sr)}:null}function MO(t){const e=$l(t);return e.byteLength>=10&&e.getUint32(0,sr)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,tl),height:e.getUint16(8,tl)}:null}function IO(t){const e=$l(t);return e.byteLength>=14&&e.getUint16(0,sr)===16973&&e.getUint32(2,tl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,tl),height:e.getUint32(22,tl)}:null}function BO(t){const e=$l(t);if(!(e.byteLength>=3&&e.getUint16(0,sr)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=LO();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,sr);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,sr),width:e.getUint16(s+7,sr)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,sr)}return null}function LO(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function $l(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function RO(t,e){const{mimeType:n}=jm(t)||{},i=globalThis._parseImageNode;return ut(i),await i(t,n)}async function OO(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=FO(r);let a;switch(o){case"imagebitmap":a=await xO(t,e,s);break;case"image":a=await Ix(t,e,s);break;case"data":a=await RO(t);break;default:ut(!1)}return r==="data"&&(a=_O(a)),a}function FO(t){switch(t){case"auto":case"data":return pO();default:return gO(t),t}}const DO=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],kO=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],NO={image:{type:"auto",decode:!0}},Wm={id:"image",module:"images",name:"Images",version:fO,mimeTypes:kO,extensions:DO,parse:OO,tests:[t=>Boolean(jm(new DataView(t)))],options:NO},UO=["image/png","image/jpeg","image/gif"],Xd={};function GO(t){return Xd[t]===void 0&&(Xd[t]=zO(t)),Xd[t]}function zO(t){switch(t){case"image/webp":return VO();case"image/svg":return La;default:if(!La){const{_parseImageNode:e}=globalThis;return Boolean(e)&&UO.includes(t)}return!0}}function VO(){if(!La)return!1;try{return document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}}const De=new ql({id:"deck"});let qg={};function HO(t){qg=t}function yn(t,e,n,i){De.level>0&&qg[t]&&qg[t].call(null,e,n,i)}function jO(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const WO={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:jO,parseTextSync:JSON.parse},nl="8.8.11",Wu=globalThis.deck&&globalThis.deck.VERSION;if(Wu&&Wu!==nl)throw new Error("deck.gl - multiple versions detected: ".concat(Wu," vs ").concat(nl));Wu||(De.log(1,"deck.gl ".concat(nl))(),globalThis.deck={...globalThis.deck,VERSION:nl,version:nl,log:De,_registerLoggers:HO},GR([WO,[Wm,{imagebitmap:{premultiplyAlpha:"none"}}]]));const QO=globalThis.deck,Le=new ql({id:"luma.gl"});function Mn(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const XO="Invalid WebGLRenderingContext",JO="Requires WebGL2";function Eh(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function Xe(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function YO(t){return Xe(t)?t:null}function wh(t){return Mn(Eh(t),XO),t}function wn(t){return Mn(Xe(t),JO),t}const UA={};function KO(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function ZO(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function qO(t,e){UA[t]=!0,e!==void 0&&KO(e)}function $O(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(UA[i]=!0);while(i!==0);for(i in UA)if(UA[i])return delete UA[i],parseInt(i,10);return 0}}const ec=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};ec.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};ec.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const po=function(e){const n=this;this.gl=e,$O(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,h,g){const m=n.currentVertexArrayObject;m.maxAttrib=Math.max(m.maxAttrib,s);const v=m.attribs[s];return v.buffer=n.currentArrayBuffer,v.size=o,v.type=a,v.normalized=l,v.stride=h,v.offset=g,v.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{ZO("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};po.prototype.VERTEX_ARRAY_BINDING_OES=34229;po.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new ec(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};po.prototype.createVertexArrayOES=function(){const e=new ec(this);return this.vertexArrayObjects.push(e),e};po.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};po.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof ec&&e.hasBeenBound&&e.ext===this)};po.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){qO(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const h=s.attribs[l],g=r?r.attribs[l]:null;if((!r||h.enabled!==g.enabled)&&(h.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),h.enabled){let m=!1;(!r||h.buffer!==g.buffer)&&(o!==h.buffer&&(i.bindBuffer.call(n,34962,h.buffer),o=h.buffer),m=!0),(m||h.cached!==g.cached)&&i.vertexAttribPointer.call(n,l,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function eF(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new po(this)),this.__OESVertexArrayObject))}}const mv="OES_element_index",_v="WEBGL_draw_buffers",tF="EXT_disjoint_timer_query",nF="EXT_disjoint_timer_query_webgl2",iF="EXT_texture_filter_anisotropic",yv="WEBGL_debug_renderer_info",rF=35723,sF=4352,oF=36795,aF=34047,AF=37445,lF=37446,yt=t=>Xe(t)?void 0:0,cF={[3074]:t=>Xe(t)?void 0:36064,[rF]:t=>Xe(t)?void 0:sF,[35977]:yt,[32937]:yt,[oF]:(t,e)=>{const n=Xe(t)?t.getExtension(nF):t.getExtension(tF);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[AF]:(t,e)=>{const n=t.getExtension(yv);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[lF]:(t,e)=>{const n=t.getExtension(yv);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[aF]:(t,e)=>{const n=t.luma.extensions[iF];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:yt,[35071]:yt,[37447]:yt,[36063]:(t,e)=>{if(!Xe(t)){const n=t.getExtension(_v);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:yt,[35374]:yt,[35377]:yt,[34852]:t=>{if(!Xe(t)){const e=t.getExtension(_v);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(mv)?2147483647:65535,[33001]:t=>t.getExtension(mv)?16777216:65535,[33e3]:t=>16777216,[37157]:yt,[35373]:yt,[35657]:yt,[36183]:yt,[37137]:yt,[34045]:yt,[35978]:yt,[35979]:yt,[35968]:yt,[35376]:yt,[35375]:yt,[35659]:yt,[37154]:yt,[35371]:yt,[35658]:yt,[35076]:yt,[35077]:yt,[35380]:yt};function uF(t,e,n){const i=cF[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const fF="OES_vertex_array_object",Bx="ANGLE_instanced_arrays",hF="WEBGL_draw_buffers",dF="EXT_disjoint_timer_query",gF="EXT_texture_filter_anisotropic",pF="VertexArray requires WebGL2 or OES_vertex_array_object extension";function mF(t,e){return{webgl2:Xe(t),ext:t.getExtension(e)}}const Lx={[fF]:{meta:{suffix:"OES"},createVertexArray:()=>{Mn(!1,pF)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Bx]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Mn(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[hF]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Mn(!1)}},[dF]:{meta:{suffix:"EXT"},createQuery:()=>{Mn(!1)},deleteQuery:()=>{Mn(!1)},beginQuery:()=>{Mn(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Jd={readBuffer:(t,e,n)=>{Xe(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=mF(t,Bx);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Xe(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Xe(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[gF];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:uF,hint(t,e,n,i){return e(n,i)}};function _F(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(eF(t),yF(t),EF(t,Lx),vF(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=_F;function yF(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function vF(t,e){let{target:n,target2:i}=e;Object.keys(Jd).forEach(r=>{if(typeof Jd[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=Jd[r].bind(null,t,s);n[r]=o,i[r]=o}})}function EF(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&wF(t,{extension:n,target:t.luma,target2:t})}function wF(t,e){let{extension:n,target:i,target2:r}=e;const s=Lx[n];Mn(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const h of Object.keys(s)){const g="".concat(h).concat(a);let m=null;h==="meta"||typeof t[h]=="function"||(l&&typeof l[g]=="function"?m=function(){return l[g](...arguments)}:typeof s[h]=="function"&&(m=s[h].bind(i))),m&&(i[h]=m,r[h]=m)}}const Qm={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Hr=(t,e,n)=>e?t.enable(n):t.disable(n),vv=(t,e,n)=>t.hint(n,e),Xn=(t,e,n)=>t.pixelStorei(n,e),TF=(t,e)=>{const n=Xe(t)?36009:36160;return t.bindFramebuffer(n,e)},CF=(t,e)=>t.bindFramebuffer(36008,e);function wA(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const xF={[3042]:Hr,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Hr,[2885]:(t,e)=>t.cullFace(e),[2929]:Hr,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Hr,[35723]:vv,[36006]:TF,[2886]:(t,e)=>t.frontFace(e),[33170]:vv,[2849]:(t,e)=>t.lineWidth(e),[32823]:Hr,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Hr,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Hr,[3088]:(t,e)=>t.scissor(...e),[2960]:Hr,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Xn,[3317]:Xn,[37440]:Xn,[37441]:Xn,[37443]:Xn,[3330]:Xn,[3332]:Xn,[3331]:Xn,[36010]:CF,[3314]:Xn,[32878]:Xn,[3316]:Xn,[3315]:Xn,[32877]:Xn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=wA(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=wA(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=wA(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=wA(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=wA(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Nt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const bF={blendEquation:(t,e,n)=>t.blendEquationSeparate(Nt(32777,e,n),Nt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Nt(32969,e,n),Nt(32968,e,n),Nt(32971,e,n),Nt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Nt(32824,e,n),Nt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Nt(32938,e,n),Nt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Nt(2962,e,n),Nt(2967,e,n),Nt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Nt(34816,e,n),Nt(36003,e,n),Nt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Nt(2964,e,n),Nt(2965,e,n),Nt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Nt(34817,e,n),Nt(34818,e,n),Nt(34819,e,n))},Ev={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},qi=(t,e)=>t.isEnabled(e),wv={[3042]:qi,[2884]:qi,[2929]:qi,[3024]:qi,[32823]:qi,[32926]:qi,[32928]:qi,[3089]:qi,[2960]:qi,[35977]:qi};function Rx(t){for(const e in t)return!1;return!0}function SF(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Tv(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function PF(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:h}=n(t.state._updateCache,...o);return l&&i(...o),h},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function MF(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class IF{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?LF(e):Object.assign({},Qm),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Mn(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Pr(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Mn(s!==void 0);const o=e[s],a=this.cache[s];SF(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function Ox(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Mn(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new IF(t,{copyState:i}),MF(t);for(const s in Ev){const o=Ev[s];PF(t,s,o)}Tv(t,"getParameter"),Tv(t,"isEnabled")}return t.state.enable=n,t}function BF(t){t.state||Ox(t,{copyState:!1}),t.state.push()}function Cv(t){Mn(t.state),t.state.pop()}function Pr(t,e){if(Mn(Eh(t),"setParameters requires a WebGL context"),Rx(e))return;const n={};for(const r in e){const s=Number(r),o=xF[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=bF[r];s(t,e,i)}}function LF(t,e){if(e=e||Qm,typeof e=="number"){const r=e,s=wv[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=wv[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function RF(t){Pr(t,Qm)}function vi(t,e,n){if(Rx(e))return n(t);const{nocatch:i=!0}=e;BF(t),Pr(t,e);let r;if(i)r=n(t),Cv(t);else try{r=n(t)}finally{Cv(t)}return r}function Ra(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Yd(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Ra(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return FF(e,i,r,s,n)}function OF(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function FF(t,e,n,i,r){const s=xv(t[0],e,n);let o=bv(t[1],e,i,r),a=xv(t[0]+1,e,n);const l=a===n-1?a:a-1;a=bv(t[1]+1,e,i,r);let h;return r?(a=a===0?a:a+1,h=o,o=a):h=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(h-o+1,1)}}function xv(t,e,n){return Math.min(Math.round(t*e),n-1)}function bv(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Xm=Lr(),DF=Xm&&typeof document<"u",Fx={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Dx(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mn(Xm,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Fx,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=GF({canvas:s,width:e,height:n,onError:i});return r=UF(o,t),r?(r=Jm(r,t),zF(r),r):null}function Jm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||VF(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Fx,e);const{manageState:n,debug:i}=e;return n&&Ox(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return Le.log(1,...s)()}}),Xm&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Le.level=Math.max(Le.level,1)):Le.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function kF(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function NF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=OF(e.useDevicePixels);HF(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function UF(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function GF(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(DF&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function zF(t){const e=Xe(t)?"WebGL2":"WebGL1",n=kF(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";Le.info(1,"".concat(e).concat(r," context ").concat(i))()}function VF(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function HF(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(Le.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(Le.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const il="8.5.16",jF="set luma.log.level=1 (or higher) to trace rendering";class kx{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Kl({id:e})),this.stats.get(e)}}const Xs=new kx;if(globalThis.luma&&globalThis.luma.VERSION!==il)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(il));globalThis.luma||(Lr()&&Le.log(1,"luma.gl ".concat(il," - ").concat(jF))(),globalThis.luma=globalThis.luma||{VERSION:il,version:il,log:Le,stats:Xs,globals:{modules:{},nodeIO:{}}});function WF(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function QF(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function we(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Kd(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return we(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function hs(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Zd={};function Wi(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Zd[t]=Zd[t]||1;const e=Zd[t]++;return"".concat(t,"-").concat(e)}function Sv(t){return we(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Oa(t){let e=!0;for(const n in t){e=!1;break}return e}function Nx(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw Le.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const Oo="Resource subclass must define virtual methods";class Rr{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wh(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||Wi(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Kd(this.gl,e),we(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Xe(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Xe(this.gl),o={},a=n||Object.keys(r);for(const l of a){const h=r[l];if(h&&(!("webgl2"in h)||s)&&(!("extension"in h)||this.gl.getExtension(h.extension))){const m=i?hs(this.gl,l):l;o[m]=this.getParameter(l,e),i&&h.type==="GLenum"&&(o[m]=hs(this.gl,o[m]))}}return o}setParameter(e,n){e=Kd(this.gl,e),we(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Xe(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=Kd(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return Nx(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Oo)}_deleteHandle(){throw new Error(Oo)}_bindHandle(e){throw new Error(Oo)}_getOptsFromHandle(){throw new Error(Oo)}_getParameter(e,n){throw new Error(Oo)}_setParameter(e,n){throw new Error(Oo)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new kx}_addStats(){const e=this[Symbol.toStringTag],n=Xs.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Xs.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(e,n),this._doTrackAllocatedMemory(e,n,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xs.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(e),this._doTrackDeallocatedMemory(e,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xs.get("Memory Usage");n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}}const XF="Failed to deduce GL constant from typed array";function $g(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(XF)}}function xl(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function JF(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const l=a*o,h=(i-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,h,h+o),e.set(s,h)}}function YF(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let l=0;l<r;l++)for(let h=0;h<4;h++)o[(a*r+l)*4+h]=e[(a*2*n+l*2)*4+h];return{data:o,width:r,height:s}}function ep(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const h=i[a]?"".concat(t,".").concat(i[a]):"N/A";Le.removed("".concat(t,".").concat(a),h)()}for(const a in r)if(a in e){const l=r[a];Le.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];Le.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const KF={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ZF={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Un{static getBytesPerElement(e){return xl(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return we(e.size),xl(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Un(KF,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Un.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Un.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=ep("Accessor",e,ZF),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Pv=10,Ux={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},qF={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Ux},$F={removedProps:Ux};class ft extends Rr{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Un.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Un.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ep("Buffer",e,qF),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=ep("Buffer",e,$F),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Un(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;we(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(wn(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return wn(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};wn(this.gl);const s=xl(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,h;e?(h=e.length,l=h-a):(l=Math.min(o,r||o),h=a+l);const g=Math.min(o,l);return r=r||g,we(r<=g),e=e||new s(h),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(we(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Pv,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;we(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,Pv),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=$g(e);return we(s),this.setAccessor(new Un(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;we(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=xl(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Un(this.accessor,{type:$g(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Le.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Le.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Le.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Le.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Un(this.accessor,e),this}}const Ym={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},Gx={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},zx={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function eD(t,e){const n=Ym[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Xe(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function tD(t,e){const n=Ym[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const nD=[9729,9728],Mv=globalThis.WebGLBuffer||function(){};class so extends Rr{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&eD(e,i),s=s&&(!r||tD(e,i))),s}constructor(e,n){const{id:i=Wi("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(P=>this.initialize(Object.assign({},e,{pixels:P,data:P}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:h={},textureUnit:g=void 0}=e;n||(n=r);let{width:m,height:v,dataFormat:w,type:C,compressed:b=!1,mipmaps:R=!0}=e;const{depth:S=0}=e;return{width:m,height:v,compressed:b,dataFormat:w,type:C}=this._deduceParameters({format:s,type:C,dataFormat:w,compressed:b,data:n,width:m,height:v}),this.width=m,this.height=v,this.depth=S,this.format=s,this.type=C,this.dataFormat=w,this.border=o,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),R&&this._isNPOT()&&(Le.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),R=!1,this._updateForNPOT(l)),this.mipmaps=R,this.setImageData({data:n,width:m,height:v,depth:S,format:s,type:C,dataFormat:w,border:o,mipmaps:R,parameters:h,compressed:b}),R&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Le.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),vi(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:h=null,type:g=this.type,width:m=this.width,height:v=this.height,dataFormat:w=this.dataFormat,compressed:C=!1}=e;h||(h=i),{type:g,dataFormat:w,compressed:C,width:m,height:v}=this._deduceParameters({format:s,type:g,dataFormat:w,compressed:C,data:h,width:m,height:v});const{gl:b}=this;b.bindTexture(this.target,this.handle);let R=null;({data:h,dataType:R}=this._getDataType({data:h,compressed:C}));let S,P=0;if(vi(this.gl,l,()=>{switch(R){case"null":b.texImage2D(n,r,s,m,v,o,w,g,h);break;case"typed-array":b.texImage2D(n,r,s,m,v,o,w,g,h,a);break;case"buffer":S=wn(b),S.bindBuffer(35052,h.handle||h),S.texImage2D(n,r,s,m,v,o,w,g,a),S.bindBuffer(35052,null);break;case"browser-object":Xe(b)?b.texImage2D(n,r,s,m,v,o,w,g,h):b.texImage2D(n,r,s,w,g,h);break;case"compressed":for(const[M,F]of h.entries())b.compressedTexImage2D(n,M,F.format,F.width,F.height,o,F.data),P+=F.levelSize;break;default:we(!1,"Unknown image data type")}}),R==="compressed")this._trackAllocatedMemory(P,"Texture");else if(h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const M=Gx[this.dataFormat]||4,F=zx[this.type]||1;this._trackAllocatedMemory(this.width*this.height*M*F,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:h=0,format:g=this.format,type:m=this.type,dataFormat:v=this.dataFormat,compressed:w=!1,offset:C=0,border:b=this.border,parameters:R={}}=e;if({type:m,dataFormat:v,compressed:w,width:a,height:l}=this._deduceParameters({format:g,type:m,dataFormat:v,compressed:w,data:r,width:a,height:l}),we(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const S=r;r=S.data,a=S.shape[0],l=S.shape[1]}r instanceof ft&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),vi(this.gl,R,()=>{if(w)this.gl.compressedTexSubImage2D(n,h,s,o,a,l,g,r);else if(r===null)this.gl.texSubImage2D(n,h,s,o,a,l,v,m,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,h,s,o,a,l,v,m,r,C);else if(r instanceof Mv){const S=wn(this.gl);S.bindBuffer(35052,r),S.texSubImage2D(n,h,s,o,a,l,v,m,C),S.bindBuffer(35052,null)}else Xe(this.gl)?wn(this.gl).texSubImage2D(n,h,s,o,a,l,v,m,r):this.gl.texSubImage2D(n,h,s,o,v,m,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Le.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ft?{data:n.handle,dataType:"buffer"}:n instanceof Mv?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const h=Ym[n];return o=o||h&&h.dataFormat,a=a||h&&h.types[0],l=l||h&&h.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},we(r,"Could not deduced texture size"),we(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),we(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:we(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Xe(this.gl)||!this.width||!this.height?!1:!Sv(this.width)||!Sv(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:nD.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let iD="";function rD(t,e){return we(typeof t=="string"),t=iD+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class hn extends so{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return so.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wh(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:rD(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const tp=[34069,34070,34071,34072,34073,34074];class Vx extends so{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wh(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:h}=this,g=r||s,m=await Promise.all(tp.map(v=>{const w=g[v];return Promise.all(Array.isArray(w)?w:[w])}));this.bind(),tp.forEach((v,w)=>{m[w].length>1&&this.opts.mipmaps!==!1&&Le.warn("".concat(this.id," has mipmap and multiple LODs."))(),m[w].forEach((C,b)=>{n&&i?h.texImage2D(v,b,a,n,i,o,a,l,C):h.texImage2D(v,b,a,a,l,C)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:h=5121}=e,{gl:g}=this,m=s||o;return this.bind(),m instanceof Promise?m.then(v=>this.setImageDataForFace(Object.assign({},e,{face:n,data:v,pixels:v}))):this.width||this.height?g.texImage2D(n,0,l,i,r,a,l,h,m):g.texImage2D(n,0,l,l,h,m),this}}Vx.FACES=tp;class sD extends so{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Xe(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wn(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:l,type:h=5121,offset:g=0,data:m,parameters:v={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),vi(this.gl,v,()=>{ArrayBuffer.isView(m)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,l,h,m),m instanceof ft&&(this.gl.bindBuffer(35052,m.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,l,h,g))}),m&&m.byteLength)this._trackAllocatedMemory(m.byteLength,"Texture");else{const w=Gx[this.dataFormat]||4,C=zx[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*w*C,"Texture")}return this.loaded=!0,this}}const Fs="EXT_color_buffer_float",Iv={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Fs,bpp:2},[33327]:{gl2:Fs,bpp:4},[34842]:{gl2:Fs,bpp:8},[33326]:{gl2:Fs,bpp:4},[33328]:{gl2:Fs,bpp:8},[34836]:{gl2:Fs,bpp:16},[35898]:{gl2:Fs,bpp:4}};function oD(t,e,n){const i=n[e];if(!i)return!1;const r=Xe(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class ia extends Rr{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||oD(e,n,Iv)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return we(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Xe(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Iv[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const aD=256,AD=1024,lD=16384,Bv=6144,Lv=6145,Rv=6146,Ov=34041,Hx="clear: bad arguments";function Km(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=lD,n!==!0&&(s.clearColor=n)),i&&(o|=aD,i!==!0&&(s.clearDepth=i)),r&&(o|=AD,i!==!0&&(s.clearStencil=i)),we(o!==0,Hx),vi(t,s,()=>{t.clear(o)})}function cD(t){let{framebuffer:e=null,buffer:n=Bv,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wn(t),vi(t,{framebuffer:e},()=>{switch(n){case Bv:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case Lv:t.clearBufferfv(Lv,0,[r]);break;case Rv:t.clearBufferiv(Rv,0,[r]);break;case Ov:const[s,o]=r;t.clearBufferfi(Ov,0,s,o);break;default:we(!1,Hx)}})}function uD(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return we(!1),0}}function Th(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:h}=e;const{framebuffer:g,deleteFramebuffer:m}=jx(t);we(g);const{gl:v,handle:w,attachments:C}=g;a=a||g.width,l=l||g.height,s===36064&&w===null&&(s=1028),we(C[s]),h=h||C[s].type,o=hD(o,h,r,a,l),h=h||$g(o);const b=v.bindFramebuffer(36160,w);return v.readPixels(n,i,a,l,r,h,o),v.bindFramebuffer(36160,b||null),m&&g.delete(),o}function Fv(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Th(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=YF({data:i,width:r,height:s}));JF({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function fD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:h,width:g,height:m}=n;const{framebuffer:v,deleteFramebuffer:w}=jx(t);we(v);const{gl:C,handle:b}=v,R=typeof a<"u"||typeof l<"u"||typeof h<"u";a=a||0,l=l||0,h=h||0;const S=C.bindFramebuffer(36160,b);we(e);let P=null;if(e instanceof so&&(P=e,g=Number.isFinite(g)?g:P.width,m=Number.isFinite(m)?m:P.height,P.bind(0),e=P.target),!R)C.copyTexImage2D(e,s,o,i,r,g,m,0);else switch(e){case 3553:case 34067:C.copyTexSubImage2D(e,s,a,l,i,r,g,m);break;case 35866:case 32879:wn(C).copyTexSubImage3D(e,s,a,l,h,i,r,g,m);break}return P&&P.unbind(),C.bindFramebuffer(36160,S||null),w&&v.delete(),P}function jx(t){return t instanceof Wt?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:wD(t),deleteFramebuffer:!0}}function hD(t,e,n,i,r){if(t)return t;e=e||5121;const s=xl(e,{clamped:!1}),o=uD(n);return new s(i*r*o)}const pt={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function dD(t){const e=new hn(t,{format:6408,type:5126,dataFormat:6408}),n=new Wt(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const Wx={[pt.WEBGL2]:[!1,!0],[pt.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[pt.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[pt.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[pt.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[pt.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[pt.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[pt.FLOAT_BLEND]:["EXT_float_blend"],[pt.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[pt.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[pt.TEXTURE_FLOAT]:["OES_texture_float",!0],[pt.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[pt.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[pt.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[pt.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[pt.COLOR_ATTACHMENT_RGBA32F]:[dD,"EXT_color_buffer_float"],[pt.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[pt.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[pt.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[pt.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[pt.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[pt.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},gD=2;function Ch(t,e){return Zm(t,e)}function Zm(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>Qx(t,n))}function pD(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in Wx)t.luma.caps[e]===void 0&&(t.luma.caps[e]=Qx(t,e));return t.luma.caps}function Qx(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=mD(t,e)),t.luma.caps[e]||Le.log(gD,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function mD(t,e){const n=Wx[e];we(n,e);let i;const r=Xe(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(t.getExtension(s))}else typeof r=="string"?i=Boolean(t.getExtension(r)):typeof r=="boolean"?i=r:we(!1);return i}const Dv="Multiple render targets not supported";class Wt extends Rr{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Wt(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=wn(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=wn(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:h=void 0,drawBuffers:g=void 0}=e;if(we(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const m in r){const v=r[m];(Array.isArray(v)?v[0]:v).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:h,drawBuffers:g}),r&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return we(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Le.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){we(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let h=l;if(!h)this._unattach(a);else if(h instanceof ia)this._attachRenderbuffer({attachment:a,renderbuffer:h});else if(Array.isArray(l)){const[g,m=0,v=0]=l;h=g,this._attachTexture({attachment:a,texture:g,layer:m,level:v})}else this._attachTexture({attachment:a,texture:h,layer:0,level:0});i&&h&&h.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(yD(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&Km(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{cD(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return Le.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Le.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Le.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Le.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Le.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Le.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=wn(this.gl),l=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=hs(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?hs(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?hs(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(Fv(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Le.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Fv(this,{targetMaxHeight:100});return Le.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new hn(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new ia(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new ia(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&we(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof ia?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:wn(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const l=_D(r);o.framebufferTexture2D(36160,n,l,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:we(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=YO(this.gl);n?n.readBuffer(e):we(e===36064||e===1029,Dv),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=wn(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):we(e.length===1&&(e[0]===36064||e[0]===1029),Dv)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=pD(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function _D(t){return t<34069?t+34069:t}function yD(t){return(Wt.STATUS||{})[t]||"Framebuffer error ".concat(t)}const vD=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Wt.ATTACHMENT_PARAMETERS=vD;function ED(t,e){we(t instanceof hn||t instanceof Vx||t instanceof sD);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:h,mipmaps:g}=t,m=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:h,mipmaps:g},e);return new n(i,m)}function wD(t,e){const{gl:n,width:i,height:r,id:s}=t;return new Wt(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:t}}))}function Qu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const TD=35632,CD=35633;function xD(t){switch(t){case TD:return"fragment";case CD:return"vertex";default:return"unknown type"}}function bD(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||Qu(e)||"(unnamed)",l="".concat(xD(n)," shader ").concat(a);for(let g=0;g<r.length;g++){const m=r[g];if(m.length<=1)continue;const v=m.split(":"),w=v[0],C=parseInt(v[2],10);if(isNaN(C))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));w!=="WARNING"?s[C]=m:o[C]=m}const h=SD(e);return{shaderName:l,errors:kv(s,h),warnings:kv(o,h)}}function kv(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,h=s.substring(o.join(":").length+1).trim();n+=Xx("^^^ ".concat(a,": ").concat(h,`

`),l)}}return n}function SD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return Xx(a,r-l)+n+s})}function Xx(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function Jx(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const PD="Shader: GLSL source code must be a JavaScript string";class bl extends Rr{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return we(!1),"unknown"}}constructor(e,n){wh(e),we(typeof n.source=="string",PD);const i=Qu(n.source,null)||n.id||Wi("unnamed ".concat(bl.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=Qu(n,null);i&&(this.id=Wi(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(bl.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Qu(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=bD(i,this.source,this.shaderType,this.id);throw Le.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),Le.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class qd extends bl{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class $d extends bl{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const MD={[5126]:Ct.bind(null,"uniform1fv",Jn,1,_n),[35664]:Ct.bind(null,"uniform2fv",Jn,2,_n),[35665]:Ct.bind(null,"uniform3fv",Jn,3,_n),[35666]:Ct.bind(null,"uniform4fv",Jn,4,_n),[5124]:Ct.bind(null,"uniform1iv",jr,1,_n),[35667]:Ct.bind(null,"uniform2iv",jr,2,_n),[35668]:Ct.bind(null,"uniform3iv",jr,3,_n),[35669]:Ct.bind(null,"uniform4iv",jr,4,_n),[35670]:Ct.bind(null,"uniform1iv",jr,1,_n),[35671]:Ct.bind(null,"uniform2iv",jr,2,_n),[35672]:Ct.bind(null,"uniform3iv",jr,3,_n),[35673]:Ct.bind(null,"uniform4iv",jr,4,_n),[35674]:Ct.bind(null,"uniformMatrix2fv",Jn,4,hr),[35675]:Ct.bind(null,"uniformMatrix3fv",Jn,9,hr),[35676]:Ct.bind(null,"uniformMatrix4fv",Jn,16,hr),[35678]:ln,[35680]:ln,[5125]:Ct.bind(null,"uniform1uiv",Kc,1,_n),[36294]:Ct.bind(null,"uniform2uiv",Kc,2,_n),[36295]:Ct.bind(null,"uniform3uiv",Kc,3,_n),[36296]:Ct.bind(null,"uniform4uiv",Kc,4,_n),[35685]:Ct.bind(null,"uniformMatrix2x3fv",Jn,6,hr),[35686]:Ct.bind(null,"uniformMatrix2x4fv",Jn,8,hr),[35687]:Ct.bind(null,"uniformMatrix3x2fv",Jn,6,hr),[35688]:Ct.bind(null,"uniformMatrix3x4fv",Jn,12,hr),[35689]:Ct.bind(null,"uniformMatrix4x2fv",Jn,8,hr),[35690]:Ct.bind(null,"uniformMatrix4x3fv",Jn,12,hr),[35678]:ln,[35680]:ln,[35679]:ln,[35682]:ln,[36289]:ln,[36292]:ln,[36293]:ln,[36298]:ln,[36299]:ln,[36300]:ln,[36303]:ln,[36306]:ln,[36307]:ln,[36308]:ln,[36311]:ln},ID={},BD={},LD={},Nv=[0];function qm(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Nv[0]=t,t=Nv);const r=t.length;if(r%e&&Le.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function Jn(t,e){return qm(t,e,Float32Array,ID)}function jr(t,e){return qm(t,e,Int32Array,BD)}function Kc(t,e){return qm(t,e,Uint32Array,LD)}function Uv(t,e,n){const i=MD[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function RD(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function OD(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!FD(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function FD(t){return Array.isArray(t)||ArrayBuffer.isView(t)?kD(t):isFinite(t)||t===!0||t===!1||t instanceof so||t instanceof ia?!0:t instanceof Wt?Boolean(t.texture):!1}function DD(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function kD(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ln(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function Ct(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const h=e(l,n),g=h.length;let m=!1;if(r===null)r=new Float32Array(g),s=g,m=!0;else{we(s===g,"Uniform length cannot change.");for(let v=0;v<g;++v)if(h[v]!==r[v]){m=!0;break}}return m&&(i(o,t,a,h),r.set(h)),m}}function _n(t,e,n,i){t[e](n,i)}function hr(t,e,n,i){t[e](n,!1,i)}const ND=5120,UD=5121,GD=5122,zD=5123,Gv=0,Zc=1,VD=2,HD=3,qc=4,jD=5,WD=6,Jt=5126,QD=35664,XD=35665,JD=35666,TA=5124,YD=35667,KD=35668,ZD=35669,CA=5125,qD=36294,$D=36295,e4=36296,t4=35670,n4=35671,i4=35672,r4=35673,s4=35674,o4=35675,a4=35676,A4=35685,l4=35686,c4=35687,u4=35688,f4=35689,h4=35690,np={[Jt]:[Jt,1,"float"],[QD]:[Jt,2,"vec2"],[XD]:[Jt,3,"vec3"],[JD]:[Jt,4,"vec4"],[TA]:[TA,1,"int"],[YD]:[TA,2,"ivec2"],[KD]:[TA,3,"ivec3"],[ZD]:[TA,4,"ivec4"],[CA]:[CA,1,"uint"],[qD]:[CA,2,"uvec2"],[$D]:[CA,3,"uvec3"],[e4]:[CA,4,"uvec4"],[t4]:[Jt,1,"bool"],[n4]:[Jt,2,"bvec2"],[i4]:[Jt,3,"bvec3"],[r4]:[Jt,4,"bvec4"],[s4]:[Jt,8,"mat2"],[A4]:[Jt,8,"mat2x3"],[l4]:[Jt,8,"mat2x4"],[o4]:[Jt,12,"mat3"],[c4]:[Jt,12,"mat3x2"],[u4]:[Jt,12,"mat3x4"],[a4]:[Jt,16,"mat4"],[f4]:[Jt,16,"mat4x2"],[h4]:[Jt,16,"mat4x3"]};function d4(t){switch(t){case Gv:return Gv;case Zc:return Zc;case HD:return Zc;case VD:return Zc;case qc:return qc;case jD:return qc;case WD:return qc;default:return we(!1),0}}function zv(t){const e=np[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function Yx(t,e){switch(t){case ND:case UD:case GD:case zD:t=Jt;break}for(const n in np){const[i,r,s]=np[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class g4{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Xe(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=zv(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new Un(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=zv(i),a=new Un({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const Vv=4,p4=35981,m4=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Kx extends Rr{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",m4),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=p4}=e;return this.hash=n||"",this.vs=typeof i=="string"?new qd(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new $d(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,we(this.vs instanceof qd),we(this.fs instanceof $d),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(wn(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new g4(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:h=5123,instanceCount:g=0,isInstanced:m=g>0,vertexArray:v=null,transformFeedback:w,framebuffer:C,parameters:b={},uniforms:R,samplers:S}=e;if((R||S)&&(Le.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(R||{})),Le.priority>=n){const P=C?C.id:"default",M="mode=".concat(hs(this.gl,i)," verts=").concat(r," ")+"instances=".concat(g," indexType=").concat(hs(this.gl,h)," ")+"isInstanced=".concat(m," isIndexed=").concat(l," ")+"Framebuffer=".concat(P);Le.log(n,M)()}return we(v),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||m&&g===0?!1:(v.bindForDraw(r,g,()=>{if(C!==void 0&&(b=Object.assign({},b,{framebuffer:C})),w){const P=d4(i);w.begin(P)}this._bindTextures(),vi(this.gl,b,()=>{l&&m?this.gl2.drawElementsInstanced(i,r,h,s,g):l&&Xe(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,h,s):l?this.gl.drawElements(i,r,h,s):m?this.gl2.drawArraysInstanced(i,s,r,g):this.gl.drawArrays(i,s,r)}),w&&w.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Le.priority>=2&&OD(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof Wt&&(s=s.texture),s instanceof so)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&DD(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new qd({handle:r});break;case 35632:i.fs=new $d({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Wi(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Le.time(Vv,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Le.timeEnd(Vv,"linkProgram for ".concat(this._getName()))(),e.debug||Le.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=RD(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Uv(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=Uv(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const _4=34918,y4=34919,v4=35007,E4=36795,w4=35976,T4=35887,C4=36202;class Rf extends Rr{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Xe(e),r=Zm(e,pt.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:we(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(v4)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?C4:T4)}beginTransformFeedbackQuery(){return this.begin(w4)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,y4);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(E4)}getResult(){return this.gl2.getQueryParameter(this.handle,_4)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return Rf.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class Zx extends Rr{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Xe(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wn(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Oa(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,Le.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof ft?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let $c=null;function x4(t){return(!$c||$c.byteLength<t)&&($c=new ArrayBuffer(t)),$c}function b4(t,e){const n=x4(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function S4(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const P4="elements must be GL.ELEMENT_ARRAY_BUFFER";class Zn extends Rr{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Xe(e)||_x()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Zn(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Zn.MAX_ATTRIBUTES=Zn.MAX_ATTRIBUTES||e.getParameter(34921),Zn.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Zn._setConstantFloatArray(e,n,i);break;case Int32Array:Zn._setConstantIntArray(e,n,i);break;case Uint32Array:Zn._setConstantUintArray(e,n,i);break;default:we(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Zn.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return we(!e||e.target===34963,P4),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:h,divisor:g}=i,{gl:m,gl2:v}=this;return e=Number(e),this.bind(()=>{m.bindBuffer(34962,n.handle),h?(we(Xe(m)),v.vertexAttribIPointer(e,r,s,o,a)):m.vertexAttribPointer(e,r,s,l,o,a),m.enableVertexAttribArray(e),v.vertexAttribDivisor(e,g||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Zn.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new ft(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=b4(n.constructor,s);S4({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:we(!1)}}static _setConstantIntArray(e,n,i){switch(we(Xe(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:we(!1)}}static _setConstantUintArray(e,n,i){switch(we(Xe(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:we(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return we(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const M4="VertexArray: attributes must be Buffers or constants (i.e. typed array)",I4=/^(.+)__LOCATION_([0-9]+)$/,B4=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class L4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Zn(e),Nx(this,"VertexArray","v6.0",B4),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ft(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ft&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof ft&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,Le.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const h=this.accessors[o]||{},g=Un.resolve(l.accessor,h,i,r),{size:m,type:v}=g;return we(Number.isFinite(m)&&Number.isFinite(v)),{location:o,accessor:g}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=I4.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof ft)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof ft){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof ft){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(M4)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(Zn.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Zn.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof ft){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Le.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function R4(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=Sl(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function Sl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return R4(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Hv(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;we(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},h=Object.keys(a).sort();let g=0;for(const w of h)!w.match(s)&&!w.match(o)&&e0({table:l,header:e,uniforms:i,uniformName:w,undefinedOnly:r})&&g++;for(const w of h)w.match(o)&&e0({table:l,header:e,uniforms:i,uniformName:w,undefinedOnly:r})&&g++;for(const w of h)l[w]||e0({table:l,header:e,uniforms:i,uniformName:w,undefinedOnly:r})&&g++;let m=0;const v={};if(!r)for(const w in i){const C=i[w];l[w]||(m++,v[w]={Type:"NOT USED: ".concat(C),[e]:Sl(C)})}return{table:l,count:g,unusedTable:v,unusedCount:m}}function e0(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=O4(o);return!s||!a?(e[r]={[n]:a?Sl(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function O4(t){return t!=null}function F4(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=jv(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(D4(o.name,l))),i[a]=jv(e,r[s],l,n)}}return i}function jv(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,h,g,m;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),h=s.indexOf("nt")!==-1),e instanceof ft){const v=e,{data:w,changed:C}=v.getDebugData();g=C?"*":"",m=w,l=v.byteLength,a=l/w.BYTES_PER_ELEMENT/o;let b;if(n){const R=n.divisor>0;b="".concat(R?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(hs(r,s),")")}else h=!0,b="".concat(l," bytes");return{[i]:"".concat(g).concat(Sl(m,{size:o,isInteger:h})),"Format ":b}}return m=e,o=e.length,s=String(e.constructor.name).replace("Array",""),h=s.indexOf("nt")!==-1,{[i]:"".concat(Sl(m,{size:o,isInteger:h})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function D4(t,e){const{type:n,size:i}=e,r=Yx(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function k4(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=Wv(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=Wv(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function Wv(t){const{type:e,size:n}=t.accessor,i=Yx(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Qv=Lr()&&typeof document<"u";let N4=0;class U4{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=R=>Dx(R),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:h={},debug:g=!1,createFramebuffer:m=!1,autoResizeViewport:v=!0,autoResizeDrawingBuffer:w=!0,stats:C=Xs.get("animation-loop-".concat(N4++))}=e;let{useDevicePixels:b=!0}=e;"useDevicePixelRatio"in e&&(Le.deprecated("useDevicePixelRatio","useDevicePixels")(),b=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:h,debug:g,createFramebuffer:m},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=C,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:v,autoResizeDrawingBuffer:w,useDevicePixels:b}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return we(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Rf.isSupported(this.gl,["timers"])?new Rf(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Le.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Qv?new Promise((e,n)=>{if(Qv&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):QF(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):WF(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Jm(this.props.gl,e):this.onCreateContext(e),!Eh(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");RF(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&NF(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Wt(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const tc="vs",$m="fs";function ii(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const t0={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function G4(t){const e={};for(const n in t){const i=t[n],r=z4(i);e[n]=r}return e}function z4(t){let e=Xv(t);return e==="object"?t?"type"in t?Object.assign({},t,t0[t.type]):"value"in t?(e=Xv(t.value),Object.assign({type:e},t,t0[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},t0[e])}function Xv(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const V4="vs",H4="fs";class Jv{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:h={},inject:g={},vertexShader:m,fragmentShader:v}=e;ii(typeof n=="string"),this.name=n,this.vs=i||m,this.fs=r||v,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=h,this.injections=j4(g),o&&(this.uniforms=G4(o))}getModuleSource(e){let n;switch(e){case V4:n=this.vs||"";break;case H4:n=this.fs||"";break;default:ii(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ii(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function j4(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function W4(t){return Q4($x(t))}function Q4(t){const e={},n={};return qx({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function qx(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&qx({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function $x(t,e){return t.map(n=>(n instanceof Jv||(ii(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ii(n.name,"shader module has no name"),n=new Jv(n),n.dependencies=$x(n.dependencies)),n))}function X4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const J4=7936,Y4=7937,K4=7938,Z4=35724,e1={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Hs={};Object.keys(e1).forEach(t=>{Hs[t]=t});function q4(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function $4(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||J4),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||Y4);return{gpuVendor:ek(n,i),vendor:n,renderer:i,version:t.getParameter(K4),shadingLanguageVersion:t.getParameter(Z4)}}function ek(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const n0={};function Yv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=e1[e];if(ii(i,e),!X4(n))return!0;if(e in n0)return n0[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),n0[e]=l,l}function tk(t,e){const n=e1[e];ii(n,e);const i=q4(t)&&n[1]||n[0],r=typeof i=="string"?Boolean(t.getExtension(i)):i;return ii(r===!1||r===!0),r}function eu(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>tk(t,n))}function nk(t){switch($4(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function ik(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return eu(t,Hs.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),eu(t,Hs.GLSL_DERIVATIVES)&&Yv(t,Hs.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),eu(t,Hs.GLSL_FRAG_DATA)&&Yv(t,Hs.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),eu(t,Hs.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const rk=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,sk=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,ok={[tc]:rk,[$m]:sk},Xu="__LUMA_INJECT_DECLARATIONS__",Kv=/void\s+main\s*\([^)]*\)\s*\{\n?/,Zv=/}\n?[^{}]*$/,i0=[];function qv(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===tc;for(const s in n){const o=n[s];o.sort((l,h)=>l.order-h.order),i0.length=o.length;for(let l=0,h=o.length;l<h;++l)i0[l]=o[l].injection;const a="".concat(i0.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(Xu,a));break;case"vs:#main-start":r&&(t=t.replace(Kv,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(Zv,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Xu,a));break;case"fs:#main-start":r||(t=t.replace(Kv,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(Zv,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Xu,""),i&&(t=t.replace(/\}\s*$/,s=>s+ok[e])),t}function ip(t){const e={};return ii(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Fa(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const eb=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ak=[...eb,[Fa("attribute"),"in $1"],[Fa("varying"),"out $1"]],Ak=[...eb,[Fa("varying"),"in $1"]],tb=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],lk=[...tb,[Fa("in"),"attribute $1"],[Fa("out"),"varying $1"]],ck=[...tb,[Fa("in"),"varying $1"]],rp="gl_FragColor",sp=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,uk=/void\s+main\s*\([^)]*\)\s*\{\n?/;function fk(t,e,n){switch(e){case 300:return n?Of(t,ak):hk(t);case 100:return n?Of(t,lk):dk(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Of(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function hk(t){t=Of(t,Ak);const e=t.match(sp);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(rp,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(uk,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(rp,"\\b"),"g"),n)}return t}function dk(t){t=Of(t,ck);const e=t.match(sp);if(e){const n=e[1];t=t.replace(sp,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),rp)}return t}const gk=`

`.concat(Xu,`

`),nb={[tc]:"vertex",[$m]:"fragment"},pk=`precision highp float;

`;function mk(t,e){const{vs:n,fs:i}=e,r=W4(e.modules||[]);return{gl:t,vs:$v(t,Object.assign({},e,{source:n,type:tc,modules:r})),fs:$v(t,Object.assign({},e,{source:i,type:$m,modules:r})),getUniforms:_k(r)}}function $v(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:h=!1,prologue:g=!0,log:m}=e;ii(typeof i=="string","shader source must be a string");const v=r===tc,w=i.split(`
`);let C=100,b="",R=i;w[0].indexOf("#version ")===0?(C=300,b=w[0],R=w.slice(1).join(`
`)):b="#version ".concat(C);const S={};s.forEach(K=>{Object.assign(S,K.getDefines())}),Object.assign(S,o);let P=g?"".concat(b,`
`).concat(vk({id:n,source:i,type:r}),`
`).concat(yk({type:r}),`
`).concat(nk(t),`
`).concat(ik(t),`
`).concat(Ek(S),`
`).concat(v?"":pk,`
`):"".concat(b,`
`);const M=Tk(a),F={},H={},j={};for(const K in l){const ee=typeof l[K]=="string"?{injection:l[K],order:0}:l[K],X=K.match(/^(v|f)s:(#)?([\w-]+)$/);if(X){const U=X[2],D=X[3];U?D==="decl"?H[K]=[ee]:j[K]=[ee]:F[K]=[ee]}else j[K]=[ee]}for(const K of s){m&&K.checkDeprecations(R,m),P+=K.getModuleSource(r,C);const X=K.injections[r];for(const U in X){const D=U.match(/^(v|f)s:#([\w-]+)$/);if(D){const re=D[2]==="decl"?H:j;re[U]=re[U]||[],re[U].push(X[U])}else F[U]=F[U]||[],F[U].push(X[U])}}return P+=gk,P=qv(P,r,H),P+=wk(M[r],F),P+=R,P=qv(P,r,j),P=fk(P,h?100:C,v),P}function _k(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function yk(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(nb[e].toUpperCase(),`
`)}function vk(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(nb[i],`

`):""}function Ek(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function wk(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function Tk(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const Ck="void main() {gl_FragColor = vec4(0);}",ib=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,xk=`#version 300 es
`.concat(ib);function rb(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function sb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?xk:e>300?"#version ".concat(e,`
`).concat(ib):Ck;const s=Pk(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function bk(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ii(!1),null}}function Sk(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ii(!1),null}}function Pk(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ii(!1),null}}const Mk=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Ik={name:"fp32",vs:Mk,fs:null};function Di(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Bk=1/Math.PI*180,Lk=1/180*Math.PI,Zt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Rk(t,{precision:e=Zt.precision}={}){return t=kk(t),"".concat(parseFloat(t.toPrecision(e)))}function ms(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ok(t){return Dk(t)}function Fk(t){return GA(t)}function Dk(t,e){return t1(t,n=>n*Lk,e)}function GA(t,e){return t1(t,n=>n*Bk,e)}function on(t,e,n){return t1(t,i=>Math.max(e,Math.min(n,i)))}function Vi(t,e,n){return ms(t)?t.map((i,r)=>Vi(i,e[r],n)):n*e+(1-n)*t}function ri(t,e,n){const i=Zt.EPSILON;n&&(Zt.EPSILON=n);try{if(t===e)return!0;if(ms(t)&&ms(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!ri(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Zt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Zt.EPSILON=i}}function kk(t){return Math.round(t/Zt.EPSILON)*Zt.EPSILON}function Nk(t){return t.clone?t.clone():new Array(t.length)}function t1(t,e,n){if(ms(t)){const i=t;n=n||Nk(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function Uk(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class n1 extends Uk(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ms(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Zt)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+Rk(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ri(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Zt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function Gk(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function lt(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function rl(t,e,n=""){if(Zt.debug&&!Gk(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class i1 extends n1{get x(){return this[0]}set x(e){this[0]=lt(e)}get y(){return this[1]}set y(e){this[1]=lt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return lt(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return lt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Di(e>=0&&e<this.ELEMENTS,"index is out of range"),lt(this[e])}setComponent(e,n){return Di(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var sl=1e-6,Qi=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function zk(){var t=new Qi(2);return Qi!=Float32Array&&(t[0]=0,t[1]=0),t}function Ff(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ob(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ab(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function Vk(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function Hk(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function Ab(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function lb(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=zk();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function cb(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function ub(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function jk(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function Wk(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function fb(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}class r1 extends i1{constructor(e=0,n=0){super(2),ms(e)&&arguments.length===1?this.copy(e):(Zt.debug&&(lt(e),lt(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Zt.debug&&(lt(e.x),lt(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return lb(this,this,e),this.check()}transformAsVector(e){return cb(this,this,e),this.check()}transformByMatrix3(e){return Ab(this,this,e),this.check()}transformByMatrix2x3(e){return Hk(this,this,e),this.check()}transformByMatrix2(e){return Vk(this,this,e),this.check()}}function hb(){var t=new Qi(3);return Qi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function db(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function e2(t,e,n){var i=new Qi(3);return i[0]=t,i[1]=e,i[2]=n,i}function Qk(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Xk(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function Jk(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Yk(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function s1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ju(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function Kk(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function o1(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function gb(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function pb(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],h=e[2],g=r*h-s*l,m=s*a-i*h,v=i*l-r*a,w=r*v-s*m,C=s*g-i*v,b=i*m-r*g,R=o*2;return g*=R,m*=R,v*=R,w*=2,C*=2,b*=2,t[0]=a+g+w,t[1]=l+m+C,t[2]=h+v+b,t}function Zk(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function qk(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function $k(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function eN(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),h=Math.sqrt(s*s+o*o+a*a),g=l*h,m=g&&s1(t,e)/g;return Math.acos(Math.min(Math.max(m,-1),1))}var mb=Qk,_b=db,r0=Xk;(function(){var t=hb();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const s0=[0,0,0];let tu;class q extends i1{static get ZERO(){return tu||(tu=new q(0,0,0),Object.freeze(tu)),tu}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&ms(e)?this.copy(e):(Zt.debug&&(lt(e),lt(n),lt(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Zt.debug&&(lt(e.x),lt(e.y),lt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=lt(e)}angle(e){return eN(this,e)}cross(e){return Ju(this,this,e),this.check()}rotateX({radians:e,origin:n=s0}){return Zk(this,this,n,e),this.check()}rotateY({radians:e,origin:n=s0}){return qk(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=s0}){return $k(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return o1(this,this,e),this.check()}transformAsVector(e){return ub(this,this,e),this.check()}transformByMatrix3(e){return gb(this,this,e),this.check()}transformByMatrix2(e){return jk(this,this,e),this.check()}transformByQuaternion(e){return pb(this,this,e),this.check()}}let nu;class a1 extends i1{static get ZERO(){return nu||(nu=new a1(0,0,0,0),Object.freeze(nu)),nu}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),ms(e)&&arguments.length===1?this.copy(e):(Zt.debug&&(lt(e),lt(n),lt(i),lt(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Zt.debug&&(lt(e.x),lt(e.y),lt(e.z),lt(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=lt(e)}get w(){return this[3]}set w(e){this[3]=lt(e)}transform(e){return o1(this,this,e),this.check()}transformByMatrix3(e){return fb(this,this,e),this.check()}transformByMatrix2(e){return Wk(this,this,e),this.check()}transformByQuaternion(e){return pb(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class yb extends n1{toString(){let e="[";if(Zt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=lt(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function tN(){var t=new Qi(9);return Qi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function nN(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function iN(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],h=e[7],g=e[8],m=g*o-a*h,v=-g*s+a*l,w=h*s-o*l,C=n*m+i*v+r*w;return C?(C=1/C,t[0]=m*C,t[1]=(-g*i+r*h)*C,t[2]=(a*i-r*o)*C,t[3]=v*C,t[4]=(g*n-r*l)*C,t[5]=(-a*n+r*s)*C,t[6]=w*C,t[7]=(-h*n+i*l)*C,t[8]=(o*n-i*s)*C,t):null}function rN(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*(h*s-o*l)+n*(-h*r+o*a)+i*(l*r-s*a)}function t2(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],g=e[7],m=e[8],v=n[0],w=n[1],C=n[2],b=n[3],R=n[4],S=n[5],P=n[6],M=n[7],F=n[8];return t[0]=v*i+w*o+C*h,t[1]=v*r+w*a+C*g,t[2]=v*s+w*l+C*m,t[3]=b*i+R*o+S*h,t[4]=b*r+R*a+S*g,t[5]=b*s+R*l+S*m,t[6]=P*i+M*o+F*h,t[7]=P*r+M*a+F*g,t[8]=P*s+M*l+F*m,t}function sN(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],g=e[7],m=e[8],v=n[0],w=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=v*i+w*o+h,t[7]=v*r+w*a+g,t[8]=v*s+w*l+m,t}function oN(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],g=e[7],m=e[8],v=Math.sin(n),w=Math.cos(n);return t[0]=w*i+v*o,t[1]=w*r+v*a,t[2]=w*s+v*l,t[3]=w*o-v*i,t[4]=w*a-v*r,t[5]=w*l-v*s,t[6]=h,t[7]=g,t[8]=m,t}function n2(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function aN(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,h=n*o,g=i*o,m=i*a,v=r*o,w=r*a,C=r*l,b=s*o,R=s*a,S=s*l;return t[0]=1-m-C,t[3]=g-S,t[6]=v+R,t[1]=g+S,t[4]=1-h-C,t[7]=w-b,t[2]=v-R,t[5]=w+b,t[8]=1-h-m,t}var op;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(op||(op={}));const AN=Object.freeze([1,0,0,0,1,0,0,0,1]);class qt extends yb{static get IDENTITY(){return cN()}static get ZERO(){return lN()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return op}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(AN)}fromObject(e){return this.check()}fromQuaternion(e){return aN(this,e),this.check()}set(e,n,i,r,s,o,a,l,h){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=h,this.check()}setRowMajor(e,n,i,r,s,o,a,l,h){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=s,this[5]=l,this[6]=i,this[7]=o,this[8]=h,this.check()}determinant(){return rN(this)}transpose(){return nN(this,this),this.check()}invert(){return iN(this,this),this.check()}multiplyLeft(e){return t2(this,e,this),this.check()}multiplyRight(e){return t2(this,this,e),this.check()}rotate(e){return oN(this,this,e),this.check()}scale(e){return Array.isArray(e)?n2(this,this,e):n2(this,this,[e,e]),this.check()}translate(e){return sN(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=Ab(n||[-0,-0],e,this);break;case 3:i=gb(n||[-0,-0,-0],e,this);break;case 4:i=fb(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let iu,ru;function lN(){return iu||(iu=new qt([0,0,0,0,0,0,0,0,0]),Object.freeze(iu)),iu}function cN(){return ru||(ru=new qt,Object.freeze(ru)),ru}function uN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fN(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ap(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],h=e[7],g=e[8],m=e[9],v=e[10],w=e[11],C=e[12],b=e[13],R=e[14],S=e[15],P=n*a-i*o,M=n*l-r*o,F=n*h-s*o,H=i*l-r*a,j=i*h-s*a,K=r*h-s*l,ee=g*b-m*C,X=g*R-v*C,U=g*S-w*C,D=m*R-v*b,ae=m*S-w*b,re=v*S-w*R,te=P*re-M*ae+F*D+H*U-j*X+K*ee;return te?(te=1/te,t[0]=(a*re-l*ae+h*D)*te,t[1]=(r*ae-i*re-s*D)*te,t[2]=(b*K-R*j+S*H)*te,t[3]=(v*j-m*K-w*H)*te,t[4]=(l*U-o*re-h*X)*te,t[5]=(n*re-r*U+s*X)*te,t[6]=(R*F-C*K-S*M)*te,t[7]=(g*K-v*F+w*M)*te,t[8]=(o*ae-a*U+h*ee)*te,t[9]=(i*U-n*ae-s*ee)*te,t[10]=(C*j-b*F+S*P)*te,t[11]=(m*F-g*j-w*P)*te,t[12]=(a*X-o*D-l*ee)*te,t[13]=(n*D-i*X+r*ee)*te,t[14]=(b*M-C*H-R*P)*te,t[15]=(g*H-m*M+v*P)*te,t):null}function hN(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],g=t[9],m=t[10],v=t[11],w=t[12],C=t[13],b=t[14],R=t[15],S=e*o-n*s,P=e*a-i*s,M=e*l-r*s,F=n*a-i*o,H=n*l-r*o,j=i*l-r*a,K=h*C-g*w,ee=h*b-m*w,X=h*R-v*w,U=g*b-m*C,D=g*R-v*C,ae=m*R-v*b;return S*ae-P*D+M*U+F*X-H*ee+j*K}function $s(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],g=e[7],m=e[8],v=e[9],w=e[10],C=e[11],b=e[12],R=e[13],S=e[14],P=e[15],M=n[0],F=n[1],H=n[2],j=n[3];return t[0]=M*i+F*a+H*m+j*b,t[1]=M*r+F*l+H*v+j*R,t[2]=M*s+F*h+H*w+j*S,t[3]=M*o+F*g+H*C+j*P,M=n[4],F=n[5],H=n[6],j=n[7],t[4]=M*i+F*a+H*m+j*b,t[5]=M*r+F*l+H*v+j*R,t[6]=M*s+F*h+H*w+j*S,t[7]=M*o+F*g+H*C+j*P,M=n[8],F=n[9],H=n[10],j=n[11],t[8]=M*i+F*a+H*m+j*b,t[9]=M*r+F*l+H*v+j*R,t[10]=M*s+F*h+H*w+j*S,t[11]=M*o+F*g+H*C+j*P,M=n[12],F=n[13],H=n[14],j=n[15],t[12]=M*i+F*a+H*m+j*b,t[13]=M*r+F*l+H*v+j*R,t[14]=M*s+F*h+H*w+j*S,t[15]=M*o+F*g+H*C+j*P,t}function Df(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,h,g,m,v,w,C,b,R,S;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],m=e[5],v=e[6],w=e[7],C=e[8],b=e[9],R=e[10],S=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=h,t[4]=g,t[5]=m,t[6]=v,t[7]=w,t[8]=C,t[9]=b,t[10]=R,t[11]=S,t[12]=o*i+g*r+C*s+e[12],t[13]=a*i+m*r+b*s+e[13],t[14]=l*i+v*r+R*s+e[14],t[15]=h*i+w*r+S*s+e[15]),t}function A1(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dN(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,h,g,m,v,w,C,b,R,S,P,M,F,H,j,K,ee,X,U,D,ae,re,te,oe;return a<sl?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),h=Math.cos(n),g=1-h,m=e[0],v=e[1],w=e[2],C=e[3],b=e[4],R=e[5],S=e[6],P=e[7],M=e[8],F=e[9],H=e[10],j=e[11],K=r*r*g+h,ee=s*r*g+o*l,X=o*r*g-s*l,U=r*s*g-o*l,D=s*s*g+h,ae=o*s*g+r*l,re=r*o*g+s*l,te=s*o*g-r*l,oe=o*o*g+h,t[0]=m*K+b*ee+M*X,t[1]=v*K+R*ee+F*X,t[2]=w*K+S*ee+H*X,t[3]=C*K+P*ee+j*X,t[4]=m*U+b*D+M*ae,t[5]=v*U+R*D+F*ae,t[6]=w*U+S*D+H*ae,t[7]=C*U+P*D+j*ae,t[8]=m*re+b*te+M*oe,t[9]=v*re+R*te+F*oe,t[10]=w*re+S*te+H*oe,t[11]=C*re+P*te+j*oe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function vb(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],h=e[8],g=e[9],m=e[10],v=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+h*i,t[5]=o*r+g*i,t[6]=a*r+m*i,t[7]=l*r+v*i,t[8]=h*r-s*i,t[9]=g*r-o*i,t[10]=m*r-a*i,t[11]=v*r-l*i,t}function gN(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],h=e[8],g=e[9],m=e[10],v=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-h*i,t[1]=o*r-g*i,t[2]=a*r-m*i,t[3]=l*r-v*i,t[8]=s*i+h*r,t[9]=o*i+g*r,t[10]=a*i+m*r,t[11]=l*i+v*r,t}function Eb(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],m=e[6],v=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+h*i,t[1]=o*r+g*i,t[2]=a*r+m*i,t[3]=l*r+v*i,t[4]=h*r-s*i,t[5]=g*r-o*i,t[6]=m*r-a*i,t[7]=v*r-l*i,t}function pN(t,e){var n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],h=e[9],g=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,h,g),t}function mN(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,h=n*o,g=i*o,m=i*a,v=r*o,w=r*a,C=r*l,b=s*o,R=s*a,S=s*l;return t[0]=1-m-C,t[1]=g+S,t[2]=v-R,t[3]=0,t[4]=g-S,t[5]=1-h-C,t[6]=w+b,t[7]=0,t[8]=v+R,t[9]=w-b,t[10]=1-h-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _N(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),h=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0,t}function yN(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var vN=yN;function EN(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*h,t[15]=1,t}var wN=EN;function TN(t,e,n,i){var r,s,o,a,l,h,g,m,v,w,C=e[0],b=e[1],R=e[2],S=i[0],P=i[1],M=i[2],F=n[0],H=n[1],j=n[2];return Math.abs(C-F)<sl&&Math.abs(b-H)<sl&&Math.abs(R-j)<sl?uN(t):(g=C-F,m=b-H,v=R-j,w=1/Math.hypot(g,m,v),g*=w,m*=w,v*=w,r=P*v-M*m,s=M*g-S*v,o=S*m-P*g,w=Math.hypot(r,s,o),w?(w=1/w,r*=w,s*=w,o*=w):(r=0,s=0,o=0),a=m*o-v*s,l=v*r-g*o,h=g*s-m*r,w=Math.hypot(a,l,h),w?(w=1/w,a*=w,l*=w,h*=w):(a=0,l=0,h=0),t[0]=r,t[1]=a,t[2]=g,t[3]=0,t[4]=s,t[5]=l,t[6]=m,t[7]=0,t[8]=o,t[9]=h,t[10]=v,t[11]=0,t[12]=-(r*C+s*b+o*R),t[13]=-(a*C+l*b+h*R),t[14]=-(g*C+m*b+v*R),t[15]=1,t)}function CN(){var t=new Qi(4);return Qi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function xN(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function l1(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function bN(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function SN(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function PN(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}function MN(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function IN(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t}function ja(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function BN(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],h=n[3],g=h*i+a*s-l*r,m=h*r+l*i-o*s,v=h*s+o*r-a*i,w=-o*i-a*r-l*s;return t[0]=g*h+w*-o+m*-l-v*-a,t[1]=m*h+w*-a+v*-o-g*-l,t[2]=v*h+w*-l+g*-a-m*-o,t[3]=e[3],t}(function(){var t=CN();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Ap;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Ap||(Ap={}));const LN=45*Math.PI/180,RN=1,o0=.1,a0=500,ON=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ze extends yb{static get IDENTITY(){return DN()}static get ZERO(){return FN()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ap}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,h,g,m,v,w,C,b,R){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=h,this[9]=g,this[10]=m,this[11]=v,this[12]=w,this[13]=C,this[14]=b,this[15]=R,this.check()}setRowMajor(e,n,i,r,s,o,a,l,h,g,m,v,w,C,b,R){return this[0]=e,this[1]=s,this[2]=h,this[3]=w,this[4]=n,this[5]=o,this[6]=g,this[7]=C,this[8]=i,this[9]=a,this[10]=m,this[11]=b,this[12]=r,this[13]=l,this[14]=v,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(ON)}fromObject(e){return this.check()}fromQuaternion(e){return mN(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=o0,far:a=a0}=e;return a===1/0?kN(this,n,i,r,s,o):_N(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return TN(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=o0,far:a=a0}=e;return wN(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=LN,aspect:i=RN,focalDistance:r=1,near:s=o0,far:o=a0}=e;i2(n);const a=n/2,l=r*Math.tan(a),h=l*i;return this.ortho({left:-h,right:h,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return i2(n),vN(this,n,i,r,s),this.check()}determinant(){return hN(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return fN(this,this),this.check()}invert(){return ap(this,this),this.check()}multiplyLeft(e){return $s(this,e,this),this.check()}multiplyRight(e){return $s(this,this,e),this.check()}rotateX(e){return vb(this,this,e),this.check()}rotateY(e){return gN(this,this,e),this.check()}rotateZ(e){return Eb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return dN(this,this,e,n),this.check()}scale(e){return A1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Df(this,this,e),this.check()}transform(e,n){return e.length===4?(n=ja(n||[-0,-0,-0,-0],e,this),rl(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=lb(n||[-0,-0],e,this);break;case 3:r=o1(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=cb(n||[-0,-0],e,this);break;case 3:i=ub(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let su,ou;function FN(){return su||(su=new ze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(su)),su}function DN(){return ou||(ou=new ze,Object.freeze(ou)),ou}function i2(t){if(t>Math.PI*2)throw Error("expected radians")}function kN(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),h=(r+i)/(r-i),g=-1,m=-1,v=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=h,t[10]=g,t[11]=m,t[12]=0,t[13]=0,t[14]=v,t[15]=0,t}function r2(){var t=new Qi(4);return Qi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function NN(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function wb(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function s2(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],h=n[2],g=n[3];return t[0]=i*g+o*a+r*h-s*l,t[1]=r*g+o*l+s*a-i*h,t[2]=s*g+o*h+i*l-r*a,t[3]=o*g-i*a-r*l-s*h,t}function UN(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a,t}function GN(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a,t}function zN(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function VN(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function Yu(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3],l=n[0],h=n[1],g=n[2],m=n[3],v,w,C,b,R;return w=r*l+s*h+o*g+a*m,w<0&&(w=-w,l=-l,h=-h,g=-g,m=-m),1-w>sl?(v=Math.acos(w),C=Math.sin(v),b=Math.sin((1-i)*v)/C,R=Math.sin(i*v)/C):(b=1-i,R=i),t[0]=b*r+R*l,t[1]=b*s+R*h,t[2]=b*o+R*g,t[3]=b*a+R*m,t}function HN(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function jN(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Tb(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[s*3+s]-e[o*3+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+r]+e[r*3+s])*i,t[o]=(e[o*3+r]+e[r*3+o])*i}return t}var WN=xN,QN=l1,XN=MN,JN=IN,YN=bN,KN=SN,Cb=PN,ZN=function(){var t=hb(),e=e2(1,0,0),n=e2(0,1,0);return function(i,r,s){var o=s1(r,s);return o<-.999999?(Ju(t,e,r),_b(t)<1e-6&&Ju(t,n,r),Yk(t,t),wb(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ju(t,r,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,Cb(i,i))}}();(function(){var t=r2(),e=r2();return function(n,i,r,s,o,a){return Yu(t,i,o,a),Yu(e,r,s,a),Yu(n,t,e,2*a*(1-a)),n}})();(function(){var t=tN();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Cb(e,Tb(e,t))}})();const qN=[0,0,0,1];class Pl extends n1{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Tb(this,e),this.check()}fromAxisRotation(e,n){return wb(this,e,n),this.check()}identity(){return NN(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=lt(e)}get y(){return this[1]}set y(e){this[1]=lt(e)}get z(){return this[2]}set z(e){this[2]=lt(e)}get w(){return this[3]}set w(e){this[3]=lt(e)}len(){return YN(this)}lengthSquared(){return KN(this)}dot(e){return XN(this,e)}rotationTo(e,n){return ZN(this,e,n),this.check()}add(e){return WN(this,this,e),this.check()}calculateW(){return VN(this,this),this.check()}conjugate(){return jN(this,this),this.check()}invert(){return HN(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(JN(this,e,n,i),this.check())}multiplyRight(e){return s2(this,this,e),this.check()}multiplyLeft(e){return s2(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return UN(this,this,e),this.check()}rotateY(e){return GN(this,this,e),this.check()}rotateZ(e){return zN(this,this,e),this.check()}scale(e){return QN(this,this,e),this.check()}slerp(e,n,i){let r,s,o;switch(arguments.length){case 1:({start:r=qN,target:s,ratio:o}=e);break;case 2:r=this,s=e,o=n;break;default:r=e,s=n,o=i}return Yu(this,r,s,o),this.check()}transformVector4(e,n=new a1){return BN(n,e,this),rl(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Ml={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},o2=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,$N={lightSources:{}};function A0(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function e8(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=A0(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=A0(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=A0(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function xb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$N;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},e8({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return xb({lightSources:e})}return{}}const c1={name:"lights",vs:o2,fs:o2,getUniforms:xb,defines:{MAX_LIGHTS:3}},t8=new Uint8Array([0,255,255,255]),n8={pickingSelectedColor:null,pickingHighlightColor:t8,pickingActive:!1,pickingAttribute:!1};function i8(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:n8;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const r8=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,s8=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,o8={name:"picking",vs:r8,fs:s8,getUniforms:i8},bb=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,a8={};function A8(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function Sb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a8;if(!("material"in t))return{};const{material:e}=t;return e?A8(e):{lighting_uEnabled:!1}}const u1={name:"gouraud-lighting",dependencies:[c1],vs:bb,defines:{LIGHTING_VERTEX:1},getUniforms:Sb},Pb={name:"phong-lighting",dependencies:[c1],fs:bb,defines:{LIGHTING_FRAGMENT:1},getUniforms:Sb},l8=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,c8=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,f1={name:"pbr",vs:l8,fs:c8,defines:{LIGHTING_FRAGMENT:1},dependencies:[c1]},u8=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,f8={name:"transform",vs:u8,fs:null};class nc{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new nc(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,h=this._getModuleList(e.modules),g=this._getHash(n),m=this._getHash(i),v=h.map(M=>this._getHash(M.name)).sort(),w=o.map(M=>this._getHash(M)),C=Object.keys(r).sort(),b=Object.keys(s).sort(),R=[],S=[];for(const M of C)R.push(this._getHash(M)),R.push(this._getHash(r[M]));for(const M of b)S.push(this._getHash(M)),S.push(this._getHash(s[M]));const P="".concat(g,"/").concat(m,"D").concat(R.join("/"),"M").concat(v.join("/"),"I").concat(S.join("/"),"V").concat(w.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[P]){const M=mk(this.gl,{vs:n,fs:i,modules:h,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[P]=new Kx(this.gl,{hash:P,vs:M.vs,fs:M.fs,varyings:o,bufferMode:a}),this._getUniforms[P]=M.getUniforms||(F=>{}),this._useCounts[P]=0}return this._useCounts[P]++,this._programCache[P]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const h8={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function d8(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=g8(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,h={...o};delete h.value,i[a]=[new ft(t,l),h],p8(s,h)}}if(r){const s=r.value||r;we(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new ft(t,{data:s,target:34963}),o]}return i}function g8(t,e){const{attributeMap:n=h8}=e||{};return n&&n[t]||t}function p8(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}we(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Fo=2,m8=1e4,_8="Model needs drawMode and vertexCount",a2=()=>{},y8={};class Cn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Wi("model")}=n;we(Eh(e)),this.id=i,this.gl=e,this.id=n.id||Wi("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||nc.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:h,transpileToGLSL100:g}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:h,transpileToGLSL100:g},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},we(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),_8)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:h,transpileToGLSL100:g}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:h,transpileToGLSL100:g},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return we(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return we(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=d8(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Oa(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Km(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let h;Le.priority>=Fo&&(h=this._logDrawCallStart(Fo));const g=this.vertexArray.getDrawParams(),{isIndexed:m=g.isIndexed,indexType:v=g.indexType,indexOffset:w=g.indexOffset,vertexArrayInstanced:C=g.isInstanced}=this.props;C&&!this.isInstanced&&Le.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:b,instanceCount:R}=this,{onBeforeRender:S=a2,onAfterRender:P=a2}=this.props;S(),this.program.setUniforms(this.uniforms);const M=this.program.draw(Object.assign(y8,e,{logPriority:h,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:m,indexType:v,isInstanced:b,instanceCount:R,offset:m?w:0}));return P(),Le.priority>=Fo&&this._logDrawCallEnd(h,l,i),M}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Le.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:h,transpileToGLSL100:g}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:h,transpileToGLSL100:g}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}we(n instanceof Kx,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new L4(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof ft&&n.delete()}}_setAnimationProps(e){this.animated&&we(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Oa(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new Zx(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:m8;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Le.group(Fo,">>> DRAWING MODEL ".concat(this.id),{collapsed:Le.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=F4({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Hv({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:h,count:g}=Hv({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});g>0&&Le.log("MISSING UNIFORMS",Object.keys(h))(),l>0&&Le.log("UNUSED UNIFORMS",Object.keys(a))();const m=k4(this.vertexArray.configuration);Le.table(e,s)(),Le.table(e,o)(),Le.table(e+1,m)(),r&&r.log({logLevel:Fo,message:"Rendered to ".concat(r.id)}),Le.groupEnd(Fo)()}}class v8{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof ft?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&we(Xe(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:h}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:h})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new Zx(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],we(i[s]instanceof ft)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new ft(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const E8="transform_uSampler_",kf="transform_uSize_",A2="transform_position";function w8(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const l={};let h=e,g={};if(o>0||i){const m=h.split(`
`),v=m.slice();if(m.forEach((w,C,b)=>{if(o>0){const R=S8(w,n);if(R){const{updatedLine:S,inject:P}=R;v[C]=S,g=ip([g,P]),Object.assign(l,R.samplerTextureMap),o--}}i&&!a&&(a=b8(w,i))}),i){we(r);const w="".concat(kf).concat(i),C="uniform vec2 ".concat(w,`;
`),b="     vec2 ".concat(A2," = transform_getPos(").concat(w,`);
     gl_Position = vec4(`).concat(A2,`, 0, 1.);
`);g=ip([g,{"vs:#decl":C,"vs:#main-start":b}])}h=v.join(`
`)}return{vs:h,targetTextureType:a,inject:g,samplerTextureMap:l}}function T8(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(kf).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(kf).concat(a)]=[s,o];return r}function C8(t){return rb(t,["attribute","in"])}function x8(t){const e="".concat(E8).concat(t),n="".concat(kf).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function b8(t,e){const n=rb(t,["varying","out"]);return n&&n.name===e?n.type:null}function S8(t,e){const n={},i=C8(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:h}=x8(s),g=bk(r),m="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(g,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":h,"vs:#main-start":m},samplerTextureMap:n}}return null}const P8={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},M8="transform_output";class I8{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let h=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const m in this.samplerTextureMap){const v=this.samplerTextureMap[m];a[m]=i[v]}this._setSourceTextureParameters();const g=T8({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,g)}return this.hasTargetTexture&&(h=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:h,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Th(n);if(!e)return i;const r=i.constructor,s=Sk(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let h=0;h<s;h++)o[a++]=i[l+h];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof hn)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new ft(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new Wt(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(P8)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=ED(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=w8({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),h=ip([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const g=e._fs||sb({version:Jx(r),input:this.targetTextureVarying,inputType:o,output:M8}),m=this.hasSourceTextures||this.targetTextureVarying?[f8].concat(e.modules||[]):e.modules;return{vs:r,fs:g,modules:m,uniforms:s,inject:h}}}class h1{static isSupported(e){return Xe(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();we(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Cn(n,Object.assign({},e,{fs:e.fs||sb({version:Jx(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){B8(n)&&(this.bufferTransform=new v8(e,n)),L8(n)&&(this.textureTransform=new I8(e,n)),we(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function B8(t){return!!(!Oa(t.feedbackBuffers)||!Oa(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function L8(t){return!!(!Oa(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const l2={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Bn{static get DRAW_MODE(){return l2}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Wi("geometry"),drawMode:i=l2.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,we(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(we(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return we(Number.isFinite(i)),i}}const R8=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),O8=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),F8=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),D8=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),k8={POSITION:{size:3,value:new Float32Array(O8)},NORMAL:{size:3,value:new Float32Array(F8)},TEXCOORD_0:{size:2,value:new Float32Array(D8)}};class N8 extends Bn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Wi("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(R8)},attributes:{...k8,...e.attributes}})}}let U8=1,G8=1;class Mb{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=U8++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=G8++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const Ib="#define SMOOTH_EDGE_RADIUS 0.5",z8=`
`.concat(Ib,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),V8=`
`.concat(Ib,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),H8={name:"geometry",vs:z8,fs:V8},Ge={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ge,"IDENTITY",{get:()=>(De.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ki={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},oi={common:0,meters:1,pixels:2},c2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ic={DRAW:"draw",MASK:"mask"},j8=Object.keys(Ge).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Ge[t],";")).join(""),W8=Object.keys(ki).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(ki[t],";")).join(""),Q8=Object.keys(oi).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(oi[t],";")).join(""),X8="".concat(j8,`
`).concat(W8,`
`).concat(Q8,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);
      return 1.0 / cos(radians(y));
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}
//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size(position_world.z),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function J8(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function rc(t){let e={},n;return i=>{for(const r in i)if(!J8(i[r],e[r])){n=t(i),e=i;break}return n}}const u2=[0,0,0,0],Y8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Bb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],K8=[0,0,0],Lb=[0,0,0],Z8=rc(e6);function Rb(t,e,n=Lb){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===Ge.LNGLAT_OFFSETS||e===Ge.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ki.WEB_MERCATOR:(e===Ge.LNGLAT||e===Ge.CARTESIAN)&&(r=[0,0,0],s=!1);break;case ki.WEB_MERCATOR_AUTO_OFFSET:e===Ge.LNGLAT?i=r:e===Ge.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case ki.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case ki.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function q8(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=u2,l=u2,h=t.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:m,offsetMode:v}=Rb(t,e,n);return v&&(l=t.projectPosition(g||m),h=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],l[3]=1,a=ja([],l,o),s=i||s,o=$s([],r,s),o=$s([],o,Y8)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:h,shaderCoordinateOrigin:m,geospatialOrigin:g}}function $8({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Ge.DEFAULT,coordinateOrigin:r=Lb,autoWrapLongitude:s=!1}){i===Ge.DEFAULT&&(i=t.isGeospatial?Ge.LNGLAT:Ge.CARTESIAN);const o=Z8({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Bb,o}function e6({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:h}=q8(t,n,i),g=t.getDistanceScales(),m=[t.width*e,t.height*e],v=ja([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,w={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:m,project_uDevicePixelRatio:e,project_uFocalDistance:v,project_uCommonUnitsPerMeter:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:K8,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Bb,project_uCameraPosition:a};if(h){const C=t.getDistanceScales(h);switch(n){case Ge.METER_OFFSETS:w.project_uCommonUnitsPerWorldUnit=C.unitsPerMeter,w.project_uCommonUnitsPerWorldUnit2=C.unitsPerMeter2;break;case Ge.LNGLAT:case Ge.LNGLAT_OFFSETS:t._pseudoMeters||(w.project_uCommonUnitsPerMeter=C.unitsPerMeter),w.project_uCommonUnitsPerWorldUnit=C.unitsPerDegree,w.project_uCommonUnitsPerWorldUnit2=C.unitsPerDegree2;break;case Ge.CARTESIAN:w.project_uCommonUnitsPerWorldUnit=[1,1,C.unitsPerMeter[2]],w.project_uCommonUnitsPerWorldUnit2=[0,0,C.unitsPerMeter2[2]];break}}return w}const t6={};function n6(t=t6){return"viewport"in t?$8(t):{}}const d1={name:"project",dependencies:[Ik,H8],vs:X8,getUniforms:n6},i6=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ti={name:"project32",dependencies:[d1],vs:i6};function r6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ya(t,e){const n=ja([],e,t);return l1(n,n,1/n[3]),n}function f2(t,e){const n=t%e;return n<0?e+n:n}function lp(t,e,n){return t<e?e:t>n?n:t}function s6(t){return Math.log(t)*Math.LOG2E}const g1=Math.log2||s6;function Mr(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ni=Math.PI,Ob=Ni/4,Hi=Ni/180,cp=180/Ni,Il=512,up=4003e4,au=85.051129,o6=1.5;function a6(t){return g1(t)}function _s(t){const[e,n]=t;Mr(Number.isFinite(e)),Mr(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Hi,r=n*Hi,s=Il*(i+Ni)/(2*Ni),o=Il*(Ni+Math.log(Math.tan(Ob+r*.5)))/(2*Ni);return[s,o]}function ys(t){const[e,n]=t,i=e/Il*(2*Ni)-Ni,r=2*(Math.atan(Math.exp(n/Il*(2*Ni)-Ni))-Ob);return[i*cp,r*cp]}function A6(t){const{latitude:e}=t;Mr(Number.isFinite(e));const n=Math.cos(e*Hi);return a6(up*n)-9}function fp(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Mr(Number.isFinite(e)&&Number.isFinite(n));const r=Il,s=Math.cos(e*Hi),o=r/360,a=o/s,l=r/up/s,h={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const g=Hi*Math.tan(e*Hi)/s,m=o*g/2,v=r/up*g,w=v/a*l;h.unitsPerDegree2=[0,m,v],h.unitsPerMeter2=[w,0,w]}return h}function Fb(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:h}=fp({longitude:n,latitude:i,highPrecision:!0}),g=_s(t);g[0]+=s*(l[0]+h[0]*o),g[1]+=o*(l[1]+h[1]*o);const m=ys(g),v=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[m[0],m[1],v]:m}function l6(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=r6();Df(a,a,[0,0,-r]),vb(a,a,-n*Hi),Eb(a,a,i*Hi);const l=s/e;return A1(a,a,[l,l,l]),o&&Df(a,a,Jk([],o)),a}function c6(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:h=1}=t;let{fovy:g=Nf(o6)}=t;i!==void 0&&(g=Nf(i));const m=g*Hi,v=r*Hi,w=Db(g);let C=w;o&&(C+=o[2]*a/Math.cos(v)/n);const b=m*(.5+(s?s[1]:0)/n),R=Math.sin(b)*C/Math.sin(lp(Math.PI/2-v-b,.01,Math.PI-.01)),S=Math.sin(v)*R+C,P=C*10,M=Math.min(S*h,P);return{fov:m,aspect:e/n,focalDistance:w,near:l,far:M}}function Nf(t){return 2*Math.atan(.5/t)*cp}function Db(t){return .5/Math.tan(.5*t*Hi)}function kb(t,e){const[n,i,r=0]=t;return Mr(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),ya(e,[n,i,r,1])}function xh(t,e,n=0){const[i,r,s]=t;if(Mr(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return ya(e,[i,r,s,1]);const o=ya(e,[i,r,0,1]),a=ya(e,[i,r,1,1]),l=o[2],h=a[2],g=l===h?0:((n||0)-l)/(h-l);return ab([],o,a,g)}function Nb(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[h,g]]=i,m=u6(t.padding),v=_s([a,lp(g,-au,au)]),w=_s([h,lp(l,-au,au)]),C=[Math.max(Math.abs(w[0]-v[0]),r),Math.max(Math.abs(w[1]-v[1]),r)],b=[e-m.left-m.right-Math.abs(o[0])*2,n-m.top-m.bottom-Math.abs(o[1])*2];Mr(b[0]>0&&b[1]>0);const R=b[0]/C[0],S=b[1]/C[1],P=(m.right-m.left)/2/R,M=(m.top-m.bottom)/2/S,F=[(w[0]+v[0])/2+P,(w[1]+v[1])/2+M],H=ys(F),j=Math.min(s,g1(Math.abs(Math.min(R,S))));return Mr(Number.isFinite(j)),{longitude:H[0],latitude:H[1],zoom:j}}function u6(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Mr(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const h2=Math.PI/180;function f6(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,h;const g=t.fovy?.5*t.fovy*h2:Math.atan(.5/t.altitude),m=(90-t.pitch)*h2;return g>m-.01?(l=d2(t,0,e),h=d2(t,n,e)):(l=r([0,0],s),h=r([n,0],s)),[o,a,h,l]}function d2(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=ya(i,[e,0,1,1]),s=ya(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=ab([],r,s,a),h=ys(l);return h.push(n),h}const g2=512;function h6(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=f2(r+180,360)-180),(a<-180||a>180)&&(a=f2(a+180,360)-180);const l=g1(n/g2);if(o<=l)o=l,s=0;else{const h=n/2/Math.pow(2,o),g=ys([0,h])[1];if(s<g)s=g;else{const m=ys([0,g2-h])[1];s>m&&(s=m)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const d6=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,g6=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,p6=rc(E6),m6=rc(w6),_6=[0,0,0,1],y6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function v6(t,e){const[n,i,r]=t,s=xh([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function E6({viewport:t,center:e}){return new ze(t.viewProjectionMatrix).invert().transform(e)}function w6({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>v6(o,i));for(const o of e){const a=o.clone().translate(new q(t.center).negate()),l=s.map(g=>a.transform(g)),h=new ze().ortho({left:Math.min(...l.map(g=>g[0])),right:Math.max(...l.map(g=>g[0])),bottom:Math.min(...l.map(g=>g[1])),top:Math.max(...l.map(g=>g[1])),near:Math.min(...l.map(g=>-g[2])),far:Math.max(...l.map(g=>-g[2]))});n.push(h.multiplyRight(o))}return n}function T6(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||_6,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=p6({viewport:t.viewport,center:e.project_uCenter}),s=[],o=m6({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],h=l.clone().translate(new q(t.viewport.center).negate());e.project_uCoordinateSystem===Ge.LNGLAT&&e.project_uProjectionMode===ki.WEB_MERCATOR?(o[a]=h,s[a]=r):(o[a]=l.clone().multiplyRight(y6),s[a]=h.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const l0={name:"shadow",dependencies:[d1],vs:d6,fs:g6,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?T6(t,e):{}},Ci={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...o8},C6=[d1],x6=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function b6(t){const e=nc.getDefaultProgramManager(t);for(const n of C6)e.addDefaultModule(n);for(const n of x6)e.addShaderHook(n);return e}const S6=[255,255,255],P6=1;let M6=0;class Ub{constructor(e={}){T(this,"id",void 0),T(this,"color",void 0),T(this,"intensity",void 0),T(this,"type","ambient");const{color:n=S6}=e,{intensity:i=P6}=e;this.id=e.id||"ambient-".concat(M6++),this.color=n,this.intensity=i}}const I6=[255,255,255],B6=1,L6=[0,0,-1];let R6=0;class p2{constructor(e={}){T(this,"id",void 0),T(this,"color",void 0),T(this,"intensity",void 0),T(this,"type","directional"),T(this,"direction",void 0),T(this,"shadow",void 0);const{color:n=I6}=e,{intensity:i=B6}=e,{direction:r=L6}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(R6++),this.color=n,this.intensity=i,this.type="directional",this.direction=new q(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class O6{constructor(e,n={id:"pass"}){T(this,"id",void 0),T(this,"gl",void 0),T(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class bh extends O6{constructor(...e){super(...e),T(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Pr(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const h=this.gl;l&&D6(h),a&&(this._lastRenderIndex=-1);const g=[];for(const m of r){const v=s&&s[m.id];o(m);const w=this._getDrawLayerParams(m,e),C=m.subViewports||[m];for(const b of C){const R=this._drawLayersInViewport(h,{target:n,moduleParameters:i,viewport:b,view:v,pass:e.pass,layers:e.layers},w);g.push(R)}}return g}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const l=[],h=Gb(this._lastRenderIndex+1),g={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},m={};for(let v=0;v<n.length;v++){const w=n[v],C=this._shouldDrawLayer(w,g,r,m),b={shouldDrawLayer:C};C&&(b.layerRenderIndex=h(w,C),b.moduleParameters=this._getModuleParameters(w,o,i,a),b.layerParameters=this.getLayerParameters(w,v,e)),l[v]=b}return l}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const h=F6(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const m=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;vi(e,{scissorTest:!0,scissor:h},()=>Km(e,m))}const g={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Pr(e,{viewport:h});for(let m=0;m<n.length;m++){const v=n[m],{shouldDrawLayer:w,layerRenderIndex:C,moduleParameters:b,layerParameters:R}=l[m];if(w&&v.props.pickable&&g.pickableCount++,v.isComposite)g.compositeCount++;else if(w){g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,C),b.viewport=o;try{v._drawLayer({moduleParameters:b,uniforms:{layerIndex:C},parameters:R})}catch(S){v.raiseError(S,"drawing ".concat(v," to ").concat(r))}}}return g}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Ra(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function Gb(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let h;if(l&&!(l in e)&&i(r.parent,!1),l in n){const g=n[l]=n[l]||Gb(e[l],e);h=g(r,s),n[a]=g}else Number.isFinite(o)?(h=o+(e[l]||0),n[a]=null):h=t;return s&&h>=t&&(t=h+1),e[a]=h,h};return i}function F6(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Ra(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function D6(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Pr(t,{viewport:[0,0,e,n]}),t.clear(16640)}class k6 extends bh{constructor(e,n){super(e,n),T(this,"shadowMap",void 0),T(this,"depthBuffer",void 0),T(this,"fbo",void 0),this.shadowMap=new hn(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new ia(e,{format:33189,width:1,height:1}),this.fbo=new Wt(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;vi(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Ra(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const N6={color:[255,255,255],intensity:1},m2=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],U6=[0,0,0,200/255];class p1{constructor(e={}){T(this,"id","lighting-effect"),T(this,"props",null),T(this,"shadowColor",U6),T(this,"shadow",void 0),T(this,"ambientLight",null),T(this,"directionalLights",[]),T(this,"pointLights",[]),T(this,"shadowPasses",[]),T(this,"shadowMaps",[]),T(this,"dummyShadowMap",null),T(this,"programManager",void 0),T(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=nc.getDefaultProgramManager(e),l0&&this.programManager.addDefaultModule(l0)),this.dummyShadowMap||(this.dummyShadowMap=new hn(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(l0),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new ze().lookAt({eye:new q(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new k6(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new Ub(N6),this.directionalLights.push(new p2(m2[0]),new p2(m2[1])))}}class G6{constructor(e={}){T(this,"_pool",[]),T(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const h=r||e&&e.constructor||Float32Array,g=n*i+s;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,g)}let m=1/0;l&&(m=l*i+s);const v=this._allocate(h,g,a,m);return e&&o?v.set(e):a||v.fill(0,0,4),this._release(e),v}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(h=>h.byteLength>=a);if(l>=0){const h=new e(o.splice(l,1)[0],0,s);return i&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const Da=new G6;function zA(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z6(t,e){const n=t%e;return n<0?e+n:n}function V6(t){return[t[12],t[13],t[14]]}function H6(t){return{left:Do(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Do(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Do(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Do(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Do(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Do(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const _2=new q;function Do(t,e,n,i){_2.set(t,e,n);const r=_2.len();return{distance:i/r,normal:new q(-t/r,-e/r,-n/r)}}function j6(t){return t-Math.fround(t)}let xA;function c0(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;xA=Da.allocate(xA,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const h=t[o++];xA[a+l]=h,xA[a+l+n]=j6(h)}a+=n*2}return xA.subarray(0,s*n*2)}const W6=Math.PI/180,Q6=zA(),y2=[0,0,0],X6={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function J6({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,h=n?new ze().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new ze().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:g=0,right:m=0,top:v=0,bottom:w=0}=s,C=on((g+t-m)/2,0,t)-t/2,b=on((v+e-w)/2,0,e)-e/2;h[8]-=C*2/t,h[9]+=b*2/e}return h}class Cs{constructor(e={}){T(this,"id",void 0),T(this,"x",void 0),T(this,"y",void 0),T(this,"width",void 0),T(this,"height",void 0),T(this,"isGeospatial",void 0),T(this,"zoom",void 0),T(this,"focalDistance",void 0),T(this,"position",void 0),T(this,"modelMatrix",void 0),T(this,"distanceScales",void 0),T(this,"scale",void 0),T(this,"center",void 0),T(this,"cameraPosition",void 0),T(this,"projectionMatrix",void 0),T(this,"viewMatrix",void 0),T(this,"viewMatrixUncentered",void 0),T(this,"viewMatrixInverse",void 0),T(this,"viewProjectionMatrix",void 0),T(this,"pixelProjectionMatrix",void 0),T(this,"pixelUnprojectionMatrix",void 0),T(this,"resolution",void 0),T(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.distanceScales=e.distanceScales||X6,this.focalDistance=e.focalDistance||1,this.position=e.position||y2,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ki.WEB_MERCATOR:ki.WEB_MERCATOR_AUTO_OFFSET:ki.IDENTITY}equals(e){return e instanceof Cs?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ri(e.projectionMatrix,this.projectionMatrix)&&ri(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=kb(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],h=xh([r,a,o],this.pixelUnprojectionMatrix,l),[g,m,v]=this.unprojectPosition(h);return Number.isFinite(o)?[g,m,v]:Number.isFinite(i)?[g,m,i]:[g,m]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=_s(e);return n[1]=on(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ys(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?fp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,H6(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=A6({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||fp({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=y2;if(s&&(a=o?new ze(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new q(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=Q6,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:h=null,focalDistance:g=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new ze().multiplyRight(n).translate(new q(this.center).negate()),this.projectionMatrix=i||J6({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*W6,focalDistance:g,padding:h,near:a,far:l});const m=zA();$s(m,m,this.projectionMatrix),$s(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=ap([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=V6(this.viewMatrixInverse);const v=zA(),w=zA();A1(v,v,[this.width/2,-this.height/2,1]),Df(v,v,[1,-1,0]),$s(w,v,this.viewProjectionMatrix),this.pixelProjectionMatrix=w,this.pixelUnprojectionMatrix=ap(zA(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||De.warn("Pixel project matrix not invertible")()}}T(Cs,"displayName","Viewport");const Y6=512,K6=4003e4,Z6=Math.PI/180;function v2(t){const e=Math.cos(t*Z6);return Y6/K6/e}class ur extends Cs{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,orthographic:h=!1,projectionMatrix:g,repeat:m=!1,worldOffset:v=0,legacyMeterSizes:w=!1}=e;let{width:C,height:b,altitude:R=1.5}=e;const S=Math.pow(2,r);C=C||1,b=b||1;let P,M=null;g?(R=g[5]/2,P=Nf(R)):(e.fovy?(P=e.fovy,R=Db(P)):P=Nf(R),M=c6({width:C,height:b,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:l}));let F=l6({height:b,pitch:s,bearing:o,scale:S,altitude:R});v&&(F=new ze().translate([512*v,0,0]).multiplyLeft(F)),super({...e,width:C,height:b,viewMatrix:F,longitude:i,latitude:n,zoom:r,...M,fovy:P,focalDistance:R}),T(this,"longitude",void 0),T(this,"latitude",void 0),T(this,"pitch",void 0),T(this,"bearing",void 0),T(this,"altitude",void 0),T(this,"fovy",void 0),T(this,"orthographic",void 0),T(this,"_subViewports",void 0),T(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=R,this.fovy=P,this.orthographic=h,this._subViewports=m?[]:null,this._pseudoMeters=w,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new ur({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*v2(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/v2(i);return[n,i,r]}addMetersToLngLat(e,n){return Fb(e,n)}panByPosition(e,n){const i=xh(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Ff([],r,ob([],i)),o=Ff([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=f6(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=Nb({width:i,height:r,bounds:e,...n});return new ur({width:i,height:r,longitude:s,latitude:o,zoom:a})}}T(ur,"displayName","WebMercatorViewport");function u0(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof ur){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function q6(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===Ge.DEFAULT&&(r=e.isGeospatial?Ge.LNGLAT:Ge.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function zb(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=ja([],[o,a,l,1],n)),i){case Ge.LNGLAT:return u0([o,a,l],e,s);case Ge.LNGLAT_OFFSETS:return u0([o+r[0],a+r[1],l+(r[2]||0)],e,s);case Ge.METER_OFFSETS:return u0(Fb(r,[o,a,l]),e,s);case Ge.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function Vb(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=q6(e),{geospatialOrigin:l,shaderCoordinateOrigin:h,offsetMode:g}=Rb(n,i,r),m=zb(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:g});if(g){const v=n.projectPosition(l||h);mb(m,m,v)}return m}const $6=[255,255,255],eU=1,tU=[0,0,1],nU=[0,0,1];let iU=0;class rU{constructor(e={}){T(this,"id",void 0),T(this,"color",void 0),T(this,"intensity",void 0),T(this,"type","point"),T(this,"position",void 0),T(this,"attenuation",void 0),T(this,"projectedLight",void 0);const{color:n=$6}=e,{intensity:i=eU}=e,{position:r=nU}=e;this.id=e.id||"point-".concat(iU++),this.color=n,this.intensity=i,this.type="point",this.position=r,this.attenuation=sU(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,i=e.context.viewport,{coordinateSystem:r,coordinateOrigin:s}=e.props,o=Vb(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:s,fromCoordinateSystem:i.isGeospatial?Ge.LNGLAT:Ge.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function sU(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:tU}const Ho={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Uf=Symbol.for("component"),va=Symbol.for("asyncPropDefaults"),oo=Symbol.for("asyncPropOriginal"),is=Symbol.for("asyncPropResolved");function Sh(t,e=()=>!0){return Array.isArray(t)?Hb(t,e,[]):e(t)?[t]:[]}function Hb(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?Hb(r,e,n):e(r)&&n.push(r)}return n}function oU({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class aU{constructor(e,n,i){T(this,"id",void 0),T(this,"context",void 0),T(this,"isLoaded",void 0),T(this,"persistent",void 0),T(this,"_loadCount",0),T(this,"_subscribers",new Set),T(this,"_data",void 0),T(this,"_loader",void 0),T(this,"_error",void 0),T(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=Sr(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class AU{constructor({gl:e,protocol:n}){T(this,"protocol",void 0),T(this,"_context",void 0),T(this,"_resources",void 0),T(this,"_consumers",void 0),T(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new aU(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const lU="layerManager.setLayers",cU="layerManager.activateViewport";class uU{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){T(this,"layers",void 0),T(this,"context",void 0),T(this,"resourceManager",void 0),T(this,"_lastRenderedLayers",[]),T(this,"_needsRedraw",!1),T(this,"_needsUpdate",!1),T(this,"_nextLayers",null),T(this,"_debug",!1),T(this,"activateViewport",o=>{yn(cU,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new AU({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&b6(e),stats:i||new Kl({id:"deck.gl"}),viewport:r||new Cs({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Mb,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){yn(lU,this,n,e),this._lastRenderedLayers=e;const i=Sh(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?De.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&De.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ho.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Ho.MATCHED,n!==e&&(e.lifecycle=Ho.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Ho.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ho.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function mo(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&mo(i,r)))return!1}return!0}class fU{constructor(e){T(this,"width",void 0),T(this,"height",void 0),T(this,"views",void 0),T(this,"viewState",void 0),T(this,"controllers",void 0),T(this,"timeline",void 0),T(this,"_viewports",void 0),T(this,"_viewportMap",void 0),T(this,"_isUpdating",void 0),T(this,"_needsRedraw",void 0),T(this,"_needsUpdate",void 0),T(this,"_eventManager",void 0),T(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Sh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!mo(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):De.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const h=Boolean(s.controller);h&&!l&&(i=!0),(i||!h)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const hU=/([0-9]+\.?[0-9]*)(%|px)/;function Wr(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=hU.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Qr(t,e){return t.relative?Math.round(t.position*e):t.position}function sn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class ao{constructor(e){T(this,"id",void 0),T(this,"viewportInstance",void 0),T(this,"_x",void 0),T(this,"_y",void 0),T(this,"_width",void 0),T(this,"_height",void 0),T(this,"_padding",void 0),T(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};sn(!l||l instanceof Cs),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Wr(i),this._y=Wr(r),this._width=Wr(s),this._height=Wr(o),this._padding=a&&{left:Wr(a.left||0),right:Wr(a.right||0),top:Wr(a.top||0),bottom:Wr(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&mo(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Qr(this._x,e),y:Qr(this._y,n),width:Qr(this._width,e),height:Qr(this._height,n)};return this._padding&&(i.padding={left:Qr(this._padding.left,e),top:Qr(this._padding.top,n),right:Qr(this._padding.right,e),bottom:Qr(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class sc{constructor(e){T(this,"_inProgress",void 0),T(this,"_handle",void 0),T(this,"_timeline",void 0),T(this,"time",void 0),T(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const E2=()=>{},hp={BREAK:1,SNAP_TO_END:2,IGNORE:3},dU=t=>t,gU=hp.BREAK;class pU{constructor(e){T(this,"getControllerState",void 0),T(this,"props",void 0),T(this,"propsInTransition",void 0),T(this,"transition",void 0),T(this,"onViewStateChange",void 0),T(this,"onStateChange",void 0),T(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,h=l(i/a),g=r.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new sc(e.timeline),this.onViewStateChange=e.onViewStateChange||E2,this.onStateChange=e.onStateChange||E2}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===hp.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===hp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||dU,interpolator:s,interruption:n.transitionInterruption||gU,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class mU{constructor(e){T(this,"_propsToCompare",void 0),T(this,"_propsToExtract",void 0),T(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!ri(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];sn(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const _U=["longitude","latitude","zoom","bearing","pitch"],yU=["longitude","latitude","zoom"];class m1 extends mU{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:_U,required:yU},super(i.transitionProps),T(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=Vi(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,Vi(e.around,n.around,i)))}return r}}const Xr={transitionDuration:0},vU=300,Au=t=>1-(1-t)*(1-t),ko={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ds={};class jb{constructor(e){T(this,"props",void 0),T(this,"state",{}),T(this,"transitionManager",void 0),T(this,"eventManager",void 0),T(this,"onViewStateChange",void 0),T(this,"onStateChange",void 0),T(this,"makeViewport",void 0),T(this,"_controllerState",void 0),T(this,"_events",{}),T(this,"_interactionState",{isDragging:!1}),T(this,"_customEvents",[]),T(this,"_eventStartBlocked",null),T(this,"_panMove",!1),T(this,"invertPan",!1),T(this,"dragMode","rotate"),T(this,"inertia",0),T(this,"scrollZoom",!0),T(this,"dragPan",!0),T(this,"dragRotate",!0),T(this,"doubleClickZoom",!0),T(this,"touchZoom",!0),T(this,"touchRotate",!1),T(this,"keyboard",!0),this.transitionManager=new pU({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?vU:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:h=!0}=e,g=Boolean(this.onViewStateChange);this.toggleEvents(ko.WHEEL,g&&i),this.toggleEvents(ko.PAN,g&&(r||s)),this.toggleEvents(ko.PINCH,g&&(a||l)),this.toggleEvents(ko.TRIPLE_PAN,g&&l),this.toggleEvents(ko.DOUBLE_TAP,g&&o),this.toggleEvents(ko.KEYBOARD,g&&h),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Xr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Xr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Au},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Xr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Au},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Xr,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Xr,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Au},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Ds._startPinchRotation=e.rotation,Ds._lastPinchEvent=e,this.updateViewport(i,Xr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Ds._startPinchRotation-i})}return this.updateViewport(n,Xr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ds._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Ds;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Au},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ds._startPinchRotation=null,Ds._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const h={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),h.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),h.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),h.isRotating=!0):(l=a.moveLeft(r),h.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),h.isRotating=!0):(l=a.moveRight(r),h.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),h.isRotating=!0):(l=a.moveUp(r),h.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),h.isRotating=!0):(l=a.moveDown(r),h.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Xr:e?{...n,transitionInterpolator:new m1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class Wb{constructor(e,n){T(this,"_viewportProps",void 0),T(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const w2=5,EU=1.2;class wU extends Wb{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:h=1.5,position:g=[0,0,0],maxZoom:m=20,minZoom:v=0,maxPitch:w=60,minPitch:C=0,startPanLngLat:b,startZoomLngLat:R,startRotatePos:S,startBearing:P,startPitch:M,startZoom:F,normalize:H=!0}=e;sn(Number.isFinite(s)),sn(Number.isFinite(r)),sn(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:h,maxZoom:m,minZoom:v,maxPitch:w,minPitch:C,normalize:H,position:g},{startPanLngLat:b,startZoomLngLat:R,startRotatePos:S,startBearing:P,startPitch:M,startZoom:F}),T(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=on(l,a,o);const h=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=on(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=on(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,h6(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:h,height:g}=this.getViewportProps(),m=s/h;let v=0;o>0?Math.abs(g-l)>w2&&(v=o/(l-g)*EU):o<0&&l>w2&&(v=1-a/l),v=on(v,-1,1);const{minPitch:w,maxPitch:C}=this.getViewportProps(),b=r+180*m;let R=i;return v>0?R=i+v*(C-i):v<0&&(R=i-v*(w-i)),{pitch:R,bearing:b}}}class TU extends jb{constructor(...e){super(...e),T(this,"ControllerState",wU),T(this,"transition",{transitionDuration:300,transitionInterpolator:new m1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),T(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Qb extends ao{get ViewportType(){return ur}get ControllerType(){return TU}}T(Qb,"displayName","MapView");class CU extends bh{constructor(e,n){super(e,n),T(this,"maskMap",void 0),T(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new hn(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new Wt(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,vi(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===ic.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const xU=new ze().lookAt({eye:[0,0,1]});function bU({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,l=e/2;if(r){const{left:h=0,right:g=0,top:m=0,bottom:v=0}=r,w=on((h+t-g)/2,0,t)-t/2,C=on((m+e-v)/2,0,e)-e/2;s-=w,o-=w,a+=C,l+=C}return new ze().ortho({left:s,right:o,bottom:a,top:l,near:n,far:i})}class SU extends Cs{constructor(e){const{width:n,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:h=!0}=e,g=Array.isArray(o)?o[0]:o,m=Array.isArray(o)?o[1]:o,v=Math.min(g,m),w=Math.pow(2,v);let C;if(g!==m){const b=Math.pow(2,g),R=Math.pow(2,m);C={unitsPerMeter:[b/w,R/w,1],metersPerUnit:[w/b,w/R,1]}}super({...e,longitude:void 0,position:a,viewMatrix:xU.clone().scale([w,w*(h?-1:1),w]),projectionMatrix:bU({width:n||1,height:i||1,padding:l,near:r,far:s}),zoom:v,distanceScales:C})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=xh(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Ff([],r,ob([],i)),o=Ff([],this.center,s);return{target:this.unprojectFlat(o)}}}class PU extends Wb{constructor(e){const{width:n,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:h=90,minZoom:g=-1/0,maxZoom:m=1/0,startPanPosition:v,startRotatePos:w,startRotationX:C,startRotationOrbit:b,startZoomPosition:R,startZoom:S}=e;super({width:n,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:h,minZoom:g,maxZoom:m},{startPanPosition:v,startRotatePos:w,startRotationX:C,startRotationOrbit:b,startZoomPosition:R,startZoom:S}),T(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let h;if(e){let g=(e[0]-r[0])/a;const m=(e[1]-r[1])/l;(s<-90||s>90)&&(g*=-1),h={rotationX:s+m*180,rotationOrbit:o+g*180}}else h={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(h)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-n.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return on(s,r,i)}_panFromCenter(e){const{width:n,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(r)?[on(r[0],i,n),on(r[1],i,n)]:on(r,i,n),e.rotationX=on(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=z6(a+180,360)-180),e}}class MU extends PU{constructor(e){super(e),T(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[o,a]=n;switch(this.zoomAxis){case"X":o=on(o+s,r,i);break;case"Y":a=on(a+s,r,i);break;default:let l=Math.min(o+s,a+s);l<r&&(s+=r-l),l=Math.max(o+s,a+s),l>i&&(s+=i-l),o+=s,a+=s}return[o,a]}return on(n+s,r,i)}}class IU extends jb{constructor(...e){super(...e),T(this,"ControllerState",MU),T(this,"transition",{transitionDuration:300,transitionInterpolator:new m1(["target","zoom"])}),T(this,"dragMode","pan")}_onPanRotate(){return!1}}class Xb extends ao{get ViewportType(){return SU}get ControllerType(){return IU}}T(Xb,"displayName","OrthographicView");function BU({layers:t,viewport:e}){let n=null;for(const s of t){const o=s.getBounds();o&&(n?(n[0]=Math.min(n[0],o[0][0]),n[1]=Math.min(n[1],o[0][1]),n[2]=Math.max(n[2],o[1][0]),n[3]=Math.max(n[3],o[1][1])):n=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=e.getBounds();if(!n)return i;const r=RU(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}function LU({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const r=1;if(n-=r*2,i-=r*2,e instanceof ur){const{longitude:a,latitude:l,zoom:h}=Nb({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new ur({longitude:a,latitude:l,zoom:h,x:r,y:r,width:n,height:i})}const s=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],o=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new Xb({x:r,y:r}).makeViewport({width:n,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function RU(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class OU{constructor(){T(this,"id","mask-effect"),T(this,"props",null),T(this,"useInPicking",!0),T(this,"dummyMaskMap",void 0),T(this,"channels",[]),T(this,"masks",null),T(this,"maskPass",void 0),T(this,"maskMap",void 0),T(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new hn(e,{width:1,height:1}));const a=n.filter(m=>m.props.visible&&m.props.operation===ic.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new CU(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const l=this._sortMaskChannels(a),h=r[0],g=!this.lastViewport||!this.lastViewport.equals(h);for(const m in l)this._renderChannel(l[m],{layerFilter:i,onViewportActive:s,views:o,viewport:h,viewportChanged:g})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[e.index];if(!a)return;const l=e===a||a.layers.length!==e.layers.length||e.layerBounds.some((h,g)=>h!==a.layerBounds[g]);if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,(l||o)&&(this.lastViewport=s,e.bounds=BU({layers:e.layers,viewport:s}),l||!ri(e.bounds,a.bounds))){const{maskPass:h,maskMap:g}=this,m=LU({bounds:e.bounds,viewport:s,width:g.width,height:g.height});e.maskBounds=m?m.getBounds():[0,0,1,1],h.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:m?[m]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const r of e){const{id:s}=r.root;let o=n[s];if(!o){if(++i>4){De.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},n[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in n))&&(this.channels[r]=null)}for(const r in n){const s=n[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const FU=new p1;class DU{constructor(){T(this,"effects",void 0),T(this,"_internalEffects",void 0),T(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!mo(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new OU),e.some(n=>n instanceof p1)||this._internalEffects.push(FU)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class kU extends bh{shouldDrawLayer(e){return e.props.operation===ic.DRAW}}const T2={blendFunc:[1,0,32771,0],blendEquation:32774};class Jb extends bh{constructor(...e){super(...e),T(this,"pickZ",void 0),T(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:h,height:g},cullRect:m,effects:v,pass:w="picking",pickZ:C}){const b=this.gl;this.pickZ=C;const R=C?null:{byLayer:new Map,byAlpha:[]};this._colors=R;const S=vi(b,{scissorTest:!0,scissor:[a,l,h,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...T2,blend:!C},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:m,effects:v==null?void 0:v.filter(M=>M.useInPicking),pass:w}));return this._colors=null,{decodePickingColor:R&&UU.bind(null,R),stats:S}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===ic.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,T2),r.blend=!0,r.blendColor=NU(this._colors,e,i)):r.blend=!1,r}}function NU(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(De.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function UU(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const GU="deckRenderer.renderLayers";class zU{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new kU(e),this.pickLayersPass=new Jb(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||Wt.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,yn(GU,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const r of e)r.preRender(this.gl,n),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Wt(this.gl),new Wt(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const VU={pickedColor:null,pickedObjectIndex:-1};function HU({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:h}=s;let g=r*r,m=-1,v=0;for(let w=0;w<h;w++){const C=w+a-i,b=C*C;if(b>g)v+=4*l;else for(let R=0;R<l;R++){if(t[v+3]-1>=0){const P=R+o-n,M=P*P+b;M<=g&&(g=M,m=v)}v+=4}}if(m>=0){const w=t.slice(m,m+4),C=e(w);if(C){const b=Math.floor(m/4/l),R=m/4-b*l;return{...C,pickedColor:w,pickedX:o+R,pickedY:a+b}}De.error("Picked non-existent layer. Is picking buffer corrupt?")()}return VU}function jU({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):De.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Yb({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=QU((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function WU(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const m=n.index,v=n.layerId,w=o?o.props.id:null;if(w!==v||a!==m){if(w!==v){const C=r.find(b=>b.props.id===v);C&&l.unshift(C)}n.layerId=w,n.index=a,n.info=null}}const h=Yb(t),g=new Map;return g.set(null,h),l.forEach(m=>{let v={...h};m===o&&(v.color=s,v.index=a,v.picked=!0),v=Kb({layer:m,info:v,mode:i});const w=v.layer;m===o&&i==="hover"&&(n.info=v),g.set(w.id,v),i==="hover"&&w.updateAutoHighlight(v)}),g}function Kb({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function QU(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class XU{constructor(e){T(this,"gl",void 0),T(this,"pickingFBO",void 0),T(this,"depthFBO",void 0),T(this,"pickLayersPass",void 0),T(this,"layerFilter",void 0),T(this,"lastPickedInfo",void 0),T(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Jb(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(v=>v.id===o):null,h=a&&r.find(v=>v.id===a)||r[0],g=h&&h.unproject([e-h.x,n-h.y]);return{...s,...{x:e,y:n,viewport:h,coordinate:g,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Wt(i),Wt.isSupported(i,{colorBufferFloat:!0}))){const r=new Wt(i);r.attach({[36064]:new hn(i,{format:Xe(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:h,onViewportActive:g,effects:m}){const v=this._getPickable(e),w=Ra(this.gl);if(!v)return{result:[],emptyInfo:Yb({viewports:i,x:r,y:s,pixelRatio:w})};this._resizeBuffer();const C=Yd(this.gl,[r,s],!0),b=[C.x+Math.floor(C.width/2),C.y+Math.floor(C.height/2)],R=Math.round(o*w),{width:S,height:P}=this.pickingFBO,M=this._getPickingRect({deviceX:b[0],deviceY:b[1],deviceRadius:R,deviceWidth:S,deviceHeight:P}),F={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let H;const j=[],K=new Set;for(let ee=0;ee<a;ee++){let X;if(M){const D=this._drawAndSample({layers:v,views:n,viewports:i,onViewportActive:g,deviceRect:M,cullRect:F,effects:m,pass:"picking:".concat(l)});X=HU({...D,deviceX:b[0],deviceY:b[1],deviceRadius:R,deviceRect:M})}else X={pickedColor:null,pickedObjectIndex:-1};let U;X.pickedLayer&&h&&this.depthFBO&&(U=this._drawAndSample({layers:[X.pickedLayer],views:n,viewports:i,onViewportActive:g,deviceRect:{x:X.pickedX,y:X.pickedY,width:1,height:1},cullRect:F,effects:m,pass:"picking:".concat(l,":z")},!0).pickedColors[0]),X.pickedLayer&&ee+1<a&&(K.add(X.pickedLayer),X.pickedLayer.disablePickingIndex(X.pickedObjectIndex)),H=WU({pickInfo:X,lastPickedInfo:this.lastPickedInfo,mode:l,layers:v,viewports:i,x:r,y:s,z:U,pixelRatio:w});for(const D of H.values())D.layer&&j.push(D);if(!X.pickedColor)break}for(const ee of K)ee.restorePickingColors();return{result:j,emptyInfo:H.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:h=null,onViewportActive:g,effects:m}){const v=this._getPickable(e);if(!v)return[];this._resizeBuffer();const w=Ra(this.gl),C=Yd(this.gl,[r,s],!0),b=C.x,R=C.y+C.height,S=Yd(this.gl,[r+o,s+a],!0),P=S.x+S.width,M=S.y,F={x:b,y:M,width:P-b,height:R-M},H=this._drawAndSample({layers:v,views:n,viewports:i,onViewportActive:g,deviceRect:F,cullRect:{x:r,y:s,width:o,height:a},effects:m,pass:"picking:".concat(l)}),j=jU(H),K=new Map,ee=Number.isFinite(h);for(let X=0;X<j.length&&!(ee&&h&&K.size>=h);X++){const U=j[X];let D={color:U.pickedColor,layer:null,index:U.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:w};D=Kb({layer:U.pickedLayer,info:D,mode:l}),K.has(D.object)||K.set(D.object,D)}return Array.from(K.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},h=!1){const g=h?this.depthFBO:this.pickingFBO,{decodePickingColor:m}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:g,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:h}),{x:v,y:w,width:C,height:b}=s,R=new(h?Float32Array:Uint8Array)(C*b*4);return Th(g,{sourceX:v,sourceY:w,sourceWidth:C,sourceHeight:b,target:R}),{pickedColors:R,decodePickingColor:m}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,h=Math.min(s,n+i+1)-a;return l<=0||h<=0?null:{x:o,y:a,width:l,height:h}}}const JU={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class YU{constructor(e){T(this,"el",null),T(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,JU),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(!!r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Wa={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,h=Math.abs,g=Date.now;function m(L,O,z){return setTimeout(M(L,z),O)}function v(L,O,z){return Array.isArray(L)?(w(L,z[O],z),!0):!1}function w(L,O,z){var Z;if(!!L)if(L.forEach)L.forEach(O,z);else if(L.length!==r)for(Z=0;Z<L.length;)O.call(z,L[Z],Z,L),Z++;else for(Z in L)L.hasOwnProperty(Z)&&O.call(z,L[Z],Z,L)}function C(L,O,z){var Z="DEPRECATED METHOD: "+O+`
`+z+` AT 
`;return function(){var ue=new Error("get-stack-trace"),Pe=ue&&ue.stack?ue.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Je=e.console&&(e.console.warn||e.console.log);return Je&&Je.call(e.console,Z,Pe),L.apply(this,arguments)}}var b;typeof Object.assign!="function"?b=function(O){if(O===r||O===null)throw new TypeError("Cannot convert undefined or null to object");for(var z=Object(O),Z=1;Z<arguments.length;Z++){var ue=arguments[Z];if(ue!==r&&ue!==null)for(var Pe in ue)ue.hasOwnProperty(Pe)&&(z[Pe]=ue[Pe])}return z}:b=Object.assign;var R=C(function(O,z,Z){for(var ue=Object.keys(z),Pe=0;Pe<ue.length;)(!Z||Z&&O[ue[Pe]]===r)&&(O[ue[Pe]]=z[ue[Pe]]),Pe++;return O},"extend","Use `assign`."),S=C(function(O,z){return R(O,z,!0)},"merge","Use `assign`.");function P(L,O,z){var Z=O.prototype,ue;ue=L.prototype=Object.create(Z),ue.constructor=L,ue._super=Z,z&&b(ue,z)}function M(L,O){return function(){return L.apply(O,arguments)}}function F(L,O){return typeof L==a?L.apply(O&&O[0]||r,O):L}function H(L,O){return L===r?O:L}function j(L,O,z){w(U(O),function(Z){L.addEventListener(Z,z,!1)})}function K(L,O,z){w(U(O),function(Z){L.removeEventListener(Z,z,!1)})}function ee(L,O){for(;L;){if(L==O)return!0;L=L.parentNode}return!1}function X(L,O){return L.indexOf(O)>-1}function U(L){return L.trim().split(/\s+/g)}function D(L,O,z){if(L.indexOf&&!z)return L.indexOf(O);for(var Z=0;Z<L.length;){if(z&&L[Z][z]==O||!z&&L[Z]===O)return Z;Z++}return-1}function ae(L){return Array.prototype.slice.call(L,0)}function re(L,O,z){for(var Z=[],ue=[],Pe=0;Pe<L.length;){var Je=O?L[Pe][O]:L[Pe];D(ue,Je)<0&&Z.push(L[Pe]),ue[Pe]=Je,Pe++}return z&&(O?Z=Z.sort(function(Ve,Qt){return Ve[O]>Qt[O]}):Z=Z.sort()),Z}function te(L,O){for(var z,Z,ue=O[0].toUpperCase()+O.slice(1),Pe=0;Pe<s.length;){if(z=s[Pe],Z=z?z+ue:O,Z in L)return Z;Pe++}return r}var oe=1;function ve(){return oe++}function ce(L){var O=L.ownerDocument||L;return O.defaultView||O.parentWindow||e}var ne=/mobile|tablet|ip(ad|hone|od)|android/i,le="ontouchstart"in e,he=te(e,"PointerEvent")!==r,xe=le&&ne.test(navigator.userAgent),Ie="touch",Ze="pen",Ft="mouse",An="kinect",tn=25,dt=1,dn=2,Ke=4,Et=8,Xi=1,li=2,bs=4,Ss=8,Ps=16,ci=li|bs,bn=Ss|Ps,Fr=ci|bn,uc=["x","y"],_o=["clientX","clientY"];function Dt(L,O){var z=this;this.manager=L,this.callback=O,this.element=L.element,this.target=L.options.inputTarget,this.domHandler=function(Z){F(L.options.enable,[L])&&z.handler(Z)},this.init()}Dt.prototype={handler:function(){},init:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(ce(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&K(this.element,this.evEl,this.domHandler),this.evTarget&&K(this.target,this.evTarget,this.domHandler),this.evWin&&K(ce(this.element),this.evWin,this.domHandler)}};function Ka(L){var O,z=L.options.inputClass;return z?O=z:he?O=me:xe?O=Ms:le?O=Y:O=Eo,new O(L,fc)}function fc(L,O,z){var Z=z.pointers.length,ue=z.changedPointers.length,Pe=O&dt&&Z-ue===0,Je=O&(Ke|Et)&&Z-ue===0;z.isFirst=!!Pe,z.isFinal=!!Je,Pe&&(L.session={}),z.eventType=O,Dr(L,z),L.emit("hammer.input",z),L.recognize(z),L.session.prevInput=z}function Dr(L,O){var z=L.session,Z=O.pointers,ue=Z.length;z.firstInput||(z.firstInput=hc(O)),ue>1&&!z.firstMultiple?z.firstMultiple=hc(O):ue===1&&(z.firstMultiple=!1);var Pe=z.firstInput,Je=z.firstMultiple,zt=Je?Je.center:Pe.center,Ve=O.center=qa(Z);O.timeStamp=g(),O.deltaTime=O.timeStamp-Pe.timeStamp,O.angle=vo(zt,Ve),O.distance=yo(zt,Ve),Za(z,O),O.offsetDirection=dc(O.deltaX,O.deltaY);var Qt=$a(O.deltaTime,O.deltaX,O.deltaY);O.overallVelocityX=Qt.x,O.overallVelocityY=Qt.y,O.overallVelocity=h(Qt.x)>h(Qt.y)?Qt.x:Qt.y,O.scale=Je?Wh(Je.pointers,Z):1,O.rotation=Je?jh(Je.pointers,Z):0,O.maxPointers=z.prevInput?O.pointers.length>z.prevInput.maxPointers?O.pointers.length:z.prevInput.maxPointers:O.pointers.length,Hh(z,O);var Qn=L.element;ee(O.srcEvent.target,Qn)&&(Qn=O.srcEvent.target),O.target=Qn}function Za(L,O){var z=O.center,Z=L.offsetDelta||{},ue=L.prevDelta||{},Pe=L.prevInput||{};(O.eventType===dt||Pe.eventType===Ke)&&(ue=L.prevDelta={x:Pe.deltaX||0,y:Pe.deltaY||0},Z=L.offsetDelta={x:z.x,y:z.y}),O.deltaX=ue.x+(z.x-Z.x),O.deltaY=ue.y+(z.y-Z.y)}function Hh(L,O){var z=L.lastInterval||O,Z=O.timeStamp-z.timeStamp,ue,Pe,Je,zt;if(O.eventType!=Et&&(Z>tn||z.velocity===r)){var Ve=O.deltaX-z.deltaX,Qt=O.deltaY-z.deltaY,Qn=$a(Z,Ve,Qt);Pe=Qn.x,Je=Qn.y,ue=h(Qn.x)>h(Qn.y)?Qn.x:Qn.y,zt=dc(Ve,Qt),L.lastInterval=O}else ue=z.velocity,Pe=z.velocityX,Je=z.velocityY,zt=z.direction;O.velocity=ue,O.velocityX=Pe,O.velocityY=Je,O.direction=zt}function hc(L){for(var O=[],z=0;z<L.pointers.length;)O[z]={clientX:l(L.pointers[z].clientX),clientY:l(L.pointers[z].clientY)},z++;return{timeStamp:g(),pointers:O,center:qa(O),deltaX:L.deltaX,deltaY:L.deltaY}}function qa(L){var O=L.length;if(O===1)return{x:l(L[0].clientX),y:l(L[0].clientY)};for(var z=0,Z=0,ue=0;ue<O;)z+=L[ue].clientX,Z+=L[ue].clientY,ue++;return{x:l(z/O),y:l(Z/O)}}function $a(L,O,z){return{x:O/L||0,y:z/L||0}}function dc(L,O){return L===O?Xi:h(L)>=h(O)?L<0?li:bs:O<0?Ss:Ps}function yo(L,O,z){z||(z=uc);var Z=O[z[0]]-L[z[0]],ue=O[z[1]]-L[z[1]];return Math.sqrt(Z*Z+ue*ue)}function vo(L,O,z){z||(z=uc);var Z=O[z[0]]-L[z[0]],ue=O[z[1]]-L[z[1]];return Math.atan2(ue,Z)*180/Math.PI}function jh(L,O){return vo(O[1],O[0],_o)+vo(L[1],L[0],_o)}function Wh(L,O){return yo(O[0],O[1],_o)/yo(L[0],L[1],_o)}var Qh={mousedown:dt,mousemove:dn,mouseup:Ke},gc="mousedown",Xh="mousemove mouseup";function Eo(){this.evEl=gc,this.evWin=Xh,this.pressed=!1,Dt.apply(this,arguments)}P(Eo,Dt,{handler:function(O){var z=Qh[O.type];z&dt&&O.button===0&&(this.pressed=!0),z&dn&&O.which!==1&&(z=Ke),this.pressed&&(z&Ke&&(this.pressed=!1),this.callback(this.manager,z,{pointers:[O],changedPointers:[O],pointerType:Ft,srcEvent:O}))}});var Jh={pointerdown:dt,pointermove:dn,pointerup:Ke,pointercancel:Et,pointerout:Et},eA={2:Ie,3:Ze,4:Ft,5:An},pc="pointerdown",mc="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(pc="MSPointerDown",mc="MSPointerMove MSPointerUp MSPointerCancel");function me(){this.evEl=pc,this.evWin=mc,Dt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}P(me,Dt,{handler:function(O){var z=this.store,Z=!1,ue=O.type.toLowerCase().replace("ms",""),Pe=Jh[ue],Je=eA[O.pointerType]||O.pointerType,zt=Je==Ie,Ve=D(z,O.pointerId,"pointerId");Pe&dt&&(O.button===0||zt)?Ve<0&&(z.push(O),Ve=z.length-1):Pe&(Ke|Et)&&(Z=!0),!(Ve<0)&&(z[Ve]=O,this.callback(this.manager,Pe,{pointers:z,changedPointers:[O],pointerType:Je,srcEvent:O}),Z&&z.splice(Ve,1))}});var Yh={touchstart:dt,touchmove:dn,touchend:Ke,touchcancel:Et},_c="touchstart",Kh="touchstart touchmove touchend touchcancel";function yc(){this.evTarget=_c,this.evWin=Kh,this.started=!1,Dt.apply(this,arguments)}P(yc,Dt,{handler:function(O){var z=Yh[O.type];if(z===dt&&(this.started=!0),!!this.started){var Z=tA.call(this,O,z);z&(Ke|Et)&&Z[0].length-Z[1].length===0&&(this.started=!1),this.callback(this.manager,z,{pointers:Z[0],changedPointers:Z[1],pointerType:Ie,srcEvent:O})}}});function tA(L,O){var z=ae(L.touches),Z=ae(L.changedTouches);return O&(Ke|Et)&&(z=re(z.concat(Z),"identifier",!0)),[z,Z]}var vc={touchstart:dt,touchmove:dn,touchend:Ke,touchcancel:Et},Ec="touchstart touchmove touchend touchcancel";function Ms(){this.evTarget=Ec,this.targetIds={},Dt.apply(this,arguments)}P(Ms,Dt,{handler:function(O){var z=vc[O.type],Z=wo.call(this,O,z);!Z||this.callback(this.manager,z,{pointers:Z[0],changedPointers:Z[1],pointerType:Ie,srcEvent:O})}});function wo(L,O){var z=ae(L.touches),Z=this.targetIds;if(O&(dt|dn)&&z.length===1)return Z[z[0].identifier]=!0,[z,z];var ue,Pe,Je=ae(L.changedTouches),zt=[],Ve=this.target;if(Pe=z.filter(function(Qt){return ee(Qt.target,Ve)}),O===dt)for(ue=0;ue<Pe.length;)Z[Pe[ue].identifier]=!0,ue++;for(ue=0;ue<Je.length;)Z[Je[ue].identifier]&&zt.push(Je[ue]),O&(Ke|Et)&&delete Z[Je[ue].identifier],ue++;if(!!zt.length)return[re(Pe.concat(zt),"identifier",!0),zt]}var nA=2500,Ji=25;function Y(){Dt.apply(this,arguments);var L=M(this.handler,this);this.touch=new Ms(this.manager,L),this.mouse=new Eo(this.manager,L),this.primaryTouch=null,this.lastTouches=[]}P(Y,Dt,{handler:function(O,z,Z){var ue=Z.pointerType==Ie,Pe=Z.pointerType==Ft;if(!(Pe&&Z.sourceCapabilities&&Z.sourceCapabilities.firesTouchEvents)){if(ue)Ae.call(this,z,Z);else if(Pe&&Fe.call(this,Z))return;this.callback(O,z,Z)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ae(L,O){L&dt?(this.primaryTouch=O.changedPointers[0].identifier,_e.call(this,O)):L&(Ke|Et)&&_e.call(this,O)}function _e(L){var O=L.changedPointers[0];if(O.identifier===this.primaryTouch){var z={x:O.clientX,y:O.clientY};this.lastTouches.push(z);var Z=this.lastTouches,ue=function(){var Pe=Z.indexOf(z);Pe>-1&&Z.splice(Pe,1)};setTimeout(ue,nA)}}function Fe(L){for(var O=L.srcEvent.clientX,z=L.srcEvent.clientY,Z=0;Z<this.lastTouches.length;Z++){var ue=this.lastTouches[Z],Pe=Math.abs(O-ue.x),Je=Math.abs(z-ue.y);if(Pe<=Ji&&Je<=Ji)return!0}return!1}var u=te(o.style,"touchAction"),N=u!==r,$e="compute",nt="auto",je="manipulation",Qe="none",wt="pan-x",et="pan-y",Ye=To();function kt(L,O){this.manager=L,this.set(O)}kt.prototype={set:function(L){L==$e&&(L=this.compute()),N&&this.manager.element.style&&Ye[L]&&(this.manager.element.style[u]=L),this.actions=L.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var L=[];return w(this.manager.recognizers,function(O){F(O.options.enable,[O])&&(L=L.concat(O.getTouchAction()))}),Yi(L.join(" "))},preventDefaults:function(L){var O=L.srcEvent,z=L.offsetDirection;if(this.manager.session.prevented){O.preventDefault();return}var Z=this.actions,ue=X(Z,Qe)&&!Ye[Qe],Pe=X(Z,et)&&!Ye[et],Je=X(Z,wt)&&!Ye[wt];if(ue){var zt=L.pointers.length===1,Ve=L.distance<2,Qt=L.deltaTime<250;if(zt&&Ve&&Qt)return}if(!(Je&&Pe)&&(ue||Pe&&z&ci||Je&&z&bn))return this.preventSrc(O)},preventSrc:function(L){this.manager.session.prevented=!0,L.preventDefault()}};function Yi(L){if(X(L,Qe))return Qe;var O=X(L,wt),z=X(L,et);return O&&z?Qe:O||z?O?wt:et:X(L,je)?je:nt}function To(){if(!N)return!1;var L={},O=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(z){L[z]=O?e.CSS.supports("touch-action",z):!0}),L}var kr=1,Tt=2,bi=4,nn=8,Si=nn,jn=16,Re=32;function V(L){this.options=b({},this.defaults,L||{}),this.id=ve(),this.manager=null,this.options.enable=H(this.options.enable,!0),this.state=kr,this.simultaneous={},this.requireFail=[]}V.prototype={defaults:{},set:function(L){return b(this.options,L),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(L){if(v(L,"recognizeWith",this))return this;var O=this.simultaneous;return L=Co(L,this),O[L.id]||(O[L.id]=L,L.recognizeWith(this)),this},dropRecognizeWith:function(L){return v(L,"dropRecognizeWith",this)?this:(L=Co(L,this),delete this.simultaneous[L.id],this)},requireFailure:function(L){if(v(L,"requireFailure",this))return this;var O=this.requireFail;return L=Co(L,this),D(O,L)===-1&&(O.push(L),L.requireFailure(this)),this},dropRequireFailure:function(L){if(v(L,"dropRequireFailure",this))return this;L=Co(L,this);var O=D(this.requireFail,L);return O>-1&&this.requireFail.splice(O,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(L){return!!this.simultaneous[L.id]},emit:function(L){var O=this,z=this.state;function Z(ue){O.manager.emit(ue,L)}z<nn&&Z(O.options.event+it(z)),Z(O.options.event),L.additionalEvent&&Z(L.additionalEvent),z>=nn&&Z(O.options.event+it(z))},tryEmit:function(L){if(this.canEmit())return this.emit(L);this.state=Re},canEmit:function(){for(var L=0;L<this.requireFail.length;){if(!(this.requireFail[L].state&(Re|kr)))return!1;L++}return!0},recognize:function(L){var O=b({},L);if(!F(this.options.enable,[this,O])){this.reset(),this.state=Re;return}this.state&(Si|jn|Re)&&(this.state=kr),this.state=this.process(O),this.state&(Tt|bi|nn|jn)&&this.tryEmit(O)},process:function(L){},getTouchAction:function(){},reset:function(){}};function it(L){return L&jn?"cancel":L&nn?"end":L&bi?"move":L&Tt?"start":""}function iA(L){return L==Ps?"down":L==Ss?"up":L==li?"left":L==bs?"right":""}function Co(L,O){var z=O.manager;return z?z.get(L):L}function Wn(){V.apply(this,arguments)}P(Wn,V,{defaults:{pointers:1},attrTest:function(L){var O=this.options.pointers;return O===0||L.pointers.length===O},process:function(L){var O=this.state,z=L.eventType,Z=O&(Tt|bi),ue=this.attrTest(L);return Z&&(z&Et||!ue)?O|jn:Z||ue?z&Ke?O|nn:O&Tt?O|bi:Tt:Re}});function xo(){Wn.apply(this,arguments),this.pX=null,this.pY=null}P(xo,Wn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Fr},getTouchAction:function(){var L=this.options.direction,O=[];return L&ci&&O.push(et),L&bn&&O.push(wt),O},directionTest:function(L){var O=this.options,z=!0,Z=L.distance,ue=L.direction,Pe=L.deltaX,Je=L.deltaY;return ue&O.direction||(O.direction&ci?(ue=Pe===0?Xi:Pe<0?li:bs,z=Pe!=this.pX,Z=Math.abs(L.deltaX)):(ue=Je===0?Xi:Je<0?Ss:Ps,z=Je!=this.pY,Z=Math.abs(L.deltaY))),L.direction=ue,z&&Z>O.threshold&&ue&O.direction},attrTest:function(L){return Wn.prototype.attrTest.call(this,L)&&(this.state&Tt||!(this.state&Tt)&&this.directionTest(L))},emit:function(L){this.pX=L.deltaX,this.pY=L.deltaY;var O=iA(L.direction);O&&(L.additionalEvent=this.options.event+O),this._super.emit.call(this,L)}});function rA(){Wn.apply(this,arguments)}P(rA,Wn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Qe]},attrTest:function(L){return this._super.attrTest.call(this,L)&&(Math.abs(L.scale-1)>this.options.threshold||this.state&Tt)},emit:function(L){if(L.scale!==1){var O=L.scale<1?"in":"out";L.additionalEvent=this.options.event+O}this._super.emit.call(this,L)}});function k(){V.apply(this,arguments),this._timer=null,this._input=null}P(k,V,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[nt]},process:function(L){var O=this.options,z=L.pointers.length===O.pointers,Z=L.distance<O.threshold,ue=L.deltaTime>O.time;if(this._input=L,!Z||!z||L.eventType&(Ke|Et)&&!ue)this.reset();else if(L.eventType&dt)this.reset(),this._timer=m(function(){this.state=Si,this.tryEmit()},O.time,this);else if(L.eventType&Ke)return Si;return Re},reset:function(){clearTimeout(this._timer)},emit:function(L){this.state===Si&&(L&&L.eventType&Ke?this.manager.emit(this.options.event+"up",L):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}});function sA(){Wn.apply(this,arguments)}P(sA,Wn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Qe]},attrTest:function(L){return this._super.attrTest.call(this,L)&&(Math.abs(L.rotation)>this.options.threshold||this.state&Tt)}});function oA(){Wn.apply(this,arguments)}P(oA,Wn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ci|bn,pointers:1},getTouchAction:function(){return xo.prototype.getTouchAction.call(this)},attrTest:function(L){var O=this.options.direction,z;return O&(ci|bn)?z=L.overallVelocity:O&ci?z=L.overallVelocityX:O&bn&&(z=L.overallVelocityY),this._super.attrTest.call(this,L)&&O&L.offsetDirection&&L.distance>this.options.threshold&&L.maxPointers==this.options.pointers&&h(z)>this.options.velocity&&L.eventType&Ke},emit:function(L){var O=iA(L.offsetDirection);O&&this.manager.emit(this.options.event+O,L),this.manager.emit(this.options.event,L)}});function bo(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}P(bo,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[je]},process:function(L){var O=this.options,z=L.pointers.length===O.pointers,Z=L.distance<O.threshold,ue=L.deltaTime<O.time;if(this.reset(),L.eventType&dt&&this.count===0)return this.failTimeout();if(Z&&ue&&z){if(L.eventType!=Ke)return this.failTimeout();var Pe=this.pTime?L.timeStamp-this.pTime<O.interval:!0,Je=!this.pCenter||yo(this.pCenter,L.center)<O.posThreshold;this.pTime=L.timeStamp,this.pCenter=L.center,!Je||!Pe?this.count=1:this.count+=1,this._input=L;var zt=this.count%O.taps;if(zt===0)return this.hasRequireFailures()?(this._timer=m(function(){this.state=Si,this.tryEmit()},O.interval,this),Tt):Si}return Re},failTimeout:function(){return this._timer=m(function(){this.state=Re},this.options.interval,this),Re},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Si&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Pi(L,O){return O=O||{},O.recognizers=H(O.recognizers,Pi.defaults.preset),new So(L,O)}Pi.VERSION="2.0.7",Pi.defaults={domEvents:!1,touchAction:$e,enable:!0,inputTarget:null,inputClass:null,preset:[[sA,{enable:!1}],[rA,{enable:!1},["rotate"]],[oA,{direction:ci}],[xo,{direction:ci},["swipe"]],[bo],[bo,{event:"doubletap",taps:2},["tap"]],[k]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Zh=1,wc=2;function So(L,O){this.options=b({},Pi.defaults,O||{}),this.options.inputTarget=this.options.inputTarget||L,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=L,this.input=Ka(this),this.touchAction=new kt(this,this.options.touchAction),Tc(this,!0),w(this.options.recognizers,function(z){var Z=this.add(new z[0](z[1]));z[2]&&Z.recognizeWith(z[2]),z[3]&&Z.requireFailure(z[3])},this)}So.prototype={set:function(L){return b(this.options,L),L.touchAction&&this.touchAction.update(),L.inputTarget&&(this.input.destroy(),this.input.target=L.inputTarget,this.input.init()),this},stop:function(L){this.session.stopped=L?wc:Zh},recognize:function(L){var O=this.session;if(!O.stopped){this.touchAction.preventDefaults(L);var z,Z=this.recognizers,ue=O.curRecognizer;(!ue||ue&&ue.state&Si)&&(ue=O.curRecognizer=null);for(var Pe=0;Pe<Z.length;)z=Z[Pe],O.stopped!==wc&&(!ue||z==ue||z.canRecognizeWith(ue))?z.recognize(L):z.reset(),!ue&&z.state&(Tt|bi|nn)&&(ue=O.curRecognizer=z),Pe++}},get:function(L){if(L instanceof V)return L;for(var O=this.recognizers,z=0;z<O.length;z++)if(O[z].options.event==L)return O[z];return null},add:function(L){if(v(L,"add",this))return this;var O=this.get(L.options.event);return O&&this.remove(O),this.recognizers.push(L),L.manager=this,this.touchAction.update(),L},remove:function(L){if(v(L,"remove",this))return this;if(L=this.get(L),L){var O=this.recognizers,z=D(O,L);z!==-1&&(O.splice(z,1),this.touchAction.update())}return this},on:function(L,O){if(L!==r&&O!==r){var z=this.handlers;return w(U(L),function(Z){z[Z]=z[Z]||[],z[Z].push(O)}),this}},off:function(L,O){if(L!==r){var z=this.handlers;return w(U(L),function(Z){O?z[Z]&&z[Z].splice(D(z[Z],O),1):delete z[Z]}),this}},emit:function(L,O){this.options.domEvents&&aA(L,O);var z=this.handlers[L]&&this.handlers[L].slice();if(!(!z||!z.length)){O.type=L,O.preventDefault=function(){O.srcEvent.preventDefault()};for(var Z=0;Z<z.length;)z[Z](O),Z++}},destroy:function(){this.element&&Tc(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Tc(L,O){var z=L.element;if(!!z.style){var Z;w(L.options.cssProps,function(ue,Pe){Z=te(z.style,Pe),O?(L.oldCssProps[Z]=z.style[Z],z.style[Z]=ue):z.style[Z]=L.oldCssProps[Z]||""}),O||(L.oldCssProps={})}}function aA(L,O){var z=n.createEvent("Event");z.initEvent(L,!0,!0),z.gesture=O,O.target.dispatchEvent(z)}b(Pi,{INPUT_START:dt,INPUT_MOVE:dn,INPUT_END:Ke,INPUT_CANCEL:Et,STATE_POSSIBLE:kr,STATE_BEGAN:Tt,STATE_CHANGED:bi,STATE_ENDED:nn,STATE_RECOGNIZED:Si,STATE_CANCELLED:jn,STATE_FAILED:Re,DIRECTION_NONE:Xi,DIRECTION_LEFT:li,DIRECTION_RIGHT:bs,DIRECTION_UP:Ss,DIRECTION_DOWN:Ps,DIRECTION_HORIZONTAL:ci,DIRECTION_VERTICAL:bn,DIRECTION_ALL:Fr,Manager:So,Input:Dt,TouchAction:kt,TouchInput:Ms,MouseInput:Eo,PointerEventInput:me,TouchMouseInput:Y,SingleTouchInput:yc,Recognizer:V,AttrRecognizer:Wn,Tap:bo,Pan:xo,Swipe:oA,Pinch:rA,Rotate:sA,Press:k,on:j,off:K,each:w,merge:S,extend:R,assign:b,inherit:P,bindFn:M,prefixed:te});var ui=typeof e<"u"?e:typeof self<"u"?self:{};ui.Hammer=Pi,typeof r=="function"&&r.amd?r(function(){return Pi}):t.exports?t.exports=Pi:e[i]=Pi})(window,document,"Hammer")})(Wa);const KU=Wa.exports,$i=Xw({__proto__:null,default:KU},[Wa.exports]),Zb=1,qb=2,dp=4,ZU={mousedown:Zb,mousemove:qb,mouseup:dp};function qU(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function $U(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(qU(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function e5(t){t.prototype.handler=function(n){let i=ZU[n.type];i&Zb&&n.button>=0&&(this.pressed=!0),i&qb&&n.which===0&&(i=dp),this.pressed&&(i&dp&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}$U(Wa.exports.PointerEventInput);e5(Wa.exports.MouseInput);const t5=Wa.exports.Manager;class Ph{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const n5=$i?[[$i.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[$i.Rotate,{enable:!1}],[$i.Pinch,{enable:!1}],[$i.Swipe,{enable:!1}],[$i.Pan,{threshold:0,enable:!1}],[$i.Press,{enable:!1}],[$i.Tap,{event:"doubletap",taps:2,enable:!1}],[$i.Tap,{event:"anytap",enable:!1}],[$i.Tap,{enable:!1}]]:null,C2={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},i5={doubletap:["tap"]},r5={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},_1={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},s5={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},x2={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},o5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ra=typeof window<"u"?window:global;let gp=!1;try{const t={get passive(){return gp=!0,!0}};ra.addEventListener("test",null,t),ra.removeEventListener("test",null)}catch{gp=!1}const a5=o5.indexOf("firefox")!==-1,{WHEEL_EVENTS:A5}=_1,b2="wheel",S2=4.000244140625,l5=40,c5=.25;class u5 extends Ph{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;ra.WheelEvent&&(a5&&r.deltaMode===ra.WheelEvent.DOM_DELTA_PIXEL&&(s/=ra.devicePixelRatio),r.deltaMode===ra.WheelEvent.DOM_DELTA_LINE&&(s*=l5)),s!==0&&s%S2===0&&(s=Math.floor(s/S2)),r.shiftKey&&s&&(s=s*c5),this.callback({type:b2,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(A5),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,gp?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===b2&&(this.options.enable=n)}}const{MOUSE_EVENTS:f5}=_1,P2="pointermove",M2="pointerover",I2="pointerout",B2="pointerenter",L2="pointerleave";class h5 extends Ph{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(f5),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===P2&&(this.enableMoveEvent=n),e===M2&&(this.enableOverEvent=n),e===I2&&(this.enableOutEvent=n),e===B2&&(this.enableEnterEvent=n),e===L2&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(M2,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(I2,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(B2,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(L2,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(P2,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:d5}=_1,R2="keydown",O2="keyup";class g5 extends Ph{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:R2,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:O2,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(d5),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===R2&&(this.enableDownEvent=n),e===O2&&(this.enableUpEvent=n)}}const F2="contextmenu";class p5 extends Ph{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:F2,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===F2&&(this.options.enable=n)}}const pp=1,Gf=2,mp=4,m5={pointerdown:pp,pointermove:Gf,pointerup:mp,mousedown:pp,mousemove:Gf,mouseup:mp},_5=1,y5=2,v5=3,E5=0,w5=1,T5=2,C5=1,x5=2,b5=4;function S5(t){const e=m5[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===mp||e===Gf&&!Number.isFinite(n)?(s=r===_5,o=r===y5,a=r===v5):e===Gf?(s=Boolean(n&C5),o=Boolean(n&b5),a=Boolean(n&x5)):e===pp&&(s=i===E5,o=i===w5,a=i===T5),{leftButton:s,middleButton:o,rightButton:a}}function P5(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const f0={srcElement:"root",priority:0};class M5{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=f0;typeof i=="string"||i&&i.addEventListener?l={...f0,srcElement:i}:i&&(l={...f0,...i});let h=a.get(l.srcElement);h||(h=[],a.set(l.srcElement,h));const g={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(g.once=!0),s&&(g.passive=!0),o.push(g),this._active=this._active||!g.passive;let m=h.length-1;for(;m>=0&&!(h[m].priority>=g.priority);)m--;h.splice(m+1,0,g)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:h,handler:g,once:m}=i[l];if(g({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),m&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:h,handler:g}=a[l];this.remove(h,g)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...S5(e),...P5(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const I5={events:null,recognizers:null,recognizerOptions:{},Manager:t5,touchAction:"none",tabIndex:0};class B5{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=r5[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...I5,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||n5}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(C2).forEach(r=>{const s=this.manager.get(r);s&&C2[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new u5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new h5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new g5(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new p5(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=i5[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const g in e)this._addEventHandler(g,e[g],i,r,s);return}const{manager:o,events:a}=this,l=x2[e]||e;let h=a.get(l);h||(h=new M5(this),a.set(l,h),h.recognizerName=s5[l]||l,o&&o.on(l,h.handleEvent)),h.add(e,n,i,r,s),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=x2[e]||e,s=i.get(r);if(!!s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ks(){}const L5=({isDragging:t})=>t?"grabbing":"grab",$b={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ks,onResize:ks,onViewStateChange:ks,onInteractionStateChange:ks,onBeforeRender:ks,onAfterRender:ks,onLoad:ks,onError:t=>De.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:L5,getTooltip:null,debug:!1,drawPickingColors:!1};class Mh{constructor(e){T(this,"props",void 0),T(this,"width",0),T(this,"height",0),T(this,"userData",{}),T(this,"canvas",null),T(this,"viewManager",null),T(this,"layerManager",null),T(this,"effectManager",null),T(this,"deckRenderer",null),T(this,"deckPicker",null),T(this,"eventManager",null),T(this,"tooltip",null),T(this,"metrics",void 0),T(this,"animationLoop",void 0),T(this,"stats",void 0),T(this,"viewState",void 0),T(this,"cursorState",void 0),T(this,"_needsRedraw",void 0),T(this,"_pickRequest",void 0),T(this,"_lastPointerDownInfo",null),T(this,"_metricsCounter",void 0),T(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),T(this,"_onEvent",n=>{const i=c2[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),h=this.props[i.handler];let g=!1;l&&(g=l.call(a,o,n)),!g&&h&&h(o,n)}),T(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...$b,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&De.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),_x()==="IE"&&De.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Kl({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Da.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&De.removed("onLayerHover","onHover")(),"onLayerClick"in e&&De.removed("onLayerClick","onClick")(),e.initialViewState&&!mo(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return sn(this.viewManager),this.viewManager.views}getViewports(e){return sn(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){sn(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),sn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:h,useDevicePixels:g}=e;return new U4({width:n,height:i,useDevicePixels:g,autoResizeViewport:!1,gl:r,onCreateContext:m=>Dx({...s,...m,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:m=>this._setGLContext(m.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:h,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Qb({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Jm(e,{enable:!0,copyState:!0})),this.tooltip=new YU(this.canvas),Pr(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new Mb;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new B5(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in c2)this.eventManager.on(r,this._onEvent);this.viewManager=new fU({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new uU(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new DU,this.deckRenderer=new zU(e),this.deckPicker=new XU(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Pr(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),De.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Xs.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}T(Mh,"defaultProps",$b);T(Mh,"VERSION",QO.VERSION);class h0{constructor(e,n){T(this,"opts",void 0),T(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function R5(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Ku(t){return t.stride||t.size*t.bytesPerElement}function eS(t,e){e.offset&&De.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Ku(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function O5(t,e){const n=eS(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class F5{constructor(e,n,i){T(this,"gl",void 0),T(this,"id",void 0),T(this,"size",void 0),T(this,"settings",void 0),T(this,"value",void 0),T(this,"doublePrecision",void 0),T(this,"_buffer",void 0),T(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&Ch(e,pt.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=R5(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new ft(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ku(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Da.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=O5(this.getAccessor(),n||{});return i[e]=new h0(this,s.high),i["".concat(e,"64Low")]=r?new h0(this,s.low):new Float32Array(this.size),i}if(n){const i=eS(this.getAccessor(),n);return{[e]:new h0(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let h=0;h<r;h++){const g=n[l++];g<o[h]&&(o[h]=g),g>a[h]&&(a[h]=g)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ft?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=Ku(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=Ku(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=c0(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?c0(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Da.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?c0(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&De.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=r[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const D2=[],k2=[];function xs(t,e=0,n=1/0){let i=D2;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(k2.length=t.length,i=k2):i=D2,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function tS(t){return t&&t[Symbol.asyncIterator]}function nS(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,h=r?r/a:0,g=Math.floor((t.length-h)/l);return(m,{index:v,target:w})=>{if(!s){const S=v*l+h;for(let P=0;P<n;P++)w[P]=t[S+P];return w}const C=s[v],b=s[v+1]||g;let R;if(o){R=new Array(b-C);for(let S=C;S<b;S++){const P=S*l+h;w=new Array(n);for(let M=0;M<n;M++)w[M]=t[P+M];R[S-C]=w}}else if(l===n)R=t.subarray(C*n+h,b*n+h);else{R=new t.constructor((b-C)*n);let S=0;for(let P=C;P<b;P++){const M=P*l+h;for(let F=0;F<n;F++)R[S++]=t[M+F]}}return R}}const D5=[],Zu=[[0,1/0]];function k5(t,e){if(t===Zu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function d0(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let h=a;for(;h<l;){const g=s(h,e);for(let m=0;m<r;m++)n[i+h]=g[m]||0,h++}}function N5({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return d0({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((g,m)=>i(g+a,m)),h=Math.min(r.length,s.length);for(let g=1;g<h;g++){const m=r[g]*n,v=s[g]*n;d0({source:t.subarray(o,m),target:e,start:a,end:v,size:n,getData:l}),o=m,a=v}return a<e.length&&d0({source:[],target:e,start:a,size:n,getData:l}),e}const U5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function iS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...U5[n],...e,...t,type:n}}function rS(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function sS(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function oS(t){t.push(t.shift())}function y1(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function aS({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,h=n.startIndices,g=r&&h,m=y1(n,e),v=n.isConstant;if(!g&&i>=m)return;const w=v?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!v){const S=s;s=(P,M)=>n.normalizeConstant(S(P,M))}const C=v?(S,P)=>s(w,P):(S,P)=>s(w.subarray(S,S+a),P),b=t.getData({length:i}),R=new Float32Array(m);N5({source:b,target:R,sourceStartIndices:r,targetStartIndices:h,size:a,getData:C}),t.byteLength<R.byteLength+l&&t.reallocate(R.byteLength+l),t.subData({data:R,offset:l})}class v1 extends F5{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Zu}),T(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return iS(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=k5(this.state.updateRanges,[i,r])}else this.state.updateRanges=Zu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=D5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Zu),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[h,g]of s)o.call(r,this,{data:n,startRow:h,endRow:g,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,g]of s){const m=Number.isFinite(h)?this.getVertexOffset(h):0,v=Number.isFinite(g)?this.getVertexOffset(g):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:v})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;sn(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=nS(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:h,size:g,startIndices:m}=e,{accessor:v,transform:w}=a,C=l.binaryAccessor||(typeof v=="function"?v:s[v]);sn(typeof C=="function",'accessor "'.concat(v,'" is not a function'));let b=e.getVertexOffset(i);const{iterable:R,objectInfo:S}=xs(n,i,r);for(const P of R){S.index++;let M=C(P,S);if(w&&(M=w.call(this,M)),m){const F=(S.index<m.length-1?m[S.index+1]:o)-m[S.index];if(M&&Array.isArray(M[0])){let H=b;for(const j of M)e._normalizeValue(j,h,H),H+=g}else M&&M.length>g?h.set(M,b):(e._normalizeValue(M,S.target,0),oU({target:h,source:S.target,start:b,count:F}));b+=F*g}else e._normalizeValue(M,h,b),b+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class G5{constructor({gl:e,attribute:n,timeline:i}){T(this,"gl",void 0),T(this,"type","interpolation"),T(this,"attributeInTransition",void 0),T(this,"settings",void 0),T(this,"attribute",void 0),T(this,"transition",void 0),T(this,"currentStartIndices",void 0),T(this,"currentLength",void 0),T(this,"transform",void 0),T(this,"buffers",void 0),this.gl=e,this.transition=new sc(i),this.attribute=n,this.attributeInTransition=new v1(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=V5(e,n);const r={byteLength:0,usage:35050};this.buffers=[new ft(e,r),new ft(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;oS(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)aS({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=y1(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:rS(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const z5=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function V5(t,e){const n=sS(e.size);return new h1(t,{vs:z5,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class H5{constructor({gl:e,attribute:n,timeline:i}){T(this,"gl",void 0),T(this,"type","spring"),T(this,"attributeInTransition",void 0),T(this,"settings",void 0),T(this,"attribute",void 0),T(this,"transition",void 0),T(this,"currentStartIndices",void 0),T(this,"currentLength",void 0),T(this,"texture",void 0),T(this,"framebuffer",void 0),T(this,"transform",void 0),T(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new sc(i),this.attribute=n,this.attributeInTransition=new v1(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=W5(e),this.framebuffer=Q5(e,this.texture),this.transform=j5(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new ft(e,r),new ft(e,r),new ft(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)aS({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=y1(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:rS(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),oS(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Th(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function j5(t,e,n){const i=sS(e.size);return new h1(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function W5(t){return new hn(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function Q5(t,e){return new Wt(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const X5={interpolation:G5,spring:H5};class J5{constructor(e,{id:n,timeline:i}){T(this,"id",void 0),T(this,"isSupported",void 0),T(this,"gl",void 0),T(this,"timeline",void 0),T(this,"transitions",void 0),T(this,"needsRedraw",void 0),T(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=h1.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);!o||this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){De.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=X5[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(De.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const N2="attributeManager.invalidate",Y5="attributeManager.updateStart",K5="attributeManager.updateEnd",Z5="attribute.updateStart",q5="attribute.allocate",$5="attribute.updateEnd";class eG{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){T(this,"id",void 0),T(this,"gl",void 0),T(this,"attributes",void 0),T(this,"updateTriggers",void 0),T(this,"needsRedraw",void 0),T(this,"userData",void 0),T(this,"stats",void 0),T(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new J5(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);yn(N2,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);yn(N2,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;yn(Y5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const g=this.attributes[h],m=g.settings.accessor;g.startIndices=i,g.numInstances=n,s[h]&&De.removed("props.".concat(h),"data.attributes.".concat(h))(),g.setExternalBuffer(o[h])||g.setBinaryValue(typeof m=="string"?o[m]:void 0,e.startIndices)||typeof m=="string"&&!o[m]&&g.setConstantValue(s[m])||g.needsUpdate()&&(l=!0,this._updateAttribute({attribute:g,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}l&&yn(K5,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new v1(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(yn(Z5,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&yn(q5,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,yn($5,n,i))}}class tG extends sc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=Vi(n,i,o)}}const U2=1e-5;function G2(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function nG(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=G2(t[o],e[o],n[o],i,r);return s}return G2(t,e,n,i,r)}function z2(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class iG extends sc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=nG(s,o,n,i,r);const l=z2(a,n),h=z2(a,o);l<U2&&h<U2&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const rG={interpolation:tG,spring:iG};class sG{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:h=l.settings.fromValue}=l;n=h,this.remove(e)}if(r=iS(r),!r)return;const o=rG[r.type];if(!o){De.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function oG(t){const e=E1(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function aG(t,e){const n=AS({newProps:t,oldProps:e,propTypes:E1(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=lG(t,e);let r=!1;return i||(r=cG(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:uG(t,e),transitionsChanged:AG(t,e)}}function AG(t,e){if(!t.transitions)return!1;const n={},i=E1(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&_p(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function AS({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=_p(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=_p(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function _p(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function lG(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function cG(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&V2(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&V2(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function uG(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function V2(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let r=e.updateTriggers[n];return r=r==null?{}:r,AS({oldProps:r,newProps:i,triggerName:n})}function E1(t){const e=t[Uf],n=e&&e.constructor;return n?n._propTypes:{}}const fG="count(): argument not an object",hG="count(): argument not a container";function dG(t){if(!pG(t))throw new Error(fG);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(gG(t))return Object.keys(t).length;throw new Error(hG)}function gG(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function pG(t){return t!==null&&typeof t=="object"}function mG(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const _G={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},yp={};function yG(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof hn)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new hn(n,{...e,parameters:{..._G,...i,...t.props.textureParameters}});return yp[r.id]=!0,r}function vG(t){!t||!(t instanceof hn)||yp[t.id]&&(t.delete(),delete yp[t.id])}const EG={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Bl(t)&&(t.length===3||t.length===4)},equal(t,e,n){return g0(t,e)}},accessor:{validate(t,e){const n=zf(t);return n==="function"||n===zf(e.value)},equal(t,e,n){return typeof e=="function"?!0:g0(t,e)}},array:{validate(t,e){return e.optional&&!t||Bl(t)},equal(t,e,n){return n.compare?g0(t,e):t===e}},object:{equal(t,e,n){return n.compare?mo(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>yG(n,t),release:t=>{vG(t)}}};function g0(t,e){if(t===e)return!0;if(!Bl(t)||!Bl(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function wG(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=TG(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function TG(t,e){switch(zf(e)){case"object":return bA(t,e);case"array":return bA(t,{type:"array",value:e,compare:!1});case"boolean":return bA(t,{type:"boolean",value:e});case"number":return bA(t,{type:"number",value:e});case"function":return bA(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function bA(t,e){return"type"in e?{name:t,...EG[e.type],...e}:"value"in e?{name:t,type:zf(e.value),...e}:{name:t,type:"object",value:e}}function Bl(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function zf(t){return Bl(t)?"array":t===null?"null":typeof t}function CG(t,e){const n=lS(t.constructor),i=Object.create(n);i[Uf]=t,i[oo]={},i[is]={};for(let r=0;r<e.length;++r){const s=e[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function lS(t){const e=Vf(t,"_mergedDefaultProps");return e||(xG(t),t._mergedDefaultProps)}function xG(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=lS(n),r=Vf(t,"defaultProps")||{},s=wG(r),o=bG(s.defaultProps,i,t),a={...n._propTypes,...s.propTypes};PG(o,a);const l={...n._deprecatedProps,...s.deprecatedProps};SG(o,l),t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=l}function bG(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=IG(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function SG(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])cS(this,s)||(this[s]=i);De.deprecated(r,e[n].join("/"))()}})}function PG(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=MG(o))}t[va]=n,t[oo]={},Object.defineProperties(t,i)}function MG(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||tS(e)?this[oo][t]=e:this[is][t]=e},get(){if(this[is]){if(t in this[is])return this[is][t]||this[va][t];if(t in this[oo]){const e=this[Uf]&&this[Uf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[va][t]}}return this[va][t]}}}function cS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Vf(t,e){return cS(t,e)&&t[e]}function IG(t){const e=Vf(t,"layerName")||Vf(t,"componentName");return e||De.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let BG=0;class w1{constructor(...e){T(this,"id",void 0),T(this,"props",void 0),T(this,"count",void 0),this.props=CG(this,e),this.id=this.props.id,this.count=BG++}clone(e){const{props:n}=this,i={};for(const r in n[va])r in n[is]?i[r]=n[is][r]:r in n[oo]&&(i[r]=n[oo][r]);return new this.constructor({...n,...i,...e})}}T(w1,"componentName","Component");T(w1,"defaultProps",{});const LG=Object.freeze({});class RG{constructor(e){T(this,"component",void 0),T(this,"onAsyncPropUpdated",void 0),T(this,"asyncProps",void 0),T(this,"oldProps",void 0),T(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||LG}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[is]||{},i=e[oo]||e,r=e[va]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(tS(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class OG extends RG{constructor({attributeManager:e,layer:n}){super(n),T(this,"attributeManager",void 0),T(this,"needsRedraw",void 0),T(this,"needsUpdate",void 0),T(this,"subLayers",void 0),T(this,"usesPickingColorCache",void 0),T(this,"changeFlags",void 0),T(this,"viewport",void 0),T(this,"uniformTransitions",void 0),T(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const FG="layer.changeFlag",DG="layer.initialize",kG="layer.update",NG="layer.finalize",UG="layer.matched",H2=2**24-1,GG=Object.freeze([]),zG=rc(({oldViewport:t,viewport:e})=>t.equals(e));let er=new Uint8ClampedArray(0);const VG={data:{type:"data",value:GG,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:Sr(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:h=>{var g;return(g=n.internalState)===null||g===void 0?void 0:g.reloadAsyncProp(e,h)},consumerId:n.id,requestId:e}):Sr(t,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:ic.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Ge.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class xn extends w1{constructor(...e){super(...e),T(this,"internalState",null),T(this,"lifecycle",Ho.NO_STATE),T(this,"context",void 0),T(this,"state",void 0),T(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){sn(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=zb(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=kb(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return sn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){sn(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Vb(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ge.DEFAULT||e===Ge.LNGLAT||e===Ge.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){sn(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:dG(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:r}=n.attributes;return(e=i||r)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=mG(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const l of i)n.invalidateAll(l);else n.invalidateAll();const{props:r,oldProps:s}=e,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&n){const{pickingColors:l,instancePickingColors:h}=n.attributes,g=l||h;g&&(a&&g.constant&&(g.constant=!1,n.invalidate(g.id)),!g.value&&!a&&(g.constant=!0,g.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!zG({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(er.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>H2&&De.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),er=Da.allocate(er,n,{size:3,copy:!0,maxCount:Math.max(n,H2)});const r=Math.floor(er.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),er[o*3+0]=s[0],er[o*3+1]=s[1],er[o*3+2]=s[2]}e.value=er.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==er.buffer&&(i.value=er.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){sn(!this.internalState),sn(Number.isFinite(this.props.coordinateSystem)),yn(DG,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new OG({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(De.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new sG(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){yn(UG,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(yn(kG,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const g of this.props.extensions)g.updateState.call(this,a,g);const h=this.getModels()[0]!==l[0];this._postUpdate(a,h)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){yn(NG,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];Pr(s.gl,{polygonOffset:l}),vi(s.gl,i,()=>{const h={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const g of this.props.extensions)g.draw.call(this,h,g);this.draw(h)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&yn(FG,this,r,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=aG(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){oG(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new eG(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const h={};o||(h.pickingSelectedColor=null),Array.isArray(l)&&(h.pickingHighlightColor=l),Number.isInteger(a)&&(h.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(h)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;return n=n||r,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}T(xn,"defaultProps",VG);T(xn,"layerName","Layer");const HG="compositeLayer.renderLayers";class Or extends xn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:h,highlightColor:g,coordinateSystem:m,coordinateOrigin:v,wrapLongitude:w,positionFormat:C,modelMatrix:b,extensions:R,fetch:S,operation:P,_subLayerProps:M}=this.props,F={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:h,highlightColor:g,coordinateSystem:m,coordinateOrigin:v,wrapLongitude:w,positionFormat:C,modelMatrix:b,extensions:R,fetch:S,operation:P},H=M&&e.id&&M[e.id],j=H&&H.updateTriggers,K=e.id||"sublayer";if(H){const ee=this.constructor._propTypes,X=e.type?e.type._propTypes:{};for(const U in H){const D=X[U]||ee[U];D&&D.type==="accessor"&&(H[U]=this.getSubLayerAccessor(H[U]))}}Object.assign(F,e,H),F.id="".concat(this.props.id,"-").concat(K),F.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...j};for(const ee of R){const X=ee.getSubLayerProps.call(this,ee);X&&Object.assign(F,X,{updateTriggers:Object.assign(F.updateTriggers,X.updateTriggers)})}return F}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=Sh(s,Boolean),this.internalState.subLayers=i}yn(HG,this,r,i);for(const s of i)s.parent=this}}T(Or,"layerName","CompositeLayer");const lu=Math.PI/180,j2=180/Math.PI,qu=6370972,sa=256;function jG(){const t=sa/qu,e=Math.PI/180*sa;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class WG extends Cs{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:h=1.5}=e;l=l||1,h=Math.max(.75,h);const g=new ze().lookAt({eye:[0,-h,0],up:[0,0,1]}),m=Math.pow(2,r);g.rotateX(n*lu),g.rotateZ(-i*lu),g.scale(m/l);const v=Math.atan(.5/h),w=sa*2*m/l;super({...e,height:l,viewMatrix:g,longitude:i,latitude:n,zoom:r,distanceScales:jG(),fovyRadians:v*2,focalDistance:h,near:s,far:Math.min(2,1/w+1)*h*o}),T(this,"longitude",void 0),T(this,"latitude",void 0),T(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return ki.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let h;if(Number.isFinite(o))h=p0(l,[r,a,o,1]);else{const w=p0(l,[r,a,-1,1]),C=p0(l,[r,a,1,1]),b=((i||0)/qu+1)*sa,R=r0(mb([],w,C)),S=r0(w),P=r0(C),M=(4*S*P-(R-S-P)**2)/16,F=4*M/R,H=Math.sqrt(S-F),j=Math.sqrt(Math.max(0,b*b-F)),K=(H-j)/Math.sqrt(R);h=Kk([],w,C,K)}const[g,m,v]=this.unprojectPosition(h);return Number.isFinite(o)?[g,m,v]:Number.isFinite(i)?[g,m,i]:[g,m]}projectPosition(e){const[n,i,r=0]=e,s=n*lu,o=i*lu,a=Math.cos(o),l=(r/qu+1)*sa;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=_b(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*j2,h=o*j2,g=(s/sa-1)*qu;return[l,h,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function p0(t,e){const n=ja([],e,t);return l1(n,n,1/n[3]),n}class uS{constructor(e){T(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&mo(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e,n){}}T(uS,"defaultProps",{});class fS{constructor(e){T(this,"opts",void 0),T(this,"typedArrayManager",void 0),T(this,"indexStarts",[0]),T(this,"vertexStarts",[0]),T(this,"vertexCount",0),T(this,"instanceCount",0),T(this,"attributes",void 0),T(this,"_attributeDefs",void 0),T(this,"data",void 0),T(this,"getGeometry",void 0),T(this,"geometryBuffer",void 0),T(this,"buffers",void 0),T(this,"positionSize",void 0),T(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Da,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(sn(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?nS(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=xs(r,n,i);for(const l of o){a.index++;const h=s?s(l,a):null;e(h,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},h={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((m,v)=>{const w=m&&this.normalizeGeometry(m);h[v]=w,i[v+1]=i[v]+(w?this.getGeometrySize(w):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof ft){const m=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/m}else if(o.buffer){const m=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/m}else if(o.value){const m=o.value,v=o.stride/m.BYTES_PER_ELEMENT||this.positionSize;r=r||m.length/v}this._allocate(r,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const g={};this._forEachGeometry((m,v)=>{const w=h[v]||m;g.vertexStart=i[v],g.indexStart=n[v];const C=v<i.length-1?i[v+1]:r;g.geometrySize=C-i[v],g.geometryIndex=v,this.updateGeometryAttributes(w,g)},a,l),this.vertexCount=n[n.length-1]}}const QG=typeof window<"u"?Ee.exports.useLayoutEffect:Ee.exports.useEffect;function Hf(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const XG={position:"absolute",zIndex:-1};function hS(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>hS(n,e));if(Ih(t)){if(JG(t))return e.style=XG,Ee.exports.cloneElement(t,e);if(YG(t))return Ee.exports.cloneElement(t,e)}return t}function Ih(t){return t&&typeof t=="object"&&"type"in t||!1}function JG(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function YG(t){const e=t.type;return e&&e.deckGLViewProps}function vp(t){if(typeof t=="function")return Ee.exports.createElement(ao,{},t);if(Array.isArray(t))return t.map(vp);if(Ih(t)){if(t.type===Ee.exports.Fragment)return vp(t.props.children);if(Hf(t.type,ao))return t}return t}function KG({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return Ee.exports.Children.forEach(vp(t),o=>{if(Ih(o)){const a=o.type;if(Hf(a,xn)){const l=ZG(a,o.props);r.push(l)}else i.push(o);if(Hf(a,ao)&&a!==ao&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function ZG(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function qG({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of t){let a=s,l=o;Ih(o)&&Hf(o.type,ao)&&(a=o.props.id||s,l=o.props.children);const h=i.getViewport(a),g=i.getViewState(a);if(h){const{x:m,y:v,width:w,height:C}=h;l=hS(l,{x:m,y:v,width:w,height:C,viewport:h,viewState:g}),r[a]||(r[a]={viewport:h,children:[]}),r[a].children.push(l)}}return Object.keys(r).map(o=>{const{viewport:a,children:l}=r[o],{x:h,y:g,width:m,height:v}=a,w={position:"absolute",left:h,top:g,width:m,height:v},C="view-".concat(o),b=Ee.exports.createElement("div",{key:C,id:C,style:w},...l);if(n){const R={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:S=>{S.viewId=o,e._onViewStateChange(S)}};return Ee.exports.createElement(n,{key:C,value:R},b)}return b})}const $G={mixBlendMode:null};function ez({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in $G?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function tz(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function dS(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function nz(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():dS(t)}});return i}const gS=Ee.exports.forwardRef((t,e)=>{const[n,i]=Ee.exports.useState(0),s=Ee.exports.useRef({control:null,version:n,forceUpdate:()=>i(H=>H+1)}).current,o=Ee.exports.useRef(null),a=Ee.exports.useRef(null),l=Ee.exports.useMemo(()=>KG(t),[t.layers,t.views,t.children]);let h=!0;const g=H=>{var j;return h&&t.viewState?(s.viewStateUpdateRequested=H,null):(s.viewStateUpdateRequested=null,(j=t.onViewStateChange)===null||j===void 0?void 0:j.call(t,H))},m=H=>{if(h)s.interactionStateUpdateRequested=H;else{var j;s.interactionStateUpdateRequested=null,(j=t.onInteractionStateChange)===null||j===void 0||j.call(t,H)}},v=Ee.exports.useMemo(()=>{const H={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:g,onInteractionStateChange:m};return delete H._customRender,s.deck&&s.deck.setProps(H),H},[t]);Ee.exports.useEffect(()=>{const H=t.Deck||Mh;return s.deck=nz(s,H,{...v,parent:o.current,canvas:a.current}),()=>{var j;return(j=s.deck)===null||j===void 0?void 0:j.finalize()}},[]),QG(()=>{dS(s);const{viewStateUpdateRequested:H,interactionStateUpdateRequested:j}=s;H&&g(H),j&&m(j)}),Ee.exports.useImperativeHandle(e,()=>tz(s),[]);const w=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:C,width:b,height:R,id:S,style:P}=t,{containerStyle:M,canvasStyle:F}=Ee.exports.useMemo(()=>ez({width:b,height:R,style:P}),[b,R,P]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===w||s.version!==n){s.lastRenderedViewports=w,s.version=n;const H=qG({children:l.children,deck:s.deck,ContextProvider:C}),j=Ee.exports.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:a,style:F});s.control=Ee.exports.createElement("div",{id:"".concat(S||"deckgl","-wrapper"),ref:o,style:M},[j,H])}return h=!1,s.control});gS.defaultProps=Mh.defaultProps;const iz=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  // d: distance on the xy plane
  // r: ratio of the current point
  // p: ratio of the peak of the arc
  // h: height multiplier
  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h
  // f(0) = 0
  // f(1) = dz

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;

  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}

/* Great circle interpolation
 * http://www.movable-type.co.uk/scripts/latlong.html
 */
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;

  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

/* END GREAT CIRCLE */

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));

  // if it's the first point, use next - current as direction
  // otherwise use current - prev
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      // split at the 180th meridian
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);

    // common x at longitude=-180
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }

  // Multiply out width and clamp to limits
  // mercator pixels are interpreted as screen pixels
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rz=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,jf=[0,0,0,255],sz={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:jf},getTargetColor:{type:"accessor",value:jf},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class T1 extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return super.getShaders({vs:iz,fs:rz,modules:[Ti,Ci]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:jf},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:jf},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:oi[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){let n=[];for(let s=0;s<50;s++)n=n.concat([s,1,0,s,-1,0]);const r=new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return r.setUniforms({numSegments:50}),r}}T(T1,"layerName","ArcLayer");T(T1,"defaultProps",sz);const oz=new Uint16Array([0,2,1,0,3,2]),az=new Float32Array([0,1,0,0,1,0,1,1]);function Az(t,e){if(!e)return lz(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),h=new Float64Array(r*s*3);let g=0,m=0;for(let v=0;v<r;v++){const w=v/(r-1);for(let C=0;C<s;C++){const b=C/(s-1),R=cz(t,w,b);h[g*3+0]=R[0],h[g*3+1]=R[1],h[g*3+2]=R[2]||0,l[g*2+0]=w,l[g*2+1]=1-b,v>0&&C>0&&(a[m++]=g-s,a[m++]=g-s-1,a[m++]=g-1,a[m++]=g-s,a[m++]=g-1,a[m++]=g),g++}}return{vertexCount:o,positions:h,indices:a,texCoords:l}}function lz(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:oz,texCoords:az}}function cz(t,e,n){return Vi(Vi(t[0],t[1],n),Vi(t[3],t[2],n),e)}const uz=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,fz=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,hz=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(fz,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),dz={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Ge.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class pS extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return super.getShaders({vs:uz,fs:hz,modules:[Ti,Ci]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:i}){const r=this.getAttributeManager();if(i.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),r.invalidateAll()}if(e.bounds!==n.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const l in a)o&&o[l]!==a[l]&&r.invalidate(l);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,i=e.info;if(!i.color||!n)return i.bitmap=null,i;const{width:r,height:s}=n;i.index=0;const o=gz(i.color),a=[Math.floor(o[0]*r),Math.floor(o[1]*s)];return i.bitmap={size:{width:r,height:s},uv:o,pixel:a},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return W2(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Az(n,this.context.viewport.resolution)}_getModel(e){return e?new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:r,coordinateConversion:s,bounds:o,disablePicking:a}=this.state,{image:l,desaturate:h,transparentColor:g,tintColor:m}=this.props;i.pickingActive&&a||l&&r&&r.setUniforms(n).setUniforms({bitmapTexture:l,desaturate:h,transparentColor:g.map(v=>v/255),tintColor:m.slice(0,3).map(v=>v/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=Ge;let{_imageCoordinateSystem:r}=this.props;if(r!==i){const{bounds:s}=this.props;if(!W2(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(r=r===e?e:n,r===e&&o===n)return{coordinateConversion:-1,bounds:s};if(r===n&&o===e){const a=_s([s[0],s[1]]),l=_s([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}T(pS,"layerName","BitmapLayer");T(pS,"defaultProps",dz);function gz(t){const[e,n,i]=t,r=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+r)/256]}function W2(t){return Number.isFinite(t[0])}const pz=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,mz=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_z=1024,yz=4,Q2=()=>{},X2={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function vz(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Ez(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function Ll(t){return t&&(t.id||t.url)}function wz(t,e,n,i){const r=t.width,s=t.height,o=new hn(t.gl,{width:e,height:n,parameters:i});return fD(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function J2(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Ll(r);t[o]={...r,x:s,y:n}}}function Tz({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const h=t[l],g=Ll(h);if(!n[g]){const{height:m,width:v}=h;i+v+e>o&&(J2(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:h,xOffset:i}),i=i+v+e,s=Math.max(s,m)}}return a.length>0&&J2(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:vz(s+r+e)}}function Cz(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=xs(t);for(const o of r){s.index++;const a=e(o,s),l=Ll(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class xz{constructor(e,{onUpdate:n=Q2,onError:i=Q2}){T(this,"gl",void 0),T(this,"onUpdate",void 0),T(this,"onError",void 0),T(this,"_loadOptions",null),T(this,"_texture",null),T(this,"_externalTexture",null),T(this,"_mapping",{}),T(this,"_textureParameters",null),T(this,"_pendingCount",0),T(this,"_autoPacking",!1),T(this,"_xOffset",0),T(this,"_yOffset",0),T(this,"_rowHeight",0),T(this,"_buffer",yz),T(this,"_canvasWidth",_z),T(this,"_canvasHeight",0),T(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Ll(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(Cz(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=Tz({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new hn(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||X2})),this._texture.height!==this._canvasHeight&&(this._texture=wz(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||X2)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,Sr(i.url,Wm,this._loadOptions).then(r=>{const s=Ll(i),{x:o,y:a,width:l,height:h}=this._mapping[s],g=Ez(n,r,l,h);this._texture.setSubImageData({data:g,x:o,y:a,width:l,height:h}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const mS=[0,0,0,255],bz={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:mS},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Bh extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return super.getShaders({vs:pz,fs:mz,modules:[Ti,Ci]})}initializeState(){this.state={iconManager:new xz(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:mS},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:h,textureParameters:g}=n,{iconManager:m}=this.state,v=o||this.internalState.isAsyncPropLoading("iconAtlas");if(m.setProps({loadOptions:n.loadOptions,autoPacking:!v,iconAtlas:o,iconMapping:v?a:null,textureParameters:g}),v?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&m.packIcons(l,h),r.extensionsChanged){var w;const{gl:C}=this.context;(w=this.state.model)===null||w===void 0||w.delete(),this.state.model=this._getModel(C),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,h=l.getTexture();h&&this.state.model.setUniforms(e).setUniforms({iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:oi[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):De.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}T(Bh,"defaultProps",bz);T(Bh,"layerName","IconLayer");const Sz=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      // Line is not split, abort
      gl_Position = vec4(0.);
      return;
    }
  }

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Multiply out width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Pz=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Mz=[0,0,0,255],Iz={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Mz},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class _S extends xn{getShaders(){return super.getShaders({vs:Sz,fs:Pz,modules:[Ti,Ci]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:oi[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}T(_S,"layerName","LineLayer");T(_S,"defaultProps",Iz);const Bz=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  // Find the center of the point and add the current vertex
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply lighting
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Lz=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,yS=[0,0,0,255],vS=[0,0,1],Rz={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:vS},getColor:{type:"accessor",value:yS},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Oz(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class C1 extends xn{getShaders(){return super.getShaders({vs:Bz,fs:Lz,modules:[Ti,u1,Ci]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:vS},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:yS}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:s}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&Oz(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:oi[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}T(C1,"layerName","PointCloudLayer");T(C1,"defaultProps",Rz);const Fz=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Dz=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Y2=[0,0,0,255],kz={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Y2},getLineColor:{type:"accessor",value:Y2},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Lh extends xn{getShaders(){return super.getShaders({vs:Fz,fs:Dz,modules:[Ti,Ci]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:h,lineWidthUnits:g,lineWidthScale:m,lineWidthMinPixels:v,lineWidthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:h,radiusUnits:oi[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:oi[g],lineWidthScale:m,lineWidthMinPixels:v,lineWidthMaxPixels:w}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}T(Lh,"defaultProps",kz);T(Lh,"layerName","ScatterplotLayer");const x1={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function b1(t,e,n={}){return Nz(t,n)!==e?(Uz(t,n),!0):!1}function Nz(t,e={}){return Math.sign(Wf(t,e))}function Wf(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function Uz(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,h=n+(s-1-a)*r;for(let g=0;g<r;++g){const m=t[l+g];t[l+g]=t[h+g],t[h+g]=m}}}function Gz(t,e,n=2,i){const r=e&&e.length,s=r?e[0]*n:t.length;let o=ES(t,0,s,n,!0,i&&i[0]);const a=[];if(!o||o.next===o.prev)return a;let l,h,g,m,v,w,C;if(r&&(o=Wz(t,e,o,n,i)),t.length>80*n){m=h=t[0],v=g=t[1];for(let b=n;b<s;b+=n)w=t[b],C=t[b+1],w<m&&(m=w),C<v&&(v=C),w>h&&(h=w),C>g&&(g=C);l=Math.max(h-m,g-v),l=l!==0?1/l:0}return Rl(o,a,n,m,v,l),a}function ES(t,e,n,i,r,s){let o,a;if(s===void 0&&(s=Wf(t,{start:e,end:n,size:i})),r===s<0)for(o=e;o<n;o+=i)a=K2(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=K2(o,t[o],t[o+1],a);return a&&Rh(a,a.next)&&(Fl(a),a=a.next),a}function vs(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Rh(n,n.next)||Bt(n.prev,n,n.next)===0)){if(Fl(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Rl(t,e,n,i,r,s,o){if(!t)return;!o&&s&&Kz(t,i,r,s);let a=t,l,h;for(;t.prev!==t.next;){if(l=t.prev,h=t.next,s?Vz(t,i,r,s):zz(t)){e.push(l.i/n),e.push(t.i/n),e.push(h.i/n),Fl(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=Hz(vs(t),e,n),Rl(t,e,n,i,r,s,2)):o===2&&jz(t,e,n,i,r,s):Rl(vs(t),e,n,i,r,s,1);break}}}function zz(t){const e=t.prev,n=t,i=t.next;if(Bt(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(oa(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Bt(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Vz(t,e,n,i){const r=t.prev,s=t,o=t.next;if(Bt(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,g=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,m=Ep(a,l,e,n,i),v=Ep(h,g,e,n,i);let w=t.prevZ,C=t.nextZ;for(;w&&w.z>=m&&C&&C.z<=v;){if(w!==t.prev&&w!==t.next&&oa(r.x,r.y,s.x,s.y,o.x,o.y,w.x,w.y)&&Bt(w.prev,w,w.next)>=0||(w=w.prevZ,C!==t.prev&&C!==t.next&&oa(r.x,r.y,s.x,s.y,o.x,o.y,C.x,C.y)&&Bt(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;w&&w.z>=m;){if(w!==t.prev&&w!==t.next&&oa(r.x,r.y,s.x,s.y,o.x,o.y,w.x,w.y)&&Bt(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;C&&C.z<=v;){if(C!==t.prev&&C!==t.next&&oa(r.x,r.y,s.x,s.y,o.x,o.y,C.x,C.y)&&Bt(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function Hz(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Rh(r,s)&&wS(r,i,i.next,s)&&Ol(r,s)&&Ol(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),Fl(i),Fl(i.next),i=t=s),i=i.next}while(i!==t);return vs(i)}function jz(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&$z(o,a)){let l=TS(o,a);o=vs(o,o.next),l=vs(l,l.next),Rl(o,e,n,i,r,s),Rl(l,e,n,i,r,s);return}a=a.next}o=o.next}while(o!==t)}function Wz(t,e,n,i,r){const s=[];let o,a,l,h,g;for(o=0,a=e.length;o<a;o++)l=e[o]*i,h=o<a-1?e[o+1]*i:t.length,g=ES(t,l,h,i,!1,r&&r[o+1]),g===g.next&&(g.steiner=!0),s.push(qz(g));for(s.sort(Qz),o=0;o<s.length;o++)Xz(s[o],n),n=vs(n,n.next);return n}function Qz(t,e){return t.x-e.x}function Xz(t,e){if(e=Jz(t,e),e){const n=TS(e,t);vs(e,e.next),vs(n,n.next)}}function Jz(t,e){let n=e;const i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const v=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(v<=i&&v>s){if(s=v,v===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;const a=o,l=o.x,h=o.y;let g=1/0,m;n=o;do i>=n.x&&n.x>=l&&i!==n.x&&oa(r<h?i:s,r,l,h,r<h?s:i,r,n.x,n.y)&&(m=Math.abs(r-n.y)/(i-n.x),Ol(n,t)&&(m<g||m===g&&(n.x>o.x||n.x===o.x&&Yz(o,n)))&&(o=n,g=m)),n=n.next;while(n!==a);return o}function Yz(t,e){return Bt(t.prev,t,e.prev)<0&&Bt(e.next,t,t.next)<0}function Kz(t,e,n,i){let r=t;do r.z===null&&(r.z=Ep(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Zz(r)}function Zz(t){let e,n,i=1,r,s,o,a,l,h;do{for(s=t,t=null,h=null,r=0;s;){for(r++,a=s,o=0,n=0;n<i&&(o++,a=a.nextZ,!!a);n++);for(l=i;o>0||l>0&&a;)o!==0&&(l===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,l--),h?h.nextZ=e:t=e,e.prevZ=h,h=e;s=a}h.nextZ=null,i*=2}while(r>1);return t}function Ep(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function qz(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function oa(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function $z(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!e9(t,e)&&(Ol(t,e)&&Ol(e,t)&&t9(t,e)&&(Bt(t.prev,t,e.prev)||Bt(t,e.prev,e))||Rh(t,e)&&Bt(t.prev,t,t.next)>0&&Bt(e.prev,e,e.next)>0)}function Bt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Rh(t,e){return t.x===e.x&&t.y===e.y}function wS(t,e,n,i){const r=uu(Bt(t,e,n)),s=uu(Bt(t,e,i)),o=uu(Bt(n,i,t)),a=uu(Bt(n,i,e));return!!(r!==s&&o!==a||r===0&&cu(t,n,e)||s===0&&cu(t,i,e)||o===0&&cu(n,t,i)||a===0&&cu(n,e,i))}function cu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function uu(t){return t>0?1:t<0?-1:0}function e9(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&wS(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ol(t,e){return Bt(t.prev,t,t.next)<0?Bt(t,e,t.next)>=0&&Bt(t,t.prev,e)>=0:Bt(t,e,t.prev)<0||Bt(t,t.next,e)<0}function t9(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function TS(t,e){const n=new wp(t.i,t.x,t.y),i=new wp(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function K2(t,e,n,i){const r=new wp(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Fl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function wp(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ui(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Tp(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Dl(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Cp(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function $u(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function CS(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let h=[];const g=[h],m=Dl(t,0,n,o);let v,w;const C=bS(m,r,s,[]),b=[];Ui(h,m);for(let R=1;R<l;R++){for(v=Dl(t,R,n,o,v),w=$u(v,C);w;){Cp(m,v,w,C,b);const S=$u(b,C);S&&(Cp(m,b,S,C,b),w=S),Ui(h,b),Tp(m,b),i9(C,r,w),i&&h.length>n&&(h=[],g.push(h),Ui(h,m)),w=$u(v,C)}Ui(h,v),Tp(m,v)}return i?g:g[0]}const Z2=0,n9=1;function fu(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function xS(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(n9):null,holes:e||[]}],h=[[],[]];let g=[];for(;l.length;){const{pos:m,types:v,holes:w}=l.shift();r9(m,i,w[0]||m.length,h),g=bS(h[0],r,s,g);const C=$u(h[1],g);if(C){let b=q2(m,v,i,0,w[0]||m.length,g,C);const R={pos:b[0].pos,types:b[0].types,holes:[]},S={pos:b[1].pos,types:b[1].types,holes:[]};l.push(R,S);for(let P=0;P<w.length;P++)b=q2(m,v,i,w[P],w[P+1]||m.length,g,C),b[0]&&(R.holes.push(R.pos.length),R.pos=fu(R.pos,b[0].pos),o&&(R.types=fu(R.types,b[0].types))),b[1]&&(S.holes.push(S.pos.length),S.pos=fu(S.pos,b[1].pos),o&&(S.types=fu(S.types,b[1].types)))}else{const b={positions:m};o&&(b.edgeTypes=v),w.length&&(b.holeIndices=w),a.push(b)}}return a}function q2(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],h=[],g=[],m=[],v=[];let w,C,b;const R=Dl(t,a-1,n,i);let S=Math.sign(o&8?R[1]-s[3]:R[0]-s[2]),P=e&&e[a-1],M=0,F=0;for(let H=0;H<a;H++)w=Dl(t,H,n,i,w),C=Math.sign(o&8?w[1]-s[3]:w[0]-s[2]),b=e&&e[i/n+H],C&&S&&S!==C&&(Cp(R,w,o,s,v),Ui(l,v)&&g.push(P),Ui(h,v)&&m.push(P)),C<=0?(Ui(l,w)&&g.push(b),M-=C):g.length&&(g[g.length-1]=Z2),C>=0?(Ui(h,w)&&m.push(b),F+=C):m.length&&(m[m.length-1]=Z2),Tp(R,w),S=C,P=b;return[M?{pos:l,types:e&&g}:null,F?{pos:h,types:e&&m}:null]}function bS(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function i9(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function r9(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const h=t[l],g=t[l+1];r=h<r?h:r,s=h>s?h:s,o=g<o?g:o,a=g>a?g:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const s9=85.051129;function o9(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);SS(o,n,0,r-i);const a=CS(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)PS(l,n);return a}function a9(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,h=0;for(let m=0;m<=e.length;m++){const v=e[m]||t.length,w=h,C=A9(t,i,l,v);for(let b=C;b<v;b++)o[h++]=t[b];for(let b=l;b<C;b++)o[h++]=t[b];SS(o,i,w,h),l9(o,i,w,h,n==null?void 0:n.maxLatitude),l=v,a[m]=h}a.pop();const g=xS(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const m of g)PS(m.positions,i);return g}function A9(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function l9(t,e,n,i,r=s9){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=Dl(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Ui(t,a),a[1]=Math.sign(a[1])*r,Ui(t,a),a[0]=s,Ui(t,a)}}function SS(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function PS(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}class c9 extends Bn{constructor(e){const{id:n=Wi("column-geometry")}=e,{indices:i,attributes:r}=u9(e);super({...e,id:n,indices:i,attributes:r})}}function u9(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(De.assert(r.length>=i),r=r.flatMap(w=>[w[0],w[1]]),b1(r,x1.COUNTER_CLOCKWISE));const s=n>0,o=i+1,a=s?o*3+1:i,l=Math.PI*2/i,h=new Uint16Array(s?i*3*2:0),g=new Float32Array(a*3),m=new Float32Array(a*3);let v=0;if(s){for(let w=0;w<o;w++){const C=w*l,b=w%i,R=Math.sin(C),S=Math.cos(C);for(let P=0;P<2;P++)g[v+0]=r?r[b*2]:S*e,g[v+1]=r?r[b*2+1]:R*e,g[v+2]=(1/2-P)*n,m[v+0]=r?r[b*2]:S,m[v+1]=r?r[b*2+1]:R,v+=3}g[v+0]=g[v-3],g[v+1]=g[v-2],g[v+2]=g[v-1],v+=3}for(let w=s?0:1;w<o;w++){const C=Math.floor(w/2)*Math.sign(.5-w%2),b=C*l,R=(C+i)%i,S=Math.sin(b),P=Math.cos(b);g[v+0]=r?r[R*2]:P*e,g[v+1]=r?r[R*2+1]:S*e,g[v+2]=n/2,m[v+2]=1,v+=3}if(s){let w=0;for(let C=0;C<i;C++)h[w++]=C*2+0,h[w++]=C*2+2,h[w++]=C*2+0,h[w++]=C*2+1,h[w++]=C*2+1,h[w++]=C*2+3}return{indices:h,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:m}}}}const f9=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;

// Custom uniforms
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;

// Result
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  // rotate primitive position and normal
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));

  // calculate elevation, if 3d not enabled set to 0
  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1
  float elevation = 0.0;
  // calculate stroke offset
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }

  // if alpha == 0.0 or z < 0.0, do not render element
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;

  // project center of column
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Light calculations
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,h9=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Qf=[0,0,0,255],d9={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:Qf},getLineColor:{type:"accessor",value:Qf},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Oh extends xn{getShaders(){const{gl:e}=this.context,n=!Xe(e),i={},r=this.props.flatShading&&Ch(e,pt.GLSL_DERIVATIVES);return r&&(i.FLAT_SHADING=1),super.getShaders({vs:f9,fs:h9,defines:i,transpileToGLSL100:n,modules:[Ti,r?Pb:u1,Ci]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Qf},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Qf},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;if(s){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,n,i){const r=new c9({radius:1,height:i?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o];s+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),r}_getModel(e){return new Cn(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:i,stroked:r}){const s=this.getGeometry(e,n,i||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:l,filled:h,stroked:g,wireframe:m,offset:v,coverage:w,radius:C,angle:b}=this.props,{model:R,fillVertexCount:S,wireframeVertexCount:P,edgeDistance:M}=this.state;R.setUniforms(e).setUniforms({radius:C,angle:b/180*Math.PI,offset:v,extruded:l,stroked:g,coverage:w,elevationScale:a,edgeDistance:M,radiusUnits:oi[o],widthUnits:oi[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s}),l&&m&&(R.setProps({isIndexed:!0}),R.setVertexCount(P).setDrawMode(1).setUniforms({isStroke:!0}).draw()),h&&(R.setProps({isIndexed:!1}),R.setVertexCount(S).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&g&&(R.setProps({isIndexed:!1}),R.setVertexCount(S*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}T(Oh,"layerName","ColumnLayer");T(Oh,"defaultProps",d9);const g9={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class MS extends Oh{getGeometry(e){return new N8}draw({uniforms:e}){const{elevationScale:n,extruded:i,offset:r,coverage:s,cellSize:o,angle:a,radiusUnits:l}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:oi[l],angle:a,offset:r,extruded:i,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}T(MS,"layerName","GridCellLayer");T(MS,"defaultProps",g9);function p9(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?CS(r,{size:e,gridResolution:n}):i?o9(r,{size:e}):r}const m9=1,_9=2,m0=4;class y9 extends fS{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?p9(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if($2(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&$2(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=m0,i[s+o-2]=m0):(i[s]+=m9,i[s+o-2]+=_9),i[s+o-1]=m0}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function $2(t){return Array.isArray(t[0])}const v9=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,E9=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,IS=[0,0,0,255],w9={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:IS},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},_0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Ao extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return super.getShaders({vs:v9,fs:E9,modules:[Ti,Ci]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:_0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:_0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:_0,defaultValue:IS},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new y9({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:h}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:oi[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:h}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}T(Ao,"defaultProps",w9);T(Ao,"layerName","PathLayer");var S1={exports:{}};S1.exports=Fh;S1.exports.default=Fh;function Fh(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=BS(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,h,g,m,v,w;if(i&&(s=S9(t,e,s,n)),t.length>80*n){a=h=t[0],l=g=t[1];for(var C=n;C<r;C+=n)m=t[C],v=t[C+1],m<a&&(a=m),v<l&&(l=v),m>h&&(h=m),v>g&&(g=v);w=Math.max(h-a,g-l),w=w!==0?32767/w:0}return kl(s,o,n,a,l,w,0),o}function BS(t,e,n,i,r){var s,o;if(r===Sp(t,e,n,i)>0)for(s=e;s<n;s+=i)o=eE(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=eE(s,t[s],t[s+1],o);return o&&Dh(o,o.next)&&(Ul(o),o=o.next),o}function lo(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Dh(n,n.next)||Lt(n.prev,n,n.next)===0)){if(Ul(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function kl(t,e,n,i,r,s,o){if(!!t){!o&&s&&L9(t,i,r,s);for(var a=t,l,h;t.prev!==t.next;){if(l=t.prev,h=t.next,s?C9(t,i,r,s):T9(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),Ul(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=x9(lo(t),e,n),kl(t,e,n,i,r,s,2)):o===2&&b9(t,e,n,i,r,s):kl(lo(t),e,n,i,r,s,1);break}}}}function T9(t){var e=t.prev,n=t,i=t.next;if(Lt(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,h=i.y,g=r<s?r<o?r:o:s<o?s:o,m=a<l?a<h?a:h:l<h?l:h,v=r>s?r>o?r:o:s>o?s:o,w=a>l?a>h?a:h:l>h?l:h,C=i.next;C!==e;){if(C.x>=g&&C.x<=v&&C.y>=m&&C.y<=w&&aa(r,a,s,l,o,h,C.x,C.y)&&Lt(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function C9(t,e,n,i){var r=t.prev,s=t,o=t.next;if(Lt(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,h=o.x,g=r.y,m=s.y,v=o.y,w=a<l?a<h?a:h:l<h?l:h,C=g<m?g<v?g:v:m<v?m:v,b=a>l?a>h?a:h:l>h?l:h,R=g>m?g>v?g:v:m>v?m:v,S=xp(w,C,e,n,i),P=xp(b,R,e,n,i),M=t.prevZ,F=t.nextZ;M&&M.z>=S&&F&&F.z<=P;){if(M.x>=w&&M.x<=b&&M.y>=C&&M.y<=R&&M!==r&&M!==o&&aa(a,g,l,m,h,v,M.x,M.y)&&Lt(M.prev,M,M.next)>=0||(M=M.prevZ,F.x>=w&&F.x<=b&&F.y>=C&&F.y<=R&&F!==r&&F!==o&&aa(a,g,l,m,h,v,F.x,F.y)&&Lt(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;M&&M.z>=S;){if(M.x>=w&&M.x<=b&&M.y>=C&&M.y<=R&&M!==r&&M!==o&&aa(a,g,l,m,h,v,M.x,M.y)&&Lt(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;F&&F.z<=P;){if(F.x>=w&&F.x<=b&&F.y>=C&&F.y<=R&&F!==r&&F!==o&&aa(a,g,l,m,h,v,F.x,F.y)&&Lt(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function x9(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Dh(r,s)&&LS(r,i,i.next,s)&&Nl(r,s)&&Nl(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Ul(i),Ul(i.next),i=t=s),i=i.next}while(i!==t);return lo(i)}function b9(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&F9(o,a)){var l=RS(o,a);o=lo(o,o.next),l=lo(l,l.next),kl(o,e,n,i,r,s,0),kl(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function S9(t,e,n,i){var r=[],s,o,a,l,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,h=BS(t,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(O9(h));for(r.sort(P9),s=0;s<r.length;s++)n=M9(r[s],n);return n}function P9(t,e){return t.x-e.x}function M9(t,e){var n=I9(t,e);if(!n)return e;var i=RS(n,t);return lo(i,i.next),lo(n,n.next)}function I9(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,h=o.x,g=o.y,m=1/0,v;n=o;do i>=n.x&&n.x>=h&&i!==n.x&&aa(r<g?i:s,r,h,g,r<g?s:i,r,n.x,n.y)&&(v=Math.abs(r-n.y)/(i-n.x),Nl(n,t)&&(v<m||v===m&&(n.x>o.x||n.x===o.x&&B9(o,n)))&&(o=n,m=v)),n=n.next;while(n!==l);return o}function B9(t,e){return Lt(t.prev,t,e.prev)<0&&Lt(e.next,t,t.next)<0}function L9(t,e,n,i){var r=t;do r.z===0&&(r.z=xp(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,R9(r)}function R9(t){var e,n,i,r,s,o,a,l,h=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<h&&(a++,i=i.nextZ,!!i);e++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(o>1);return t}function xp(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function O9(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function aa(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function F9(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!D9(t,e)&&(Nl(t,e)&&Nl(e,t)&&k9(t,e)&&(Lt(t.prev,t,e.prev)||Lt(t,e.prev,e))||Dh(t,e)&&Lt(t.prev,t,t.next)>0&&Lt(e.prev,e,e.next)>0)}function Lt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Dh(t,e){return t.x===e.x&&t.y===e.y}function LS(t,e,n,i){var r=du(Lt(t,e,n)),s=du(Lt(t,e,i)),o=du(Lt(n,i,t)),a=du(Lt(n,i,e));return!!(r!==s&&o!==a||r===0&&hu(t,n,e)||s===0&&hu(t,i,e)||o===0&&hu(n,t,i)||a===0&&hu(n,e,i))}function hu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function du(t){return t>0?1:t<0?-1:0}function D9(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&LS(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Nl(t,e){return Lt(t.prev,t,t.next)<0?Lt(t,e,t.next)>=0&&Lt(t,t.prev,e)>=0:Lt(t,e,t.prev)<0||Lt(t,t.next,e)<0}function k9(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function RS(t,e){var n=new bp(t.i,t.x,t.y),i=new bp(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function eE(t,e,n,i){var r=new bp(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ul(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bp(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Fh.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Sp(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*n,g=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Sp(t,h,g,n))}var m=0;for(a=0;a<i.length;a+=3){var v=i[a]*n,w=i[a+1]*n,C=i[a+2]*n;m+=Math.abs((t[v]-t[C])*(t[w+1]-t[v+1])-(t[v]-t[w])*(t[C+1]-t[v+1]))}return o===0&&m===0?0:Math.abs((m-o)/o)};function Sp(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}Fh.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};const gu=x1.CLOCKWISE,tE=x1.COUNTER_CLOCKWISE,rs={isClosed:!0};function N9(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function VA(t){return"positions"in t?t.positions:t}function ef(t){return"holeIndices"in t?t.holeIndices:null}function U9(t){return Array.isArray(t[0])}function G9(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function z9(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function V9(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function nE(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!z9(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return rs.start=e,rs.end=s,rs.size=i,b1(t,r,rs),s}function iE(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let h=0;h<a;h++)t[l++]=n[r+h];if(!V9(n,i,r,s))for(let h=0;h<i;h++)t[l++]=n[r+h];return rs.start=e,rs.end=l,rs.size=i,b1(t,o,rs),l}function OS(t,e){N9(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=iE(n,o,r,e,s[a-1],s[a],a===0?gu:tE),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!U9(t))return iE(n,0,t,e,0,n.length,gu),n;if(!G9(t)){let r=0;for(const[s,o]of t.entries())r=nE(n,r,o,e,s===0?gu:tE),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return nE(n,0,t,e,gu),n}function H9(t,e,n){let i=ef(t);i&&(i=i.map(s=>s/e));let r=VA(t);if(n){const s=r.length;r=r.slice();const o=[];for(let a=0;a<s;a+=e){o[0]=r[a],o[1]=r[a+1];const l=n(o);r[a]=l[0],r[a+1]=l[1]}}return S1.exports(r,i,e)}class j9 extends fS{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=OS(e,this.positionSize);return this.opts.resolution?xS(VA(n),ef(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?a9(VA(n),ef(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(rE(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return VA(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&rE(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let h=r;const g=H9(e,this.positionSize,this.opts.preproject);l=a.allocate(l,r+g.length,{copy:!0});for(let m=0;m<g.length;m++)l[h++]=g[m]+i;o[n+1]=r+g.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=VA(e);for(let a=n,l=0;l<i;a++,l++){const h=o[l*s],g=o[l*s+1],m=s>2?o[l*s+2]:0;r[a*3]=h,r[a*3+1]=g,r[a*3+2]=m}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&ef(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function rE(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const FS=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,W9=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(FS,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),Q9=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(FS,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),X9=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Xf=[0,0,0,255],J9={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Xf},getLineColor:{type:"accessor",value:Xf},material:!0},pu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class kh extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?W9:Q9,fs:X9,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ti,u1,Ci]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===Ge.DEFAULT&&(i=Ge.LNGLAT),this.setState({numInstances:0,polygonTesselator:new j9({preproject:i===Ge.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||Zm(e,pt.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:pu,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:pu,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:pu,accessor:"getFillColor",defaultValue:Xf,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:pu,accessor:"getLineColor",defaultValue:Xf,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,{index:a,target:l})=>this.encodePickingColor(o&&o.__source?o.__source.index:a,l),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,h={...e,extruded:Boolean(n),elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(h),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(h).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new Cn(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new Cn(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Bn({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}T(kh,"defaultProps",J9);T(kh,"layerName","SolidPolygonLayer");function DS({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let v=0;v<o;v++){const w=e(t[v]);if(a>v&&w>=r&&(a=v),w>=s){l=v;break}}let h=a;const m=l-a!==i.length?t.slice(l):void 0;for(let v=0;v<i.length;v++)t[h++]=i[v];if(m){for(let v=0;v<m.length;v++)t[h++]=m[v];t.length=h}return{startRow:a,endRow:a+i.length}}const kS=[0,0,0,255],Y9=[0,0,0,255],K9={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:Y9},getLineColor:{type:"accessor",value:kS},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Qa extends Or{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&De.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),r=e.dataChanged.map(s=>DS({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:r})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a=r==="XY"?2:3,{startRow:l,endRow:h}=e,{iterable:g,objectInfo:m}=xs(n,l,h);for(const v of g){m.index++;let w=i(v,m);s&&(w=OS(w,a));const{holeIndices:C}=w,b=w.positions||w;if(C)for(let R=0;R<=C.length;R++){const S=b.slice(C[R-1]||0,C[R]||b.length);o.push(this.getSubLayerRow({path:S},v,m.index))}else o.push(this.getSubLayerRow({path:b},v,m.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:h,transitions:g,positionFormat:m}=this.props,{lineWidthUnits:v,lineWidthScale:w,lineWidthMinPixels:C,lineWidthMaxPixels:b,lineJointRounded:R,lineMiterLimit:S,lineDashJustified:P}=this.props,{getFillColor:M,getLineColor:F,getLineWidth:H,getLineDashArray:j,getElevation:K,getPolygon:ee,updateTriggers:X,material:U}=this.props,{paths:D,pathsDiff:ae}=this.state,re=this.getSubLayerClass("fill",kh),te=this.getSubLayerClass("stroke",Ao),oe=this.shouldRenderSubLayer("fill",D)&&new re({_dataDiff:n,extruded:s,elevationScale:h,filled:r,wireframe:o,_normalize:a,_windingOrder:l,getElevation:K,getFillColor:M,getLineColor:s&&o?F:kS,material:U,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:X&&{getPolygon:X.getPolygon,getElevation:X.getElevation,getFillColor:X.getFillColor,lineColors:s&&o,getLineColor:X.getLineColor}}),{data:e,positionFormat:m,getPolygon:ee}),ve=!s&&i&&this.shouldRenderSubLayer("stroke",D)&&new te({_dataDiff:ae&&(()=>ae),widthUnits:v,widthScale:w,widthMinPixels:C,widthMaxPixels:b,jointRounded:R,miterLimit:S,dashJustified:P,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(F),getWidth:this.getSubLayerAccessor(H),getDashArray:this.getSubLayerAccessor(j)},this.getSubLayerProps({id:"stroke",updateTriggers:X&&{getWidth:X.getLineWidth,getColor:X.getLineColor,getDashArray:X.getLineDashArray}}),{data:D,positionFormat:m,getPath:ce=>ce.path});return[!s&&oe,ve,s&&oe]}}T(Qa,"layerName","PolygonLayer");T(Qa,"defaultProps",K9);function Z9(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?q9(t,i,n):null}function q9(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function $9(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const eV=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,sE=192/256,oE=[],tV={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class P1 extends Bh{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:eV}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&De.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:sE,outlineBuffer:r?Math.max(i,sE*(1-r)):-1,gamma:i,sdf:Boolean(n),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):oE}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):oE}}T(P1,"defaultProps",tV);T(P1,"layerName","MultiIconLayer");var M1={exports:{}};M1.exports=oc;M1.exports.default=oc;var Ea=1e20;function oc(t,e,n,i,r,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,a=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function nV(t,e,n,i,r,s,o){s.fill(Ea,0,e*n),o.fill(0,0,e*n);for(var a=(e-i)/2,l=0;l<r;l++)for(var h=0;h<i;h++){var g=(l+a)*e+h+a,m=t.data[4*(l*i+h)+3]/255;if(m===1)s[g]=0,o[g]=Ea;else if(m===0)s[g]=Ea,o[g]=0;else{var v=Math.max(0,.5-m),w=Math.max(0,m-.5);s[g]=v*v,o[g]=w*w}}}function iV(t,e,n,i,r,s,o){for(var a=0;a<e*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/s+o))}}oc.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,r=2*this.buffer,s,o,a,l,h,g,m,v;e&&this.useMetrics?(h=Math.floor(n.actualBoundingBoxAscent),v=this.buffer+Math.ceil(n.actualBoundingBoxAscent),g=this.buffer,m=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),l=Math.min(this.size-g,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+r,a=l+r,this.ctx.textBaseline="alphabetic"):(s=o=this.size,a=l=this.size,h=19*this.fontSize/24,g=m=0,v=this.middle,this.ctx.textBaseline="middle");var w;o&&l&&(this.ctx.clearRect(m,g,o,l),this.ctx.fillText(t,this.buffer,v),w=this.ctx.getImageData(m,g,o,l));var C=new Uint8ClampedArray(s*a);return nV(w,s,a,o,l,this.gridOuter,this.gridInner),aE(this.gridOuter,s,a,this.f,this.v,this.z),aE(this.gridInner,s,a,this.f,this.v,this.z),iV(C,s,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:C,metrics:{width:o,height:l,sdfWidth:s,sdfHeight:a,top:h,left:0,advance:i}}};oc.prototype.draw=function(t){return this._draw(t,!1).data};oc.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function aE(t,e,n,i,r,s){for(var o=0;o<e;o++)AE(t,o,e,n,i,r,s);for(var a=0;a<n;a++)AE(t,a*e,1,e,i,r,s)}function AE(t,e,n,i,r,s,o){var a,l,h,g;for(s[0]=0,o[0]=-Ea,o[1]=Ea,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,l=0,h=0;a<i;a++){do g=s[l],h=(r[a]-r[g]+a*a-g*g)/(a-g)/2;while(h<=o[l]&&--l>-1);l++,s[l]=a,o[l]=h,o[l+1]=Ea}for(a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;g=s[l],t[e+a*n]=r[g]+(a-g)*(a-g)}}const rV=32,sV=[];function oV(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function aV({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,h=o;for(const m of t)if(!s[m]){const v=e(m);h+v+i*2>r&&(h=0,l++),s[m]={x:h+i,y:a+l*(n+i*2)+i,width:v,height:n},h+=v+i*2}const g=n+i*2;return{mapping:s,xOffset:h,yOffset:a+l*g,canvasHeight:oV(a+(l+1)*g)}}function NS(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.width)||0}return r}function US(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const h=NS(t,l,l+1,r);a+h>i&&(o<l&&s.push(l),o=l,a=0),a+=h}return a}function AV(t,e,n,i,r,s){let o=e,a=e,l=e,h=0;for(let g=e;g<n;g++)if((t[g]===" "||t[g+1]===" "||g+1===n)&&(l=g+1),l>a){let m=NS(t,a,l,r);h+m>i&&(o<a&&(s.push(a),o=a,h=0),m>i&&(m=US(t,a,l,i,r,s),o=s[s.length-1])),a=l,h+=m}return h}function lV(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?US(t,r,s,n,i,o):AV(t,r,s,n,i,o),o}function cV(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const h=t[l],g=i[h];g?(a||(a=g.height),r[l]=o+g.width/2,o+=g.width):(De.warn("Missing character: ".concat(h," (").concat(h.codePointAt(0),")"))(),r[l]=o,o+=rV)}s[0]=o,s[1]=a}function lE(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),h=new Array(o),g=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,m=[0,0],v=[0,0];let w=0,C=0,b=0;for(let R=0;R<=o;R++){const S=s[R];if((S===`
`||R===o)&&(b=R),b>C){const P=g?lV(s,n,i,r,C,b):sV;for(let M=0;M<=P.length;M++){const F=M===0?C:P[M-1],H=M<P.length?P[M]:b;cV(s,F,H,r,a,v);for(let j=F;j<H;j++)l[j]=w+v[1]/2,h[j]=v[0];w=w+v[1]*e,m[0]=Math.max(m[0],v[0])}C=b}S===`
`&&(a[C]=0,l[C]=0,h[C]=0,C++)}return m[1]=w,{x:a,y:l,rowWidth:h,size:m}}function uV({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,h=r[e]||Math.ceil((t.length-l)/a),g=s&&new Set,m=new Array(e);let v=t;if(a>1||l>0){const w=t.constructor;v=new w(h);for(let C=0;C<h;C++)v[C]=t[C*a+l]}for(let w=0;w<e;w++){const C=r[w],b=r[w+1]||h,R=v.subarray(C,b);m[w]=String.fromCodePoint.apply(null,R),g&&R.forEach(g.add,g)}if(g)for(const w of g)s.add(String.fromCodePoint(w));return{texts:m,characterCount:h}}class GS{constructor(e=5){T(this,"limit",void 0),T(this,"_cache",{}),T(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function fV(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const ol={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:fV(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},cE=1024,hV=.9,uE=1.2,zS=3;let Jf=new GS(zS);function dV(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Jf.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function gV(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function fE(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function pV(t){De.assert(Number.isFinite(t)&&t>=zS,"Invalid cache limit"),Jf=new GS(t)}class mV{constructor(){T(this,"props",{...ol}),T(this,"_key",void 0),T(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return uE}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const i=dV(this._key,this.props.characterSet),r=Jf.get(this._key);if(r&&i.size===0){this._key!==n&&(this._atlas=r);return}const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,Jf.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:r,fontWeight:s,fontSize:o,buffer:a,sdf:l,radius:h,cutoff:g}=this.props;let m=i&&i.data;m||(m=document.createElement("canvas"),m.width=cE);const v=m.getContext("2d");fE(v,r,o,s);const{mapping:w,canvasHeight:C,xOffset:b,yOffset:R}=aV({getFontWidth:S=>v.measureText(S).width,fontHeight:o*uE,buffer:a,characterSet:n,maxCanvasWidth:cE,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(m.height!==C){const S=v.getImageData(0,0,m.width,m.height);m.height=C,v.putImageData(S,0,0)}if(fE(v,r,o,s),l){const S=new M1.exports(o,a,h,g,r,s),P=v.getImageData(0,0,S.size,S.size);for(const M of n)gV(S.draw(M),P),v.putImageData(P,w[M].x-a,w[M].y+a)}else for(const S of n)v.fillText(S,w[S].x,w[S].y+o*hV);return{xOffset:b,yOffset:R,mapping:w,data:m,width:m.width,height:m.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}const _V=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,yV=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,vV={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class I1 extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){return super.getShaders({vs:_V,fs:yV,modules:[Ti,Ci]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:l,sizeUnits:oi[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Cn(e,{...this.getShaders(),id:this.props.id,geometry:new Bn({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}T(I1,"defaultProps",vV);T(I1,"layerName","TextBackgroundLayer");const hE={start:1,middle:0,end:-1},dE={top:1,center:0,bottom:-1},y0=[0,0,0,255],EV=1,wV={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:y0},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:ol.characterSet},fontFamily:ol.fontFamily,fontWeight:ol.fontWeight,lineHeight:EV,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:y0},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:y0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class B1 extends Or{constructor(...e){super(...e),T(this,"state",void 0),T(this,"getBoundingRect",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:h,getAlignmentBaseline:g}=this.props,m=s(n,i)||"",{size:[v,w]}=lE(m,l,o,a,r),C=hE[typeof h=="function"?h(n,i):h],b=dE[typeof g=="function"?g(n,i):g];return[(C-1)*v/2,(b-1)*w/2,v,w]}),T(this,"getIconOffsets",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:h,getAlignmentBaseline:g}=this.props,m=s(n,i)||"",{x:v,y:w,rowWidth:C,size:[b,R]}=lE(m,l,o,a,r),S=hE[typeof h=="function"?h(n,i):h],P=dE[typeof g=="function"?g(n,i):g],M=v.length,F=new Array(M*2);let H=0;for(let j=0;j<M;j++){const K=(1-S)*(b-C[j])/2;F[H++]=(S-1)*b/2+K+v[j],F[H++]=(P-1)*R/2+w[j]}return F})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new mV}}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:h,characterCount:g}=uV({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=g,s=(m,{index:v})=>h[v]}else{const{iterable:h,objectInfo:g}=xs(n);o=[0],a=0;for(const m of h){g.index++;const v=Array.from(s(m,g)||"");l&&v.forEach(l.add,l),a+=v.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:h,getPosition:g,getColor:m,getSize:v,getAngle:w,getPixelOffset:C,getBackgroundColor:b,getBorderColor:R,getBorderWidth:S,backgroundPadding:P,background:M,billboard:F,fontSettings:H,outlineWidth:j,outlineColor:K,sizeScale:ee,sizeUnits:X,sizeMinPixels:U,sizeMaxPixels:D,transitions:ae,updateTriggers:re}=this.props,te=this.getSubLayerClass("characters",P1),oe=this.getSubLayerClass("background",I1);return[M&&new oe({getFillColor:b,getLineColor:R,getLineWidth:S,padding:P,getPosition:g,getSize:v,getAngle:w,getPixelOffset:C,billboard:F,sizeScale:ee/this.state.fontAtlasManager.props.fontSize,sizeUnits:X,sizeMinPixels:U,sizeMaxPixels:D,transitions:ae&&{getPosition:ae.getPosition,getAngle:ae.getAngle,getSize:ae.getSize,getFillColor:ae.getBackgroundColor,getLineColor:ae.getBorderColor,getLineWidth:ae.getBorderWidth,getPixelOffset:ae.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:re.getPosition,getAngle:re.getAngle,getSize:re.getSize,getFillColor:re.getBackgroundColor,getLineColor:re.getBorderColor,getLineWidth:re.getBorderWidth,getPixelOffset:re.getPixelOffset,getBoundingRect:{getText:re.getText,getTextAnchor:re.getTextAnchor,getAlignmentBaseline:re.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new te({sdf:H.sdf,smoothing:Number.isFinite(H.smoothing)?H.smoothing:ol.smoothing,outlineWidth:j,outlineColor:K,iconAtlas:s,iconMapping:o,getPosition:g,getColor:m,getSize:v,getAngle:w,getPixelOffset:C,billboard:F,sizeScale:ee*r,sizeUnits:X,sizeMinPixels:U*r,sizeMaxPixels:D*r,transitions:ae&&{getPosition:ae.getPosition,getAngle:ae.getAngle,getColor:ae.getColor,getSize:ae.getSize,getPixelOffset:ae.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:re.getText,getPosition:re.getPosition,getAngle:re.getAngle,getColor:re.getColor,getSize:re.getSize,getPixelOffset:re.getPixelOffset,getIconOffsets:{getText:re.getText,getTextAnchor:re.getTextAnchor,getAlignmentBaseline:re.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:h,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){pV(e)}}T(B1,"defaultProps",wV);T(B1,"layerName","TextLayer");const tf={circle:{type:Lh,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Bh,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:B1,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},nf={type:Ao,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Pp={type:kh,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function SA({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function v0(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function TV(t){if(Array.isArray(t))return t;switch(De.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return De.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function gE(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o];De.assert(a&&a.geometry,"GeoJSON does not have geometry");const{geometry:l}=a;if(l.type==="GeometryCollection"){De.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:h}=l;for(let g=0;g<h.length;g++){const m=h[g];pE(m,i,e,a,o)}}else pE(l,i,e,a,o)}return i}function pE(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:h,polygonOutlineFeatures:g}=e;if(!xV(s,o)){De.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(m=>{a.push(n({geometry:{type:"Point",coordinates:m}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(m=>{l.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"Polygon":h.push(n({geometry:t},i,r)),o.forEach(m=>{g.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"MultiPolygon":o.forEach(m=>{h.push(n({geometry:{type:"Polygon",coordinates:m}},i,r)),m.forEach(v=>{g.push(n({geometry:{type:"LineString",coordinates:v}},i,r))})});break}}const CV={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function xV(t,e){let n=CV[t];for(De.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function VS(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function mu(t){return t.geometry.coordinates}function bV(t,e){const n=VS(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=mu,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=mu,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=mu,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=mu,n}function SV(t,e){const n=VS(),{points:i,lines:r,polygons:s}=t,o=$9(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const PV=["points","linestrings","polygons"],MV={...SA(tf.circle),...SA(tf.icon),...SA(tf.text),...SA(nf),...SA(Pp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ac extends Or{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=SV(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=TV(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const h in l)s[h]=l[h].slice(),o[h]=[];for(const h of n.dataChanged){const g=gE(i,r,h);for(const m in l)o[m].push(DS({data:s[m],getIndex:v=>v.__source.index,dataRange:h,replace:g[m]}))}}else s=gE(i,r);const a=bV(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=PV.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Pp.type);if(s){const o=v0(this,Pp.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,nf.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,nf.type);if(o||a){const l=v0(this,nf.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),h=tf[a],g=h&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,h.type);if(g){const m=v0(this,h.props);let v=n.points;if(a==="text"&&i){const{instancePickingColors:w,...C}=v.data.attributes;v={...v,data:{...v.data,attributes:C}}}o.push(new g(m,this.getSubLayerProps({id:l,updateTriggers:m.updateTriggers,highlightedObjectIndex:r}),v))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=Z9(s,o);return e(a,r)}}}T(ac,"layerName","GeoJsonLayer");T(ac,"defaultProps",MV);const IV={getHeight:{type:"accessor",value:0},greatCircle:!0};class HS extends T1{}T(HS,"layerName","GreatCircleLayer");T(HS,"defaultProps",IV);const BV={...Qa.defaultProps};class Xa extends Or{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:n,wireframe:i,filled:r,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:h,lineJointRounded:g,lineMiterLimit:m,lineDashJustified:v,getElevation:w,getFillColor:C,getLineColor:b,getLineWidth:R}=this.props,{updateTriggers:S,material:P,transitions:M}=this.props,F=this.getSubLayerClass("cell",Qa);return new F({filled:r,wireframe:i,extruded:n,elevationScale:e,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:h,lineJointRounded:g,lineMiterLimit:m,lineDashJustified:v,material:P,transitions:M,getElevation:w,getFillColor:C,getLineColor:b,getLineWidth:R},this.getSubLayerProps({id:"cell",updateTriggers:S&&{getElevation:S.getElevation,getFillColor:S.getFillColor,getLineColor:S.getLineColor,getLineWidth:S.getLineWidth}}),this.indexToBounds())}}T(Xa,"layerName","GeoCellLayer");T(Xa,"defaultProps",BV);function LV(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jS={exports:{}};(function(t){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,n){typeof LV=="function"&&!0&&t&&t.exports?t.exports=n():(e.dcodeIO=e.dcodeIO||{}).Long=n()})(Jw,function(){function e(U,D,ae){this.low=U|0,this.high=D|0,this.unsigned=!!ae}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function n(U){return(U&&U.__isLong__)===!0}e.isLong=n;var i={},r={};function s(U,D){var ae,re,te;return D?(U>>>=0,(te=0<=U&&U<256)&&(re=r[U],re)?re:(ae=a(U,(U|0)<0?-1:0,!0),te&&(r[U]=ae),ae)):(U|=0,(te=-128<=U&&U<128)&&(re=i[U],re)?re:(ae=a(U,U<0?-1:0,!1),te&&(i[U]=ae),ae))}e.fromInt=s;function o(U,D){if(isNaN(U)||!isFinite(U))return D?P:S;if(D){if(U<0)return P;if(U>=C)return K}else{if(U<=-b)return ee;if(U+1>=b)return j}return U<0?o(-U,D).neg():a(U%w|0,U/w|0,D)}e.fromNumber=o;function a(U,D,ae){return new e(U,D,ae)}e.fromBits=a;var l=Math.pow;function h(U,D,ae){if(U.length===0)throw Error("empty string");if(U==="NaN"||U==="Infinity"||U==="+Infinity"||U==="-Infinity")return S;if(typeof D=="number"?(ae=D,D=!1):D=!!D,ae=ae||10,ae<2||36<ae)throw RangeError("radix");var re;if((re=U.indexOf("-"))>0)throw Error("interior hyphen");if(re===0)return h(U.substring(1),D,ae).neg();for(var te=o(l(ae,8)),oe=S,ve=0;ve<U.length;ve+=8){var ce=Math.min(8,U.length-ve),ne=parseInt(U.substring(ve,ve+ce),ae);if(ce<8){var le=o(l(ae,ce));oe=oe.mul(le).add(o(ne))}else oe=oe.mul(te),oe=oe.add(o(ne))}return oe.unsigned=D,oe}e.fromString=h;function g(U){return U instanceof e?U:typeof U=="number"?o(U):typeof U=="string"?h(U):a(U.low,U.high,U.unsigned)}e.fromValue=g;var m=1<<16,v=1<<24,w=m*m,C=w*w,b=C/2,R=s(v),S=s(0);e.ZERO=S;var P=s(0,!0);e.UZERO=P;var M=s(1);e.ONE=M;var F=s(1,!0);e.UONE=F;var H=s(-1);e.NEG_ONE=H;var j=a(-1,2147483647,!1);e.MAX_VALUE=j;var K=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=K;var ee=a(0,-2147483648,!1);e.MIN_VALUE=ee;var X=e.prototype;return X.toInt=function(){return this.unsigned?this.low>>>0:this.low},X.toNumber=function(){return this.unsigned?(this.high>>>0)*w+(this.low>>>0):this.high*w+(this.low>>>0)},X.toString=function(D){if(D=D||10,D<2||36<D)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ee)){var ae=o(D),re=this.div(ae),te=re.mul(ae).sub(this);return re.toString(D)+te.toInt().toString(D)}else return"-"+this.neg().toString(D);for(var oe=o(l(D,6),this.unsigned),ve=this,ce="";;){var ne=ve.div(oe),le=ve.sub(ne.mul(oe)).toInt()>>>0,he=le.toString(D);if(ve=ne,ve.isZero())return he+ce;for(;he.length<6;)he="0"+he;ce=""+he+ce}},X.getHighBits=function(){return this.high},X.getHighBitsUnsigned=function(){return this.high>>>0},X.getLowBits=function(){return this.low},X.getLowBitsUnsigned=function(){return this.low>>>0},X.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ee)?64:this.neg().getNumBitsAbs();for(var D=this.high!=0?this.high:this.low,ae=31;ae>0&&(D&1<<ae)==0;ae--);return this.high!=0?ae+33:ae+1},X.isZero=function(){return this.high===0&&this.low===0},X.isNegative=function(){return!this.unsigned&&this.high<0},X.isPositive=function(){return this.unsigned||this.high>=0},X.isOdd=function(){return(this.low&1)===1},X.isEven=function(){return(this.low&1)===0},X.equals=function(D){return n(D)||(D=g(D)),this.unsigned!==D.unsigned&&this.high>>>31===1&&D.high>>>31===1?!1:this.high===D.high&&this.low===D.low},X.eq=X.equals,X.notEquals=function(D){return!this.eq(D)},X.neq=X.notEquals,X.lessThan=function(D){return this.comp(D)<0},X.lt=X.lessThan,X.lessThanOrEqual=function(D){return this.comp(D)<=0},X.lte=X.lessThanOrEqual,X.greaterThan=function(D){return this.comp(D)>0},X.gt=X.greaterThan,X.greaterThanOrEqual=function(D){return this.comp(D)>=0},X.gte=X.greaterThanOrEqual,X.compare=function(D){if(n(D)||(D=g(D)),this.eq(D))return 0;var ae=this.isNegative(),re=D.isNegative();return ae&&!re?-1:!ae&&re?1:this.unsigned?D.high>>>0>this.high>>>0||D.high===this.high&&D.low>>>0>this.low>>>0?-1:1:this.sub(D).isNegative()?-1:1},X.comp=X.compare,X.negate=function(){return!this.unsigned&&this.eq(ee)?ee:this.not().add(M)},X.neg=X.negate,X.add=function(D){n(D)||(D=g(D));var ae=this.high>>>16,re=this.high&65535,te=this.low>>>16,oe=this.low&65535,ve=D.high>>>16,ce=D.high&65535,ne=D.low>>>16,le=D.low&65535,he=0,xe=0,Ie=0,Ze=0;return Ze+=oe+le,Ie+=Ze>>>16,Ze&=65535,Ie+=te+ne,xe+=Ie>>>16,Ie&=65535,xe+=re+ce,he+=xe>>>16,xe&=65535,he+=ae+ve,he&=65535,a(Ie<<16|Ze,he<<16|xe,this.unsigned)},X.subtract=function(D){return n(D)||(D=g(D)),this.add(D.neg())},X.sub=X.subtract,X.multiply=function(D){if(this.isZero()||(n(D)||(D=g(D)),D.isZero()))return S;if(this.eq(ee))return D.isOdd()?ee:S;if(D.eq(ee))return this.isOdd()?ee:S;if(this.isNegative())return D.isNegative()?this.neg().mul(D.neg()):this.neg().mul(D).neg();if(D.isNegative())return this.mul(D.neg()).neg();if(this.lt(R)&&D.lt(R))return o(this.toNumber()*D.toNumber(),this.unsigned);var ae=this.high>>>16,re=this.high&65535,te=this.low>>>16,oe=this.low&65535,ve=D.high>>>16,ce=D.high&65535,ne=D.low>>>16,le=D.low&65535,he=0,xe=0,Ie=0,Ze=0;return Ze+=oe*le,Ie+=Ze>>>16,Ze&=65535,Ie+=te*le,xe+=Ie>>>16,Ie&=65535,Ie+=oe*ne,xe+=Ie>>>16,Ie&=65535,xe+=re*le,he+=xe>>>16,xe&=65535,xe+=te*ne,he+=xe>>>16,xe&=65535,xe+=oe*ce,he+=xe>>>16,xe&=65535,he+=ae*le+re*ne+te*ce+oe*ve,he&=65535,a(Ie<<16|Ze,he<<16|xe,this.unsigned)},X.mul=X.multiply,X.divide=function(D){if(n(D)||(D=g(D)),D.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?P:S;var ae,re,te;if(this.unsigned){if(D.unsigned||(D=D.toUnsigned()),D.gt(this))return P;if(D.gt(this.shru(1)))return F;te=P}else{if(this.eq(ee)){if(D.eq(M)||D.eq(H))return ee;if(D.eq(ee))return M;var oe=this.shr(1);return ae=oe.div(D).shl(1),ae.eq(S)?D.isNegative()?M:H:(re=this.sub(D.mul(ae)),te=ae.add(re.div(D)),te)}else if(D.eq(ee))return this.unsigned?P:S;if(this.isNegative())return D.isNegative()?this.neg().div(D.neg()):this.neg().div(D).neg();if(D.isNegative())return this.div(D.neg()).neg();te=S}for(re=this;re.gte(D);){ae=Math.max(1,Math.floor(re.toNumber()/D.toNumber()));for(var ve=Math.ceil(Math.log(ae)/Math.LN2),ce=ve<=48?1:l(2,ve-48),ne=o(ae),le=ne.mul(D);le.isNegative()||le.gt(re);)ae-=ce,ne=o(ae,this.unsigned),le=ne.mul(D);ne.isZero()&&(ne=M),te=te.add(ne),re=re.sub(le)}return te},X.div=X.divide,X.modulo=function(D){return n(D)||(D=g(D)),this.sub(this.div(D).mul(D))},X.mod=X.modulo,X.not=function(){return a(~this.low,~this.high,this.unsigned)},X.and=function(D){return n(D)||(D=g(D)),a(this.low&D.low,this.high&D.high,this.unsigned)},X.or=function(D){return n(D)||(D=g(D)),a(this.low|D.low,this.high|D.high,this.unsigned)},X.xor=function(D){return n(D)||(D=g(D)),a(this.low^D.low,this.high^D.high,this.unsigned)},X.shiftLeft=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low<<D,this.high<<D|this.low>>>32-D,this.unsigned):a(0,this.low<<D-32,this.unsigned)},X.shl=X.shiftLeft,X.shiftRight=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low>>>D|this.high<<32-D,this.high>>D,this.unsigned):a(this.high>>D-32,this.high>=0?0:-1,this.unsigned)},X.shr=X.shiftRight,X.shiftRightUnsigned=function(D){if(n(D)&&(D=D.toInt()),D&=63,D===0)return this;var ae=this.high;if(D<32){var re=this.low;return a(re>>>D|ae<<32-D,ae>>>D,this.unsigned)}else return D===32?a(ae,0,this.unsigned):a(ae>>>D-32,0,this.unsigned)},X.shru=X.shiftRightUnsigned,X.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},X.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},X.toBytes=function(U){return U?this.toBytesLE():this.toBytesBE()},X.toBytesLE=function(){var U=this.high,D=this.low;return[D&255,D>>>8&255,D>>>16&255,D>>>24&255,U&255,U>>>8&255,U>>>16&255,U>>>24&255]},X.toBytesBE=function(){var U=this.high,D=this.low;return[U>>>24&255,U>>>16&255,U>>>8&255,U&255,D>>>24&255,D>>>16&255,D>>>8&255,D&255]},e})})(jS);const rf=jS.exports,RV=3,OV=30,FV=2*OV+1,mE=180/Math.PI;function DV(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function _E(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function kV(t){return[_E(t[0]),_E(t[1])]}function NV(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function UV([t,e,n]){const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*mE,i*mE]}function GV(t){let e=rf.fromString(t,!0,10).toString(2);for(;e.length<RV+FV;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),s=r.length/2,o=rf.fromString(i,!0,2).toString(10);let a=rf.fromString(r,!0,2).toString(4);for(;a.length<s;)a="0"+a;return"".concat(o,"/").concat(a)}function zV(t,e,n,i){if(i===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function VV(t){const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length,s=[0,0];let o;for(let a=r-1;a>=0;a--){o=r-a;const l=i[a];let h=0,g=0;l==="1"?g=1:l==="2"?(h=1,g=1):l==="3"&&(h=1);const m=Math.pow(2,o-1);zV(m,s,h,g),s[0]+=m*h,s[1]+=m*g}if(n%2===1){const a=s[0];s[0]=s[1],s[1]=a}return{face:n,ij:s,level:o}}function HV(t){const e=t.padEnd(16,"0");return rf.fromString(e,16)}const jV=100;function WV({face:t,ij:e,level:n}){const i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(jV*Math.pow(2,-n))),s=new Float64Array(4*r*2+2);let o=0,a=0;for(let l=0;l<4;l++){const h=i[l].slice(0),g=i[l+1],m=(g[0]-h[0])/r,v=(g[1]-h[1])/r;for(let w=0;w<r;w++){h[0]+=m,h[1]+=v;const C=DV(e,n,h),b=kV(C),R=NV(t,b),S=UV(R);Math.abs(S[1])>89.999&&(S[0]=a);const P=S[0]-a;S[0]+=P>180?-360:P<-180?360:0,s[o++]=S[0],s[o++]=S[1],a=S[0]}}return s[o++]=s[0],s[o++]=s[1],s}function QV(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=HV(t)}return GV(t.toString())}function XV(t){const e=QV(t),n=VV(e);return WV(n)}const JV={getS2Token:{type:"accessor",value:t=>t.token}};class WS extends Xa{indexToBounds(){const{data:e,getS2Token:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>XV(n(i,r))}}}T(WS,"layerName","S2Layer");T(WS,"defaultProps",JV);const E0=512;function YV(t){let e=0,n=0,i=1<<t.length;const r=i/E0;for(let s=0;s<t.length;s++){i>>=1;const o=parseInt(t[s]);o%2&&(e|=i),o>1&&(n|=i)}return[[e/r,E0-n/r],[(e+.99)/r,E0-(n+.99)/r]]}function KV(t){const[e,n]=YV(t),[i,r]=ys(e),[s,o]=ys(n);return[s,r,s,o,i,o,i,r,s,r]}const ZV={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class QS extends Xa{indexToBounds(){const{data:e,getQuadkey:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>KV(n(i,r))}}}T(QS,"layerName","QuadkeyLayer");T(QS,"defaultProps",ZV);class qV{constructor(e){T(this,"index",void 0),T(this,"isVisible",void 0),T(this,"isSelected",void 0),T(this,"parent",void 0),T(this,"children",void 0),T(this,"content",void 0),T(this,"state",void 0),T(this,"layers",void 0),T(this,"id",void 0),T(this,"bbox",void 0),T(this,"zoom",void 0),T(this,"userData",void 0),T(this,"_abortController",void 0),T(this,"_loader",void 0),T(this,"_loaderId",void 0),T(this,"_isLoaded",void 0),T(this,"_isCancelled",void 0),T(this,"_needsReload",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||De.error("byteLength not defined in tile data")(),e}async _loadData({getData:e,requestScheduler:n,onLoad:i,onError:r}){const{index:s,id:o,bbox:a,userData:l,zoom:h}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:m}=this._abortController,v=await n.scheduleRequest(this,b=>b.isSelected?1:-1);if(!v){this._isCancelled=!0;return}if(this._isCancelled){v.done();return}let w=null,C;try{w=await e({index:s,id:o,bbox:a,userData:l,zoom:h,signal:m})}catch(b){C=b||!0}finally{v.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=w,this._isCancelled&&!w){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,C?r(C,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}const vn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},yE=new q,$V=new q;class L1{constructor(e=[0,0,0],n=[0,0,0],i){T(this,"center",void 0),T(this,"halfDiagonal",void 0),T(this,"minimum",void 0),T(this,"maximum",void 0),i=i||yE.copy(e).add(n).scale(.5),this.center=new q(i),this.halfDiagonal=new q(n).subtract(this.center),this.minimum=new q(e),this.maximum=new q(n)}clone(){return new L1(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=$V.from(e.normal),r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-r>0?vn.INSIDE:s+r<0?vn.OUTSIDE:vn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=yE.from(e).subtract(this.center),{halfDiagonal:i}=this;let r=0,s;return s=Math.abs(n.x)-i.x,s>0&&(r+=s*s),s=Math.abs(n.y)-i.y,s>0&&(r+=s*s),s=Math.abs(n.z)-i.z,s>0&&(r+=s*s),r}}const PA=new q,vE=new q;class Ac{constructor(e=[0,0,0],n=0){T(this,"center",void 0),T(this,"radius",void 0),this.radius=-0,this.center=new q,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=PA.from(n),this.center=new q().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ac(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,s=e.radius,o=PA.copy(r).subtract(n),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();const l=(i+a+s)*.5;return vE.copy(o).scale((-i+l)/a).add(n),this.center.copy(vE),this.radius=l,this}expand(e){const i=PA.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=pN(PA,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=PA.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?vn.OUTSIDE:s<i?vn.INTERSECTING:vn.INSIDE}}const eH=new q,tH=new q,_u=new q,yu=new q,vu=new q,nH=new q,iH=new q,dr={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class lc{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){T(this,"center",void 0),T(this,"halfAxes",void 0),this.center=new q().from(e),this.halfAxes=new qt(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new q(e).len(),new q(n).len(),new q(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new q(e).normalize(),s=new q(n).normalize(),o=new q(i).normalize();return new Pl().fromMatrix3(new qt([...r,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new Pl(i),s=new qt().fromQuaternion(r);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new q().from(e),this.halfAxes=s,this}clone(){return new lc(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ac){const n=this.halfAxes,i=n.getColumn(0,_u),r=n.getColumn(1,yu),s=n.getColumn(2,vu),o=eH.copy(i).add(r).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,s=i.x,o=i.y,a=i.z,l=Math.abs(s*r[dr.COLUMN0ROW0]+o*r[dr.COLUMN0ROW1]+a*r[dr.COLUMN0ROW2])+Math.abs(s*r[dr.COLUMN1ROW0]+o*r[dr.COLUMN1ROW1]+a*r[dr.COLUMN1ROW2])+Math.abs(s*r[dr.COLUMN2ROW0]+o*r[dr.COLUMN2ROW1]+a*r[dr.COLUMN2ROW2]),h=i.dot(n)+e.distance;return h<=-l?vn.OUTSIDE:h>=l?vn.INSIDE:vn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=tH.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,_u),s=i.getColumn(1,yu),o=i.getColumn(2,vu),a=r.magnitude(),l=s.magnitude(),h=o.magnitude();r.normalize(),s.normalize(),o.normalize();let g=0,m;return m=Math.abs(n.dot(r))-a,m>0&&(g+=m*m),m=Math.abs(n.dot(s))-l,m>0&&(g+=m*m),m=Math.abs(n.dot(o))-h,m>0&&(g+=m*m),g}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,_u),h=a.getColumn(1,yu),g=a.getColumn(2,vu),m=nH.copy(l).add(h).add(g).add(o),v=iH.copy(m).subtract(e);let w=n.dot(v);return r=Math.min(w,r),s=Math.max(w,s),m.copy(o).add(l).add(h).subtract(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),m.copy(o).add(l).subtract(h).add(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),m.copy(o).add(l).subtract(h).subtract(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),o.copy(m).subtract(l).add(h).add(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),o.copy(m).subtract(l).add(h).subtract(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),o.copy(m).subtract(l).subtract(h).add(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),o.copy(m).subtract(l).subtract(h).subtract(g),v.copy(m).subtract(e),w=n.dot(v),r=Math.min(w,r),s=Math.max(w,s),i[0]=r,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,_u);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,yu);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,vu);return r.transformAsPoint(e),this.halfAxes=new qt([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const EE=new q,wE=new q;class mi{constructor(e=[0,0,1],n=0){T(this,"normal",void 0),T(this,"distance",void 0),this.normal=new q,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Di(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=EE.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),Di(ri(this.normal.len(),1)),this.distance=r,this}clone(){return new mi(this.normal,this.distance)}equals(e){return ri(this.distance,e.distance)&&ri(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=wE.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=EE.from(e);const i=this.getPointDistance(e),r=wE.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const TE=[new q([1,0,0]),new q([0,1,0]),new q([0,0,1])],CE=new q,rH=new q;new mi(new q(1,0,0),0);class ei{constructor(e=[]){T(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*TE.length;const n=e.center,i=e.radius;let r=0;for(const s of TE){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new mi),a||(a=this.planes[r+1]=new mi);const l=CE.copy(s).scale(-i).add(n);-s.dot(l),o.fromPointNormal(l,s);const h=CE.copy(s).scale(i).add(n),g=rH.copy(s).negate();-g.dot(h),a.fromPointNormal(h,g),r+=2}return this}computeVisibility(e){let n=vn.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case vn.OUTSIDE:return vn.OUTSIDE;case vn.INTERSECTING:n=vn.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Di(Number.isFinite(n),"parentPlaneMask is required."),n===ei.MASK_OUTSIDE||n===ei.MASK_INSIDE)return n;let i=ei.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(n&o)===0)continue;const a=r[s],l=e.intersectPlane(a);if(l===vn.OUTSIDE)return ei.MASK_OUTSIDE;l===vn.INTERSECTING&&(i|=o)}return i}}T(ei,"MASK_OUTSIDE",4294967295);T(ei,"MASK_INSIDE",0);T(ei,"MASK_INDETERMINATE",2147483647);new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;const tr=new qt,sH=new qt,oH=new qt,Eu=new qt,xE=new qt;function aH(t,e={}){const n=Ml.EPSILON20,i=10;let r=0,s=0;const o=sH,a=oH;o.identity(),a.copy(t);const l=n*AH(a);for(;s<i&&lH(a)>l;)cH(a,Eu),xE.copy(Eu).transpose(),a.multiplyRight(Eu),a.multiplyLeft(xE),o.multiplyRight(Eu),++r>2&&(++s,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function AH(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const Mp=[1,0,0],Ip=[2,2,1];function lH(t){let e=0;for(let n=0;n<3;++n){const i=t[tr.getElementIndex(Ip[n],Mp[n])];e+=2*i*i}return Math.sqrt(e)}function cH(t,e){const n=Ml.EPSILON15;let i=0,r=1;for(let h=0;h<3;++h){const g=Math.abs(t[tr.getElementIndex(Ip[h],Mp[h])]);g>i&&(r=h,i=g)}const s=Mp[r],o=Ip[r];let a=1,l=0;if(Math.abs(t[tr.getElementIndex(o,s)])>n){const h=t[tr.getElementIndex(o,o)],g=t[tr.getElementIndex(s,s)],m=t[tr.getElementIndex(o,s)],v=(h-g)/2/m;let w;v<0?w=-1/(-v+Math.sqrt(1+v*v)):w=1/(v+Math.sqrt(1+v*v)),a=1/Math.sqrt(1+w*w),l=w*a}return qt.IDENTITY.to(e),e[tr.getElementIndex(s,s)]=e[tr.getElementIndex(o,o)]=a,e[tr.getElementIndex(o,s)]=l,e[tr.getElementIndex(s,o)]=-l,e}const Jr=new q,uH=new q,fH=new q,hH=new q,dH=new q,gH=new qt,pH={diagonal:new qt,unitary:new qt};function mH(t,e=new lc){if(!t||t.length===0)return e.halfAxes=new qt([0,0,0,0,0,0,0,0,0]),e.center=new q,e;const n=t.length,i=new q(0,0,0);for(const X of t)i.add(X);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,h=0,g=0;for(const X of t){const U=Jr.copy(X).subtract(i);s+=U.x*U.x,o+=U.x*U.y,a+=U.x*U.z,l+=U.y*U.y,h+=U.y*U.z,g+=U.z*U.z}s*=r,o*=r,a*=r,l*=r,h*=r,g*=r;const m=gH;m[0]=s,m[1]=o,m[2]=a,m[3]=o,m[4]=l,m[5]=h,m[6]=a,m[7]=h,m[8]=g;const{unitary:v}=aH(m,pH),w=e.halfAxes.copy(v);let C=w.getColumn(0,fH),b=w.getColumn(1,hH),R=w.getColumn(2,dH),S=-Number.MAX_VALUE,P=-Number.MAX_VALUE,M=-Number.MAX_VALUE,F=Number.MAX_VALUE,H=Number.MAX_VALUE,j=Number.MAX_VALUE;for(const X of t)Jr.copy(X),S=Math.max(Jr.dot(C),S),P=Math.max(Jr.dot(b),P),M=Math.max(Jr.dot(R),M),F=Math.min(Jr.dot(C),F),H=Math.min(Jr.dot(b),H),j=Math.min(Jr.dot(R),j);C=C.multiplyByScalar(.5*(F+S)),b=b.multiplyByScalar(.5*(H+P)),R=R.multiplyByScalar(.5*(j+M)),e.center.copy(C).add(b).add(R);const K=uH.set(S-F,P-H,M-j).multiplyByScalar(.5),ee=new qt([K[0],0,0,0,K[1],0,0,0,K[2]]);return e.halfAxes.multiplyRight(ee),e}const Aa=512,bE=3,XS=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],JS=XS.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),_H=JS.concat([[.25,.5],[.75,.5]]);class la{constructor(e,n,i){T(this,"x",void 0),T(this,"y",void 0),T(this,"z",void 0),T(this,"childVisible",void 0),T(this,"selected",void 0),T(this,"_children",void 0),this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new la(e,n,i),new la(e,n+1,i),new la(e+1,n,i),new la(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:r,minZ:s,maxZ:o,bounds:a,offset:l,project:h}=e,g=this.getBoundingVolume(r,l,h);if(a&&!this.insideBounds(a)||i.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:v}=this;if(v<o&&v>=s){const w=g.distanceTo(n.cameraPosition)*n.scale/n.height;v+=Math.floor(Math.log2(w))}if(v>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const v of this.children)v.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,i,r]){const s=Math.pow(2,this.z),o=Aa/s;return this.x*o<i&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,i){if(i){const l=this.z<1?_H:this.z<2?JS:XS,h=[];for(const g of l){const m=Lp(this.x+g[0],this.y+g[1],this.z);m[2]=e[0],h.push(i(m)),e[0]!==e[1]&&(m[2]=e[1],h.push(i(m)))}return mH(h)}const r=Math.pow(2,this.z),s=Aa/r,o=this.x*s+n*Aa,a=Aa-(this.y+1)*s;return new L1([o,a,e[0]],[o+s,a+s,e[1]])}}function yH(t,e,n,i){const r=t instanceof WG&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:w,distance:C})=>new mi(w.clone().negate(),C)),o=new ei(s),a=t.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,h=n&&n[1]*a||0,g=t instanceof ur&&t.pitch<=60?e:0;if(i){const[w,C,b,R]=i,S=_s([w,R]),P=_s([b,C]);i=[S[0],Aa-S[1],P[0],Aa-P[1]]}const m=new la(0,0,0),v={viewport:t,project:r,cullingVolume:o,elevationBounds:[l,h],minZ:g,maxZ:e,bounds:i,offset:0};if(m.update(v),t instanceof ur&&t.subViewports&&t.subViewports.length>1){for(v.offset=-1;m.update(v)&&!(--v.offset<-bE););for(v.offset=1;m.update(v)&&!(++v.offset>bE););}return m.getSelected()}const Ir=512,vH=[-1/0,-1/0,1/0,1/0],Bp={type:"url",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equals:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function YS(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function EH(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function Yf(t,e){if(!t||!t.length)return null;const{index:n,id:i}=e;if(Array.isArray(t)){const s=EH(i)%t.length;t=t[s]}let r=t;for(const s of Object.keys(n)){const o=new RegExp("{".concat(s,"}"),"g");r=r.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function wH(t,e,n){let i;if(e&&e.length===2){const[r,s]=e,o=t.getBounds({z:r}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function Kf({viewport:t,z:e,cullRect:n}){const i=n.x-t.x,r=n.y-t.y,{width:s,height:o}=n;if(!Array.isArray(e)){const h={targetZ:e||0},g=t.unproject([i,r],h),m=t.unproject([i+s,r],h),v=t.unproject([i,r+o],h),w=t.unproject([i+s,r+o],h);return[Math.min(g[0],m[0],v[0],w[0]),Math.min(g[1],m[1],v[1],w[1]),Math.max(g[0],m[0],v[0],w[0]),Math.max(g[1],m[1],v[1],w[1])]}const a=Kf({viewport:t,z:e[0],cullRect:n}),l=Kf({viewport:t,z:e[1],cullRect:n});return[Math.min(a[0],l[0]),Math.min(a[1],l[1]),Math.max(a[2],l[2]),Math.max(a[3],l[3])]}function TH(t,e,n){return n?YS(t,n).map(r=>r*e/Ir):t.map(i=>i*e/Ir)}function R1(t,e){return Math.pow(2,t)*Ir/e}function Lp(t,e,n){const i=R1(n,Ir),r=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function SE(t,e,n,i){const r=R1(n,i);return[t/r*Ir,e/r*Ir]}function CH(t,e,n,i,r=Ir){if(t.isGeospatial){const[h,g]=Lp(e,n,i),[m,v]=Lp(e+1,n+1,i);return{west:h,north:g,east:m,south:v}}const[s,o]=SE(e,n,i,r),[a,l]=SE(e+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function xH(t,e,n,i,r){const s=wH(t,null,i),o=R1(e,n),[a,l,h,g]=TH(s,o,r),m=[];for(let v=Math.floor(a);v<h;v++)for(let w=Math.floor(l);w<g;w++)m.push({x:v,y:w,z:e});return m}function bH({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:s=Ir,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let h=t.isGeospatial?Math.round(t.zoom+Math.log2(Ir/s))+l:Math.ceil(t.zoom)+l;if(typeof n=="number"&&Number.isFinite(n)&&h<n){if(!r)return[];h=n}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let g=r;return o&&a&&r&&!t.isGeospatial&&(g=YS(r,o)),t.isGeospatial?yH(t,h,i,r):xH(t,h,s,g||vH,a)}function SH(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function PH(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}const PE=1,Nh=2,MH="never",IH="no-overlap",O1="best-available",BH=5,LH={[O1]:OH,[IH]:FH,[MH]:()=>{}};class RH{constructor(e){T(this,"opts",void 0),T(this,"_requestScheduler",void 0),T(this,"_cache",void 0),T(this,"_dirty",void 0),T(this,"_tiles",void 0),T(this,"_cacheByteSize",void 0),T(this,"_viewport",void 0),T(this,"_zRange",void 0),T(this,"_selectedTiles",void 0),T(this,"_frameNumber",void 0),T(this,"_modelMatrix",void 0),T(this,"_modelMatrixInverse",void 0),T(this,"_maxZoom",void 0),T(this,"_minZoom",void 0),T(this,"onTileLoad",void 0),T(this,"_getCullBounds",rc(Kf)),this.opts=e,this.onTileLoad=n=>{this.opts.onTileLoad(n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new fx({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new ze,this._modelMatrixInverse=new ze,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:i}={}){const r=new ze(i),s=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!ri(this._zRange,n)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const[i,r,s,o]=Kf({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:a}=e;if("west"in a)return a.west<s&&a.east>i&&a.south<o&&a.north>r;const l=Math.min(a.top,a.bottom),h=Math.max(a.top,a.bottom);return a.left<s&&a.right>i&&l<o&&h>r}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:i,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:l,zoomOffset:h}=this.opts;return bH({viewport:e,maxZoom:n,minZoom:i,zRange:r,tileSize:a,extent:l,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:CH(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),i=Math.floor(e.y/2),r=e.z-1;return{x:n,y:i,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||O1,n=new Array(this._cache.size);let i=0;for(const r of this._cache.values())n[i++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:LH[e])(Array.from(this._cache.values())),i=0;for(const r of this._cache.values())if(n[i++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e}=this.opts,n=[];let i=0;for(const r of this._cache.values())r.isLoading&&(i++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&i>e&&n.length>0;)n.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const i=this._getNearestAncestor(n);n.parent=i,i!=null&&i.children&&i.children.push(n)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:BH*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(const[o,a]of e)if(a.isVisible||(this._cacheByteSize-=n.maxCacheByteSize?a.byteLength:0,e.delete(o),this.opts.onTileUnload(a)),e.size<=i&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,a)=>o.zoom-a.zoom),this._dirty=!1)}_getTile(e,n){const i=this.getTileId(e);let r=this._cache.get(i),s=!1;return!r&&n?(r=new qV(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let i=e.index;for(;this.getTileZoom(i)>n;){i=this.getParentIndex(i);const r=this._getTile(i);if(r)return r}return null}}function OH(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!KS(e)&&F1(e);for(const e of t)e.isVisible=Boolean(e.state&Nh)}function FH(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&KS(n);const e=Array.from(t).sort((n,i)=>n.zoom-i.zoom);for(const n of e)if(n.isVisible=Boolean(n.state&Nh),n.children&&(n.isVisible||n.state&PE))for(const i of n.children)i.state=PE;else n.isSelected&&F1(n)}function KS(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Nh,!0;e=e.parent}return!1}function F1(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Nh:F1(e)}const DH={TilesetClass:RH,data:{type:"data",value:[]},dataComparator:Bp.equals,renderSubLayers:{type:"function",value:t=>new ac(t),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:t=>console.error(t),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:O1,zRange:null,maxRequests:6,zoomOffset:0};class cc extends Or{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var e,n;return(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0?void 0:n.selectedTiles.every(i=>i.isLoaded&&i.layers&&i.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():this.state.tileset.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:l,zoomOffset:h}=this.props;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:s,maxRequests:l,zoomOffset:h,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==r;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:r}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?Yf(n,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:n}){return e.tile=n.props.tile,e}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.id),data:e.content,_offset:0,tile:e});e.layers=Sh(i,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,n)}}T(cc,"defaultProps",DH);T(cc,"layerName","TileLayer");const kH={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class D1 extends Ao{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:i,currentTime:r}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:i,currentTime:r},super.draw(e)}}T(D1,"layerName","TripsLayer");T(D1,"defaultProps",kH);var Mt=function(t){t=t||{};var e=typeof t<"u"?t:{},n={},i;for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);var r="";function s(Y){return e.locateFile?e.locateFile(Y,r):r+Y}var o;document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="",o=function(Ae,_e,Fe){var u=new XMLHttpRequest;u.open("GET",Ae,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status==200||u.status==0&&u.response){_e(u.response);return}var $e=eA(Ae);if($e){_e($e.buffer);return}Fe()},u.onerror=Fe,u.send(null)};var a=e.print||console.log.bind(console),l=e.printErr||console.warn.bind(console);for(i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);n=null,e.arguments&&e.arguments;var h=0,g=function(Y){h=Y},m=function(){return h},v=8;function w(Y,Ae,_e,Fe){switch(_e=_e||"i8",_e.charAt(_e.length-1)==="*"&&(_e="i32"),_e){case"i1":ae[Y>>0]=Ae;break;case"i8":ae[Y>>0]=Ae;break;case"i16":te[Y>>1]=Ae;break;case"i32":oe[Y>>2]=Ae;break;case"i64":Za=[Ae>>>0,(Dr=Ae,+bs(Dr)>=1?Dr>0?(ci(+Ps(Dr/4294967296),4294967295)|0)>>>0:~~+Ss((Dr-+(~~Dr>>>0))/4294967296)>>>0:0)],oe[Y>>2]=Za[0],oe[Y+4>>2]=Za[1];break;case"float":ve[Y>>2]=Ae;break;case"double":ce[Y>>3]=Ae;break;default:Ji("invalid type for setValue: "+_e)}}function C(Y,Ae,_e){switch(Ae=Ae||"i8",Ae.charAt(Ae.length-1)==="*"&&(Ae="i32"),Ae){case"i1":return ae[Y>>0];case"i8":return ae[Y>>0];case"i16":return te[Y>>1];case"i32":return oe[Y>>2];case"i64":return oe[Y>>2];case"float":return ve[Y>>2];case"double":return ce[Y>>3];default:Ji("invalid type for getValue: "+Ae)}return null}var b=!1;function R(Y,Ae){Y||Ji("Assertion failed: "+Ae)}function S(Y){var Ae=e["_"+Y];return R(Ae,"Cannot call unknown function "+Y+", make sure it is exported"),Ae}function P(Y,Ae,_e,Fe,u){var N={string:function(kt){var Yi=0;if(kt!=null&&kt!==0){var To=(kt.length<<2)+1;Yi=_c(To),ee(kt,Yi,To)}return Yi},array:function(kt){var Yi=_c(kt.length);return X(kt,Yi),Yi}};function $e(kt){return Ae==="string"?j(kt):Ae==="boolean"?Boolean(kt):kt}var nt=S(Y),je=[],Qe=0;if(Fe)for(var wt=0;wt<Fe.length;wt++){var et=N[_e[wt]];et?(Qe===0&&(Qe=yc()),je[wt]=et(Fe[wt])):je[wt]=Fe[wt]}var Ye=nt.apply(null,je);return Ye=$e(Ye),Qe!==0&&Kh(Qe),Ye}function M(Y,Ae,_e,Fe){_e=_e||[];var u=_e.every(function($e){return $e==="number"}),N=Ae!=="string";return N&&u&&!Fe?S(Y):function(){return P(Y,Ae,_e,arguments)}}var F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function H(Y,Ae,_e){for(var Fe=Ae+_e,u=Ae;Y[u]&&!(u>=Fe);)++u;if(u-Ae>16&&Y.subarray&&F)return F.decode(Y.subarray(Ae,u));for(var N="";Ae<u;){var $e=Y[Ae++];if(!($e&128)){N+=String.fromCharCode($e);continue}var nt=Y[Ae++]&63;if(($e&224)==192){N+=String.fromCharCode(($e&31)<<6|nt);continue}var je=Y[Ae++]&63;if(($e&240)==224?$e=($e&15)<<12|nt<<6|je:$e=($e&7)<<18|nt<<12|je<<6|Y[Ae++]&63,$e<65536)N+=String.fromCharCode($e);else{var Qe=$e-65536;N+=String.fromCharCode(55296|Qe>>10,56320|Qe&1023)}}return N}function j(Y,Ae){return Y?H(re,Y,Ae):""}function K(Y,Ae,_e,Fe){if(!(Fe>0))return 0;for(var u=_e,N=_e+Fe-1,$e=0;$e<Y.length;++$e){var nt=Y.charCodeAt($e);if(nt>=55296&&nt<=57343){var je=Y.charCodeAt(++$e);nt=65536+((nt&1023)<<10)|je&1023}if(nt<=127){if(_e>=N)break;Ae[_e++]=nt}else if(nt<=2047){if(_e+1>=N)break;Ae[_e++]=192|nt>>6,Ae[_e++]=128|nt&63}else if(nt<=65535){if(_e+2>=N)break;Ae[_e++]=224|nt>>12,Ae[_e++]=128|nt>>6&63,Ae[_e++]=128|nt&63}else{if(_e+3>=N)break;Ae[_e++]=240|nt>>18,Ae[_e++]=128|nt>>12&63,Ae[_e++]=128|nt>>6&63,Ae[_e++]=128|nt&63}}return Ae[_e]=0,_e-u}function ee(Y,Ae,_e){return K(Y,re,Ae,_e)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function X(Y,Ae){ae.set(Y,Ae)}function U(Y,Ae){return Y%Ae>0&&(Y+=Ae-Y%Ae),Y}var D,ae,re,te,oe,ve,ce;function ne(Y){D=Y,e.HEAP8=ae=new Int8Array(Y),e.HEAP16=te=new Int16Array(Y),e.HEAP32=oe=new Int32Array(Y),e.HEAPU8=re=new Uint8Array(Y),e.HEAPU16=new Uint16Array(Y),e.HEAPU32=new Uint32Array(Y),e.HEAPF32=ve=new Float32Array(Y),e.HEAPF64=ce=new Float64Array(Y)}var le=5266928,he=24016,xe=e.TOTAL_MEMORY||33554432;e.buffer?D=e.buffer:D=new ArrayBuffer(xe),xe=D.byteLength,ne(D),oe[he>>2]=le;function Ie(Y){for(;Y.length>0;){var Ae=Y.shift();if(typeof Ae=="function"){Ae();continue}var _e=Ae.func;typeof _e=="number"?Ae.arg===void 0?e.dynCall_v(_e):e.dynCall_vi(_e,Ae.arg):_e(Ae.arg===void 0?null:Ae.arg)}}var Ze=[],Ft=[],An=[],tn=[];function dt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Xi(e.preRun.shift());Ie(Ze)}function dn(){Ie(Ft)}function Ke(){Ie(An)}function Et(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)li(e.postRun.shift());Ie(tn)}function Xi(Y){Ze.unshift(Y)}function li(Y){tn.unshift(Y)}var bs=Math.abs,Ss=Math.ceil,Ps=Math.floor,ci=Math.min,bn=0,Fr=null;function uc(Y){bn++,e.monitorRunDependencies&&e.monitorRunDependencies(bn)}function _o(Y){if(bn--,e.monitorRunDependencies&&e.monitorRunDependencies(bn),bn==0&&Fr){var Ae=Fr;Fr=null,Ae()}}e.preloadedImages={},e.preloadedAudios={};var Dt=null,Ka="data:application/octet-stream;base64,";function fc(Y){return String.prototype.startsWith?Y.startsWith(Ka):Y.indexOf(Ka)===0}var Dr,Za;Dt="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var Hh=24032;function hc(Y){return Y}function qa(Y){var Ae=/\b__Z[\w\d_]+/g;return Y.replace(Ae,function(_e){var Fe=_e;return _e===Fe?_e:Fe+" ["+_e+"]"})}function $a(){var Y=new Error;if(!Y.stack){try{throw new Error(0)}catch(Ae){Y=Ae}if(!Y.stack)return"(no stack trace available)"}return Y.stack.toString()}function dc(){var Y=$a();return e.extraStackTrace&&(Y+=`
`+e.extraStackTrace()),qa(Y)}function yo(Y,Ae,_e,Fe){Ji("Assertion failed: "+j(Y)+", at: "+[Ae?j(Ae):"unknown filename",_e,Fe?j(Fe):"unknown function"])}function vo(){return ae.length}function jh(Y,Ae,_e){re.set(re.subarray(Ae,Ae+_e),Y)}function Wh(Y){return e.___errno_location&&(oe[e.___errno_location()>>2]=Y),Y}function Qh(Y){Ji("OOM")}function gc(Y){try{var Ae=new ArrayBuffer(Y);return Ae.byteLength!=Y?void 0:(new Int8Array(Ae).set(ae),Yh(Ae),ne(Ae),1)}catch{}}function Xh(Y){var Ae=vo(),_e=16777216,Fe=2147483648-_e;if(Y>Fe)return!1;for(var u=16777216,N=Math.max(Ae,u);N<Y;)N<=536870912?N=U(2*N,_e):N=Math.min(U((3*N+2147483648)/4,_e),Fe);var $e=gc(N);return!!$e}var Eo=typeof atob=="function"?atob:function(Y){var Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_e="",Fe,u,N,$e,nt,je,Qe,wt=0;Y=Y.replace(/[^A-Za-z0-9\+\/\=]/g,"");do $e=Ae.indexOf(Y.charAt(wt++)),nt=Ae.indexOf(Y.charAt(wt++)),je=Ae.indexOf(Y.charAt(wt++)),Qe=Ae.indexOf(Y.charAt(wt++)),Fe=$e<<2|nt>>4,u=(nt&15)<<4|je>>2,N=(je&3)<<6|Qe,_e=_e+String.fromCharCode(Fe),je!==64&&(_e=_e+String.fromCharCode(u)),Qe!==64&&(_e=_e+String.fromCharCode(N));while(wt<Y.length);return _e};function Jh(Y){try{for(var Ae=Eo(Y),_e=new Uint8Array(Ae.length),Fe=0;Fe<Ae.length;++Fe)_e[Fe]=Ae.charCodeAt(Fe);return _e}catch{throw new Error("Converting base64 string to bytes failed.")}}function eA(Y){if(!!fc(Y))return Jh(Y.slice(Ka.length))}var pc={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},mc={a:Ji,b:g,c:m,d:yo,e:Wh,f:vo,g:jh,h:Xh,i:Qh,j:hc,k:qa,l:gc,m:$a,n:dc,o:Hh,p:he},me=function(Y,Ae,_e){var Fe=new Y.Int8Array(_e),u=new Y.Int32Array(_e);new Y.Uint8Array(_e),new Y.Float32Array(_e);var N=new Y.Float64Array(_e),$e=Ae.p|0,nt=Y.Math.floor,je=Y.Math.abs,Qe=Y.Math.sqrt,wt=Y.Math.pow,et=Y.Math.cos,Ye=Y.Math.sin,kt=Y.Math.tan,Yi=Y.Math.acos,To=Y.Math.asin,kr=Y.Math.atan,Tt=Y.Math.atan2,bi=Y.Math.ceil,nn=Y.Math.imul,Si=Y.Math.min,jn=Y.Math.clz32,Re=Ae.b,V=Ae.c,it=Ae.d,iA=Ae.e,Co=Ae.f,Wn=Ae.g,xo=Ae.h,rA=Ae.i,k=24048;function sA(A){return Fe=new Int8Array(A),u=new Int32Array(A),N=new Float64Array(A),_e=A,!0}function oA(A){A=A|0;var c=0;return c=k,k=k+A|0,k=k+15&-16,c|0}function bo(){return k|0}function Pi(A){A=A|0,k=A}function Zh(A,c){A=A|0,k=A}function wc(A){return A=A|0,(nn(A*3|0,A+1|0)|0)+1|0}function So(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0;!(aA(A,c,f,d,0)|0)||(y=(nn(f*3|0,f+1|0)|0)+1|0,Ii(d|0,0,y<<3|0)|0,p=Mi(y,4)|0,p&&(ui(A,c,f,d,p,y,0),He(p)))}function Tc(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0;if(!!(aA(A,c,f,d,p)|0)){if(y=(nn(f*3|0,f+1|0)|0)+1|0,Ii(d|0,0,y<<3|0)|0,p|0){Ii(p|0,0,y<<2|0)|0,ui(A,c,f,d,p,y,0);return}p=Mi(y,4)|0,p&&(ui(A,c,f,d,p,y,0),He(p))}}function aA(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0;if(J=k,k=k+16|0,W=J,y=d,u[y>>2]=A,u[y+4>>2]=c,y=(p|0)!=0,y&&(u[p>>2]=0),Xt(A,c)|0)return W=1,k=J,W|0;u[W>>2]=0;e:do if((f|0)>=1)if(y)for(I=0,B=1,G=1,_=0,y=A;;){if(!(_|I)){if(y=L(y,c,4,W)|0,c=V()|0,(y|0)==0&(c|0)==0){y=2;break e}if(Xt(y,c)|0){y=1;break e}}if(y=L(y,c,u[16+(I<<2)>>2]|0,W)|0,c=V()|0,(y|0)==0&(c|0)==0){y=2;break e}if(A=d+(G<<3)|0,u[A>>2]=y,u[A+4>>2]=c,u[p+(G<<2)>>2]=B,_=_+1|0,A=(_|0)==(B|0),E=I+1|0,x=(E|0)==6,Xt(y,c)|0){y=1;break e}if(B=B+(x&A&1)|0,(B|0)>(f|0)){y=0;break}else I=A?x?0:E:I,G=G+1|0,_=A?0:_}else for(I=0,B=1,G=1,_=0,y=A;;){if(!(_|I)){if(y=L(y,c,4,W)|0,c=V()|0,(y|0)==0&(c|0)==0){y=2;break e}if(Xt(y,c)|0){y=1;break e}}if(y=L(y,c,u[16+(I<<2)>>2]|0,W)|0,c=V()|0,(y|0)==0&(c|0)==0){y=2;break e}if(A=d+(G<<3)|0,u[A>>2]=y,u[A+4>>2]=c,_=_+1|0,A=(_|0)==(B|0),E=I+1|0,x=(E|0)==6,Xt(y,c)|0){y=1;break e}if(B=B+(x&A&1)|0,(B|0)>(f|0)){y=0;break}else I=A?x?0:E:I,G=G+1|0,_=A?0:_}else y=0;while(0);return W=y,k=J,W|0}function ui(A,c,f,d,p,y,_){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0,y=y|0,_=_|0;var E=0,x=0,I=0,B=0,G=0,W=0,J=0;if(G=k,k=k+16|0,B=G,(A|0)==0&(c|0)==0){k=G;return}if(E=Gr(A|0,c|0,y|0,((y|0)<0)<<31>>31|0)|0,V()|0,x=d+(E<<3)|0,W=x,J=u[W>>2]|0,W=u[W+4>>2]|0,I=(J|0)==(A|0)&(W|0)==(c|0),!((J|0)==0&(W|0)==0|I))do E=(E+1|0)%(y|0)|0,x=d+(E<<3)|0,J=x,W=u[J>>2]|0,J=u[J+4>>2]|0,I=(W|0)==(A|0)&(J|0)==(c|0);while(!((W|0)==0&(J|0)==0|I));if(E=p+(E<<2)|0,I&&(u[E>>2]|0)<=(_|0)){k=G;return}if(J=x,u[J>>2]=A,u[J+4>>2]=c,u[E>>2]=_,(_|0)>=(f|0)){k=G;return}J=_+1|0,u[B>>2]=0,W=L(A,c,2,B)|0,ui(W,V()|0,f,d,p,y,J),u[B>>2]=0,W=L(A,c,3,B)|0,ui(W,V()|0,f,d,p,y,J),u[B>>2]=0,W=L(A,c,1,B)|0,ui(W,V()|0,f,d,p,y,J),u[B>>2]=0,W=L(A,c,5,B)|0,ui(W,V()|0,f,d,p,y,J),u[B>>2]=0,W=L(A,c,4,B)|0,ui(W,V()|0,f,d,p,y,J),u[B>>2]=0,W=L(A,c,6,B)|0,ui(W,V()|0,f,d,p,y,J),k=G}function L(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0;if((u[d>>2]|0)>0){p=0;do f=Ls(f)|0,p=p+1|0;while((p|0)<(u[d>>2]|0))}E=ge(A|0,c|0,45)|0,V()|0,x=E&127,y=Fn(A,c)|0,p=ge(A|0,c|0,52)|0,V()|0,p=p&15;e:do if(!p)_=6;else for(;;){if(G=(15-p|0)*3|0,W=ge(A|0,c|0,G|0)|0,V()|0,W=W&7,J=(fi(p)|0)==0,p=p+-1|0,B=Ce(7,0,G|0)|0,c=c&~(V()|0),G=Ce(u[(J?464:48)+(W*28|0)+(f<<2)>>2]|0,0,G|0)|0,I=V()|0,f=u[(J?672:256)+(W*28|0)+(f<<2)>>2]|0,A=G|A&~B,c=I|c,!f){f=0;break e}if(!p){_=6;break}}while(0);(_|0)==6&&(J=u[880+(x*28|0)+(f<<2)>>2]|0,W=Ce(J|0,0,45)|0,A=W|A,c=V()|0|c&-1040385,f=u[4304+(x*28|0)+(f<<2)>>2]|0,(J&127|0)==127&&(J=Ce(u[880+(x*28|0)+20>>2]|0,0,45)|0,c=V()|0|c&-1040385,f=u[4304+(x*28|0)+20>>2]|0,A=Ur(J|A,c)|0,c=V()|0,u[d>>2]=(u[d>>2]|0)+1)),_=ge(A|0,c|0,45)|0,V()|0,_=_&127;e:do if(Ve(_)|0){t:do if((Fn(A,c)|0)==1){if((x|0)!=(_|0))if(i_(_,u[7728+(x*28|0)>>2]|0)|0){A=od(A,c)|0,y=1,c=V()|0;break}else{A=Ur(A,c)|0,y=1,c=V()|0;break}switch(y|0){case 5:{A=od(A,c)|0,c=V()|0,u[d>>2]=(u[d>>2]|0)+5,y=0;break t}case 3:{A=Ur(A,c)|0,c=V()|0,u[d>>2]=(u[d>>2]|0)+1,y=0;break t}default:return W=0,J=0,Re(W|0),J|0}}else y=0;while(0);if((f|0)>0){p=0;do A=sd(A,c)|0,c=V()|0,p=p+1|0;while((p|0)!=(f|0))}if((x|0)!=(_|0)){if(!(Qt(_)|0)){if((y|0)!=0|(Fn(A,c)|0)!=5)break;u[d>>2]=(u[d>>2]|0)+1;break}switch(E&127){case 8:case 118:break e}(Fn(A,c)|0)!=3&&(u[d>>2]=(u[d>>2]|0)+1)}}else if((f|0)>0){p=0;do A=Ur(A,c)|0,c=V()|0,p=p+1|0;while((p|0)!=(f|0))}while(0);return u[d>>2]=((u[d>>2]|0)+f|0)%6|0,W=c,J=A,Re(W|0),J|0}function O(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0;if(G=k,k=k+16|0,B=G,!f)return B=d,u[B>>2]=A,u[B+4>>2]=c,B=0,k=G,B|0;u[B>>2]=0;e:do if(Xt(A,c)|0)A=1;else{if(y=(f|0)>0,y){p=0,I=A;do{if(I=L(I,c,4,B)|0,c=V()|0,(I|0)==0&(c|0)==0){A=2;break e}if(p=p+1|0,Xt(I,c)|0){A=1;break e}}while((p|0)<(f|0));if(x=d,u[x>>2]=I,u[x+4>>2]=c,x=f+-1|0,y){y=0,_=1,p=I,A=c;do{if(p=L(p,A,2,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if(E=d+(_<<3)|0,u[E>>2]=p,u[E+4>>2]=A,_=_+1|0,Xt(p,A)|0){A=1;break e}y=y+1|0}while((y|0)<(f|0));E=0,y=_;do{if(p=L(p,A,3,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if(_=d+(y<<3)|0,u[_>>2]=p,u[_+4>>2]=A,y=y+1|0,Xt(p,A)|0){A=1;break e}E=E+1|0}while((E|0)<(f|0));_=0;do{if(p=L(p,A,1,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if(E=d+(y<<3)|0,u[E>>2]=p,u[E+4>>2]=A,y=y+1|0,Xt(p,A)|0){A=1;break e}_=_+1|0}while((_|0)<(f|0));_=0;do{if(p=L(p,A,5,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if(E=d+(y<<3)|0,u[E>>2]=p,u[E+4>>2]=A,y=y+1|0,Xt(p,A)|0){A=1;break e}_=_+1|0}while((_|0)<(f|0));_=0;do{if(p=L(p,A,4,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if(E=d+(y<<3)|0,u[E>>2]=p,u[E+4>>2]=A,y=y+1|0,Xt(p,A)|0){A=1;break e}_=_+1|0}while((_|0)<(f|0));for(_=0;;){if(p=L(p,A,6,B)|0,A=V()|0,(p|0)==0&(A|0)==0){A=2;break e}if((_|0)!=(x|0))if(E=d+(y<<3)|0,u[E>>2]=p,u[E+4>>2]=A,!(Xt(p,A)|0))y=y+1|0;else{A=1;break e}if(_=_+1|0,(_|0)>=(f|0)){_=I,y=c;break}}}else _=I,p=I,y=c,A=c}else _=d,u[_>>2]=A,u[_+4>>2]=c,_=A,p=A,y=c,A=c;A=((_|0)!=(p|0)|(y|0)!=(A|0))&1}while(0);return B=A,k=G,B|0}function z(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0;if(y=k,k=k+48|0,p=y+8|0,d=y,E=A,_=u[E+4>>2]|0,f=d,u[f>>2]=u[E>>2],u[f+4>>2]=_,ld(d,p),p=ed(p,c)|0,c=u[d>>2]|0,d=u[A+8>>2]|0,(d|0)<=0)return E=c,_=(p|0)<(E|0),E=_?E:p,E=E+12|0,k=y,E|0;f=u[A+12>>2]|0,A=0;do c=(u[f+(A<<3)>>2]|0)+c|0,A=A+1|0;while((A|0)<(d|0));return E=(p|0)<(c|0),E=E?c:p,E=E+12|0,k=y,E|0}function Z(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0;if(E=k,k=k+48|0,d=E+8|0,p=E,!(ue(A,c,f)|0)){k=E;return}if(x=A,y=u[x+4>>2]|0,_=p,u[_>>2]=u[x>>2],u[_+4>>2]=y,ld(p,d),_=ed(d,c)|0,c=u[p>>2]|0,y=u[A+8>>2]|0,(y|0)>0){p=u[A+12>>2]|0,d=0;do c=(u[p+(d<<3)>>2]|0)+c|0,d=d+1|0;while((d|0)!=(y|0))}if(c=(_|0)<(c|0)?c:_,(c|0)<=-12){k=E;return}x=c+11|0,Ii(f|0,0,(((x|0)>0?x:0)<<3)+8|0)|0,k=E}function ue(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0,Ue=0,ct=0,at=0,gt=0,rt=0,mt=0,_t=0,ke=0;if(ke=k,k=k+112|0,gt=ke+80|0,x=ke+72|0,rt=ke,mt=ke+56|0,I=A+8|0,_t=Ki((u[I>>2]<<5)+32|0)|0,_t||it(22848,22448,800,22456),aM(A,_t),y=A,d=u[y+4>>2]|0,E=x,u[E>>2]=u[y>>2],u[E+4>>2]=d,ld(x,gt),E=ed(gt,c)|0,d=u[x>>2]|0,y=u[I>>2]|0,(y|0)>0){_=u[A+12>>2]|0,p=0;do d=(u[_+(p<<3)>>2]|0)+d|0,p=p+1|0;while((p|0)!=(y|0))}if(E=(E|0)<(d|0)?d:E,at=E+12|0,p=Mi(at,8)|0,B=Mi(at,8)|0,u[gt>>2]=0,Ue=A,ct=u[Ue+4>>2]|0,d=x,u[d>>2]=u[Ue>>2],u[d+4>>2]=ct,d=Pe(x,at,c,gt,p,B)|0,d|0)return He(p),He(B),He(_t),_t=d,k=ke,_t|0;e:do if((u[I>>2]|0)>0){for(y=A+12|0,d=0;_=Pe((u[y>>2]|0)+(d<<3)|0,at,c,gt,p,B)|0,d=d+1|0,!(_|0);)if((d|0)>=(u[I>>2]|0))break e;return He(p),He(B),He(_t),_t=_,k=ke,_t|0}while(0);(E|0)>-12&&Ii(B|0,0,((at|0)>1?at:1)<<3|0)|0;e:do if((u[gt>>2]|0)>0){ct=((at|0)<0)<<31>>31,Q=p,Se=B,Me=p,ye=p,Te=B,Ue=p,d=p,pe=p,be=B,$=B,fe=B,p=B;t:for(;;){for(se=u[gt>>2]|0,J=0,ie=0,y=0;;){_=rt,E=_+56|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(E|0));if(c=Q+(J<<3)|0,x=u[c>>2]|0,c=u[c+4>>2]|0,aA(x,c,1,rt,0)|0){_=rt,E=_+56|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(E|0));_=Mi(7,4)|0,_|0&&(ui(x,c,1,rt,_,7,0),He(_))}W=0;do{G=rt+(W<<3)|0,B=u[G>>2]|0,G=u[G+4>>2]|0;n:do if(!((B|0)==0&(G|0)==0)){if(x=Gr(B|0,G|0,at|0,ct|0)|0,V()|0,_=f+(x<<3)|0,E=_,c=u[E>>2]|0,E=u[E+4>>2]|0,!((c|0)==0&(E|0)==0))for(I=0;;){if((I|0)>(at|0))break t;if((c|0)==(B|0)&(E|0)==(G|0))break n;if(x=(x+1|0)%(at|0)|0,_=f+(x<<3)|0,E=_,c=u[E>>2]|0,E=u[E+4>>2]|0,(c|0)==0&(E|0)==0)break;I=I+1|0}(B|0)==0&(G|0)==0||(Rs(B,G,mt),AM(A,_t,mt)|0&&(I=_,u[I>>2]=B,u[I+4>>2]=G,I=Se+(y<<3)|0,u[I>>2]=B,u[I+4>>2]=G,y=y+1|0))}while(0);W=W+1|0}while(W>>>0<7);if(ie=ie+1|0,(ie|0)>=(se|0))break;J=J+1|0}if((se|0)>0&&Ii(Me|0,0,se<<3|0)|0,u[gt>>2]=y,(y|0)>0)B=p,G=fe,W=Ue,J=$,ie=be,se=Se,p=pe,fe=d,$=ye,be=Me,pe=B,d=G,Ue=Te,Te=W,ye=J,Me=ie,Se=Q,Q=se;else break e}return He(ye),He(Te),He(_t),_t=-1,k=ke,_t|0}else d=B;while(0);return He(_t),He(p),He(d),_t=0,k=ke,_t|0}function Pe(A,c,f,d,p,y){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0,y=y|0;var _=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0,Ue=0,ct=0,at=0,gt=0;if(ct=k,k=k+48|0,Me=ct+32|0,ye=ct+16|0,Te=ct,_=u[A>>2]|0,(_|0)<=0)return Ue=0,k=ct,Ue|0;be=A+4|0,$=Me+8|0,fe=ye+8|0,Q=Te+8|0,Se=((c|0)<0)<<31>>31,pe=0;e:for(;;){E=u[be>>2]|0,ie=E+(pe<<4)|0,u[Me>>2]=u[ie>>2],u[Me+4>>2]=u[ie+4>>2],u[Me+8>>2]=u[ie+8>>2],u[Me+12>>2]=u[ie+12>>2],(pe|0)==(_+-1|0)?(u[ye>>2]=u[E>>2],u[ye+4>>2]=u[E+4>>2],u[ye+8>>2]=u[E+8>>2],u[ye+12>>2]=u[E+12>>2]):(ie=E+(pe+1<<4)|0,u[ye>>2]=u[ie>>2],u[ye+4>>2]=u[ie+4>>2],u[ye+8>>2]=u[ie+8>>2],u[ye+12>>2]=u[ie+12>>2]),ie=uP(Me,ye,f)|0;t:do if((ie|0)>0){se=+(ie|0),J=0;n:for(;;){gt=+(ie-J|0),at=+(J|0),N[Te>>3]=+N[Me>>3]*gt/se+ +N[ye>>3]*at/se,N[Q>>3]=+N[$>>3]*gt/se+ +N[fe>>3]*at/se,G=y_(Te,f)|0,W=V()|0,E=Gr(G|0,W|0,c|0,Se|0)|0,V()|0,_=y+(E<<3)|0,x=_,I=u[x>>2]|0,x=u[x+4>>2]|0;i:do if((I|0)==0&(x|0)==0)Ue=14;else for(B=0;;){if((B|0)>(c|0)){_=1;break i}if((I|0)==(G|0)&(x|0)==(W|0)){_=7;break i}if(E=(E+1|0)%(c|0)|0,_=y+(E<<3)|0,x=_,I=u[x>>2]|0,x=u[x+4>>2]|0,(I|0)==0&(x|0)==0){Ue=14;break}else B=B+1|0}while(0);switch((Ue|0)==14&&(Ue=0,(G|0)==0&(W|0)==0?_=7:(u[_>>2]=G,u[_+4>>2]=W,_=u[d>>2]|0,B=p+(_<<3)|0,u[B>>2]=G,u[B+4>>2]=W,u[d>>2]=_+1,_=0)),_&7){case 7:case 0:break;default:break n}if(J=J+1|0,(ie|0)<=(J|0)){Ue=8;break t}}if(_|0){_=-1,Ue=20;break e}}else Ue=8;while(0);if((Ue|0)==8&&(Ue=0),pe=pe+1|0,_=u[A>>2]|0,(pe|0)>=(_|0)){_=0,Ue=20;break}}return(Ue|0)==20?(k=ct,_|0):0}function Je(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0;if(I=k,k=k+176|0,x=I,(c|0)<1){P_(f,0,0),k=I;return}_=A,_=ge(u[_>>2]|0,u[_+4>>2]|0,52)|0,V()|0,P_(f,(c|0)>6?c:6,_&15),_=0;do{if(d=A+(_<<3)|0,Os(u[d>>2]|0,u[d+4>>2]|0,x),d=u[x>>2]|0,(d|0)>0){E=0;do y=x+8+(E<<4)|0,E=E+1|0,d=x+8+(((E|0)%(d|0)|0)<<4)|0,p=EM(f,d,y)|0,p?B_(f,p)|0:vM(f,y,d)|0,d=u[x>>2]|0;while((E|0)<(d|0))}_=_+1|0}while((_|0)!=(c|0));k=I}function zt(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0;if(y=k,k=k+32|0,d=y,p=y+16|0,Je(A,c,p),u[f>>2]=0,u[f+4>>2]=0,u[f+8>>2]=0,A=I_(p)|0,!A){w_(f)|0,M_(p),k=y;return}do{c=$P(f)|0;do eM(c,A)|0,_=A+16|0,u[d>>2]=u[_>>2],u[d+4>>2]=u[_+4>>2],u[d+8>>2]=u[_+8>>2],u[d+12>>2]=u[_+12>>2],B_(p,A)|0,A=wM(p,d)|0;while((A|0)!=0);A=I_(p)|0}while((A|0)!=0);w_(f)|0,M_(p),k=y}function Ve(A){return A=A|0,u[7728+(A*28|0)+16>>2]|0}function Qt(A){return A=A|0,(A|0)==4|(A|0)==117|0}function Qn(A){return A=A|0,u[11152+((u[A>>2]|0)*216|0)+((u[A+4>>2]|0)*72|0)+((u[A+8>>2]|0)*24|0)+(u[A+12>>2]<<3)>>2]|0}function oP(A){return A=A|0,u[11152+((u[A>>2]|0)*216|0)+((u[A+4>>2]|0)*72|0)+((u[A+8>>2]|0)*24|0)+(u[A+12>>2]<<3)+4>>2]|0}function aP(A,c){A=A|0,c=c|0,A=7728+(A*28|0)|0,u[c>>2]=u[A>>2],u[c+4>>2]=u[A+4>>2],u[c+8>>2]=u[A+8>>2],u[c+12>>2]=u[A+12>>2]}function AP(A,c){A=A|0,c=c|0;var f=0,d=0;if(c>>>0>20)return c=-1,c|0;do if((u[11152+(c*216|0)>>2]|0)!=(A|0))if((u[11152+(c*216|0)+8>>2]|0)!=(A|0))if((u[11152+(c*216|0)+16>>2]|0)!=(A|0))if((u[11152+(c*216|0)+24>>2]|0)!=(A|0))if((u[11152+(c*216|0)+32>>2]|0)!=(A|0))if((u[11152+(c*216|0)+40>>2]|0)!=(A|0))if((u[11152+(c*216|0)+48>>2]|0)!=(A|0))if((u[11152+(c*216|0)+56>>2]|0)!=(A|0))if((u[11152+(c*216|0)+64>>2]|0)!=(A|0))if((u[11152+(c*216|0)+72>>2]|0)!=(A|0))if((u[11152+(c*216|0)+80>>2]|0)!=(A|0))if((u[11152+(c*216|0)+88>>2]|0)!=(A|0))if((u[11152+(c*216|0)+96>>2]|0)!=(A|0))if((u[11152+(c*216|0)+104>>2]|0)!=(A|0))if((u[11152+(c*216|0)+112>>2]|0)!=(A|0))if((u[11152+(c*216|0)+120>>2]|0)!=(A|0))if((u[11152+(c*216|0)+128>>2]|0)!=(A|0))if((u[11152+(c*216|0)+136>>2]|0)==(A|0))A=2,f=1,d=2;else{if((u[11152+(c*216|0)+144>>2]|0)==(A|0)){A=0,f=2,d=0;break}if((u[11152+(c*216|0)+152>>2]|0)==(A|0)){A=0,f=2,d=1;break}if((u[11152+(c*216|0)+160>>2]|0)==(A|0)){A=0,f=2,d=2;break}if((u[11152+(c*216|0)+168>>2]|0)==(A|0)){A=1,f=2,d=0;break}if((u[11152+(c*216|0)+176>>2]|0)==(A|0)){A=1,f=2,d=1;break}if((u[11152+(c*216|0)+184>>2]|0)==(A|0)){A=1,f=2,d=2;break}if((u[11152+(c*216|0)+192>>2]|0)==(A|0)){A=2,f=2,d=0;break}if((u[11152+(c*216|0)+200>>2]|0)==(A|0)){A=2,f=2,d=1;break}if((u[11152+(c*216|0)+208>>2]|0)==(A|0)){A=2,f=2,d=2;break}else A=-1;return A|0}else A=2,f=1,d=1;else A=2,f=1,d=0;else A=1,f=1,d=2;else A=1,f=1,d=1;else A=1,f=1,d=0;else A=0,f=1,d=2;else A=0,f=1,d=1;else A=0,f=1,d=0;else A=2,f=0,d=2;else A=2,f=0,d=1;else A=2,f=0,d=0;else A=1,f=0,d=2;else A=1,f=0,d=1;else A=1,f=0,d=0;else A=0,f=0,d=2;else A=0,f=0,d=1;else A=0,f=0,d=0;while(0);return c=u[11152+(c*216|0)+(f*72|0)+(A*24|0)+(d<<3)+4>>2]|0,c|0}function i_(A,c){return A=A|0,c=c|0,(u[7728+(A*28|0)+20>>2]|0)==(c|0)?(c=1,c|0):(c=(u[7728+(A*28|0)+24>>2]|0)==(c|0),c|0)}function qh(A,c){return A=A|0,c=c|0,u[880+(A*28|0)+(c<<2)>>2]|0}function $h(A,c){return A=A|0,c=c|0,(u[880+(A*28|0)>>2]|0)==(c|0)?(c=0,c|0):(u[880+(A*28|0)+4>>2]|0)==(c|0)?(c=1,c|0):(u[880+(A*28|0)+8>>2]|0)==(c|0)?(c=2,c|0):(u[880+(A*28|0)+12>>2]|0)==(c|0)?(c=3,c|0):(u[880+(A*28|0)+16>>2]|0)==(c|0)?(c=4,c|0):(u[880+(A*28|0)+20>>2]|0)==(c|0)?(c=5,c|0):((u[880+(A*28|0)+24>>2]|0)==(c|0)?6:7)|0}function lP(){return 122}function cP(A){A=A|0;var c=0,f=0,d=0;c=0;do Ce(c|0,0,45)|0,d=V()|0|134225919,f=A+(c<<3)|0,u[f>>2]=-1,u[f+4>>2]=d,c=c+1|0;while((c|0)!=122)}function r_(A){return A=A|0,+N[A+16>>3]<+N[A+24>>3]|0}function s_(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;return f=+N[c>>3],!(f>=+N[A+8>>3])||!(f<=+N[A>>3])?(c=0,c|0):(d=+N[A+16>>3],f=+N[A+24>>3],p=+N[c+8>>3],c=p>=f,A=p<=d&1,d<f?c&&(A=1):c||(A=0),c=(A|0)!=0,c|0)}function ed(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0;_=k,k=k+288|0,f=_+264|0,d=_+96|0,p=_,y=p,E=y+96|0;do u[y>>2]=0,y=y+4|0;while((y|0)<(E|0));return Ad(c,p),y=p,E=u[y>>2]|0,y=u[y+4>>2]|0,Rs(E,y,f),Os(E,y,d),x=+cA(f,d+8|0),N[f>>3]=+N[A>>3],y=f+8|0,N[y>>3]=+N[A+16>>3],N[d>>3]=+N[A+8>>3],E=d+8|0,N[E>>3]=+N[A+24>>3],I=+cA(f,d),E=~~+bi(+(I*I/+R_(+ +je(+((+N[y>>3]-+N[E>>3])/(+N[f>>3]-+N[d>>3]))),3)/(x*(x*2.59807621135)*.8))),k=_,((E|0)==0?1:E)|0}function uP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0;E=k,k=k+288|0,d=E+264|0,p=E+96|0,y=E,_=y,x=_+96|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(x|0));return Ad(f,y),x=y,_=u[x>>2]|0,x=u[x+4>>2]|0,Rs(_,x,d),Os(_,x,p),I=+cA(d,p+8|0),x=~~+bi(+(+cA(A,c)/(I*2))),k=E,((x|0)==0?1:x)|0}function fP(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0,u[A>>2]=c,u[A+4>>2]=f,u[A+8>>2]=d}function hP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0;G=c+8|0,u[G>>2]=0,x=+N[A>>3],_=+je(+x),I=+N[A+8>>3],E=+je(+I)/.8660254037844386,_=_+E*.5,f=~~_,A=~~E,_=_-+(f|0),E=E-+(A|0);do if(_<.5)if(_<.3333333333333333)if(u[c>>2]=f,E<(_+1)*.5){u[c+4>>2]=A;break}else{A=A+1|0,u[c+4>>2]=A;break}else if(W=1-_,A=(!(E<W)&1)+A|0,u[c+4>>2]=A,W<=E&E<_*2){f=f+1|0,u[c>>2]=f;break}else{u[c>>2]=f;break}else{if(!(_<.6666666666666666))if(f=f+1|0,u[c>>2]=f,E<_*.5){u[c+4>>2]=A;break}else{A=A+1|0,u[c+4>>2]=A;break}if(E<1-_){if(u[c+4>>2]=A,_*2+-1<E){u[c>>2]=f;break}}else A=A+1|0,u[c+4>>2]=A;f=f+1|0,u[c>>2]=f}while(0);do if(x<0)if(A&1){B=(A+1|0)/2|0,B=fA(f|0,((f|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-((+(B>>>0)+4294967296*+(V()|0))*2+1)),u[c>>2]=f;break}else{B=(A|0)/2|0,B=fA(f|0,((f|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-(+(B>>>0)+4294967296*+(V()|0))*2),u[c>>2]=f;break}while(0);B=c+4|0,I<0&&(f=f-((A<<1|1|0)/2|0)|0,u[c>>2]=f,A=0-A|0,u[B>>2]=A),d=A-f|0,(f|0)<0?(p=0-f|0,u[B>>2]=d,u[G>>2]=p,u[c>>2]=0,A=d,f=0):p=0,(A|0)<0&&(f=f-A|0,u[c>>2]=f,p=p-A|0,u[G>>2]=p,u[B>>2]=0,A=0),y=f-p|0,d=A-p|0,(p|0)<0&&(u[c>>2]=y,u[B>>2]=d,u[G>>2]=0,A=d,f=y,p=0),d=(A|0)<(f|0)?A:f,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[c>>2]=f-d,u[B>>2]=A-d,u[G>>2]=p-d)}function gn(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0;c=u[A>>2]|0,_=A+4|0,f=u[_>>2]|0,(c|0)<0&&(f=f-c|0,u[_>>2]=f,y=A+8|0,u[y>>2]=(u[y>>2]|0)-c,u[A>>2]=0,c=0),(f|0)<0?(c=c-f|0,u[A>>2]=c,y=A+8|0,p=(u[y>>2]|0)-f|0,u[y>>2]=p,u[_>>2]=0,f=0):(p=A+8|0,y=p,p=u[p>>2]|0),(p|0)<0&&(c=c-p|0,u[A>>2]=c,f=f-p|0,u[_>>2]=f,u[y>>2]=0,p=0),d=(f|0)<(c|0)?f:c,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[A>>2]=c-d,u[_>>2]=f-d,u[y>>2]=p-d)}function Is(A,c){A=A|0,c=c|0;var f=0,d=0;d=u[A+8>>2]|0,f=+((u[A+4>>2]|0)-d|0),N[c>>3]=+((u[A>>2]|0)-d|0)-f*.5,N[c+8>>3]=f*.8660254037844386}function Sn(A,c,f){A=A|0,c=c|0,f=f|0,u[f>>2]=(u[c>>2]|0)+(u[A>>2]|0),u[f+4>>2]=(u[c+4>>2]|0)+(u[A+4>>2]|0),u[f+8>>2]=(u[c+8>>2]|0)+(u[A+8>>2]|0)}function td(A,c,f){A=A|0,c=c|0,f=f|0,u[f>>2]=(u[A>>2]|0)-(u[c>>2]|0),u[f+4>>2]=(u[A+4>>2]|0)-(u[c+4>>2]|0),u[f+8>>2]=(u[A+8>>2]|0)-(u[c+8>>2]|0)}function o_(A,c){A=A|0,c=c|0;var f=0,d=0;f=nn(u[A>>2]|0,c)|0,u[A>>2]=f,f=A+4|0,d=nn(u[f>>2]|0,c)|0,u[f>>2]=d,A=A+8|0,c=nn(u[A>>2]|0,c)|0,u[A>>2]=c}function Cc(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;_=u[A>>2]|0,E=(_|0)<0,d=(u[A+4>>2]|0)-(E?_:0)|0,y=(d|0)<0,p=(y?0-d|0:0)+((u[A+8>>2]|0)-(E?_:0))|0,f=(p|0)<0,A=f?0:p,c=(y?0:d)-(f?p:0)|0,p=(E?0:_)-(y?d:0)-(f?p:0)|0,f=(c|0)<(p|0)?c:p,f=(A|0)<(f|0)?A:f,d=(f|0)>0,A=A-(d?f:0)|0,c=c-(d?f:0)|0;e:do switch(p-(d?f:0)|0){case 0:switch(c|0){case 0:return E=(A|0)==0?0:(A|0)==1?1:7,E|0;case 1:return E=(A|0)==0?2:(A|0)==1?3:7,E|0;default:break e}case 1:switch(c|0){case 0:return E=(A|0)==0?4:(A|0)==1?5:7,E|0;case 1:{if(!A)A=6;else break e;return A|0}default:break e}}while(0);return E=7,E|0}function a_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;_=A+8|0,f=u[_>>2]|0,c=(u[A>>2]|0)-f|0,E=A+4|0,f=(u[E>>2]|0)-f|0,d=Mc(+((c*3|0)-f|0)/7)|0,u[A>>2]=d,c=Mc(+((f<<1)+c|0)/7)|0,u[E>>2]=c,u[_>>2]=0,f=c-d|0,(d|0)<0?(y=0-d|0,u[E>>2]=f,u[_>>2]=y,u[A>>2]=0,c=f,d=0,f=y):f=0,(c|0)<0&&(d=d-c|0,u[A>>2]=d,f=f-c|0,u[_>>2]=f,u[E>>2]=0,c=0),y=d-f|0,p=c-f|0,(f|0)<0?(u[A>>2]=y,u[E>>2]=p,u[_>>2]=0,c=p,p=y,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[A>>2]=p-d,u[E>>2]=c-d,u[_>>2]=f-d)}function nd(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;_=A+8|0,f=u[_>>2]|0,c=(u[A>>2]|0)-f|0,E=A+4|0,f=(u[E>>2]|0)-f|0,d=Mc(+((c<<1)+f|0)/7)|0,u[A>>2]=d,c=Mc(+((f*3|0)-c|0)/7)|0,u[E>>2]=c,u[_>>2]=0,f=c-d|0,(d|0)<0?(y=0-d|0,u[E>>2]=f,u[_>>2]=y,u[A>>2]=0,c=f,d=0,f=y):f=0,(c|0)<0&&(d=d-c|0,u[A>>2]=d,f=f-c|0,u[_>>2]=f,u[E>>2]=0,c=0),y=d-f|0,p=c-f|0,(f|0)<0?(u[A>>2]=y,u[E>>2]=p,u[_>>2]=0,c=p,p=y,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[A>>2]=p-d,u[E>>2]=c-d,u[_>>2]=f-d)}function xc(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;c=u[A>>2]|0,_=A+4|0,f=u[_>>2]|0,E=A+8|0,d=u[E>>2]|0,p=f+(c*3|0)|0,u[A>>2]=p,f=d+(f*3|0)|0,u[_>>2]=f,c=(d*3|0)+c|0,u[E>>2]=c,d=f-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=d,u[E>>2]=c,u[A>>2]=0,f=d,d=0):d=p,(f|0)<0&&(d=d-f|0,u[A>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=d-c|0,p=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=p,u[E>>2]=0,d=y,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=d-f,u[_>>2]=p-f,u[E>>2]=c-f)}function Bs(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;p=u[A>>2]|0,_=A+4|0,c=u[_>>2]|0,E=A+8|0,f=u[E>>2]|0,d=(c*3|0)+p|0,p=f+(p*3|0)|0,u[A>>2]=p,u[_>>2]=d,c=(f*3|0)+c|0,u[E>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=f,u[E>>2]=c,u[A>>2]=0,p=0):f=d,(f|0)<0&&(p=p-f|0,u[A>>2]=p,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=p-c|0,d=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=d,u[E>>2]=0,p=y,c=0):d=f,f=(d|0)<(p|0)?d:p,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=p-f,u[_>>2]=d-f,u[E>>2]=c-f)}function A_(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0;(c+-1|0)>>>0>=6||(p=(u[15472+(c*12|0)>>2]|0)+(u[A>>2]|0)|0,u[A>>2]=p,E=A+4|0,d=(u[15472+(c*12|0)+4>>2]|0)+(u[E>>2]|0)|0,u[E>>2]=d,_=A+8|0,c=(u[15472+(c*12|0)+8>>2]|0)+(u[_>>2]|0)|0,u[_>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[E>>2]=f,u[_>>2]=c,u[A>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[A>>2]=d,c=c-f|0,u[_>>2]=c,u[E>>2]=0,f=0),y=d-c|0,p=f-c|0,(c|0)<0?(u[A>>2]=y,u[E>>2]=p,u[_>>2]=0,d=y,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=d-f,u[E>>2]=p-f,u[_>>2]=c-f))}function l_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;p=u[A>>2]|0,_=A+4|0,c=u[_>>2]|0,E=A+8|0,f=u[E>>2]|0,d=c+p|0,p=f+p|0,u[A>>2]=p,u[_>>2]=d,c=f+c|0,u[E>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=f,u[E>>2]=c,u[A>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[A>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=d-c|0,p=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=p,u[E>>2]=0,d=y,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=d-f,u[_>>2]=p-f,u[E>>2]=c-f)}function bc(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;c=u[A>>2]|0,_=A+4|0,d=u[_>>2]|0,E=A+8|0,f=u[E>>2]|0,p=d+c|0,u[A>>2]=p,d=f+d|0,u[_>>2]=d,c=f+c|0,u[E>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=f,u[E>>2]=c,u[A>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[A>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=d-c|0,p=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=p,u[E>>2]=0,d=y,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=d-f,u[_>>2]=p-f,u[E>>2]=c-f)}function Ls(A){switch(A=A|0,A|0){case 1:{A=5;break}case 5:{A=4;break}case 4:{A=6;break}case 6:{A=2;break}case 2:{A=3;break}case 3:{A=1;break}}return A|0}function Nr(A){switch(A=A|0,A|0){case 1:{A=3;break}case 3:{A=2;break}case 2:{A=6;break}case 6:{A=4;break}case 4:{A=5;break}case 5:{A=1;break}}return A|0}function c_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;c=u[A>>2]|0,_=A+4|0,f=u[_>>2]|0,E=A+8|0,d=u[E>>2]|0,p=f+(c<<1)|0,u[A>>2]=p,f=d+(f<<1)|0,u[_>>2]=f,c=(d<<1)+c|0,u[E>>2]=c,d=f-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=d,u[E>>2]=c,u[A>>2]=0,f=d,d=0):d=p,(f|0)<0&&(d=d-f|0,u[A>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=d-c|0,p=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=p,u[E>>2]=0,d=y,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=d-f,u[_>>2]=p-f,u[E>>2]=c-f)}function u_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;p=u[A>>2]|0,_=A+4|0,c=u[_>>2]|0,E=A+8|0,f=u[E>>2]|0,d=(c<<1)+p|0,p=f+(p<<1)|0,u[A>>2]=p,u[_>>2]=d,c=(f<<1)+c|0,u[E>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[_>>2]=f,u[E>>2]=c,u[A>>2]=0,p=0):f=d,(f|0)<0&&(p=p-f|0,u[A>>2]=p,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),y=p-c|0,d=f-c|0,(c|0)<0?(u[A>>2]=y,u[_>>2]=d,u[E>>2]=0,p=y,c=0):d=f,f=(d|0)<(p|0)?d:p,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[A>>2]=p-f,u[_>>2]=d-f,u[E>>2]=c-f)}function id(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0;return _=(u[A>>2]|0)-(u[c>>2]|0)|0,E=(_|0)<0,d=(u[A+4>>2]|0)-(u[c+4>>2]|0)-(E?_:0)|0,y=(d|0)<0,p=(E?0-_|0:0)+(u[A+8>>2]|0)-(u[c+8>>2]|0)+(y?0-d|0:0)|0,A=(p|0)<0,c=A?0:p,f=(y?0:d)-(A?p:0)|0,p=(E?0:_)-(y?d:0)-(A?p:0)|0,A=(f|0)<(p|0)?f:p,A=(c|0)<(A|0)?c:A,d=(A|0)>0,c=c-(d?A:0)|0,f=f-(d?A:0)|0,A=p-(d?A:0)|0,A=(A|0)>-1?A:0-A|0,f=(f|0)>-1?f:0-f|0,c=(c|0)>-1?c:0-c|0,c=(f|0)>(c|0)?f:c,((A|0)>(c|0)?A:c)|0}function dP(A,c){A=A|0,c=c|0;var f=0;f=u[A+8>>2]|0,u[c>>2]=(u[A>>2]|0)-f,u[c+4>>2]=(u[A+4>>2]|0)-f}function gP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0;d=u[A>>2]|0,u[c>>2]=d,A=u[A+4>>2]|0,_=c+4|0,u[_>>2]=A,E=c+8|0,u[E>>2]=0,f=A-d|0,(d|0)<0?(A=0-d|0,u[_>>2]=f,u[E>>2]=A,u[c>>2]=0,d=0):(f=A,A=0),(f|0)<0&&(d=d-f|0,u[c>>2]=d,A=A-f|0,u[E>>2]=A,u[_>>2]=0,f=0),y=d-A|0,p=f-A|0,(A|0)<0?(u[c>>2]=y,u[_>>2]=p,u[E>>2]=0,f=p,p=y,A=0):p=d,d=(f|0)<(p|0)?f:p,d=(A|0)<(d|0)?A:d,!((d|0)<=0)&&(u[c>>2]=p-d,u[_>>2]=f-d,u[E>>2]=A-d)}function f_(A){A=A|0;var c=0,f=0,d=0,p=0;c=A+8|0,p=u[c>>2]|0,f=p-(u[A>>2]|0)|0,u[A>>2]=f,d=A+4|0,A=(u[d>>2]|0)-p|0,u[d>>2]=A,u[c>>2]=0-(A+f)}function pP(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;f=u[A>>2]|0,c=0-f|0,u[A>>2]=c,_=A+8|0,u[_>>2]=0,E=A+4|0,d=u[E>>2]|0,p=d+f|0,(f|0)>0?(u[E>>2]=p,u[_>>2]=f,u[A>>2]=0,c=0,d=p):f=0,(d|0)<0?(y=c-d|0,u[A>>2]=y,f=f-d|0,u[_>>2]=f,u[E>>2]=0,p=y-f|0,c=0-f|0,(f|0)<0?(u[A>>2]=p,u[E>>2]=c,u[_>>2]=0,d=c,f=0):(d=0,p=y)):p=c,c=(d|0)<(p|0)?d:p,c=(f|0)<(c|0)?f:c,!((c|0)<=0)&&(u[A>>2]=p-c,u[E>>2]=d-c,u[_>>2]=f-c)}function mP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;d=k,k=k+16|0,p=d,_P(A,c,f,p),hP(p,f+4|0),k=d}function _P(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0;if(x=k,k=k+32|0,y=x,mM(A,y),u[f>>2]=0,p=+Vt(15888,y),_=+Vt(15912,y),_<p&&(u[f>>2]=1,p=_),_=+Vt(15936,y),_<p&&(u[f>>2]=2,p=_),_=+Vt(15960,y),_<p&&(u[f>>2]=3,p=_),_=+Vt(15984,y),_<p&&(u[f>>2]=4,p=_),_=+Vt(16008,y),_<p&&(u[f>>2]=5,p=_),_=+Vt(16032,y),_<p&&(u[f>>2]=6,p=_),_=+Vt(16056,y),_<p&&(u[f>>2]=7,p=_),_=+Vt(16080,y),_<p&&(u[f>>2]=8,p=_),_=+Vt(16104,y),_<p&&(u[f>>2]=9,p=_),_=+Vt(16128,y),_<p&&(u[f>>2]=10,p=_),_=+Vt(16152,y),_<p&&(u[f>>2]=11,p=_),_=+Vt(16176,y),_<p&&(u[f>>2]=12,p=_),_=+Vt(16200,y),_<p&&(u[f>>2]=13,p=_),_=+Vt(16224,y),_<p&&(u[f>>2]=14,p=_),_=+Vt(16248,y),_<p&&(u[f>>2]=15,p=_),_=+Vt(16272,y),_<p&&(u[f>>2]=16,p=_),_=+Vt(16296,y),_<p&&(u[f>>2]=17,p=_),_=+Vt(16320,y),_<p&&(u[f>>2]=18,p=_),_=+Vt(16344,y),_<p&&(u[f>>2]=19,p=_),_=+Yi(+(1-p*.5)),_<1e-16){u[d>>2]=0,u[d+4>>2]=0,u[d+8>>2]=0,u[d+12>>2]=0,k=x;return}if(f=u[f>>2]|0,p=+N[16368+(f*24|0)>>3],p=+lA(p-+lA(+TP(15568+(f<<4)|0,A))),fi(c)|0?E=+lA(p+-.3334731722518321):E=p,p=+kt(+_)/.381966011250105,(c|0)>0){y=0;do p=p*2.6457513110645907,y=y+1|0;while((y|0)!=(c|0))}_=+et(+E)*p,N[d>>3]=_,E=+Ye(+E)*p,N[d+8>>3]=E,k=x}function AA(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0;if(y=+pM(A),y<1e-16){c=15568+(c<<4)|0,u[p>>2]=u[c>>2],u[p+4>>2]=u[c+4>>2],u[p+8>>2]=u[c+8>>2],u[p+12>>2]=u[c+12>>2];return}if(_=+Tt(+ +N[A+8>>3],+ +N[A>>3]),(f|0)>0){A=0;do y=y/2.6457513110645907,A=A+1|0;while((A|0)!=(f|0))}d?(y=y/3,f=(fi(f)|0)==0,y=+kr(+((f?y:y/2.6457513110645907)*.381966011250105))):(y=+kr(+(y*.381966011250105)),fi(f)|0&&(_=+lA(_+.3334731722518321))),CP(15568+(c<<4)|0,+lA(+N[16368+(c*24|0)>>3]-_),y,p)}function yP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;d=k,k=k+16|0,p=d,Is(A+4|0,p),AA(p,u[A>>2]|0,c,0,f),k=d}function h_(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0,Ue=0,ct=0,at=0,gt=0,rt=0,mt=0,_t=0,ke=0;if(mt=k,k=k+272|0,y=mt+256|0,$=mt+240|0,at=mt,gt=mt+224|0,rt=mt+208|0,fe=mt+176|0,Q=mt+160|0,Se=mt+192|0,Me=mt+144|0,ye=mt+128|0,Te=mt+112|0,Ue=mt+96|0,ct=mt+80|0,u[y>>2]=c,u[$>>2]=u[A>>2],u[$+4>>2]=u[A+4>>2],u[$+8>>2]=u[A+8>>2],u[$+12>>2]=u[A+12>>2],d_($,y,at),u[p>>2]=0,$=d+f+((d|0)==5&1)|0,($|0)<=(f|0)){k=mt;return}x=u[y>>2]|0,I=gt+4|0,B=fe+4|0,G=f+5|0,W=16848+(x<<2)|0,J=16928+(x<<2)|0,ie=ye+8|0,se=Te+8|0,pe=Ue+8|0,be=rt+4|0,E=f;e:for(;;){_=at+(((E|0)%5|0)<<4)|0,u[rt>>2]=u[_>>2],u[rt+4>>2]=u[_+4>>2],u[rt+8>>2]=u[_+8>>2],u[rt+12>>2]=u[_+12>>2];do;while((Po(rt,x,0,1)|0)==2);if((E|0)>(f|0)&(fi(c)|0)!=0){if(u[fe>>2]=u[rt>>2],u[fe+4>>2]=u[rt+4>>2],u[fe+8>>2]=u[rt+8>>2],u[fe+12>>2]=u[rt+12>>2],Is(I,Q),d=u[fe>>2]|0,y=u[17008+(d*80|0)+(u[gt>>2]<<2)>>2]|0,u[fe>>2]=u[18608+(d*80|0)+(y*20|0)>>2],_=u[18608+(d*80|0)+(y*20|0)+16>>2]|0,(_|0)>0){A=0;do l_(B),A=A+1|0;while((A|0)<(_|0))}switch(_=18608+(d*80|0)+(y*20|0)+4|0,u[Se>>2]=u[_>>2],u[Se+4>>2]=u[_+4>>2],u[Se+8>>2]=u[_+8>>2],o_(Se,(u[W>>2]|0)*3|0),Sn(B,Se,B),gn(B),Is(B,Me),_t=+(u[J>>2]|0),N[ye>>3]=_t*3,N[ie>>3]=0,ke=_t*-1.5,N[Te>>3]=ke,N[se>>3]=_t*2.598076211353316,N[Ue>>3]=ke,N[pe>>3]=_t*-2.598076211353316,u[17008+((u[fe>>2]|0)*80|0)+(u[rt>>2]<<2)>>2]|0){case 1:{A=Te,d=ye;break}case 3:{A=Ue,d=Te;break}case 2:{A=ye,d=Ue;break}default:{A=12;break e}}b_(Q,Me,d,A,ct),AA(ct,u[fe>>2]|0,x,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1}if((E|0)<(G|0)&&(Is(be,fe),AA(fe,u[rt>>2]|0,x,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),u[gt>>2]=u[rt>>2],u[gt+4>>2]=u[rt+4>>2],u[gt+8>>2]=u[rt+8>>2],u[gt+12>>2]=u[rt+12>>2],E=E+1|0,(E|0)>=($|0)){A=3;break}}if((A|0)==3){k=mt;return}else(A|0)==12&&it(22474,22521,581,22531)}function d_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0;x=k,k=k+128|0,d=x+64|0,p=x,y=d,_=20208,E=y+60|0;do u[y>>2]=u[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(E|0));y=p,_=20272,E=y+60|0;do u[y>>2]=u[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(E|0));E=(fi(u[c>>2]|0)|0)==0,d=E?d:p,p=A+4|0,c_(p),u_(p),fi(u[c>>2]|0)|0&&(Bs(p),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[A>>2],c=f+4|0,Sn(p,d,c),gn(c),u[f+16>>2]=u[A>>2],c=f+20|0,Sn(p,d+12|0,c),gn(c),u[f+32>>2]=u[A>>2],c=f+36|0,Sn(p,d+24|0,c),gn(c),u[f+48>>2]=u[A>>2],c=f+52|0,Sn(p,d+36|0,c),gn(c),u[f+64>>2]=u[A>>2],f=f+68|0,Sn(p,d+48|0,f),gn(f),k=x}function Po(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0;if(ie=k,k=k+32|0,W=ie+12|0,E=ie,J=A+4|0,G=u[16928+(c<<2)>>2]|0,B=(d|0)!=0,G=B?G*3|0:G,p=u[J>>2]|0,I=A+8|0,_=u[I>>2]|0,B){if(y=A+12|0,d=u[y>>2]|0,p=_+p+d|0,(p|0)==(G|0))return J=1,k=ie,J|0;x=y}else x=A+12|0,d=u[x>>2]|0,p=_+p+d|0;if((p|0)<=(G|0))return J=0,k=ie,J|0;do if((d|0)>0){if(d=u[A>>2]|0,(_|0)>0){y=18608+(d*80|0)+60|0,d=A;break}d=18608+(d*80|0)+40|0,f?(fP(W,G,0,0),td(J,W,E),bc(E),Sn(E,W,J),y=d,d=A):(y=d,d=A)}else y=18608+((u[A>>2]|0)*80|0)+20|0,d=A;while(0);if(u[d>>2]=u[y>>2],p=y+16|0,(u[p>>2]|0)>0){d=0;do l_(J),d=d+1|0;while((d|0)<(u[p>>2]|0))}return A=y+4|0,u[W>>2]=u[A>>2],u[W+4>>2]=u[A+4>>2],u[W+8>>2]=u[A+8>>2],c=u[16848+(c<<2)>>2]|0,o_(W,B?c*3|0:c),Sn(J,W,J),gn(J),B?d=((u[I>>2]|0)+(u[J>>2]|0)+(u[x>>2]|0)|0)==(G|0)?1:2:d=2,J=d,k=ie,J|0}function vP(A,c){A=A|0,c=c|0;var f=0;do f=Po(A,c,0,1)|0;while((f|0)==2);return f|0}function g_(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0,Ue=0,ct=0,at=0;if(Ue=k,k=k+240|0,y=Ue+224|0,Se=Ue+208|0,Me=Ue,ye=Ue+192|0,Te=Ue+176|0,pe=Ue+160|0,be=Ue+144|0,$=Ue+128|0,fe=Ue+112|0,Q=Ue+96|0,u[y>>2]=c,u[Se>>2]=u[A>>2],u[Se+4>>2]=u[A+4>>2],u[Se+8>>2]=u[A+8>>2],u[Se+12>>2]=u[A+12>>2],p_(Se,y,Me),u[p>>2]=0,se=d+f+((d|0)==6&1)|0,(se|0)<=(f|0)){k=Ue;return}x=u[y>>2]|0,I=f+6|0,B=16928+(x<<2)|0,G=be+8|0,W=$+8|0,J=fe+8|0,ie=ye+4|0,_=0,E=f,d=-1;e:for(;;){if(y=(E|0)%6|0,A=Me+(y<<4)|0,u[ye>>2]=u[A>>2],u[ye+4>>2]=u[A+4>>2],u[ye+8>>2]=u[A+8>>2],u[ye+12>>2]=u[A+12>>2],A=_,_=Po(ye,x,0,1)|0,(E|0)>(f|0)&(fi(c)|0)!=0&&(A|0)!=1&&(u[ye>>2]|0)!=(d|0)){switch(Is(Me+(((y+5|0)%6|0)<<4)+4|0,Te),Is(Me+(y<<4)+4|0,pe),ct=+(u[B>>2]|0),N[be>>3]=ct*3,N[G>>3]=0,at=ct*-1.5,N[$>>3]=at,N[W>>3]=ct*2.598076211353316,N[fe>>3]=at,N[J>>3]=ct*-2.598076211353316,y=u[Se>>2]|0,u[17008+(y*80|0)+(((d|0)==(y|0)?u[ye>>2]|0:d)<<2)>>2]|0){case 1:{A=$,d=be;break}case 3:{A=fe,d=$;break}case 2:{A=be,d=fe;break}default:{A=8;break e}}b_(Te,pe,d,A,Q),!(S_(Te,Q)|0)&&!(S_(pe,Q)|0)&&(AA(Q,u[Se>>2]|0,x,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1)}if((E|0)<(I|0)&&(Is(ie,Te),AA(Te,u[ye>>2]|0,x,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),E=E+1|0,(E|0)>=(se|0)){A=3;break}else d=u[ye>>2]|0}if((A|0)==3){k=Ue;return}else(A|0)==8&&it(22557,22521,746,22602)}function p_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0;x=k,k=k+160|0,d=x+80|0,p=x,y=d,_=20336,E=y+72|0;do u[y>>2]=u[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(E|0));y=p,_=20416,E=y+72|0;do u[y>>2]=u[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(E|0));E=(fi(u[c>>2]|0)|0)==0,d=E?d:p,p=A+4|0,c_(p),u_(p),fi(u[c>>2]|0)|0&&(Bs(p),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[A>>2],c=f+4|0,Sn(p,d,c),gn(c),u[f+16>>2]=u[A>>2],c=f+20|0,Sn(p,d+12|0,c),gn(c),u[f+32>>2]=u[A>>2],c=f+36|0,Sn(p,d+24|0,c),gn(c),u[f+48>>2]=u[A>>2],c=f+52|0,Sn(p,d+36|0,c),gn(c),u[f+64>>2]=u[A>>2],c=f+68|0,Sn(p,d+48|0,c),gn(c),u[f+80>>2]=u[A>>2],f=f+84|0,Sn(p,d+60|0,f),gn(f),k=x}function lA(A){A=+A;var c=0;return c=A<0?A+6.283185307179586:A,+(A>=6.283185307179586?c+-6.283185307179586:c)}function Mo(A,c){return A=A|0,c=c|0,+je(+(+N[A>>3]-+N[c>>3]))<17453292519943298e-27?(c=+je(+(+N[A+8>>3]-+N[c+8>>3]))<17453292519943298e-27,c|0):(c=0,c|0)}function EP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0;return p=+N[c>>3],d=+N[A>>3],y=+Ye(+((p-d)*.5)),f=+Ye(+((+N[c+8>>3]-+N[A+8>>3])*.5)),f=y*y+f*(+et(+p)*+et(+d)*f),+(+Tt(+ +Qe(+f),+ +Qe(+(1-f)))*2)}function cA(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0;return p=+N[c>>3],d=+N[A>>3],y=+Ye(+((p-d)*.5)),f=+Ye(+((+N[c+8>>3]-+N[A+8>>3])*.5)),f=y*y+f*(+et(+p)*+et(+d)*f),+(+Tt(+ +Qe(+f),+ +Qe(+(1-f)))*2*6371.007180918475)}function wP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0;return p=+N[c>>3],d=+N[A>>3],y=+Ye(+((p-d)*.5)),f=+Ye(+((+N[c+8>>3]-+N[A+8>>3])*.5)),f=y*y+f*(+et(+p)*+et(+d)*f),+(+Tt(+ +Qe(+f),+ +Qe(+(1-f)))*2*6371.007180918475*1e3)}function TP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;return y=+N[c>>3],d=+et(+y),p=+N[c+8>>3]-+N[A+8>>3],_=d*+Ye(+p),f=+N[A>>3],+ +Tt(+_,+(+Ye(+y)*+et(+f)-+et(+p)*(d*+Ye(+f))))}function CP(A,c,f,d){A=A|0,c=+c,f=+f,d=d|0;var p=0,y=0,_=0,E=0;if(f<1e-16){u[d>>2]=u[A>>2],u[d+4>>2]=u[A+4>>2],u[d+8>>2]=u[A+8>>2],u[d+12>>2]=u[A+12>>2];return}y=c<0?c+6.283185307179586:c,y=c>=6.283185307179586?y+-6.283185307179586:y;do if(y<1e-16)c=+N[A>>3]+f,N[d>>3]=c,p=d;else{if(p=+je(+(y+-3.141592653589793))<1e-16,c=+N[A>>3],p){c=c-f,N[d>>3]=c,p=d;break}if(_=+et(+f),f=+Ye(+f),c=_*+Ye(+c)+ +et(+y)*(f*+et(+c)),c=c>1?1:c,c=+To(+(c<-1?-1:c)),N[d>>3]=c,+je(+(c+-1.5707963267948966))<1e-16){N[d>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+je(+(c+1.5707963267948966))<1e-16){N[d>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(E=+et(+c),y=f*+Ye(+y)/E,f=+N[A>>3],c=(_-+Ye(+c)*+Ye(+f))/+et(+f)/E,_=y>1?1:y,c=c>1?1:c,c=+N[A+8>>3]+ +Tt(+(_<-1?-1:_),+(c<-1?-1:c)),c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);N[d+8>>3]=c;return}while(0);if(+je(+(c+-1.5707963267948966))<1e-16){N[p>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+je(+(c+1.5707963267948966))<1e-16){N[p>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(c=+N[A+8>>3],c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);N[d+8>>3]=c}function xP(A){return A=A|0,+ +N[20496+(A<<3)>>3]}function bP(A){return A=A|0,+ +N[20624+(A<<3)>>3]}function SP(A){return A=A|0,+ +N[20752+(A<<3)>>3]}function PP(A){return A=A|0,+ +N[20880+(A<<3)>>3]}function MP(A){A=A|0;var c=0;return c=21008+(A<<3)|0,A=u[c>>2]|0,Re(u[c+4>>2]|0),A|0}function Io(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0;return W=+N[c>>3],B=+N[A>>3],x=+Ye(+((W-B)*.5)),y=+N[c+8>>3],I=+N[A+8>>3],_=+Ye(+((y-I)*.5)),E=+et(+B),G=+et(+W),_=x*x+_*(G*E*_),_=+Tt(+ +Qe(+_),+ +Qe(+(1-_)))*2,x=+N[f>>3],W=+Ye(+((x-W)*.5)),d=+N[f+8>>3],y=+Ye(+((d-y)*.5)),p=+et(+x),y=W*W+y*(G*p*y),y=+Tt(+ +Qe(+y),+ +Qe(+(1-y)))*2,x=+Ye(+((B-x)*.5)),d=+Ye(+((I-d)*.5)),d=x*x+d*(E*p*d),d=+Tt(+ +Qe(+d),+ +Qe(+(1-d)))*2,p=(_+y+d)*.5,+(+kr(+ +Qe(+(+kt(+(p*.5))*+kt(+((p-_)*.5))*+kt(+((p-y)*.5))*+kt(+((p-d)*.5)))))*4)}function IP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;if(y=k,k=k+192|0,d=y+168|0,p=y,Rs(A,c,d),Os(A,c,p),c=u[p>>2]|0,(c|0)<=0)return f=0,k=y,+f;if(f=+Io(p+8|0,p+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)==1)return k=y,+f;A=1;do _=A,A=A+1|0,f=f+ +Io(p+8+(_<<4)|0,p+8+(((A|0)%(c|0)|0)<<4)|0,d);while((A|0)<(c|0));return k=y,+f}function BP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;if(y=k,k=k+192|0,d=y+168|0,p=y,Rs(A,c,d),Os(A,c,p),c=u[p>>2]|0,(c|0)>0){if(f=+Io(p+8|0,p+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)!=1){A=1;do _=A,A=A+1|0,f=f+ +Io(p+8+(_<<4)|0,p+8+(((A|0)%(c|0)|0)<<4)|0,d);while((A|0)<(c|0))}}else f=0;return k=y,+(f*6371.007180918475*6371.007180918475)}function LP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;if(y=k,k=k+192|0,d=y+168|0,p=y,Rs(A,c,d),Os(A,c,p),c=u[p>>2]|0,(c|0)>0){if(f=+Io(p+8|0,p+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)!=1){A=1;do _=A,A=A+1|0,f=f+ +Io(p+8+(_<<4)|0,p+8+(((A|0)%(c|0)|0)<<4)|0,d);while((A|0)<(c|0))}}else f=0;return k=y,+(f*6371.007180918475*6371.007180918475*1e3*1e3)}function RP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0;if(_=k,k=k+176|0,y=_,Sc(A,c,y),A=u[y>>2]|0,(A|0)<=1)return p=0,k=_,+p;c=A+-1|0,A=0,f=0,d=+N[y+8>>3],p=+N[y+16>>3];do A=A+1|0,x=d,d=+N[y+8+(A<<4)>>3],I=+Ye(+((d-x)*.5)),E=p,p=+N[y+8+(A<<4)+8>>3],E=+Ye(+((p-E)*.5)),E=I*I+E*(+et(+d)*+et(+x)*E),f=f+ +Tt(+ +Qe(+E),+ +Qe(+(1-E)))*2;while((A|0)<(c|0));return k=_,+f}function OP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0;if(_=k,k=k+176|0,y=_,Sc(A,c,y),A=u[y>>2]|0,(A|0)<=1)return p=0,k=_,+p;c=A+-1|0,A=0,f=0,d=+N[y+8>>3],p=+N[y+16>>3];do A=A+1|0,x=d,d=+N[y+8+(A<<4)>>3],I=+Ye(+((d-x)*.5)),E=p,p=+N[y+8+(A<<4)+8>>3],E=+Ye(+((p-E)*.5)),E=I*I+E*(+et(+x)*+et(+d)*E),f=f+ +Tt(+ +Qe(+E),+ +Qe(+(1-E)))*2;while((A|0)!=(c|0));return I=f*6371.007180918475,k=_,+I}function FP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0;if(_=k,k=k+176|0,y=_,Sc(A,c,y),A=u[y>>2]|0,(A|0)<=1)return p=0,k=_,+p;c=A+-1|0,A=0,f=0,d=+N[y+8>>3],p=+N[y+16>>3];do A=A+1|0,x=d,d=+N[y+8+(A<<4)>>3],I=+Ye(+((d-x)*.5)),E=p,p=+N[y+8+(A<<4)+8>>3],E=+Ye(+((p-E)*.5)),E=I*I+E*(+et(+x)*+et(+d)*E),f=f+ +Tt(+ +Qe(+E),+ +Qe(+(1-E)))*2;while((A|0)!=(c|0));return I=f*6371.007180918475*1e3,k=_,+I}function DP(A,c){return A=A|0,c=c|0,c=ge(A|0,c|0,52)|0,V()|0,c&15|0}function m_(A,c){return A=A|0,c=c|0,c=ge(A|0,c|0,45)|0,V()|0,c&127|0}function __(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0;if(!(!0&(c&-16777216|0)==134217728)||(_=ge(A|0,c|0,45)|0,V()|0,_=_&127,_>>>0>121))return c=0,c|0;f=ge(A|0,c|0,52)|0,V()|0,f=f&15;do if(f|0){for(p=1,d=0;;){if(y=ge(A|0,c|0,(15-p|0)*3|0)|0,V()|0,y=y&7,(y|0)!=0&(d^1))if((y|0)==1&(Ve(_)|0)!=0){E=0,d=13;break}else d=1;if((y|0)==7){E=0,d=13;break}if(p>>>0<f>>>0)p=p+1|0;else{d=9;break}}if((d|0)==9){if((f|0)==15)E=1;else break;return E|0}else if((d|0)==13)return E|0}while(0);for(;;){if(E=ge(A|0,c|0,(14-f|0)*3|0)|0,V()|0,!((E&7|0)==7&!0)){E=0,d=13;break}if(f>>>0<14)f=f+1|0;else{E=1,d=13;break}}return(d|0)==13?E|0:0}function rd(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,(d|0)>=(f|0)){if((d|0)!=(f|0))if(f>>>0<=15){if(p=Ce(f|0,0,52)|0,A=p|A,c=V()|0|c&-15728641,(d|0)>(f|0))do p=Ce(7,0,(14-f|0)*3|0)|0,f=f+1|0,A=p|A,c=V()|0|c;while((f|0)<(d|0))}else c=0,A=0}else c=0,A=0;return Re(c|0),A|0}function kP(A,c,f){return A=A|0,c=c|0,f=f|0,A=ge(A|0,c|0,52)|0,V()|0,A=A&15,(f|0)<16&(A|0)<=(f|0)?(f=Pc(7,f-A|0)|0,f|0):(f=0,f|0)}function On(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0;if(_=ge(A|0,c|0,52)|0,V()|0,_=_&15,!!((f|0)<16&(_|0)<=(f|0))){if((_|0)==(f|0)){f=d,u[f>>2]=A,u[f+4>>2]=c;return}if(x=Pc(7,f-_|0)|0,I=(x|0)/7|0,E=ge(A|0,c|0,45)|0,V()|0,!(Ve(E&127)|0))y=0;else{e:do if(!_)p=0;else for(y=1;;){if(p=ge(A|0,c|0,(15-y|0)*3|0)|0,V()|0,p=p&7,p|0)break e;if(y>>>0<_>>>0)y=y+1|0;else{p=0;break}}while(0);y=(p|0)==0}if(B=Ce(_+1|0,0,52)|0,p=V()|0|c&-15728641,E=(14-_|0)*3|0,c=Ce(7,0,E|0)|0,c=(B|A)&~c,_=p&~(V()|0),On(c,_,f,d),p=d+(I<<3)|0,!y){B=Ce(1,0,E|0)|0,On(B|c,V()|0|_,f,p),B=p+(I<<3)|0,x=Ce(2,0,E|0)|0,On(x|c,V()|0|_,f,B),B=B+(I<<3)|0,x=Ce(3,0,E|0)|0,On(x|c,V()|0|_,f,B),B=B+(I<<3)|0,x=Ce(4,0,E|0)|0,On(x|c,V()|0|_,f,B),B=B+(I<<3)|0,x=Ce(5,0,E|0)|0,On(x|c,V()|0|_,f,B),x=Ce(6,0,E|0)|0,On(x|c,V()|0|_,f,B+(I<<3)|0);return}y=p+(I<<3)|0,(x|0)>6&&(x=p+8|0,B=(y>>>0>x>>>0?y:x)+-1+(0-p)|0,Ii(p|0,0,B+8&-8|0)|0,p=x+(B>>>3<<3)|0),B=Ce(2,0,E|0)|0,On(B|c,V()|0|_,f,p),B=p+(I<<3)|0,x=Ce(3,0,E|0)|0,On(x|c,V()|0|_,f,B),B=B+(I<<3)|0,x=Ce(4,0,E|0)|0,On(x|c,V()|0|_,f,B),B=B+(I<<3)|0,x=Ce(5,0,E|0)|0,On(x|c,V()|0|_,f,B),x=Ce(6,0,E|0)|0,On(x|c,V()|0|_,f,B+(I<<3)|0)}}function Xt(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;if(p=ge(A|0,c|0,45)|0,V()|0,!(Ve(p&127)|0))return p=0,p|0;p=ge(A|0,c|0,52)|0,V()|0,p=p&15;e:do if(!p)f=0;else for(d=1;;){if(f=ge(A|0,c|0,(15-d|0)*3|0)|0,V()|0,f=f&7,f|0)break e;if(d>>>0<p>>>0)d=d+1|0;else{f=0;break}}while(0);return p=(f|0)==0&1,p|0}function NP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,(f|0)<16&(d|0)<=(f|0)){if((d|0)!=(f|0)&&(p=Ce(f|0,0,52)|0,A=p|A,c=V()|0|c&-15728641,(d|0)<(f|0)))do p=Ce(7,0,(14-d|0)*3|0)|0,d=d+1|0,A=A&~p,c=c&~(V()|0);while((d|0)<(f|0))}else c=0,A=0;return Re(c|0),A|0}function UP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0;if(!f)return ye=0,ye|0;if(p=A,d=u[p>>2]|0,p=u[p+4>>2]|0,!0&(p&15728640|0)==0){if((f|0)<=0||(ye=c,u[ye>>2]=d,u[ye+4>>2]=p,(f|0)==1))return ye=0,ye|0;d=1;do Se=A+(d<<3)|0,Me=u[Se+4>>2]|0,ye=c+(d<<3)|0,u[ye>>2]=u[Se>>2],u[ye+4>>2]=Me,d=d+1|0;while((d|0)!=(f|0));return d=0,d|0}if(Se=f<<3,Me=Ki(Se)|0,!Me)return ye=-3,ye|0;if(Bc(Me|0,A|0,Se|0)|0,Q=Mi(f,8)|0,!Q)return He(Me),ye=-3,ye|0;d=f;e:for(;;){_=Me,B=u[_>>2]|0,_=u[_+4>>2]|0,$=ge(B|0,_|0,52)|0,V()|0,$=$&15,fe=$+-1|0,be=(d|0)>0;t:do if(be){if(pe=((d|0)<0)<<31>>31,ie=Ce(fe|0,0,52)|0,se=V()|0,fe>>>0>15)for(p=0,A=B,f=_;;){if(!((A|0)==0&(f|0)==0)){if(y=ge(A|0,f|0,52)|0,V()|0,y=y&15,E=(y|0)<(fe|0),y=(y|0)==(fe|0),I=E?0:y?A:0,A=E?0:y?f:0,f=Gr(I|0,A|0,d|0,pe|0)|0,V()|0,y=Q+(f<<3)|0,E=y,x=u[E>>2]|0,E=u[E+4>>2]|0,(x|0)==0&(E|0)==0)f=I;else for(ie=0,J=f,W=E,f=I;;){if((ie|0)>(d|0)){ye=41;break e}if((x|0)==(f|0)&(W&-117440513|0)==(A|0)){I=ge(x|0,W|0,56)|0,V()|0,I=I&7,G=I+1|0,se=ge(x|0,W|0,45)|0,V()|0;n:do if(!(Ve(se&127)|0))E=7;else{if(x=ge(x|0,W|0,52)|0,V()|0,x=x&15,!x){E=6;break}for(E=1;;){if(se=Ce(7,0,(15-E|0)*3|0)|0,!((se&f|0)==0&((V()|0)&A|0)==0)){E=7;break n}if(E>>>0<x>>>0)E=E+1|0;else{E=6;break}}}while(0);if((I+2|0)>>>0>E>>>0){ye=51;break e}se=Ce(G|0,0,56)|0,A=V()|0|A&-117440513,E=y,u[E>>2]=0,u[E+4>>2]=0,E=J,f=se|f}else E=(J+1|0)%(d|0)|0;if(y=Q+(E<<3)|0,W=y,x=u[W>>2]|0,W=u[W+4>>2]|0,(x|0)==0&(W|0)==0)break;ie=ie+1|0,J=E}se=y,u[se>>2]=f,u[se+4>>2]=A}if(p=p+1|0,(p|0)>=(d|0))break t;f=Me+(p<<3)|0,A=u[f>>2]|0,f=u[f+4>>2]|0}for(p=0,A=B,f=_;;){if(!((A|0)==0&(f|0)==0)){if(E=ge(A|0,f|0,52)|0,V()|0,E=E&15,(E|0)>=(fe|0)){if((E|0)!=(fe|0)&&(A=A|ie,f=f&-15728641|se,E>>>0>=$>>>0)){y=fe;do J=Ce(7,0,(14-y|0)*3|0)|0,y=y+1|0,A=J|A,f=V()|0|f;while(y>>>0<E>>>0)}}else A=0,f=0;if(E=Gr(A|0,f|0,d|0,pe|0)|0,V()|0,y=Q+(E<<3)|0,x=y,I=u[x>>2]|0,x=u[x+4>>2]|0,!((I|0)==0&(x|0)==0))for(J=0;;){if((J|0)>(d|0)){ye=41;break e}if((I|0)==(A|0)&(x&-117440513|0)==(f|0)){G=ge(I|0,x|0,56)|0,V()|0,G=G&7,W=G+1|0,Te=ge(I|0,x|0,45)|0,V()|0;n:do if(!(Ve(Te&127)|0))x=7;else{if(I=ge(I|0,x|0,52)|0,V()|0,I=I&15,!I){x=6;break}for(x=1;;){if(Te=Ce(7,0,(15-x|0)*3|0)|0,!((Te&A|0)==0&((V()|0)&f|0)==0)){x=7;break n}if(x>>>0<I>>>0)x=x+1|0;else{x=6;break}}}while(0);if((G+2|0)>>>0>x>>>0){ye=51;break e}Te=Ce(W|0,0,56)|0,f=V()|0|f&-117440513,W=y,u[W>>2]=0,u[W+4>>2]=0,A=Te|A}else E=(E+1|0)%(d|0)|0;if(y=Q+(E<<3)|0,x=y,I=u[x>>2]|0,x=u[x+4>>2]|0,(I|0)==0&(x|0)==0)break;J=J+1|0}Te=y,u[Te>>2]=A,u[Te+4>>2]=f}if(p=p+1|0,(p|0)>=(d|0))break t;f=Me+(p<<3)|0,A=u[f>>2]|0,f=u[f+4>>2]|0}}while(0);if((d+5|0)>>>0<11){ye=99;break}if(se=Mi((d|0)/6|0,8)|0,!se){ye=58;break}t:do if(be){J=0,W=0;do{if(E=Q+(J<<3)|0,A=E,p=u[A>>2]|0,A=u[A+4>>2]|0,!((p|0)==0&(A|0)==0)){x=ge(p|0,A|0,56)|0,V()|0,x=x&7,f=x+1|0,I=A&-117440513,Te=ge(p|0,A|0,45)|0,V()|0;n:do if(Ve(Te&127)|0){if(G=ge(p|0,A|0,52)|0,V()|0,G=G&15,G|0)for(y=1;;){if(Te=Ce(7,0,(15-y|0)*3|0)|0,!((p&Te|0)==0&(I&(V()|0)|0)==0))break n;if(y>>>0<G>>>0)y=y+1|0;else break}A=Ce(f|0,0,56)|0,p=A|p,A=V()|0|I,f=E,u[f>>2]=p,u[f+4>>2]=A,f=x+2|0}while(0);(f|0)==7&&(Te=se+(W<<3)|0,u[Te>>2]=p,u[Te+4>>2]=A&-117440513,W=W+1|0)}J=J+1|0}while((J|0)!=(d|0));if(be){if(ie=((d|0)<0)<<31>>31,G=Ce(fe|0,0,52)|0,J=V()|0,fe>>>0>15)for(A=0,p=0;;){do if(!((B|0)==0&(_|0)==0)){for(x=ge(B|0,_|0,52)|0,V()|0,x=x&15,y=(x|0)<(fe|0),x=(x|0)==(fe|0),E=y?0:x?B:0,x=y?0:x?_:0,y=Gr(E|0,x|0,d|0,ie|0)|0,V()|0,f=0;;){if((f|0)>(d|0)){ye=98;break e}if(Te=Q+(y<<3)|0,I=u[Te+4>>2]|0,(I&-117440513|0)==(x|0)&&(u[Te>>2]|0)==(E|0)){ye=70;break}if(y=(y+1|0)%(d|0)|0,Te=Q+(y<<3)|0,(u[Te>>2]|0)==(E|0)&&(u[Te+4>>2]|0)==(x|0))break;f=f+1|0}if((ye|0)==70&&(ye=0,!0&(I&117440512|0)==100663296))break;Te=c+(p<<3)|0,u[Te>>2]=B,u[Te+4>>2]=_,p=p+1|0}while(0);if(A=A+1|0,(A|0)>=(d|0)){d=W;break t}_=Me+(A<<3)|0,B=u[_>>2]|0,_=u[_+4>>2]|0}for(A=0,p=0;;){do if(!((B|0)==0&(_|0)==0)){if(x=ge(B|0,_|0,52)|0,V()|0,x=x&15,(x|0)>=(fe|0))if((x|0)!=(fe|0))if(f=B|G,y=_&-15728641|J,x>>>0<$>>>0)x=y;else{E=fe;do Te=Ce(7,0,(14-E|0)*3|0)|0,E=E+1|0,f=Te|f,y=V()|0|y;while(E>>>0<x>>>0);x=y}else f=B,x=_;else f=0,x=0;for(E=Gr(f|0,x|0,d|0,ie|0)|0,V()|0,y=0;;){if((y|0)>(d|0)){ye=98;break e}if(Te=Q+(E<<3)|0,I=u[Te+4>>2]|0,(I&-117440513|0)==(x|0)&&(u[Te>>2]|0)==(f|0)){ye=93;break}if(E=(E+1|0)%(d|0)|0,Te=Q+(E<<3)|0,(u[Te>>2]|0)==(f|0)&&(u[Te+4>>2]|0)==(x|0))break;y=y+1|0}if((ye|0)==93&&(ye=0,!0&(I&117440512|0)==100663296))break;Te=c+(p<<3)|0,u[Te>>2]=B,u[Te+4>>2]=_,p=p+1|0}while(0);if(A=A+1|0,(A|0)>=(d|0)){d=W;break t}_=Me+(A<<3)|0,B=u[_>>2]|0,_=u[_+4>>2]|0}}else p=0,d=W}else p=0,d=0;while(0);if(Ii(Q|0,0,Se|0)|0,Bc(Me|0,se|0,d<<3|0)|0,He(se),d)c=c+(p<<3)|0;else break}return(ye|0)==41?(He(Me),He(Q),Te=-1,Te|0):(ye|0)==51?(He(Me),He(Q),Te=-2,Te|0):(ye|0)==58?(He(Me),He(Q),Te=-3,Te|0):(ye|0)==98?(He(se),He(Me),He(Q),Te=-1,Te|0):((ye|0)==99&&Bc(c|0,Me|0,d<<3|0)|0,He(Me),He(Q),Te=0,Te|0)}function GP(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0;if((c|0)<=0)return p=0,p|0;if((p|0)>=16){for(y=0;;){if(B=A+(y<<3)|0,!((u[B>>2]|0)==0&(u[B+4>>2]|0)==0)){y=14;break}if(y=y+1|0,(y|0)>=(c|0)){_=0,y=16;break}}if((y|0)==14)return((d|0)>0?-2:-1)|0;if((y|0)==16)return _|0}y=0,B=0;e:for(;;){I=A+(B<<3)|0,E=I,_=u[E>>2]|0,E=u[E+4>>2]|0;do if(!((_|0)==0&(E|0)==0)){if((y|0)>=(d|0)){_=-1,y=16;break e}if(x=ge(_|0,E|0,52)|0,V()|0,x=x&15,(x|0)>(p|0)){_=-2,y=16;break e}if((x|0)==(p|0)){I=f+(y<<3)|0,u[I>>2]=_,u[I+4>>2]=E,y=y+1|0;break}if(_=(Pc(7,p-x|0)|0)+y|0,(_|0)>(d|0)){_=-1,y=16;break e}On(u[I>>2]|0,u[I+4>>2]|0,p,f+(y<<3)|0),y=_}while(0);if(B=B+1|0,(B|0)>=(c|0)){_=0,y=16;break}}return(y|0)==16?_|0:0}function zP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0;if((c|0)<=0)return f=0,f|0;if((f|0)>=16){for(d=0;;){if(_=A+(d<<3)|0,!((u[_>>2]|0)==0&(u[_+4>>2]|0)==0)){d=-1,p=13;break}if(d=d+1|0,(d|0)>=(c|0)){d=0,p=13;break}}if((p|0)==13)return d|0}d=0,_=0;e:for(;;){p=A+(_<<3)|0,y=u[p>>2]|0,p=u[p+4>>2]|0;do if(!((y|0)==0&(p|0)==0)){if(p=ge(y|0,p|0,52)|0,V()|0,p=p&15,(p|0)>(f|0)){d=-1,p=13;break e}if((p|0)==(f|0)){d=d+1|0;break}else{d=(Pc(7,f-p|0)|0)+d|0;break}}while(0);if(_=_+1|0,(_|0)>=(c|0)){p=13;break}}return(p|0)==13?d|0:0}function VP(A,c){return A=A|0,c=c|0,c=ge(A|0,c|0,52)|0,V()|0,c&1|0}function Fn(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;if(p=ge(A|0,c|0,52)|0,V()|0,p=p&15,!p)return p=0,p|0;for(d=1;;){if(f=ge(A|0,c|0,(15-d|0)*3|0)|0,V()|0,f=f&7,f|0){d=5;break}if(d>>>0<p>>>0)d=d+1|0;else{f=0,d=5;break}}return(d|0)==5?f|0:0}function sd(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0;if(x=ge(A|0,c|0,52)|0,V()|0,x=x&15,!x)return E=c,x=A,Re(E|0),x|0;for(E=1,f=0;;){y=(15-E|0)*3|0,d=Ce(7,0,y|0)|0,p=V()|0,_=ge(A|0,c|0,y|0)|0,V()|0,y=Ce(Ls(_&7)|0,0,y|0)|0,_=V()|0,A=y|A&~d,c=_|c&~p;e:do if(!f)if((y&d|0)==0&(_&p|0)==0)f=0;else if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(_=ge(A|0,c|0,(15-f|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(_=(15-f|0)*3|0,p=ge(A|0,c|0,_|0)|0,V()|0,y=Ce(7,0,_|0)|0,c=c&~(V()|0),_=Ce(Ls(p&7)|0,0,_|0)|0,A=A&~y|_,c=c|(V()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(E>>>0<x>>>0)E=E+1|0;else break}return Re(c|0),A|0}function Ur(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,!d)return f=c,d=A,Re(f|0),d|0;for(f=1;y=(15-f|0)*3|0,_=ge(A|0,c|0,y|0)|0,V()|0,p=Ce(7,0,y|0)|0,c=c&~(V()|0),y=Ce(Ls(_&7)|0,0,y|0)|0,A=y|A&~p,c=V()|0|c,f>>>0<d>>>0;)f=f+1|0;return Re(c|0),A|0}function HP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0;if(x=ge(A|0,c|0,52)|0,V()|0,x=x&15,!x)return E=c,x=A,Re(E|0),x|0;for(E=1,f=0;;){y=(15-E|0)*3|0,d=Ce(7,0,y|0)|0,p=V()|0,_=ge(A|0,c|0,y|0)|0,V()|0,y=Ce(Nr(_&7)|0,0,y|0)|0,_=V()|0,A=y|A&~d,c=_|c&~p;e:do if(!f)if((y&d|0)==0&(_&p|0)==0)f=0;else if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(_=ge(A|0,c|0,(15-f|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(p=(15-f|0)*3|0,y=Ce(7,0,p|0)|0,_=c&~(V()|0),c=ge(A|0,c|0,p|0)|0,V()|0,c=Ce(Nr(c&7)|0,0,p|0)|0,A=A&~y|c,c=_|(V()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(E>>>0<x>>>0)E=E+1|0;else break}return Re(c|0),A|0}function od(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0;if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,!d)return f=c,d=A,Re(f|0),d|0;for(f=1;_=(15-f|0)*3|0,y=Ce(7,0,_|0)|0,p=c&~(V()|0),c=ge(A|0,c|0,_|0)|0,V()|0,c=Ce(Nr(c&7)|0,0,_|0)|0,A=c|A&~y,c=V()|0|p,f>>>0<d>>>0;)f=f+1|0;return Re(c|0),A|0}function jP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0;if(x=k,k=k+64|0,E=x+40|0,d=x+24|0,p=x+12|0,y=x,Ce(c|0,0,52)|0,f=V()|0|134225919,!c)return(u[A+4>>2]|0)>2||(u[A+8>>2]|0)>2||(u[A+12>>2]|0)>2?(_=0,E=0,Re(_|0),k=x,E|0):(Ce(Qn(A)|0,0,45)|0,_=V()|0|f,E=-1,Re(_|0),k=x,E|0);if(u[E>>2]=u[A>>2],u[E+4>>2]=u[A+4>>2],u[E+8>>2]=u[A+8>>2],u[E+12>>2]=u[A+12>>2],_=E+4|0,(c|0)>0)for(A=-1;u[d>>2]=u[_>>2],u[d+4>>2]=u[_+4>>2],u[d+8>>2]=u[_+8>>2],c&1?(a_(_),u[p>>2]=u[_>>2],u[p+4>>2]=u[_+4>>2],u[p+8>>2]=u[_+8>>2],xc(p)):(nd(_),u[p>>2]=u[_>>2],u[p+4>>2]=u[_+4>>2],u[p+8>>2]=u[_+8>>2],Bs(p)),td(d,p,y),gn(y),B=(15-c|0)*3|0,I=Ce(7,0,B|0)|0,f=f&~(V()|0),B=Ce(Cc(y)|0,0,B|0)|0,A=B|A&~I,f=V()|0|f,(c|0)>1;)c=c+-1|0;else A=-1;e:do if((u[_>>2]|0)<=2&&(u[E+8>>2]|0)<=2&&(u[E+12>>2]|0)<=2){if(d=Qn(E)|0,c=Ce(d|0,0,45)|0,c=c|A,A=V()|0|f&-1040385,y=oP(E)|0,!(Ve(d)|0)){if((y|0)<=0)break;for(p=0;;){if(d=ge(c|0,A|0,52)|0,V()|0,d=d&15,d)for(f=1;B=(15-f|0)*3|0,E=ge(c|0,A|0,B|0)|0,V()|0,I=Ce(7,0,B|0)|0,A=A&~(V()|0),B=Ce(Ls(E&7)|0,0,B|0)|0,c=c&~I|B,A=A|(V()|0),f>>>0<d>>>0;)f=f+1|0;if(p=p+1|0,(p|0)==(y|0))break e}}p=ge(c|0,A|0,52)|0,V()|0,p=p&15;t:do if(p){f=1;n:for(;;){switch(B=ge(c|0,A|0,(15-f|0)*3|0)|0,V()|0,B&7){case 1:break n;case 0:break;default:break t}if(f>>>0<p>>>0)f=f+1|0;else break t}if(i_(d,u[E>>2]|0)|0)for(f=1;E=(15-f|0)*3|0,I=Ce(7,0,E|0)|0,B=A&~(V()|0),A=ge(c|0,A|0,E|0)|0,V()|0,A=Ce(Nr(A&7)|0,0,E|0)|0,c=c&~I|A,A=B|(V()|0),f>>>0<p>>>0;)f=f+1|0;else for(f=1;B=(15-f|0)*3|0,E=ge(c|0,A|0,B|0)|0,V()|0,I=Ce(7,0,B|0)|0,A=A&~(V()|0),B=Ce(Ls(E&7)|0,0,B|0)|0,c=c&~I|B,A=A|(V()|0),f>>>0<p>>>0;)f=f+1|0}while(0);if((y|0)>0){f=0;do c=sd(c,A)|0,A=V()|0,f=f+1|0;while((f|0)!=(y|0))}}else c=0,A=0;while(0);return I=A,B=c,Re(I|0),k=x,B|0}function fi(A){return A=A|0,(A|0)%2|0|0}function y_(A,c){A=A|0,c=c|0;var f=0,d=0;return d=k,k=k+16|0,f=d,c>>>0<=15&&(u[A+4>>2]&2146435072|0)!=2146435072&&(u[A+8+4>>2]&2146435072|0)!=2146435072?(mP(A,c,f),c=jP(f,c)|0,A=V()|0):(A=0,c=0),Re(A|0),k=d,c|0}function ad(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0;if(p=f+4|0,y=ge(A|0,c|0,52)|0,V()|0,y=y&15,_=ge(A|0,c|0,45)|0,V()|0,d=(y|0)==0,Ve(_&127)|0){if(d)return _=1,_|0;d=1}else{if(d)return _=0,_|0;(u[p>>2]|0)==0&&(u[f+8>>2]|0)==0?d=(u[f+12>>2]|0)!=0&1:d=1}for(f=1;f&1?xc(p):Bs(p),_=ge(A|0,c|0,(15-f|0)*3|0)|0,V()|0,A_(p,_&7),f>>>0<y>>>0;)f=f+1|0;return d|0}function uA(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0;B=k,k=k+16|0,x=B,I=ge(A|0,c|0,45)|0,V()|0,I=I&127;e:do if((Ve(I)|0)!=0&&(y=ge(A|0,c|0,52)|0,V()|0,y=y&15,(y|0)!=0)){d=1;t:for(;;){switch(E=ge(A|0,c|0,(15-d|0)*3|0)|0,V()|0,E&7){case 5:break t;case 0:break;default:{d=c;break e}}if(d>>>0<y>>>0)d=d+1|0;else{d=c;break e}}for(p=1,d=c;c=(15-p|0)*3|0,_=Ce(7,0,c|0)|0,E=d&~(V()|0),d=ge(A|0,d|0,c|0)|0,V()|0,d=Ce(Nr(d&7)|0,0,c|0)|0,A=A&~_|d,d=E|(V()|0),p>>>0<y>>>0;)p=p+1|0}else d=c;while(0);if(E=7728+(I*28|0)|0,u[f>>2]=u[E>>2],u[f+4>>2]=u[E+4>>2],u[f+8>>2]=u[E+8>>2],u[f+12>>2]=u[E+12>>2],!(ad(A,d,f)|0)){k=B;return}if(_=f+4|0,u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],y=ge(A|0,d|0,52)|0,V()|0,E=y&15,y&1?(Bs(_),y=E+1|0):y=E,!(Ve(I)|0))d=0;else{e:do if(!E)d=0;else for(c=1;;){if(p=ge(A|0,d|0,(15-c|0)*3|0)|0,V()|0,p=p&7,p|0){d=p;break e}if(c>>>0<E>>>0)c=c+1|0;else{d=0;break}}while(0);d=(d|0)==4&1}if(!(Po(f,y,d,0)|0))(y|0)!=(E|0)&&(u[_>>2]=u[x>>2],u[_+4>>2]=u[x+4>>2],u[_+8>>2]=u[x+8>>2]);else{if(Ve(I)|0)do;while((Po(f,y,0,0)|0)!=0);(y|0)!=(E|0)&&nd(_)}k=B}function Rs(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;d=k,k=k+16|0,p=d,uA(A,c,p),c=ge(A|0,c|0,52)|0,V()|0,yP(p,c&15,f),k=d}function Os(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0;_=k,k=k+16|0,y=_,uA(A,c,y),d=ge(A|0,c|0,45)|0,V()|0,d=(Ve(d&127)|0)==0,p=ge(A|0,c|0,52)|0,V()|0,p=p&15;e:do if(!d){if(p|0)for(d=1;;){if(E=Ce(7,0,(15-d|0)*3|0)|0,!((E&A|0)==0&((V()|0)&c|0)==0))break e;if(d>>>0<p>>>0)d=d+1|0;else break}h_(y,p,0,5,f),k=_;return}while(0);g_(y,p,0,6,f),k=_}function WP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;if(d=ge(A|0,c|0,45)|0,V()|0,!(Ve(d&127)|0))return d=2,d|0;if(d=ge(A|0,c|0,52)|0,V()|0,d=d&15,!d)return d=5,d|0;for(f=1;;){if(p=Ce(7,0,(15-f|0)*3|0)|0,!((p&A|0)==0&((V()|0)&c|0)==0)){f=2,A=6;break}if(f>>>0<d>>>0)f=f+1|0;else{f=5,A=6;break}}return(A|0)==6?f|0:0}function v_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0;G=k,k=k+128|0,I=G+112|0,y=G+96|0,B=G,p=ge(A|0,c|0,52)|0,V()|0,E=p&15,u[I>>2]=E,_=ge(A|0,c|0,45)|0,V()|0,_=_&127;e:do if(Ve(_)|0){if(E|0)for(d=1;;){if(x=Ce(7,0,(15-d|0)*3|0)|0,!((x&A|0)==0&((V()|0)&c|0)==0)){p=0;break e}if(d>>>0<E>>>0)d=d+1|0;else break}if(p&1)p=1;else{x=Ce(E+1|0,0,52)|0,B=V()|0|c&-15728641,I=Ce(7,0,(14-E|0)*3|0)|0,v_((x|A)&~I,B&~(V()|0),f),k=G;return}}else p=0;while(0);uA(A,c,y),p?(d_(y,I,B),x=5):(p_(y,I,B),x=6);e:do if(Ve(_)|0)if(!E)d=20;else for(d=1;;){if(_=Ce(7,0,(15-d|0)*3|0)|0,!((_&A|0)==0&((V()|0)&c|0)==0)){d=8;break e}if(d>>>0<E>>>0)d=d+1|0;else{d=20;break}}else d=8;while(0);if(Ii(f|0,-1,d|0)|0,p){p=0;do{for(y=B+(p<<4)|0,vP(y,u[I>>2]|0)|0,y=u[y>>2]|0,d=0;_=f+(d<<2)|0,E=u[_>>2]|0,!((E|0)==-1|(E|0)==(y|0));)d=d+1|0;u[_>>2]=y,p=p+1|0}while((p|0)!=(x|0))}else{p=0;do{for(y=B+(p<<4)|0,Po(y,u[I>>2]|0,0,1)|0,y=u[y>>2]|0,d=0;_=f+(d<<2)|0,E=u[_>>2]|0,!((E|0)==-1|(E|0)==(y|0));)d=d+1|0;u[_>>2]=y,p=p+1|0}while((p|0)!=(x|0))}k=G}function QP(){return 12}function Ad(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0;if(Ce(A|0,0,52)|0,E=V()|0|134225919,(A|0)<1){d=0,f=0;do Ve(d)|0&&(Ce(d|0,0,45)|0,_=E|(V()|0),A=c+(f<<3)|0,u[A>>2]=-1,u[A+4>>2]=_,f=f+1|0),d=d+1|0;while((d|0)!=122);return}_=0,f=0;do{if(Ve(_)|0){for(Ce(_|0,0,45)|0,d=1,p=-1,y=E|(V()|0);x=Ce(7,0,(15-d|0)*3|0)|0,p=p&~x,y=y&~(V()|0),(d|0)!=(A|0);)d=d+1|0;x=c+(f<<3)|0,u[x>>2]=p,u[x+4>>2]=y,f=f+1|0}_=_+1|0}while((_|0)!=122)}function E_(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0;if(E=k,k=k+64|0,_=E,(A|0)==(f|0)&(c|0)==(d|0)|(!1|(c&2013265920|0)!=134217728|(!1|(d&2013265920|0)!=134217728))||(p=ge(A|0,c|0,52)|0,V()|0,p=p&15,y=ge(f|0,d|0,52)|0,V()|0,(p|0)!=(y&15|0)))return _=0,k=E,_|0;if(y=p+-1|0,p>>>0>1&&(I=rd(A,c,y)|0,x=V()|0,y=rd(f,d,y)|0,(I|0)==(y|0)&(x|0)==(V()|0))&&(y=(p^15)*3|0,p=ge(A|0,c|0,y|0)|0,V()|0,p=p&7,y=ge(f|0,d|0,y|0)|0,V()|0,y=y&7,(p|0)==0|(y|0)==0||(u[21136+(p<<2)>>2]|0)==(y|0)||(u[21168+(p<<2)>>2]|0)==(y|0)))return I=1,k=E,I|0;p=_,y=p+56|0;do u[p>>2]=0,p=p+4|0;while((p|0)<(y|0));return So(A,c,1,_),I=_,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0))&&(I=_+8|0,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0)))&&(I=_+16|0,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0)))&&(I=_+24|0,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0)))&&(I=_+32|0,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0)))&&(I=_+40|0,!((u[I>>2]|0)==(f|0)&&(u[I+4>>2]|0)==(d|0)))?(p=_+48|0,p=((u[p>>2]|0)==(f|0)?(u[p+4>>2]|0)==(d|0):0)&1):p=1,I=p,k=E,I|0}function XP(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0;if(I=k,k=k+16|0,_=I,!(E_(A,c,f,d)|0))return E=0,x=0,Re(E|0),k=I,x|0;for(E=c&-2130706433,p=(Xt(A,c)|0)==0,p=p?1:2;u[_>>2]=0,B=L(A,c,p,_)|0,y=p+1|0,!((B|0)==(f|0)&(V()|0)==(d|0));)if(y>>>0<7)p=y;else{p=0,A=0,x=6;break}return(x|0)==6?(Re(p|0),k=I,A|0):(B=Ce(p|0,0,56)|0,x=E|(V()|0)|268435456,B=A|B,Re(x|0),k=I,B|0)}function JP(A,c){A=A|0,c=c|0;var f=0;return f=!0&(c&2013265920|0)==268435456,Re((f?c&-2130706433|134217728:0)|0),(f?A:0)|0}function YP(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;return d=k,k=k+16|0,f=d,!0&(c&2013265920|0)==268435456?(p=ge(A|0,c|0,56)|0,V()|0,u[f>>2]=0,f=L(A,c&-2130706433|134217728,p&7,f)|0,c=V()|0,Re(c|0),k=d,f|0):(c=0,f=0,Re(c|0),k=d,f|0)}function KP(A,c){A=A|0,c=c|0;var f=0;if(!(!0&(c&2013265920|0)==268435456))return f=0,f|0;switch(f=ge(A|0,c|0,56)|0,V()|0,f&7){case 0:case 7:return f=0,f|0}return f=c&-2130706433|134217728,!0&(c&117440512|0)==16777216&(Xt(A,f)|0)!=0?(f=0,f|0):(f=__(A,f)|0,f|0)}function ZP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0;y=k,k=k+16|0,d=y,_=!0&(c&2013265920|0)==268435456,p=c&-2130706433|134217728,E=f,u[E>>2]=_?A:0,u[E+4>>2]=_?p:0,_?(c=ge(A|0,c|0,56)|0,V()|0,u[d>>2]=0,A=L(A,p,c&7,d)|0,c=V()|0):(A=0,c=0),E=f+8|0,u[E>>2]=A,u[E+4>>2]=c,k=y}function qP(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;p=(Xt(A,c)|0)==0,c=c&-2130706433,d=f,u[d>>2]=p?A:0,u[d+4>>2]=p?c|285212672:0,d=f+8|0,u[d>>2]=A,u[d+4>>2]=c|301989888,d=f+16|0,u[d>>2]=A,u[d+4>>2]=c|318767104,d=f+24|0,u[d>>2]=A,u[d+4>>2]=c|335544320,d=f+32|0,u[d>>2]=A,u[d+4>>2]=c|352321536,f=f+40|0,u[f>>2]=A,u[f+4>>2]=c|369098752}function Sc(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0;if(_=k,k=k+16|0,y=_,d=ge(A|0,c|0,56)|0,V()|0,E=!0&(c&2013265920|0)==268435456,p=E?A:0,A=E?c&-2130706433|134217728:0,c=yM(p,A,d&7)|0,(c|0)==-1){u[f>>2]=0,k=_;return}uA(p,A,y),d=ge(p|0,A|0,52)|0,V()|0,d=d&15,Xt(p,A)|0?h_(y,d,c,2,f):g_(y,d,c,2,f),k=_}function $P(A){A=A|0;var c=0,f=0,d=0;return c=Mi(1,12)|0,c||it(22691,22646,49,22704),f=A+4|0,d=u[f>>2]|0,d|0?(d=d+8|0,u[d>>2]=c,u[f>>2]=c,c|0):(u[A>>2]|0&&it(22721,22646,61,22744),d=A,u[d>>2]=c,u[f>>2]=c,c|0)}function eM(A,c){A=A|0,c=c|0;var f=0,d=0;return d=Ki(24)|0,d||it(22758,22646,78,22772),u[d>>2]=u[c>>2],u[d+4>>2]=u[c+4>>2],u[d+8>>2]=u[c+8>>2],u[d+12>>2]=u[c+12>>2],u[d+16>>2]=0,c=A+4|0,f=u[c>>2]|0,f|0?(u[f+16>>2]=d,u[c>>2]=d,d|0):(u[A>>2]|0&&it(22787,22646,82,22772),u[A>>2]=d,u[c>>2]=d,d|0)}function tM(A){A=A|0;var c=0,f=0,d=0,p=0;if(!!A)for(d=1;;){if(c=u[A>>2]|0,c|0)do{if(f=u[c>>2]|0,f|0)do p=f,f=u[f+16>>2]|0,He(p);while((f|0)!=0);p=c,c=u[c+8>>2]|0,He(p)}while((c|0)!=0);if(c=A,A=u[A+8>>2]|0,d||He(c),A)d=0;else break}}function w_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0,Te=0,Ue=0,ct=0,at=0,gt=0,rt=0,mt=0,_t=0,ke=0;if(p=A+8|0,u[p>>2]|0)return ke=1,ke|0;if(d=u[A>>2]|0,!d)return ke=0,ke|0;c=d,f=0;do f=f+1|0,c=u[c+8>>2]|0;while((c|0)!=0);if(f>>>0<2)return ke=0,ke|0;mt=Ki(f<<2)|0,mt||it(22807,22646,317,22826),rt=Ki(f<<5)|0,rt||it(22848,22646,321,22826),u[A>>2]=0,Me=A+4|0,u[Me>>2]=0,u[p>>2]=0,f=0,gt=0,Se=0,G=0;e:for(;;){if(B=u[d>>2]|0,B){y=0,_=B;do{if(x=+N[_+8>>3],c=_,_=u[_+16>>2]|0,I=(_|0)==0,p=I?B:_,E=+N[p+8>>3],+je(+(x-E))>3.141592653589793){ke=14;break}y=y+(E-x)*(+N[c>>3]+ +N[p>>3])}while(!I);if((ke|0)==14){ke=0,y=0,c=B;do Q=+N[c+8>>3],at=c+16|0,ct=u[at>>2]|0,ct=(ct|0)==0?B:ct,fe=+N[ct+8>>3],y=y+(+N[c>>3]+ +N[ct>>3])*((fe<0?fe+6.283185307179586:fe)-(Q<0?Q+6.283185307179586:Q)),c=u[((c|0)==0?d:at)>>2]|0;while((c|0)!=0)}y>0?(u[mt+(gt<<2)>>2]=d,gt=gt+1|0,p=Se,c=G):ke=19}else ke=19;if((ke|0)==19){ke=0;do if(f){if(c=f+8|0,u[c>>2]|0){ke=21;break e}if(f=Mi(1,12)|0,!f){ke=23;break e}u[c>>2]=f,p=f+4|0,_=f,c=G}else if(G){p=Me,_=G+8|0,c=d,f=A;break}else if(u[A>>2]|0){ke=27;break e}else{p=Me,_=A,c=d,f=A;break}while(0);if(u[_>>2]=d,u[p>>2]=d,_=rt+(Se<<5)|0,I=u[d>>2]|0,I){for(B=rt+(Se<<5)+8|0,N[B>>3]=17976931348623157e292,G=rt+(Se<<5)+24|0,N[G>>3]=17976931348623157e292,N[_>>3]=-17976931348623157e292,W=rt+(Se<<5)+16|0,N[W>>3]=-17976931348623157e292,be=17976931348623157e292,$=-17976931348623157e292,p=0,J=I,x=17976931348623157e292,se=17976931348623157e292,pe=-17976931348623157e292,E=-17976931348623157e292;y=+N[J>>3],Q=+N[J+8>>3],J=u[J+16>>2]|0,ie=(J|0)==0,fe=+N[(ie?I:J)+8>>3],y<x&&(N[B>>3]=y,x=y),Q<se&&(N[G>>3]=Q,se=Q),y>pe?N[_>>3]=y:y=pe,Q>E&&(N[W>>3]=Q,E=Q),be=Q>0&Q<be?Q:be,$=Q<0&Q>$?Q:$,p=p|+je(+(Q-fe))>3.141592653589793,!ie;)pe=y;p&&(N[W>>3]=$,N[G>>3]=be)}else u[_>>2]=0,u[_+4>>2]=0,u[_+8>>2]=0,u[_+12>>2]=0,u[_+16>>2]=0,u[_+20>>2]=0,u[_+24>>2]=0,u[_+28>>2]=0;p=Se+1|0}if(at=d+8|0,d=u[at>>2]|0,u[at>>2]=0,d)Se=p,G=c;else{ke=45;break}}if((ke|0)==21)it(22624,22646,35,22658);else if((ke|0)==23)it(22678,22646,37,22658);else if((ke|0)==27)it(22721,22646,61,22744);else if((ke|0)==45){e:do if((gt|0)>0){for(at=(p|0)==0,Ue=p<<2,ct=(A|0)==0,Te=0,c=0;;){if(ye=u[mt+(Te<<2)>>2]|0,at)ke=73;else{if(Se=Ki(Ue)|0,!Se){ke=50;break}if(Me=Ki(Ue)|0,!Me){ke=52;break}t:do if(ct)f=0;else{for(p=0,f=0,_=A;d=rt+(p<<5)|0,T_(u[_>>2]|0,d,u[ye>>2]|0)|0?(u[Se+(f<<2)>>2]=_,u[Me+(f<<2)>>2]=d,ie=f+1|0):ie=f,_=u[_+8>>2]|0,_;)p=p+1|0,f=ie;if((ie|0)>0)if(d=u[Se>>2]|0,(ie|0)==1)f=d;else for(W=0,J=-1,f=d,G=d;;){for(I=u[G>>2]|0,d=0,_=0;p=u[u[Se+(_<<2)>>2]>>2]|0,(p|0)==(I|0)?B=d:B=d+((T_(p,u[Me+(_<<2)>>2]|0,u[I>>2]|0)|0)&1)|0,_=_+1|0,(_|0)!=(ie|0);)d=B;if(p=(B|0)>(J|0),f=p?G:f,d=W+1|0,(d|0)==(ie|0))break t;W=d,J=p?B:J,G=u[Se+(d<<2)>>2]|0}else f=0}while(0);if(He(Se),He(Me),f){if(p=f+4|0,d=u[p>>2]|0,d)f=d+8|0;else if(u[f>>2]|0){ke=70;break}u[f>>2]=ye,u[p>>2]=ye}else ke=73}if((ke|0)==73){if(ke=0,c=u[ye>>2]|0,c|0)do Me=c,c=u[c+16>>2]|0,He(Me);while((c|0)!=0);He(ye),c=2}if(Te=Te+1|0,(Te|0)>=(gt|0)){_t=c;break e}}(ke|0)==50?it(22863,22646,249,22882):(ke|0)==52?it(22901,22646,252,22882):(ke|0)==70&&it(22721,22646,61,22744)}else _t=0;while(0);return He(mt),He(rt),ke=_t,ke|0}return 0}function T_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0;if(!(s_(c,f)|0)||(c=r_(c)|0,I=+N[f>>3],d=+N[f+8>>3],d=c&d<0?d+6.283185307179586:d,A=u[A>>2]|0,!A))return A=0,A|0;if(c){c=0,f=A;e:for(;;){for(;_=+N[f>>3],x=+N[f+8>>3],f=f+16|0,B=u[f>>2]|0,B=(B|0)==0?A:B,y=+N[B>>3],p=+N[B+8>>3],_>y?(E=_,_=x):(E=y,y=_,_=p,p=x),!!(I<y|I>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(x=p<0?p+6.283185307179586:p,_=_<0?_+6.283185307179586:_,d=_==d|x==d?d+-2220446049250313e-31:d,x=x+(I-y)/(E-y)*(_-x),(x<0?x+6.283185307179586:x)>d&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}else{c=0,f=A;e:for(;;){for(;_=+N[f>>3],x=+N[f+8>>3],f=f+16|0,B=u[f>>2]|0,B=(B|0)==0?A:B,y=+N[B>>3],p=+N[B+8>>3],_>y?(E=_,_=x):(E=y,y=_,_=p,p=x),!!(I<y|I>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(d=_==d|p==d?d+-2220446049250313e-31:d,p+(I-y)/(E-y)*(_-p)>d&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}return 0}function fr(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0;if($=k,k=k+32|0,be=$+16|0,pe=$,y=ge(A|0,c|0,52)|0,V()|0,y=y&15,J=ge(f|0,d|0,52)|0,V()|0,(y|0)!=(J&15|0))return be=1,k=$,be|0;if(I=ge(A|0,c|0,45)|0,V()|0,I=I&127,B=ge(f|0,d|0,45)|0,V()|0,B=B&127,J=(I|0)!=(B|0),J){if(E=$h(I,B)|0,(E|0)==7)return be=2,k=$,be|0;x=$h(B,I)|0,(x|0)==7?it(22925,22949,151,22959):(ie=E,_=x)}else ie=0,_=0;G=Ve(I)|0,W=Ve(B)|0,u[be>>2]=0,u[be+4>>2]=0,u[be+8>>2]=0,u[be+12>>2]=0;do if(ie){if(B=u[4304+(I*28|0)+(ie<<2)>>2]|0,E=(B|0)>0,W)if(E){I=0,x=f,E=d;do x=HP(x,E)|0,E=V()|0,_=Nr(_)|0,(_|0)==1&&(_=Nr(1)|0),I=I+1|0;while((I|0)!=(B|0));B=_,I=x,x=E}else B=_,I=f,x=d;else if(E){I=0,x=f,E=d;do x=od(x,E)|0,E=V()|0,_=Nr(_)|0,I=I+1|0;while((I|0)!=(B|0));B=_,I=x,x=E}else B=_,I=f,x=d;if(ad(I,x,be)|0,J||it(22972,22949,181,22959),E=(G|0)!=0,_=(W|0)!=0,E&_&&it(22999,22949,182,22959),E){if(_=Fn(A,c)|0,Fe[22032+(_*7|0)+ie>>0]|0){y=3;break}x=u[21200+(_*28|0)+(ie<<2)>>2]|0,I=x,se=26}else if(_){if(_=Fn(I,x)|0,Fe[22032+(_*7|0)+B>>0]|0){y=4;break}I=0,x=u[21200+(B*28|0)+(_<<2)>>2]|0,se=26}else _=0;if((se|0)==26)if((x|0)<=-1&&it(23030,22949,212,22959),(I|0)<=-1&&it(23053,22949,213,22959),(x|0)>0){E=be+4|0,_=0;do bc(E),_=_+1|0;while((_|0)!=(x|0));_=I}else _=I;if(u[pe>>2]=0,u[pe+4>>2]=0,u[pe+8>>2]=0,A_(pe,ie),y|0)for(;fi(y)|0?xc(pe):Bs(pe),(y|0)>1;)y=y+-1|0;if((_|0)>0){y=0;do bc(pe),y=y+1|0;while((y|0)!=(_|0))}se=be+4|0,Sn(se,pe,se),gn(se),se=50}else if(ad(f,d,be)|0,(G|0)!=0&(W|0)!=0)if((B|0)!=(I|0)&&it(23077,22949,243,22959),_=Fn(A,c)|0,y=Fn(f,d)|0,Fe[22032+(_*7|0)+y>>0]|0)y=5;else if(_=u[21200+(_*28|0)+(y<<2)>>2]|0,(_|0)>0){E=be+4|0,y=0;do bc(E),y=y+1|0;while((y|0)!=(_|0));se=50}else se=50;else se=50;while(0);return(se|0)==50&&(y=be+4|0,u[p>>2]=u[y>>2],u[p+4>>2]=u[y+4>>2],u[p+8>>2]=u[y+8>>2],y=0),be=y,k=$,be|0}function C_(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0;if(ie=k,k=k+48|0,_=ie+36|0,E=ie+24|0,x=ie+12|0,I=ie,y=ge(A|0,c|0,52)|0,V()|0,y=y&15,W=ge(A|0,c|0,45)|0,V()|0,W=W&127,B=Ve(W)|0,Ce(y|0,0,52)|0,pe=V()|0|134225919,se=d,u[se>>2]=-1,u[se+4>>2]=pe,!y)return(u[f>>2]|0)>1||(u[f+4>>2]|0)>1||(u[f+8>>2]|0)>1||(p=qh(W,Cc(f)|0)|0,(p|0)==127)?(pe=1,k=ie,pe|0):(J=Ce(p|0,0,45)|0,se=V()|0,W=d,se=u[W+4>>2]&-1040385|se,pe=d,u[pe>>2]=u[W>>2]|J,u[pe+4>>2]=se,pe=0,k=ie,pe|0);for(u[_>>2]=u[f>>2],u[_+4>>2]=u[f+4>>2],u[_+8>>2]=u[f+8>>2];u[E>>2]=u[_>>2],u[E+4>>2]=u[_+4>>2],u[E+8>>2]=u[_+8>>2],fi(y)|0?(a_(_),u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],xc(x)):(nd(_),u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],Bs(x)),td(E,x,I),gn(I),se=d,be=u[se>>2]|0,se=u[se+4>>2]|0,$=(15-y|0)*3|0,f=Ce(7,0,$|0)|0,se=se&~(V()|0),$=Ce(Cc(I)|0,0,$|0)|0,se=V()|0|se,pe=d,u[pe>>2]=$|be&~f,u[pe+4>>2]=se,(y|0)>1;)y=y+-1|0;e:do if((u[_>>2]|0)<=1&&(u[_+4>>2]|0)<=1&&(u[_+8>>2]|0)<=1){y=Cc(_)|0,E=qh(W,y)|0,(E|0)==127?I=0:I=Ve(E)|0;t:do if(y){if(B){if(_=21408+((Fn(A,c)|0)*28|0)+(y<<2)|0,_=u[_>>2]|0,(_|0)>0){f=0;do y=Ls(y)|0,f=f+1|0;while((f|0)!=(_|0))}if((y|0)==1){p=3;break e}f=qh(W,y)|0,(f|0)==127&&it(23104,22949,376,23134),Ve(f)|0?it(23147,22949,377,23134):(J=_,G=y,p=f)}else J=0,G=y,p=E;if(x=u[4304+(W*28|0)+(G<<2)>>2]|0,(x|0)<=-1&&it(23178,22949,384,23134),!I){if((J|0)<=-1&&it(23030,22949,417,23134),J|0){_=d,y=0,f=u[_>>2]|0,_=u[_+4>>2]|0;do f=Ur(f,_)|0,_=V()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,y=y+1|0;while((y|0)<(J|0))}if((x|0)<=0){y=54;break}for(_=d,y=0,f=u[_>>2]|0,_=u[_+4>>2]|0;;)if(f=Ur(f,_)|0,_=V()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,y=y+1|0,(y|0)==(x|0)){y=54;break t}}if(E=$h(p,W)|0,(E|0)==7&&it(22925,22949,393,23134),y=d,f=u[y>>2]|0,y=u[y+4>>2]|0,(x|0)>0){_=0;do f=Ur(f,y)|0,y=V()|0,$=d,u[$>>2]=f,u[$+4>>2]=y,_=_+1|0;while((_|0)!=(x|0))}if(f=Fn(f,y)|0,$=Qt(p)|0,f=u[($?21824:21616)+(E*28|0)+(f<<2)>>2]|0,(f|0)<=-1&&it(23030,22949,412,23134),!f)y=54;else{E=d,y=0,_=u[E>>2]|0,E=u[E+4>>2]|0;do _=sd(_,E)|0,E=V()|0,$=d,u[$>>2]=_,u[$+4>>2]=E,y=y+1|0;while((y|0)<(f|0));y=54}}else if((B|0)!=0&(I|0)!=0)if($=Fn(A,c)|0,y=d,y=21408+($*28|0)+((Fn(u[y>>2]|0,u[y+4>>2]|0)|0)<<2)|0,y=u[y>>2]|0,(y|0)<=-1&&it(23201,22949,433,23134),!y)p=E,y=55;else{_=d,p=0,f=u[_>>2]|0,_=u[_+4>>2]|0;do f=Ur(f,_)|0,_=V()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,p=p+1|0;while((p|0)<(y|0));p=E,y=54}else p=E,y=54;while(0);if((y|0)==54&&I&&(y=55),(y|0)==55&&($=d,(Fn(u[$>>2]|0,u[$+4>>2]|0)|0)==1)){p=4;break}$=d,pe=u[$>>2]|0,$=u[$+4>>2]&-1040385,be=Ce(p|0,0,45)|0,$=$|(V()|0),p=d,u[p>>2]=pe|be,u[p+4>>2]=$,p=0}else p=2;while(0);return $=p,k=ie,$|0}function nM(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0;return _=k,k=k+16|0,y=_,A=fr(A,c,f,d,y)|0,A||(dP(y,p),A=0),k=_,A|0}function iM(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0;return p=k,k=k+16|0,y=p,gP(f,y),d=C_(A,c,y,d)|0,k=p,d|0}function rM(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0;return _=k,k=k+32|0,p=_+12|0,y=_,(fr(A,c,A,c,p)|0)==0&&(fr(A,c,f,d,y)|0)==0?A=id(p,y)|0:A=-1,k=_,A|0}function sM(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0,_=0;return _=k,k=k+32|0,p=_+12|0,y=_,(fr(A,c,A,c,p)|0)==0&&(fr(A,c,f,d,y)|0)==0?A=id(p,y)|0:A=-1,k=_,(A>>>31^1)+A|0}function oM(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0;if(Se=k,k=k+48|0,y=Se+24|0,_=Se+12|0,Q=Se,(fr(A,c,A,c,y)|0)==0&&(fr(A,c,f,d,_)|0)==0){if(fe=id(y,_)|0,(fe|0)<0)return Q=fe,k=Se,Q|0;for(u[y>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[_>>2]=0,u[_+4>>2]=0,u[_+8>>2]=0,fr(A,c,A,c,y)|0,fr(A,c,f,d,_)|0,f_(y),f_(_),fe?(B=u[y>>2]|0,J=+(fe|0),pe=y+4|0,G=u[pe>>2]|0,be=y+8|0,W=u[be>>2]|0,$=y,f=B,d=G,y=W,ie=+((u[_>>2]|0)-B|0)/J,se=+((u[_+4>>2]|0)-G|0)/J,J=+((u[_+8>>2]|0)-W|0)/J):(d=y+4|0,W=y+8|0,pe=d,be=W,$=y,f=u[y>>2]|0,d=u[d>>2]|0,y=u[W>>2]|0,ie=0,se=0,J=0),u[Q>>2]=f,W=Q+4|0,u[W>>2]=d,G=Q+8|0,u[G>>2]=y,B=0;;){x=+(B|0),Me=ie*x+ +(f|0),E=se*x+ +(u[pe>>2]|0),x=J*x+ +(u[be>>2]|0),d=~~+Ic(+Me),_=~~+Ic(+E),f=~~+Ic(+x),Me=+je(+(+(d|0)-Me)),E=+je(+(+(_|0)-E)),x=+je(+(+(f|0)-x));do if(Me>E&Me>x)d=0-(_+f)|0,y=_;else if(I=0-d|0,E>x){y=I-f|0;break}else{y=_,f=I-_|0;break}while(0);if(u[Q>>2]=d,u[W>>2]=y,u[G>>2]=f,pP(Q),C_(A,c,Q,p+(B<<3)|0)|0,(B|0)==(fe|0))break;B=B+1|0,f=u[$>>2]|0}return Q=0,k=Se,Q|0}return Q=-1,k=Se,Q|0}function Pc(A,c){A=A|0,c=c|0;var f=0;if(!c)return f=1,f|0;f=A,A=1;do A=nn((c&1|0)==0?1:f,A)|0,c=c>>1,f=nn(f,f)|0;while((c|0)!=0);return A|0}function x_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0;if(!(s_(c,f)|0)||(c=r_(c)|0,W=+N[f>>3],d=+N[f+8>>3],d=c&d<0?d+6.283185307179586:d,G=u[A>>2]|0,(G|0)<=0))return G=0,G|0;if(B=u[A+4>>2]|0,c){c=0,f=-1,A=0;e:for(;;){for(I=A;_=+N[B+(I<<4)>>3],x=+N[B+(I<<4)+8>>3],A=(f+2|0)%(G|0)|0,y=+N[B+(A<<4)>>3],p=+N[B+(A<<4)+8>>3],_>y?(E=_,_=x):(E=y,y=_,_=p,p=x),!!(W<y|W>E);)if(f=I+1|0,(f|0)<(G|0))A=I,I=f,f=A;else{f=22;break e}if(x=p<0?p+6.283185307179586:p,_=_<0?_+6.283185307179586:_,d=_==d|x==d?d+-2220446049250313e-31:d,x=x+(W-y)/(E-y)*(_-x),(x<0?x+6.283185307179586:x)>d&&(c=c^1),A=I+1|0,(A|0)>=(G|0)){f=22;break}else f=I}if((f|0)==22)return c|0}else{c=0,f=-1,A=0;e:for(;;){for(I=A;_=+N[B+(I<<4)>>3],x=+N[B+(I<<4)+8>>3],A=(f+2|0)%(G|0)|0,y=+N[B+(A<<4)>>3],p=+N[B+(A<<4)+8>>3],_>y?(E=_,_=x):(E=y,y=_,_=p,p=x),!!(W<y|W>E);)if(f=I+1|0,(f|0)<(G|0))A=I,I=f,f=A;else{f=22;break e}if(d=_==d|p==d?d+-2220446049250313e-31:d,p+(W-y)/(E-y)*(_-p)>d&&(c=c^1),A=I+1|0,(A|0)>=(G|0)){f=22;break}else f=I}if((f|0)==22)return c|0}return 0}function ld(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0;if(ie=u[A>>2]|0,!ie){u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;return}if(se=c+8|0,N[se>>3]=17976931348623157e292,pe=c+24|0,N[pe>>3]=17976931348623157e292,N[c>>3]=-17976931348623157e292,be=c+16|0,N[be>>3]=-17976931348623157e292,!((ie|0)<=0)){for(W=u[A+4>>2]|0,I=17976931348623157e292,B=-17976931348623157e292,G=0,A=-1,y=17976931348623157e292,_=17976931348623157e292,x=-17976931348623157e292,d=-17976931348623157e292,J=0;f=+N[W+(J<<4)>>3],E=+N[W+(J<<4)+8>>3],A=A+2|0,p=+N[W+(((A|0)==(ie|0)?0:A)<<4)+8>>3],f<y&&(N[se>>3]=f,y=f),E<_&&(N[pe>>3]=E,_=E),f>x?N[c>>3]=f:f=x,E>d&&(N[be>>3]=E,d=E),I=E>0&E<I?E:I,B=E<0&E>B?E:B,G=G|+je(+(E-p))>3.141592653589793,A=J+1|0,(A|0)!=(ie|0);)$=J,x=f,J=A,A=$;!G||(N[be>>3]=B,N[pe>>3]=I)}}function aM(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0,Me=0,ye=0;if(ie=u[A>>2]|0,ie){if(se=c+8|0,N[se>>3]=17976931348623157e292,pe=c+24|0,N[pe>>3]=17976931348623157e292,N[c>>3]=-17976931348623157e292,be=c+16|0,N[be>>3]=-17976931348623157e292,(ie|0)>0){for(p=u[A+4>>2]|0,W=17976931348623157e292,J=-17976931348623157e292,d=0,f=-1,x=17976931348623157e292,I=17976931348623157e292,G=-17976931348623157e292,_=-17976931348623157e292,$=0;y=+N[p+($<<4)>>3],B=+N[p+($<<4)+8>>3],Me=f+2|0,E=+N[p+(((Me|0)==(ie|0)?0:Me)<<4)+8>>3],y<x&&(N[se>>3]=y,x=y),B<I&&(N[pe>>3]=B,I=B),y>G?N[c>>3]=y:y=G,B>_&&(N[be>>3]=B,_=B),W=B>0&B<W?B:W,J=B<0&B>J?B:J,d=d|+je(+(B-E))>3.141592653589793,f=$+1|0,(f|0)!=(ie|0);)Me=$,G=y,$=f,f=Me;d&&(N[be>>3]=J,N[pe>>3]=W)}}else u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;if(Me=A+8|0,f=u[Me>>2]|0,!((f|0)<=0)){Se=A+12|0,Q=0;do if(p=u[Se>>2]|0,d=Q,Q=Q+1|0,pe=c+(Q<<5)|0,be=u[p+(d<<3)>>2]|0,be){if($=c+(Q<<5)+8|0,N[$>>3]=17976931348623157e292,A=c+(Q<<5)+24|0,N[A>>3]=17976931348623157e292,N[pe>>3]=-17976931348623157e292,fe=c+(Q<<5)+16|0,N[fe>>3]=-17976931348623157e292,(be|0)>0){for(ie=u[p+(d<<3)+4>>2]|0,W=17976931348623157e292,J=-17976931348623157e292,p=0,d=-1,se=0,x=17976931348623157e292,I=17976931348623157e292,B=-17976931348623157e292,_=-17976931348623157e292;y=+N[ie+(se<<4)>>3],G=+N[ie+(se<<4)+8>>3],d=d+2|0,E=+N[ie+(((d|0)==(be|0)?0:d)<<4)+8>>3],y<x&&(N[$>>3]=y,x=y),G<I&&(N[A>>3]=G,I=G),y>B?N[pe>>3]=y:y=B,G>_&&(N[fe>>3]=G,_=G),W=G>0&G<W?G:W,J=G<0&G>J?G:J,p=p|+je(+(G-E))>3.141592653589793,d=se+1|0,(d|0)!=(be|0);)ye=se,se=d,B=y,d=ye;p&&(N[fe>>3]=J,N[A>>3]=W)}}else u[pe>>2]=0,u[pe+4>>2]=0,u[pe+8>>2]=0,u[pe+12>>2]=0,u[pe+16>>2]=0,u[pe+20>>2]=0,u[pe+24>>2]=0,u[pe+28>>2]=0,f=u[Me>>2]|0;while((Q|0)<(f|0))}}function AM(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0;if(!(x_(A,c,f)|0))return p=0,p|0;if(p=A+8|0,(u[p>>2]|0)<=0)return p=1,p|0;for(d=A+12|0,A=0;;){if(y=A,A=A+1|0,x_((u[d>>2]|0)+(y<<3)|0,c+(A<<5)|0,f)|0){A=0,d=6;break}if((A|0)>=(u[p>>2]|0)){A=1,d=6;break}}return(d|0)==6?A|0:0}function lM(){return 8}function cM(){return 16}function uM(){return 168}function fM(){return 8}function hM(){return 16}function dM(){return 12}function gM(){return 8}function pM(A){A=A|0;var c=0,f=0;return f=+N[A>>3],c=+N[A+8>>3],+ +Qe(+(f*f+c*c))}function b_(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0;I=+N[A>>3],x=+N[c>>3]-I,E=+N[A+8>>3],_=+N[c+8>>3]-E,G=+N[f>>3],y=+N[d>>3]-G,W=+N[f+8>>3],B=+N[d+8>>3]-W,y=(y*(E-W)-(I-G)*B)/(x*B-_*y),N[p>>3]=I+x*y,N[p+8>>3]=E+_*y}function S_(A,c){return A=A|0,c=c|0,+N[A>>3]!=+N[c>>3]?(c=0,c|0):(c=+N[A+8>>3]==+N[c+8>>3],c|0)}function Vt(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;return p=+N[A>>3]-+N[c>>3],d=+N[A+8>>3]-+N[c+8>>3],f=+N[A+16>>3]-+N[c+16>>3],+(p*p+d*d+f*f)}function mM(A,c){A=A|0,c=c|0;var f=0,d=0,p=0;f=+N[A>>3],d=+et(+f),f=+Ye(+f),N[c+16>>3]=f,f=+N[A+8>>3],p=d*+et(+f),N[c>>3]=p,f=d*+Ye(+f),N[c+8>>3]=f}function _M(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0;if(I=k,k=k+32|0,p=I+16|0,y=I,uA(A,c,p),_=m_(A,c)|0,x=Fn(A,c)|0,aP(_,y),c=AP(_,u[p>>2]|0)|0,!(Ve(_)|0))return x=c,k=I,x|0;do switch(_|0){case 4:{A=0,f=14;break}case 14:{A=1,f=14;break}case 24:{A=2,f=14;break}case 38:{A=3,f=14;break}case 49:{A=4,f=14;break}case 58:{A=5,f=14;break}case 63:{A=6,f=14;break}case 72:{A=7,f=14;break}case 83:{A=8,f=14;break}case 97:{A=9,f=14;break}case 107:{A=10,f=14;break}case 117:{A=11,f=14;break}default:E=0,d=0}while(0);return(f|0)==14&&(E=u[22096+(A*24|0)+8>>2]|0,d=u[22096+(A*24|0)+16>>2]|0),A=u[p>>2]|0,(A|0)!=(u[y>>2]|0)&&(_=Qt(_)|0,A=u[p>>2]|0,_|(A|0)==(d|0)&&(c=(c+1|0)%6|0)),(x|0)==3&(A|0)==(d|0)?(x=(c+5|0)%6|0,k=I,x|0):(x|0)==5&(A|0)==(E|0)?(x=(c+1|0)%6|0,k=I,x|0):(x=c,k=I,x|0)}function yM(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;return d=Xt(A,c)|0,(f+-1|0)>>>0>5||(p=(d|0)!=0,(f|0)==1&p)?(f=-1,f|0):(d=_M(A,c)|0,p?(f=(5-d+(u[22384+(f<<2)>>2]|0)|0)%5|0,f|0):(f=(6-d+(u[22416+(f<<2)>>2]|0)|0)%6|0,f|0))}function P_(A,c,f){A=A|0,c=c|0,f=f|0;var d=0;(c|0)>0?(d=Mi(c,4)|0,u[A>>2]=d,d||it(23230,23253,40,23267)):u[A>>2]=0,u[A+4>>2]=c,u[A+8>>2]=0,u[A+12>>2]=f}function M_(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0;p=A+4|0,y=A+12|0,_=A+8|0;e:for(;;){for(f=u[p>>2]|0,c=0;;){if((c|0)>=(f|0))break e;if(d=u[A>>2]|0,E=u[d+(c<<2)>>2]|0,!E)c=c+1|0;else break}c=d+(~~(+je(+(+wt(10,+ +(15-(u[y>>2]|0)|0))*(+N[E>>3]+ +N[E+8>>3])))%+(f|0))>>>0<<2)|0,f=u[c>>2]|0;t:do if(f|0){if(d=E+32|0,(f|0)==(E|0))u[c>>2]=u[d>>2];else{if(f=f+32|0,c=u[f>>2]|0,!c)break;for(;(c|0)!=(E|0);)if(f=c+32|0,c=u[f>>2]|0,!c)break t;u[f>>2]=u[d>>2]}He(E),u[_>>2]=(u[_>>2]|0)+-1}while(0)}He(u[A>>2]|0)}function I_(A){A=A|0;var c=0,f=0,d=0;for(d=u[A+4>>2]|0,f=0;;){if((f|0)>=(d|0)){c=0,f=4;break}if(c=u[(u[A>>2]|0)+(f<<2)>>2]|0,!c)f=f+1|0;else{f=4;break}}return(f|0)==4?c|0:0}function B_(A,c){A=A|0,c=c|0;var f=0,d=0,p=0,y=0;if(f=~~(+je(+(+wt(10,+ +(15-(u[A+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[A+4>>2]|0))>>>0,f=(u[A>>2]|0)+(f<<2)|0,d=u[f>>2]|0,!d)return y=1,y|0;y=c+32|0;do if((d|0)!=(c|0)){if(f=u[d+32>>2]|0,!f)return y=1,y|0;for(p=f;;){if((p|0)==(c|0)){p=8;break}if(f=u[p+32>>2]|0,f)d=p,p=f;else{f=1,p=10;break}}if((p|0)==8){u[d+32>>2]=u[y>>2];break}else if((p|0)==10)return f|0}else u[f>>2]=u[y>>2];while(0);return He(c),y=A+8|0,u[y>>2]=(u[y>>2]|0)+-1,y=0,y|0}function vM(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0;y=Ki(40)|0,y||it(23283,23253,98,23296),u[y>>2]=u[c>>2],u[y+4>>2]=u[c+4>>2],u[y+8>>2]=u[c+8>>2],u[y+12>>2]=u[c+12>>2],p=y+16|0,u[p>>2]=u[f>>2],u[p+4>>2]=u[f+4>>2],u[p+8>>2]=u[f+8>>2],u[p+12>>2]=u[f+12>>2],u[y+32>>2]=0,p=~~(+je(+(+wt(10,+ +(15-(u[A+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[A+4>>2]|0))>>>0,p=(u[A>>2]|0)+(p<<2)|0,d=u[p>>2]|0;do if(!d)u[p>>2]=y;else{for(;!(Mo(d,c)|0&&Mo(d+16|0,f)|0);)if(p=u[d+32>>2]|0,d=(p|0)==0?d:p,!(u[d+32>>2]|0)){_=10;break}if((_|0)==10){u[d+32>>2]=y;break}return He(y),_=d,_|0}while(0);return _=A+8|0,u[_>>2]=(u[_>>2]|0)+1,_=y,_|0}function EM(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0;if(p=~~(+je(+(+wt(10,+ +(15-(u[A+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[A+4>>2]|0))>>>0,p=u[(u[A>>2]|0)+(p<<2)>>2]|0,!p)return f=0,f|0;if(!f){for(A=p;;){if(Mo(A,c)|0){d=10;break}if(A=u[A+32>>2]|0,!A){A=0,d=10;break}}if((d|0)==10)return A|0}for(A=p;;){if(Mo(A,c)|0&&Mo(A+16|0,f)|0){d=10;break}if(A=u[A+32>>2]|0,!A){A=0,d=10;break}}return(d|0)==10?A|0:0}function wM(A,c){A=A|0,c=c|0;var f=0;if(f=~~(+je(+(+wt(10,+ +(15-(u[A+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[A+4>>2]|0))>>>0,A=u[(u[A>>2]|0)+(f<<2)>>2]|0,!A)return f=0,f|0;for(;;){if(Mo(A,c)|0){c=5;break}if(A=u[A+32>>2]|0,!A){A=0,c=5;break}}return(c|0)==5?A|0:0}function TM(){return 23312}function CM(A){return A=+A,+ +O_(+A)}function Mc(A){return A=+A,~~+CM(A)|0}function Ki(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0,se=0,pe=0,be=0,$=0,fe=0,Q=0,Se=0;Se=k,k=k+16|0,W=Se;do if(A>>>0<245){if(I=A>>>0<11?16:A+11&-8,A=I>>>3,G=u[5829]|0,f=G>>>A,f&3|0)return c=(f&1^1)+A|0,A=23356+(c<<1<<2)|0,f=A+8|0,d=u[f>>2]|0,p=d+8|0,y=u[p>>2]|0,(y|0)==(A|0)?u[5829]=G&~(1<<c):(u[y+12>>2]=A,u[f>>2]=y),Q=c<<3,u[d+4>>2]=Q|3,Q=d+Q+4|0,u[Q>>2]=u[Q>>2]|1,Q=p,k=Se,Q|0;if(B=u[5831]|0,I>>>0>B>>>0){if(f|0)return c=2<<A,c=f<<A&(c|0-c),c=(c&0-c)+-1|0,E=c>>>12&16,c=c>>>E,f=c>>>5&8,c=c>>>f,y=c>>>2&4,c=c>>>y,A=c>>>1&2,c=c>>>A,d=c>>>1&1,d=(f|E|y|A|d)+(c>>>d)|0,c=23356+(d<<1<<2)|0,A=c+8|0,y=u[A>>2]|0,E=y+8|0,f=u[E>>2]|0,(f|0)==(c|0)?(A=G&~(1<<d),u[5829]=A):(u[f+12>>2]=c,u[A>>2]=f,A=G),Q=d<<3,_=Q-I|0,u[y+4>>2]=I|3,p=y+I|0,u[p+4>>2]=_|1,u[y+Q>>2]=_,B|0&&(d=u[5834]|0,c=B>>>3,f=23356+(c<<1<<2)|0,c=1<<c,A&c?(A=f+8|0,c=u[A>>2]|0):(u[5829]=A|c,c=f,A=f+8|0),u[A>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5831]=_,u[5834]=p,Q=E,k=Se,Q|0;if(y=u[5830]|0,y){for(f=(y&0-y)+-1|0,p=f>>>12&16,f=f>>>p,d=f>>>5&8,f=f>>>d,_=f>>>2&4,f=f>>>_,E=f>>>1&2,f=f>>>E,x=f>>>1&1,x=u[23620+((d|p|_|E|x)+(f>>>x)<<2)>>2]|0,f=x,E=x,x=(u[x+4>>2]&-8)-I|0;A=u[f+16>>2]|0,!(!A&&(A=u[f+20>>2]|0,!A));)_=(u[A+4>>2]&-8)-I|0,p=_>>>0<x>>>0,f=A,E=p?A:E,x=p?_:x;if(_=E+I|0,_>>>0>E>>>0){p=u[E+24>>2]|0,c=u[E+12>>2]|0;do if((c|0)==(E|0)){if(A=E+20|0,c=u[A>>2]|0,!c&&(A=E+16|0,c=u[A>>2]|0,!c)){f=0;break}for(;;)if(d=c+20|0,f=u[d>>2]|0,f)c=f,A=d;else if(d=c+16|0,f=u[d>>2]|0,f)c=f,A=d;else break;u[A>>2]=0,f=c}else f=u[E+8>>2]|0,u[f+12>>2]=c,u[c+8>>2]=f,f=c;while(0);do if(p|0){if(c=u[E+28>>2]|0,A=23620+(c<<2)|0,(E|0)==(u[A>>2]|0)){if(u[A>>2]=f,!f){u[5830]=y&~(1<<c);break}}else if(Q=p+16|0,u[((u[Q>>2]|0)==(E|0)?Q:p+20|0)>>2]=f,!f)break;u[f+24>>2]=p,c=u[E+16>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),c=u[E+20>>2]|0,c|0&&(u[f+20>>2]=c,u[c+24>>2]=f)}while(0);return x>>>0<16?(Q=x+I|0,u[E+4>>2]=Q|3,Q=E+Q+4|0,u[Q>>2]=u[Q>>2]|1):(u[E+4>>2]=I|3,u[_+4>>2]=x|1,u[_+x>>2]=x,B|0&&(d=u[5834]|0,c=B>>>3,f=23356+(c<<1<<2)|0,c=1<<c,c&G?(A=f+8|0,c=u[A>>2]|0):(u[5829]=c|G,c=f,A=f+8|0),u[A>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5831]=x,u[5834]=_),Q=E+8|0,k=Se,Q|0}else G=I}else G=I}else G=I}else if(A>>>0<=4294967231)if(A=A+11|0,I=A&-8,d=u[5830]|0,d){p=0-I|0,A=A>>>8,A?I>>>0>16777215?x=31:(G=(A+1048320|0)>>>16&8,se=A<<G,E=(se+520192|0)>>>16&4,se=se<<E,x=(se+245760|0)>>>16&2,x=14-(E|G|x)+(se<<x>>>15)|0,x=I>>>(x+7|0)&1|x<<1):x=0,f=u[23620+(x<<2)>>2]|0;e:do if(!f)f=0,A=0,se=61;else for(A=0,E=I<<((x|0)==31?0:25-(x>>>1)|0),y=0;;){if(_=(u[f+4>>2]&-8)-I|0,_>>>0<p>>>0)if(_)A=f,p=_;else{A=f,p=0,se=65;break e}if(se=u[f+20>>2]|0,f=u[f+16+(E>>>31<<2)>>2]|0,y=(se|0)==0|(se|0)==(f|0)?y:se,f)E=E<<1;else{f=y,se=61;break}}while(0);if((se|0)==61){if((f|0)==0&(A|0)==0){if(A=2<<x,A=(A|0-A)&d,!A){G=I;break}G=(A&0-A)+-1|0,_=G>>>12&16,G=G>>>_,y=G>>>5&8,G=G>>>y,E=G>>>2&4,G=G>>>E,x=G>>>1&2,G=G>>>x,f=G>>>1&1,A=0,f=u[23620+((y|_|E|x|f)+(G>>>f)<<2)>>2]|0}f?se=65:(E=A,_=p)}if((se|0)==65)for(y=f;;)if(G=(u[y+4>>2]&-8)-I|0,f=G>>>0<p>>>0,p=f?G:p,A=f?y:A,f=u[y+16>>2]|0,f||(f=u[y+20>>2]|0),f)y=f;else{E=A,_=p;break}if((E|0)!=0&&_>>>0<((u[5831]|0)-I|0)>>>0&&(B=E+I|0,B>>>0>E>>>0)){y=u[E+24>>2]|0,c=u[E+12>>2]|0;do if((c|0)==(E|0)){if(A=E+20|0,c=u[A>>2]|0,!c&&(A=E+16|0,c=u[A>>2]|0,!c)){c=0;break}for(;;)if(p=c+20|0,f=u[p>>2]|0,f)c=f,A=p;else if(p=c+16|0,f=u[p>>2]|0,f)c=f,A=p;else break;u[A>>2]=0}else Q=u[E+8>>2]|0,u[Q+12>>2]=c,u[c+8>>2]=Q;while(0);do if(y){if(A=u[E+28>>2]|0,f=23620+(A<<2)|0,(E|0)==(u[f>>2]|0)){if(u[f>>2]=c,!c){d=d&~(1<<A),u[5830]=d;break}}else if(Q=y+16|0,u[((u[Q>>2]|0)==(E|0)?Q:y+20|0)>>2]=c,!c)break;u[c+24>>2]=y,A=u[E+16>>2]|0,A|0&&(u[c+16>>2]=A,u[A+24>>2]=c),A=u[E+20>>2]|0,A&&(u[c+20>>2]=A,u[A+24>>2]=c)}while(0);e:do if(_>>>0<16)Q=_+I|0,u[E+4>>2]=Q|3,Q=E+Q+4|0,u[Q>>2]=u[Q>>2]|1;else{if(u[E+4>>2]=I|3,u[B+4>>2]=_|1,u[B+_>>2]=_,c=_>>>3,_>>>0<256){f=23356+(c<<1<<2)|0,A=u[5829]|0,c=1<<c,A&c?(A=f+8|0,c=u[A>>2]|0):(u[5829]=A|c,c=f,A=f+8|0),u[A>>2]=B,u[c+12>>2]=B,u[B+8>>2]=c,u[B+12>>2]=f;break}if(c=_>>>8,c?_>>>0>16777215?f=31:(fe=(c+1048320|0)>>>16&8,Q=c<<fe,$=(Q+520192|0)>>>16&4,Q=Q<<$,f=(Q+245760|0)>>>16&2,f=14-($|fe|f)+(Q<<f>>>15)|0,f=_>>>(f+7|0)&1|f<<1):f=0,c=23620+(f<<2)|0,u[B+28>>2]=f,A=B+16|0,u[A+4>>2]=0,u[A>>2]=0,A=1<<f,!(d&A)){u[5830]=d|A,u[c>>2]=B,u[B+24>>2]=c,u[B+12>>2]=B,u[B+8>>2]=B;break}c=u[c>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(_|0)){for(d=_<<((f|0)==31?0:25-(f>>>1)|0);f=c+16+(d>>>31<<2)|0,A=u[f>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(_|0)){c=A;break t}else d=d<<1,c=A;u[f>>2]=B,u[B+24>>2]=c,u[B+12>>2]=B,u[B+8>>2]=B;break e}while(0);fe=c+8|0,Q=u[fe>>2]|0,u[Q+12>>2]=B,u[fe>>2]=B,u[B+8>>2]=Q,u[B+12>>2]=c,u[B+24>>2]=0}while(0);return Q=E+8|0,k=Se,Q|0}else G=I}else G=I;else G=-1;while(0);if(f=u[5831]|0,f>>>0>=G>>>0)return c=f-G|0,A=u[5834]|0,c>>>0>15?(Q=A+G|0,u[5834]=Q,u[5831]=c,u[Q+4>>2]=c|1,u[A+f>>2]=c,u[A+4>>2]=G|3):(u[5831]=0,u[5834]=0,u[A+4>>2]=f|3,Q=A+f+4|0,u[Q>>2]=u[Q>>2]|1),Q=A+8|0,k=Se,Q|0;if(_=u[5832]|0,_>>>0>G>>>0)return $=_-G|0,u[5832]=$,Q=u[5835]|0,fe=Q+G|0,u[5835]=fe,u[fe+4>>2]=$|1,u[Q+4>>2]=G|3,Q=Q+8|0,k=Se,Q|0;if(u[5947]|0?A=u[5949]|0:(u[5949]=4096,u[5948]=4096,u[5950]=-1,u[5951]=-1,u[5952]=0,u[5940]=0,u[5947]=W&-16^1431655768,A=4096),E=G+48|0,x=G+47|0,y=A+x|0,p=0-A|0,I=y&p,I>>>0<=G>>>0||(A=u[5939]|0,A|0&&(B=u[5937]|0,W=B+I|0,W>>>0<=B>>>0|W>>>0>A>>>0)))return Q=0,k=Se,Q|0;e:do if(u[5940]&4)c=0,se=143;else{f=u[5835]|0;t:do if(f){for(d=23764;W=u[d>>2]|0,!(W>>>0<=f>>>0&&(W+(u[d+4>>2]|0)|0)>>>0>f>>>0);)if(A=u[d+8>>2]|0,A)d=A;else{se=128;break t}if(c=y-_&p,c>>>0<2147483647)if(A=zr(c|0)|0,(A|0)==((u[d>>2]|0)+(u[d+4>>2]|0)|0)){if((A|0)!=-1){_=c,y=A,se=145;break e}}else d=A,se=136;else c=0}else se=128;while(0);do if((se|0)==128)if(f=zr(0)|0,(f|0)!=-1&&(c=f,J=u[5948]|0,ie=J+-1|0,c=((ie&c|0)==0?0:(ie+c&0-J)-c|0)+I|0,J=u[5937]|0,ie=c+J|0,c>>>0>G>>>0&c>>>0<2147483647)){if(W=u[5939]|0,W|0&&ie>>>0<=J>>>0|ie>>>0>W>>>0){c=0;break}if(A=zr(c|0)|0,(A|0)==(f|0)){_=c,y=f,se=145;break e}else d=A,se=136}else c=0;while(0);do if((se|0)==136){if(f=0-c|0,!(E>>>0>c>>>0&(c>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){c=0;break}else{_=c,y=d,se=145;break e}if(A=u[5949]|0,A=x-c+A&0-A,A>>>0>=2147483647){_=c,y=d,se=145;break e}if((zr(A|0)|0)==-1){zr(f|0)|0,c=0;break}else{_=A+c|0,y=d,se=145;break e}}while(0);u[5940]=u[5940]|4,se=143}while(0);if((se|0)==143&&I>>>0<2147483647&&($=zr(I|0)|0,ie=zr(0)|0,pe=ie-$|0,be=pe>>>0>(G+40|0)>>>0,!(($|0)==-1|be^1|$>>>0<ie>>>0&(($|0)!=-1&(ie|0)!=-1)^1))&&(_=be?pe:c,y=$,se=145),(se|0)==145){c=(u[5937]|0)+_|0,u[5937]=c,c>>>0>(u[5938]|0)>>>0&&(u[5938]=c),x=u[5835]|0;e:do if(x){for(c=23764;;){if(A=u[c>>2]|0,f=u[c+4>>2]|0,(y|0)==(A+f|0)){se=154;break}if(d=u[c+8>>2]|0,d)c=d;else break}if((se|0)==154&&(fe=c+4|0,(u[c+12>>2]&8|0)==0)&&y>>>0>x>>>0&A>>>0<=x>>>0){u[fe>>2]=f+_,Q=(u[5832]|0)+_|0,$=x+8|0,$=($&7|0)==0?0:0-$&7,fe=x+$|0,$=Q-$|0,u[5835]=fe,u[5832]=$,u[fe+4>>2]=$|1,u[x+Q+4>>2]=40,u[5836]=u[5951];break}for(y>>>0<(u[5833]|0)>>>0&&(u[5833]=y),f=y+_|0,c=23764;;){if((u[c>>2]|0)==(f|0)){se=162;break}if(A=u[c+8>>2]|0,A)c=A;else break}if((se|0)==162&&(u[c+12>>2]&8|0)==0){u[c>>2]=y,B=c+4|0,u[B>>2]=(u[B>>2]|0)+_,B=y+8|0,B=y+((B&7|0)==0?0:0-B&7)|0,c=f+8|0,c=f+((c&7|0)==0?0:0-c&7)|0,I=B+G|0,E=c-B-G|0,u[B+4>>2]=G|3;t:do if((x|0)==(c|0))Q=(u[5832]|0)+E|0,u[5832]=Q,u[5835]=I,u[I+4>>2]=Q|1;else{if((u[5834]|0)==(c|0)){Q=(u[5831]|0)+E|0,u[5831]=Q,u[5834]=I,u[I+4>>2]=Q|1,u[I+Q>>2]=Q;break}if(A=u[c+4>>2]|0,(A&3|0)==1){_=A&-8,d=A>>>3;n:do if(A>>>0<256)if(A=u[c+8>>2]|0,f=u[c+12>>2]|0,(f|0)==(A|0)){u[5829]=u[5829]&~(1<<d);break}else{u[A+12>>2]=f,u[f+8>>2]=A;break}else{y=u[c+24>>2]|0,A=u[c+12>>2]|0;do if((A|0)==(c|0)){if(f=c+16|0,d=f+4|0,A=u[d>>2]|0,A)f=d;else if(A=u[f>>2]|0,!A){A=0;break}for(;;)if(p=A+20|0,d=u[p>>2]|0,d)A=d,f=p;else if(p=A+16|0,d=u[p>>2]|0,d)A=d,f=p;else break;u[f>>2]=0}else Q=u[c+8>>2]|0,u[Q+12>>2]=A,u[A+8>>2]=Q;while(0);if(!y)break;f=u[c+28>>2]|0,d=23620+(f<<2)|0;do if((u[d>>2]|0)!=(c|0)){if(Q=y+16|0,u[((u[Q>>2]|0)==(c|0)?Q:y+20|0)>>2]=A,!A)break n}else{if(u[d>>2]=A,A|0)break;u[5830]=u[5830]&~(1<<f);break n}while(0);if(u[A+24>>2]=y,f=c+16|0,d=u[f>>2]|0,d|0&&(u[A+16>>2]=d,u[d+24>>2]=A),f=u[f+4>>2]|0,!f)break;u[A+20>>2]=f,u[f+24>>2]=A}while(0);c=c+_|0,p=_+E|0}else p=E;if(c=c+4|0,u[c>>2]=u[c>>2]&-2,u[I+4>>2]=p|1,u[I+p>>2]=p,c=p>>>3,p>>>0<256){f=23356+(c<<1<<2)|0,A=u[5829]|0,c=1<<c,A&c?(A=f+8|0,c=u[A>>2]|0):(u[5829]=A|c,c=f,A=f+8|0),u[A>>2]=I,u[c+12>>2]=I,u[I+8>>2]=c,u[I+12>>2]=f;break}c=p>>>8;do if(!c)d=0;else{if(p>>>0>16777215){d=31;break}fe=(c+1048320|0)>>>16&8,Q=c<<fe,$=(Q+520192|0)>>>16&4,Q=Q<<$,d=(Q+245760|0)>>>16&2,d=14-($|fe|d)+(Q<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1}while(0);if(c=23620+(d<<2)|0,u[I+28>>2]=d,A=I+16|0,u[A+4>>2]=0,u[A>>2]=0,A=u[5830]|0,f=1<<d,!(A&f)){u[5830]=A|f,u[c>>2]=I,u[I+24>>2]=c,u[I+12>>2]=I,u[I+8>>2]=I;break}c=u[c>>2]|0;n:do if((u[c+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,A=u[f>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(p|0)){c=A;break n}else d=d<<1,c=A;u[f>>2]=I,u[I+24>>2]=c,u[I+12>>2]=I,u[I+8>>2]=I;break t}while(0);fe=c+8|0,Q=u[fe>>2]|0,u[Q+12>>2]=I,u[fe>>2]=I,u[I+8>>2]=Q,u[I+12>>2]=c,u[I+24>>2]=0}while(0);return Q=B+8|0,k=Se,Q|0}for(c=23764;A=u[c>>2]|0,!(A>>>0<=x>>>0&&(Q=A+(u[c+4>>2]|0)|0,Q>>>0>x>>>0));)c=u[c+8>>2]|0;p=Q+-47|0,A=p+8|0,A=p+((A&7|0)==0?0:0-A&7)|0,p=x+16|0,A=A>>>0<p>>>0?x:A,c=A+8|0,f=_+-40|0,$=y+8|0,$=($&7|0)==0?0:0-$&7,fe=y+$|0,$=f-$|0,u[5835]=fe,u[5832]=$,u[fe+4>>2]=$|1,u[y+f+4>>2]=40,u[5836]=u[5951],f=A+4|0,u[f>>2]=27,u[c>>2]=u[5941],u[c+4>>2]=u[5942],u[c+8>>2]=u[5943],u[c+12>>2]=u[5944],u[5941]=y,u[5942]=_,u[5944]=0,u[5943]=c,c=A+24|0;do fe=c,c=c+4|0,u[c>>2]=7;while((fe+8|0)>>>0<Q>>>0);if((A|0)!=(x|0)){if(y=A-x|0,u[f>>2]=u[f>>2]&-2,u[x+4>>2]=y|1,u[A>>2]=y,c=y>>>3,y>>>0<256){f=23356+(c<<1<<2)|0,A=u[5829]|0,c=1<<c,A&c?(A=f+8|0,c=u[A>>2]|0):(u[5829]=A|c,c=f,A=f+8|0),u[A>>2]=x,u[c+12>>2]=x,u[x+8>>2]=c,u[x+12>>2]=f;break}if(c=y>>>8,c?y>>>0>16777215?d=31:(fe=(c+1048320|0)>>>16&8,Q=c<<fe,$=(Q+520192|0)>>>16&4,Q=Q<<$,d=(Q+245760|0)>>>16&2,d=14-($|fe|d)+(Q<<d>>>15)|0,d=y>>>(d+7|0)&1|d<<1):d=0,f=23620+(d<<2)|0,u[x+28>>2]=d,u[x+20>>2]=0,u[p>>2]=0,c=u[5830]|0,A=1<<d,!(c&A)){u[5830]=c|A,u[f>>2]=x,u[x+24>>2]=f,u[x+12>>2]=x,u[x+8>>2]=x;break}c=u[f>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(y|0)){for(d=y<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,A=u[f>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(y|0)){c=A;break t}else d=d<<1,c=A;u[f>>2]=x,u[x+24>>2]=c,u[x+12>>2]=x,u[x+8>>2]=x;break e}while(0);fe=c+8|0,Q=u[fe>>2]|0,u[Q+12>>2]=x,u[fe>>2]=x,u[x+8>>2]=Q,u[x+12>>2]=c,u[x+24>>2]=0}}else Q=u[5833]|0,(Q|0)==0|y>>>0<Q>>>0&&(u[5833]=y),u[5941]=y,u[5942]=_,u[5944]=0,u[5838]=u[5947],u[5837]=-1,u[5842]=23356,u[5841]=23356,u[5844]=23364,u[5843]=23364,u[5846]=23372,u[5845]=23372,u[5848]=23380,u[5847]=23380,u[5850]=23388,u[5849]=23388,u[5852]=23396,u[5851]=23396,u[5854]=23404,u[5853]=23404,u[5856]=23412,u[5855]=23412,u[5858]=23420,u[5857]=23420,u[5860]=23428,u[5859]=23428,u[5862]=23436,u[5861]=23436,u[5864]=23444,u[5863]=23444,u[5866]=23452,u[5865]=23452,u[5868]=23460,u[5867]=23460,u[5870]=23468,u[5869]=23468,u[5872]=23476,u[5871]=23476,u[5874]=23484,u[5873]=23484,u[5876]=23492,u[5875]=23492,u[5878]=23500,u[5877]=23500,u[5880]=23508,u[5879]=23508,u[5882]=23516,u[5881]=23516,u[5884]=23524,u[5883]=23524,u[5886]=23532,u[5885]=23532,u[5888]=23540,u[5887]=23540,u[5890]=23548,u[5889]=23548,u[5892]=23556,u[5891]=23556,u[5894]=23564,u[5893]=23564,u[5896]=23572,u[5895]=23572,u[5898]=23580,u[5897]=23580,u[5900]=23588,u[5899]=23588,u[5902]=23596,u[5901]=23596,u[5904]=23604,u[5903]=23604,Q=_+-40|0,$=y+8|0,$=($&7|0)==0?0:0-$&7,fe=y+$|0,$=Q-$|0,u[5835]=fe,u[5832]=$,u[fe+4>>2]=$|1,u[y+Q+4>>2]=40,u[5836]=u[5951];while(0);if(c=u[5832]|0,c>>>0>G>>>0)return $=c-G|0,u[5832]=$,Q=u[5835]|0,fe=Q+G|0,u[5835]=fe,u[fe+4>>2]=$|1,u[Q+4>>2]=G|3,Q=Q+8|0,k=Se,Q|0}return Q=TM()|0,u[Q>>2]=12,Q=0,k=Se,Q|0}function He(A){A=A|0;var c=0,f=0,d=0,p=0,y=0,_=0,E=0,x=0;if(!A)return;f=A+-8|0,p=u[5833]|0,A=u[A+-4>>2]|0,c=A&-8,x=f+c|0;do if(A&1)E=f,_=f;else{if(d=u[f>>2]|0,!(A&3)||(_=f+(0-d)|0,y=d+c|0,_>>>0<p>>>0))return;if((u[5834]|0)==(_|0)){if(A=x+4|0,c=u[A>>2]|0,(c&3|0)!=3){E=_,c=y;break}u[5831]=y,u[A>>2]=c&-2,u[_+4>>2]=y|1,u[_+y>>2]=y;return}if(f=d>>>3,d>>>0<256)if(A=u[_+8>>2]|0,c=u[_+12>>2]|0,(c|0)==(A|0)){u[5829]=u[5829]&~(1<<f),E=_,c=y;break}else{u[A+12>>2]=c,u[c+8>>2]=A,E=_,c=y;break}p=u[_+24>>2]|0,A=u[_+12>>2]|0;do if((A|0)==(_|0)){if(c=_+16|0,f=c+4|0,A=u[f>>2]|0,A)c=f;else if(A=u[c>>2]|0,!A){A=0;break}for(;;)if(d=A+20|0,f=u[d>>2]|0,f)A=f,c=d;else if(d=A+16|0,f=u[d>>2]|0,f)A=f,c=d;else break;u[c>>2]=0}else E=u[_+8>>2]|0,u[E+12>>2]=A,u[A+8>>2]=E;while(0);if(p){if(c=u[_+28>>2]|0,f=23620+(c<<2)|0,(u[f>>2]|0)==(_|0)){if(u[f>>2]=A,!A){u[5830]=u[5830]&~(1<<c),E=_,c=y;break}}else if(E=p+16|0,u[((u[E>>2]|0)==(_|0)?E:p+20|0)>>2]=A,!A){E=_,c=y;break}u[A+24>>2]=p,c=_+16|0,f=u[c>>2]|0,f|0&&(u[A+16>>2]=f,u[f+24>>2]=A),c=u[c+4>>2]|0,c?(u[A+20>>2]=c,u[c+24>>2]=A,E=_,c=y):(E=_,c=y)}else E=_,c=y}while(0);if(_>>>0>=x>>>0||(A=x+4|0,d=u[A>>2]|0,!(d&1)))return;if(d&2)u[A>>2]=d&-2,u[E+4>>2]=c|1,u[_+c>>2]=c,p=c;else{if((u[5835]|0)==(x|0)){if(x=(u[5832]|0)+c|0,u[5832]=x,u[5835]=E,u[E+4>>2]=x|1,(E|0)!=(u[5834]|0))return;u[5834]=0,u[5831]=0;return}if((u[5834]|0)==(x|0)){x=(u[5831]|0)+c|0,u[5831]=x,u[5834]=_,u[E+4>>2]=x|1,u[_+x>>2]=x;return}p=(d&-8)+c|0,f=d>>>3;do if(d>>>0<256)if(c=u[x+8>>2]|0,A=u[x+12>>2]|0,(A|0)==(c|0)){u[5829]=u[5829]&~(1<<f);break}else{u[c+12>>2]=A,u[A+8>>2]=c;break}else{y=u[x+24>>2]|0,A=u[x+12>>2]|0;do if((A|0)==(x|0)){if(c=x+16|0,f=c+4|0,A=u[f>>2]|0,A)c=f;else if(A=u[c>>2]|0,!A){f=0;break}for(;;)if(d=A+20|0,f=u[d>>2]|0,f)A=f,c=d;else if(d=A+16|0,f=u[d>>2]|0,f)A=f,c=d;else break;u[c>>2]=0,f=A}else f=u[x+8>>2]|0,u[f+12>>2]=A,u[A+8>>2]=f,f=A;while(0);if(y|0){if(A=u[x+28>>2]|0,c=23620+(A<<2)|0,(u[c>>2]|0)==(x|0)){if(u[c>>2]=f,!f){u[5830]=u[5830]&~(1<<A);break}}else if(d=y+16|0,u[((u[d>>2]|0)==(x|0)?d:y+20|0)>>2]=f,!f)break;u[f+24>>2]=y,A=x+16|0,c=u[A>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),A=u[A+4>>2]|0,A|0&&(u[f+20>>2]=A,u[A+24>>2]=f)}}while(0);if(u[E+4>>2]=p|1,u[_+p>>2]=p,(E|0)==(u[5834]|0)){u[5831]=p;return}}if(A=p>>>3,p>>>0<256){f=23356+(A<<1<<2)|0,c=u[5829]|0,A=1<<A,c&A?(c=f+8|0,A=u[c>>2]|0):(u[5829]=c|A,A=f,c=f+8|0),u[c>>2]=E,u[A+12>>2]=E,u[E+8>>2]=A,u[E+12>>2]=f;return}A=p>>>8,A?p>>>0>16777215?d=31:(_=(A+1048320|0)>>>16&8,x=A<<_,y=(x+520192|0)>>>16&4,x=x<<y,d=(x+245760|0)>>>16&2,d=14-(y|_|d)+(x<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1):d=0,A=23620+(d<<2)|0,u[E+28>>2]=d,u[E+20>>2]=0,u[E+16>>2]=0,c=u[5830]|0,f=1<<d;e:do if(!(c&f))u[5830]=c|f,u[A>>2]=E,u[E+24>>2]=A,u[E+12>>2]=E,u[E+8>>2]=E;else{A=u[A>>2]|0;t:do if((u[A+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);f=A+16+(d>>>31<<2)|0,c=u[f>>2]|0,!!c;)if((u[c+4>>2]&-8|0)==(p|0)){A=c;break t}else d=d<<1,A=c;u[f>>2]=E,u[E+24>>2]=A,u[E+12>>2]=E,u[E+8>>2]=E;break e}while(0);_=A+8|0,x=u[_>>2]|0,u[x+12>>2]=E,u[_>>2]=E,u[E+8>>2]=x,u[E+12>>2]=A,u[E+24>>2]=0}while(0);if(x=(u[5837]|0)+-1|0,u[5837]=x,!(x|0)){for(A=23772;A=u[A>>2]|0,A;)A=A+8|0;u[5837]=-1}}function Mi(A,c){A=A|0,c=c|0;var f=0;return A?(f=nn(c,A)|0,(c|A)>>>0>65535&&(f=((f>>>0)/(A>>>0)|0|0)==(c|0)?f:-1)):f=0,A=Ki(f)|0,!A||!(u[A+-4>>2]&3)||Ii(A|0,0,f|0)|0,A|0}function xM(A,c,f,d){return A=A|0,c=c|0,f=f|0,d=d|0,f=A+f>>>0,Re(c+d+(f>>>0<A>>>0|0)>>>0|0),f|0|0}function fA(A,c,f,d){return A=A|0,c=c|0,f=f|0,d=d|0,d=c-d-(f>>>0>A>>>0|0)>>>0,Re(d|0),A-f>>>0|0|0}function L_(A){return A=A|0,(A?31-(jn(A^A-1)|0)|0:32)|0}function bM(A,c,f,d,p){A=A|0,c=c|0,f=f|0,d=d|0,p=p|0;var y=0,_=0,E=0,x=0,I=0,B=0,G=0,W=0,J=0,ie=0;if(B=A,x=c,I=x,_=f,W=d,E=W,!I)return y=(p|0)!=0,E?y?(u[p>>2]=A|0,u[p+4>>2]=c&0,W=0,p=0,Re(W|0),p|0):(W=0,p=0,Re(W|0),p|0):(y&&(u[p>>2]=(B>>>0)%(_>>>0),u[p+4>>2]=0),W=0,p=(B>>>0)/(_>>>0)>>>0,Re(W|0),p|0);y=(E|0)==0;do if(_){if(!y){if(y=(jn(E|0)|0)-(jn(I|0)|0)|0,y>>>0<=31){G=y+1|0,E=31-y|0,c=y-31>>31,_=G,A=B>>>(G>>>0)&c|I<<E,c=I>>>(G>>>0)&c,y=0,E=B<<E;break}return p?(u[p>>2]=A|0,u[p+4>>2]=x|c&0,W=0,p=0,Re(W|0),p|0):(W=0,p=0,Re(W|0),p|0)}if(y=_-1|0,y&_|0){E=(jn(_|0)|0)+33-(jn(I|0)|0)|0,ie=64-E|0,G=32-E|0,x=G>>31,J=E-32|0,c=J>>31,_=E,A=G-1>>31&I>>>(J>>>0)|(I<<G|B>>>(E>>>0))&c,c=c&I>>>(E>>>0),y=B<<ie&x,E=(I<<ie|B>>>(J>>>0))&x|B<<G&E-33>>31;break}return p|0&&(u[p>>2]=y&B,u[p+4>>2]=0),(_|0)==1?(J=x|c&0,ie=A|0|0,Re(J|0),ie|0):(ie=L_(_|0)|0,J=I>>>(ie>>>0)|0,ie=I<<32-ie|B>>>(ie>>>0)|0,Re(J|0),ie|0)}else{if(y)return p|0&&(u[p>>2]=(I>>>0)%(_>>>0),u[p+4>>2]=0),J=0,ie=(I>>>0)/(_>>>0)>>>0,Re(J|0),ie|0;if(!B)return p|0&&(u[p>>2]=0,u[p+4>>2]=(I>>>0)%(E>>>0)),J=0,ie=(I>>>0)/(E>>>0)>>>0,Re(J|0),ie|0;if(y=E-1|0,!(y&E))return p|0&&(u[p>>2]=A|0,u[p+4>>2]=y&I|c&0),J=0,ie=I>>>((L_(E|0)|0)>>>0),Re(J|0),ie|0;if(y=(jn(E|0)|0)-(jn(I|0)|0)|0,y>>>0<=30){c=y+1|0,E=31-y|0,_=c,A=I<<E|B>>>(c>>>0),c=I>>>(c>>>0),y=0,E=B<<E;break}return p?(u[p>>2]=A|0,u[p+4>>2]=x|c&0,J=0,ie=0,Re(J|0),ie|0):(J=0,ie=0,Re(J|0),ie|0)}while(0);if(!_)I=E,x=0,E=0;else{G=f|0|0,B=W|d&0,I=xM(G|0,B|0,-1,-1)|0,f=V()|0,x=E,E=0;do d=x,x=y>>>31|x<<1,y=E|y<<1,d=A<<1|d>>>31|0,W=A>>>31|c<<1|0,fA(I|0,f|0,d|0,W|0)|0,ie=V()|0,J=ie>>31|((ie|0)<0?-1:0)<<1,E=J&1,A=fA(d|0,W|0,J&G|0,(((ie|0)<0?-1:0)>>31|((ie|0)<0?-1:0)<<1)&B|0)|0,c=V()|0,_=_-1|0;while((_|0)!=0);I=x,x=0}return _=0,p|0&&(u[p>>2]=A,u[p+4>>2]=c),J=(y|0)>>>31|(I|_)<<1|(_<<1|y>>>31)&0|x,ie=(y<<1|0>>>31)&-2|E,Re(J|0),ie|0}function Gr(A,c,f,d){A=A|0,c=c|0,f=f|0,d=d|0;var p=0,y=0;return y=k,k=k+16|0,p=y|0,bM(A,c,f,d,p)|0,k=y,Re(u[p+4>>2]|0),u[p>>2]|0|0}function ge(A,c,f){return A=A|0,c=c|0,f=f|0,(f|0)<32?(Re(c>>>f|0),A>>>f|(c&(1<<f)-1)<<32-f):(Re(0),c>>>f-32|0)}function Ce(A,c,f){return A=A|0,c=c|0,f=f|0,(f|0)<32?(Re(c<<f|(A&(1<<f)-1<<32-f)>>>32-f|0),A<<f):(Re(A<<f-32|0),0)}function R_(A,c){return A=+A,c=+c,A!=A?+c:c!=c?+A:+Si(+A,+c)}function Ic(A){return A=+A,A>=0?+nt(A+.5):+bi(A-.5)}function Bc(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0;if((f|0)>=8192)return Wn(A|0,c|0,f|0)|0,A|0;if(y=A|0,p=A+f|0,(A&3)==(c&3)){for(;A&3;){if(!f)return y|0;Fe[A>>0]=Fe[c>>0]|0,A=A+1|0,c=c+1|0,f=f-1|0}for(f=p&-4|0,d=f-64|0;(A|0)<=(d|0);)u[A>>2]=u[c>>2],u[A+4>>2]=u[c+4>>2],u[A+8>>2]=u[c+8>>2],u[A+12>>2]=u[c+12>>2],u[A+16>>2]=u[c+16>>2],u[A+20>>2]=u[c+20>>2],u[A+24>>2]=u[c+24>>2],u[A+28>>2]=u[c+28>>2],u[A+32>>2]=u[c+32>>2],u[A+36>>2]=u[c+36>>2],u[A+40>>2]=u[c+40>>2],u[A+44>>2]=u[c+44>>2],u[A+48>>2]=u[c+48>>2],u[A+52>>2]=u[c+52>>2],u[A+56>>2]=u[c+56>>2],u[A+60>>2]=u[c+60>>2],A=A+64|0,c=c+64|0;for(;(A|0)<(f|0);)u[A>>2]=u[c>>2],A=A+4|0,c=c+4|0}else for(f=p-4|0;(A|0)<(f|0);)Fe[A>>0]=Fe[c>>0]|0,Fe[A+1>>0]=Fe[c+1>>0]|0,Fe[A+2>>0]=Fe[c+2>>0]|0,Fe[A+3>>0]=Fe[c+3>>0]|0,A=A+4|0,c=c+4|0;for(;(A|0)<(p|0);)Fe[A>>0]=Fe[c>>0]|0,A=A+1|0,c=c+1|0;return y|0}function Ii(A,c,f){A=A|0,c=c|0,f=f|0;var d=0,p=0,y=0,_=0;if(y=A+f|0,c=c&255,(f|0)>=67){for(;A&3;)Fe[A>>0]=c,A=A+1|0;for(d=y&-4|0,_=c|c<<8|c<<16|c<<24,p=d-64|0;(A|0)<=(p|0);)u[A>>2]=_,u[A+4>>2]=_,u[A+8>>2]=_,u[A+12>>2]=_,u[A+16>>2]=_,u[A+20>>2]=_,u[A+24>>2]=_,u[A+28>>2]=_,u[A+32>>2]=_,u[A+36>>2]=_,u[A+40>>2]=_,u[A+44>>2]=_,u[A+48>>2]=_,u[A+52>>2]=_,u[A+56>>2]=_,u[A+60>>2]=_,A=A+64|0;for(;(A|0)<(d|0);)u[A>>2]=_,A=A+4|0}for(;(A|0)<(y|0);)Fe[A>>0]=c,A=A+1|0;return y-f|0}function O_(A){return A=+A,A>=0?+nt(A+.5):+bi(A-.5)}function zr(A){A=A|0;var c=0,f=0,d=0;return d=Co()|0,f=u[$e>>2]|0,c=f+A|0,(A|0)>0&(c|0)<(f|0)|(c|0)<0?(rA(c|0)|0,iA(12),-1):(c|0)>(d|0)&&!(xo(c|0)|0)?(iA(12),-1):(u[$e>>2]=c,f|0)}return{___uremdi3:Gr,_bitshift64Lshr:ge,_bitshift64Shl:Ce,_calloc:Mi,_cellAreaKm2:BP,_cellAreaM2:LP,_cellAreaRads2:IP,_compact:UP,_destroyLinkedPolygon:tM,_edgeLengthKm:SP,_edgeLengthM:PP,_emscripten_replace_memory:sA,_exactEdgeLengthKm:OP,_exactEdgeLengthM:FP,_exactEdgeLengthRads:RP,_experimentalH3ToLocalIj:nM,_experimentalLocalIjToH3:iM,_free:He,_geoToH3:y_,_getDestinationH3IndexFromUnidirectionalEdge:YP,_getH3IndexesFromUnidirectionalEdge:ZP,_getH3UnidirectionalEdge:XP,_getH3UnidirectionalEdgeBoundary:Sc,_getH3UnidirectionalEdgesFromHexagon:qP,_getOriginH3IndexFromUnidirectionalEdge:JP,_getPentagonIndexes:Ad,_getRes0Indexes:cP,_h3Distance:rM,_h3GetBaseCell:m_,_h3GetFaces:v_,_h3GetResolution:DP,_h3IndexesAreNeighbors:E_,_h3IsPentagon:Xt,_h3IsResClassIII:VP,_h3IsValid:__,_h3Line:oM,_h3LineSize:sM,_h3SetToLinkedGeo:zt,_h3ToCenterChild:NP,_h3ToChildren:On,_h3ToGeo:Rs,_h3ToGeoBoundary:Os,_h3ToParent:rd,_h3UnidirectionalEdgeIsValid:KP,_hexAreaKm2:xP,_hexAreaM2:bP,_hexRing:O,_i64Subtract:fA,_kRing:So,_kRingDistances:Tc,_llvm_minnum_f64:R_,_llvm_round_f64:Ic,_malloc:Ki,_maxFaceCount:WP,_maxH3ToChildrenSize:kP,_maxKringSize:wc,_maxPolyfillSize:z,_maxUncompactSize:zP,_memcpy:Bc,_memset:Ii,_numHexagons:MP,_pentagonIndexCount:QP,_pointDistKm:cA,_pointDistM:wP,_pointDistRads:EP,_polyfill:Z,_res0IndexCount:lP,_round:O_,_sbrk:zr,_sizeOfCoordIJ:gM,_sizeOfGeoBoundary:uM,_sizeOfGeoCoord:cM,_sizeOfGeoPolygon:hM,_sizeOfGeofence:fM,_sizeOfH3Index:lM,_sizeOfLinkedGeoPolygon:dM,_uncompact:GP,establishStackSpace:Zh,stackAlloc:oA,stackRestore:Pi,stackSave:bo}}(pc,mc,D);e.___uremdi3=me.___uremdi3,e._bitshift64Lshr=me._bitshift64Lshr,e._bitshift64Shl=me._bitshift64Shl,e._calloc=me._calloc,e._cellAreaKm2=me._cellAreaKm2,e._cellAreaM2=me._cellAreaM2,e._cellAreaRads2=me._cellAreaRads2,e._compact=me._compact,e._destroyLinkedPolygon=me._destroyLinkedPolygon,e._edgeLengthKm=me._edgeLengthKm,e._edgeLengthM=me._edgeLengthM;var Yh=e._emscripten_replace_memory=me._emscripten_replace_memory;e._exactEdgeLengthKm=me._exactEdgeLengthKm,e._exactEdgeLengthM=me._exactEdgeLengthM,e._exactEdgeLengthRads=me._exactEdgeLengthRads,e._experimentalH3ToLocalIj=me._experimentalH3ToLocalIj,e._experimentalLocalIjToH3=me._experimentalLocalIjToH3,e._free=me._free,e._geoToH3=me._geoToH3,e._getDestinationH3IndexFromUnidirectionalEdge=me._getDestinationH3IndexFromUnidirectionalEdge,e._getH3IndexesFromUnidirectionalEdge=me._getH3IndexesFromUnidirectionalEdge,e._getH3UnidirectionalEdge=me._getH3UnidirectionalEdge,e._getH3UnidirectionalEdgeBoundary=me._getH3UnidirectionalEdgeBoundary,e._getH3UnidirectionalEdgesFromHexagon=me._getH3UnidirectionalEdgesFromHexagon,e._getOriginH3IndexFromUnidirectionalEdge=me._getOriginH3IndexFromUnidirectionalEdge,e._getPentagonIndexes=me._getPentagonIndexes,e._getRes0Indexes=me._getRes0Indexes,e._h3Distance=me._h3Distance,e._h3GetBaseCell=me._h3GetBaseCell,e._h3GetFaces=me._h3GetFaces,e._h3GetResolution=me._h3GetResolution,e._h3IndexesAreNeighbors=me._h3IndexesAreNeighbors,e._h3IsPentagon=me._h3IsPentagon,e._h3IsResClassIII=me._h3IsResClassIII,e._h3IsValid=me._h3IsValid,e._h3Line=me._h3Line,e._h3LineSize=me._h3LineSize,e._h3SetToLinkedGeo=me._h3SetToLinkedGeo,e._h3ToCenterChild=me._h3ToCenterChild,e._h3ToChildren=me._h3ToChildren,e._h3ToGeo=me._h3ToGeo,e._h3ToGeoBoundary=me._h3ToGeoBoundary,e._h3ToParent=me._h3ToParent,e._h3UnidirectionalEdgeIsValid=me._h3UnidirectionalEdgeIsValid,e._hexAreaKm2=me._hexAreaKm2,e._hexAreaM2=me._hexAreaM2,e._hexRing=me._hexRing,e._i64Subtract=me._i64Subtract,e._kRing=me._kRing,e._kRingDistances=me._kRingDistances,e._llvm_minnum_f64=me._llvm_minnum_f64,e._llvm_round_f64=me._llvm_round_f64,e._malloc=me._malloc,e._maxFaceCount=me._maxFaceCount,e._maxH3ToChildrenSize=me._maxH3ToChildrenSize,e._maxKringSize=me._maxKringSize,e._maxPolyfillSize=me._maxPolyfillSize,e._maxUncompactSize=me._maxUncompactSize,e._memcpy=me._memcpy,e._memset=me._memset,e._numHexagons=me._numHexagons,e._pentagonIndexCount=me._pentagonIndexCount,e._pointDistKm=me._pointDistKm,e._pointDistM=me._pointDistM,e._pointDistRads=me._pointDistRads,e._polyfill=me._polyfill,e._res0IndexCount=me._res0IndexCount,e._round=me._round,e._sbrk=me._sbrk,e._sizeOfCoordIJ=me._sizeOfCoordIJ,e._sizeOfGeoBoundary=me._sizeOfGeoBoundary,e._sizeOfGeoCoord=me._sizeOfGeoCoord,e._sizeOfGeoPolygon=me._sizeOfGeoPolygon,e._sizeOfGeofence=me._sizeOfGeofence,e._sizeOfH3Index=me._sizeOfH3Index,e._sizeOfLinkedGeoPolygon=me._sizeOfLinkedGeoPolygon,e._uncompact=me._uncompact,e.establishStackSpace=me.establishStackSpace;var _c=e.stackAlloc=me.stackAlloc,Kh=e.stackRestore=me.stackRestore,yc=e.stackSave=me.stackSave;if(e.asm=me,e.cwrap=M,e.setValue=w,e.getValue=C,e.getTempRet0=m,Dt){fc(Dt)||(Dt=s(Dt));{uc();var tA=function(Y){Y.byteLength&&(Y=new Uint8Array(Y)),re.set(Y,v),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,_o()},vc=function(){o(Dt,tA,function(){throw"could not load memory initializer "+Dt})},Ec=eA(Dt);if(Ec)tA(Ec.buffer);else if(e.memoryInitializerRequest){var Ms=function(){var Y=e.memoryInitializerRequest,Ae=Y.response;if(Y.status!==200&&Y.status!==0){var _e=eA(e.memoryInitializerRequestURL);if(_e)Ae=_e.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Y.status+", retrying "+Dt),vc();return}}tA(Ae)};e.memoryInitializerRequest.response?setTimeout(Ms,0):e.memoryInitializerRequest.addEventListener("load",Ms)}else vc()}}var wo;Fr=function Y(){wo||nA(),wo||(Fr=Y)};function nA(Y){if(bn>0||(dt(),bn>0))return;function Ae(){wo||(wo=!0,!b&&(dn(),Ke(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Et()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Ae()},1)):Ae()}e.run=nA;function Ji(Y){throw e.onAbort&&e.onAbort(Y),Y+="",a(Y),l(Y),b=!0,"abort("+Y+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Ji,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return nA(),t}(typeof Mt=="object"?Mt:{}),Oe="number",MA=Oe,Ne=Oe,We=Oe,Dn=Oe,tt=Oe,NH=[["sizeOfH3Index",Oe],["sizeOfGeoCoord",Oe],["sizeOfGeoBoundary",Oe],["sizeOfGeoPolygon",Oe],["sizeOfGeofence",Oe],["sizeOfLinkedGeoPolygon",Oe],["sizeOfCoordIJ",Oe],["h3IsValid",MA,[Ne,We]],["geoToH3",Ne,[Oe,Oe,Dn]],["h3ToGeo",null,[Ne,We,tt]],["h3ToGeoBoundary",null,[Ne,We,tt]],["maxKringSize",Oe,[Oe]],["kRing",null,[Ne,We,Oe,tt]],["kRingDistances",null,[Ne,We,Oe,tt,tt]],["hexRing",null,[Ne,We,Oe,tt]],["maxPolyfillSize",Oe,[tt,Dn]],["polyfill",null,[tt,Dn,tt]],["h3SetToLinkedGeo",null,[tt,Oe,tt]],["destroyLinkedPolygon",null,[tt]],["compact",Oe,[tt,tt,Oe]],["uncompact",Oe,[tt,Oe,tt,Oe,Dn]],["maxUncompactSize",Oe,[tt,Oe,Dn]],["h3IsPentagon",MA,[Ne,We]],["h3IsResClassIII",MA,[Ne,We]],["h3GetBaseCell",Oe,[Ne,We]],["h3GetResolution",Oe,[Ne,We]],["maxFaceCount",Oe,[Ne,We]],["h3GetFaces",null,[Ne,We,tt]],["h3ToParent",Ne,[Ne,We,Dn]],["h3ToChildren",null,[Ne,We,Dn,tt]],["h3ToCenterChild",Ne,[Ne,We,Dn]],["maxH3ToChildrenSize",Oe,[Ne,We,Dn]],["h3IndexesAreNeighbors",MA,[Ne,We,Ne,We]],["getH3UnidirectionalEdge",Ne,[Ne,We,Ne,We]],["getOriginH3IndexFromUnidirectionalEdge",Ne,[Ne,We]],["getDestinationH3IndexFromUnidirectionalEdge",Ne,[Ne,We]],["h3UnidirectionalEdgeIsValid",MA,[Ne,We]],["getH3IndexesFromUnidirectionalEdge",null,[Ne,We,tt]],["getH3UnidirectionalEdgesFromHexagon",null,[Ne,We,tt]],["getH3UnidirectionalEdgeBoundary",null,[Ne,We,tt]],["h3Distance",Oe,[Ne,We,Ne,We]],["h3Line",Oe,[Ne,We,Ne,We,tt]],["h3LineSize",Oe,[Ne,We,Ne,We]],["experimentalH3ToLocalIj",Oe,[Ne,We,Ne,We,tt]],["experimentalLocalIjToH3",Oe,[Ne,We,tt,tt]],["hexAreaM2",Oe,[Dn]],["hexAreaKm2",Oe,[Dn]],["edgeLengthM",Oe,[Dn]],["edgeLengthKm",Oe,[Dn]],["pointDistM",Oe,[tt,tt]],["pointDistKm",Oe,[tt,tt]],["pointDistRads",Oe,[tt,tt]],["cellAreaM2",Oe,[Ne,We]],["cellAreaKm2",Oe,[Ne,We]],["cellAreaRads2",Oe,[Ne,We]],["exactEdgeLengthM",Oe,[Ne,We]],["exactEdgeLengthKm",Oe,[Ne,We]],["exactEdgeLengthRads",Oe,[Ne,We]],["numHexagons",Oe,[Dn]],["getRes0Indexes",null,[tt]],["res0IndexCount",Oe],["getPentagonIndexes",null,[Oe,tt]],["pentagonIndexCount",Oe]],en={};NH.forEach(function(e){en[e[0]]=Mt.cwrap.apply(Mt,e)});var ca=16,UH=4,ME=4,ka=8,GH=en.sizeOfH3Index(),ZS=en.sizeOfGeoCoord(),zH=en.sizeOfGeoBoundary();en.sizeOfGeoPolygon();en.sizeOfGeofence();var VH=en.sizeOfLinkedGeoPolygon();en.sizeOfCoordIJ();var IE={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function HH(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw new Error("Invalid resolution: "+t)}var jH=/[^0-9a-fA-F]/;function co(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||jH.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),ca),n=parseInt(t.substring(t.length-8),ca);return[n,e]}function BE(t){if(t>=0)return t.toString(ca);t=t&2147483647;var e=qS(8,t.toString(ca)),n=(parseInt(e[0],ca)+8).toString(ca);return e=n+e.substring(1),e}function WH(t,e){return BE(e)+qS(8,BE(t))}function qS(t,e){for(var n=t-e.length,i="",r=0;r<n;r++)i+="0";return i=i+e,i}function QH(t){var e=Mt.getTempRet0();return[t,e]}function XH(t){var e=QH(t),n=e[0],i=e[1];return i?WH(n,i):null}function JH(t,e,n){Mt.HEAPU32.set(co(t),e/UH+2*n)}function YH(t,e){for(var n=e.length,i=0;i<n;i++)JH(e[i],t,i)}function Zf(t){return oj(Mt.getValue(t,"double"))}function k1(t){return[Zf(t),Zf(t+ka)]}function $S(t){return[Zf(t+ka),Zf(t)]}function KH(t,e,n){for(var i=Mt.getValue(t,"i32"),r=t+ka,s=[],o=e?$S:k1,a=0;a<i*2;a+=2)s.push(o(r+ka*a));return n&&s.push(s[0]),s}function ZH(t,e){for(var n=[],i=e?$S:k1,r,s,o,a;t;){for(n.push(r=[]),s=Mt.getValue(t,"i8*");s;){for(r.push(o=[]),a=Mt.getValue(s,"i8*");a;)o.push(i(a)),a=Mt.getValue(a+ka*2,"i8*");e&&o.push(o[0]),s=Mt.getValue(s+ME*2,"i8*")}t=Mt.getValue(t+ME*2,"i8*")}return n}function qH(t){var e=co(t),n=e[0],i=e[1];return Boolean(en.h3IsPentagon(n,i))}function $H(t){var e=co(t),n=e[0],i=e[1];return en.h3IsValid(n,i)?en.h3GetResolution(n,i):-1}function ej(t,e,n){var i=Mt._malloc(ZS);Mt.HEAPF64.set([t,e].map(sj),i/ka);var r=XH(en.geoToH3(i,n));return Mt._free(i),r}function N1(t){var e=Mt._malloc(ZS),n=co(t),i=n[0],r=n[1];en.h3ToGeo(i,r,e);var s=k1(e);return Mt._free(e),s}function tj(t,e){var n=Mt._malloc(zH),i=co(t),r=i[0],s=i[1];en.h3ToGeoBoundary(r,s,n);var o=KH(n,e,e);return Mt._free(n),o}function nj(t,e){if(!t||!t.length)return[];var n=t.length,i=Mt._calloc(n,GH);YH(i,t);var r=Mt._calloc(VH),s=r;en.h3SetToLinkedGeo(i,n,r);var o=ZH(r,e);return en.destroyLinkedPolygon(s),Mt._free(s),Mt._free(i),o}function ij(t,e){var n=co(t),i=n[0],r=n[1],s=co(e),o=s[0],a=s[1];return en.h3Distance(i,r,o,a)}function rj(t,e){switch(HH(t),e){case IE.m:return en.edgeLengthM(t);case IE.km:return en.edgeLengthKm(t);default:throw new Error("Unknown unit: "+e)}}function sj(t){return t*Math.PI/180}function oj(t){return t*180/Math.PI}const aj={getHexagons:{type:"accessor",value:t=>t.hexagons}};class e3 extends Xa{initializeState(){Ja._checkH3Lib()}updateState({props:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagons){const{data:i,getHexagons:r}=e,s=[],{iterable:o,objectInfo:a}=xs(i);for(const l of o){a.index++;const h=r(l,a),g=nj(h,!0);for(const m of g)s.push(this.getSubLayerRow({polygon:m},l,a.index))}this.setState({polygons:s})}}indexToBounds(){return{data:this.state.polygons,getPolygon:e=>e.polygon}}}T(e3,"layerName","H3ClusterLayer");T(e3,"defaultProps",aj);const Aj=10;function t3(t,e){e=e===void 0?t[0][0]:e;for(const n of t){const i=n[0]-e;i>180?n[0]-=360:i<-180&&(n[0]+=360)}}function lj(t,e,n){const[i,r]=N1(t),s=e.length;t3(e,r);const o=e[0]===e[s-1]?s-1:s;for(let a=0;a<o;a++)e[a][0]=Vi(r,e[a][0],n),e[a][1]=Vi(i,e[a][1],n)}function cj(t,e,n){const i=t(e,n),[r,s]=N1(i);return[s,r]}function LE(t,e=1){const n=tj(t,!0);return e!==1?lj(t,n,e):t3(n),n}function uj(t){const e=new Float64Array(t.length*2);let n=0;for(const i of t)e[n++]=i[0],e[n++]=i[1];return e}function fj(t,e){let n;return t==null?n=e:typeof t=="object"?n={...t,coverage:e}:n={getHexagon:t,coverage:e},n}const hj={...Qa.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class Ja extends Or{constructor(...e){super(...e),T(this,"state",void 0)}initializeState(){Ja._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:n}){if(e.highPrecision!==!0&&(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagon)){const i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,n=!1,i=!1;const{iterable:r,objectInfo:s}=xs(this.props.data);for(const o of r){s.index++;const a=this.props.getHexagon(o,s),l=$H(a);if(e<0){if(e=l,!this.props.highPrecision)break}else if(e!==l){i=!0;break}if(qH(a)){n=!0;break}}return{resolution:e,edgeLengthKM:e>=0?rj(e,"km"):0,hasMultipleRes:i,hasPentagon:n}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:n,hasMultipleRes:i}=this.state,{viewport:r}=this.context;return Boolean(r==null?void 0:r.resolution)||i||n||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:n,edgeLengthKM:i,centerHex:r}=this.state;if(n<0)return;const s=this.props.centerHexagon||ej(e.latitude,e.longitude,n);if(r===s)return;if(r){const v=ij(r,s);if(v>=0&&v*i<Aj)return}const{unitsPerMeter:o}=e.distanceScales;let a=LE(s);const[l,h]=N1(s),[g,m]=e.projectFlat([h,l]);a=a.map(v=>{const w=e.projectFlat(v);return[(w[0]-g)/o[0],(w[1]-m)/o[1]]}),this.setState({centerHex:s,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:n,coverage:i,extruded:r,wireframe:s,stroked:o,filled:a,lineWidthUnits:l,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,getFillColor:v,getElevation:w,getLineColor:C,getLineWidth:b,transitions:R,updateTriggers:S}=this.props;return{elevationScale:e,extruded:r,coverage:i,wireframe:s,stroked:o,filled:a,lineWidthUnits:l,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,material:n,getElevation:w,getFillColor:v,getLineColor:C,getLineWidth:b,transitions:R,updateTriggers:{getFillColor:S.getFillColor,getElevation:S.getElevation,getLineColor:S.getLineColor,getLineWidth:S.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:n,updateTriggers:i,coverage:r}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",Qa),o=this._getForwardProps();return o.updateTriggers.getPolygon=fj(i.getHexagon,r),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,l)=>{const h=n(a,l);return uj(LE(h,r))}})}_renderColumnLayer(){const{data:e,getHexagon:n,updateTriggers:i}=this.props,r=this.getSubLayerClass("hexagon-cell",Oh),s=this._getForwardProps();return s.updateTriggers.getPosition=i.getHexagon,new r(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:cj.bind(null,n)})}}T(Ja,"defaultProps",hj);T(Ja,"layerName","H3HexagonLayer");T(Ja,"_checkH3Lib",()=>{});const w0=Math.PI/180,wu=new Float32Array(16),RE=new Float32Array(12);function OE(t,e,n){const i=e[0]*w0,r=e[1]*w0,s=e[2]*w0,o=Math.sin(s),a=Math.sin(i),l=Math.sin(r),h=Math.cos(s),g=Math.cos(i),m=Math.cos(r),v=n[0],w=n[1],C=n[2];t[0]=v*m*g,t[1]=v*l*g,t[2]=v*-a,t[3]=w*(-l*h+m*a*o),t[4]=w*(m*h+l*a*o),t[5]=w*g*o,t[6]=C*(l*o+m*a*h),t[7]=C*(-m*o+l*a*h),t[8]=C*g*h}function FE(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const n3={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:i,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),h=l&&a.length===16,g=Array.isArray(s),m=Array.isArray(r),v=Array.isArray(o),w=h||!l&&Boolean(a(i[0]));w?t.constant=h:t.constant=m&&g&&v;const C=t.value;if(t.constant){let b;w?(wu.set(a),b=FE(wu)):(b=RE,OE(b,r,s),b.set(o,9)),t.value=new Float32Array(b)}else{let b=e*t.size;const{iterable:R,objectInfo:S}=xs(i,e,n);for(const P of R){S.index++;let M;if(w)wu.set(h?a:a(P,S)),M=FE(wu);else{M=RE;const F=m?r:r(P,S),H=g?s:s(P,S);OE(M,F,H),M.set(v?o:o(P,S),9)}C[b++]=M[0],C[b++]=M[1],C[b++]=M[2],C[b++]=M[3],C[b++]=M[4],C[b++]=M[5],C[b++]=M[6],C[b++]=M[7],C[b++]=M[8],C[b++]=M[9],C[b++]=M[10],C[b++]=M[11]}}}};function i3(t,e){return e===Ge.CARTESIAN||e===Ge.METER_OFFSETS||e===Ge.DEFAULT&&!t.isGeospatial}const dj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs

// Scale the model
uniform float sizeScale;
uniform bool composeModelMatrix;

// Primitive attributes
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;

// Instance attributes
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;

// Outputs to fragment shader
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    // using instancePositions as world coordinates
    // when using globe mode, this branch does not re-orient the model to align with the surface of the earth
    // call project_normal before setting position to avoid rotation
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,gj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {

// NOTE(Tarek): This is necessary because
// headless.gl reports the extension as
// available but does not support it in
// the shader.
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function DE(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),De.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function pj(t,e){if(t.attributes)return DE(t.attributes,e),t instanceof Bn?t:new Bn(t);if(t.positions||t.POSITION)return DE(t,e),new Bn({attributes:t});throw Error("Invalid mesh")}const mj=[0,0,0,255],_j={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:mj},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}};class Gl extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){const e=!Xe(this.context.gl),n={};return Ch(this.context.gl,pt.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:dj,fs:gj,modules:[Ti,Pb,Ci],transpileToGLSL100:e,defines:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:n3}),this.setState({emptyTexture:new hn(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e;if(n.mesh!==i.mesh||r.extensionsChanged){var s;if((s=this.state.model)===null||s===void 0||s.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:Boolean(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:r,_instanced:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!s||i3(n,r),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new Cn(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:pj(e,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:r}=this.state;return n.setUniforms({sampler:i||r,hasTexture:Boolean(i)}),n}setTexture(e){const{emptyTexture:n,model:i}=this.state;i&&i.setUniforms({sampler:e||n,hasTexture:Boolean(e)})}}T(Gl,"defaultProps",_j);T(Gl,"layerName","SimpleMeshLayer");class wa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||Wi(this.constructor.name),this.display=!0,this.position=new q,this.rotation=new q,this.scale=new q(1,1,1),this.matrix=new ze,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}setPosition(e){return we(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return we(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return we(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:i,scale:r,update:s=!0}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:i,scale:r}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,n){we(e),n=n||this.matrix;const i=new ze(e).multiplyRight(n),r=i.invert(),s=r.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:r,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class al extends wa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;Le.assert(n.every(i=>i instanceof wa),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const r of n)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const n=this.children,i=n.indexOf(e);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}traverse(e){let{worldMatrix:n=new ze}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new ze(n).multiplyRight(this.matrix);for(const r of this.children)r instanceof al?r.traverse(e,{worldMatrix:i}):e(r,{worldMatrix:i})}}const yj={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vj={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function kE(t){if(!t._animation){const e=vj[t.componentType],n=yj[t.type],i=n*t.count,{buffer:r,byteOffset:s}=t.bufferView.data,o=new e(r,s+(t.byteOffset||0),i);if(n===1)t._animation=Array.from(o);else{const a=[];for(let l=0;l<o.length;l+=n)a.push(Array.from(o.slice(l,l+n)));t._animation=a}}return t._animation}const Ej=new ze;function wj(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=Ej.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const T0=new Pl;function Tj(t,e,n,i,r){if(e==="rotation"){T0.slerp({start:n,target:i,ratio:r});for(let s=0;s<T0.length;s++)t[e][s]=T0[s]}else for(let s=0;s<n.length;s++)t[e][s]=r*i[s]+(1-r)*n[s]}function Cj(t,e,n){let{p0:i,outTangent0:r,inTangent1:s,p1:o,tDiff:a,ratio:l}=n;for(let h=0;h<t[e].length;h++){const g=r[h]*a,m=s[h]*a;t[e][h]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*i[h]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*g+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[h]+(Math.pow(l,3)-Math.pow(l,2))*m}}function xj(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}function bj(t,e,n,i){let{input:r,interpolation:s,output:o}=e;const a=r[r.length-1],l=t%a,h=r.findIndex(w=>w>=l),g=Math.max(0,h-1);if(!Array.isArray(n[i]))switch(i){case"translation":n[i]=[0,0,0];break;case"rotation":n[i]=[0,0,0,1];break;case"scale":n[i]=[1,1,1];break;default:Le.warn("Bad animation path ".concat(i))()}we(n[i].length===o[g].length);const m=r[g],v=r[h];switch(s){case"STEP":xj(n,i,o[g]);break;case"LINEAR":if(v>m){const w=(l-m)/(v-m);Tj(n,i,o[g],o[h],w)}break;case"CUBICSPLINE":if(v>m){const w=(l-m)/(v-m),C=v-m,b=o[3*g+1],R=o[3*g+2],S=o[3*h+0],P=o[3*h+1];Cj(n,i,{p0:b,outTangent0:R,inTangent1:S,p1:P,tDiff:C,ratio:w})}break;default:Le.warn("Interpolation ".concat(s," not supported"))();break}}class Sj{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:s,target:o,path:a}=r;bj(i,s,o,a),wj(o,o._node)})}}class Pj{constructor(e){this.animations=e.animations.map((n,i)=>{const r=n.name||"Animation-".concat(i),s=n.samplers.map(a=>{let{input:l,interpolation:h="LINEAR",output:g}=a;return{input:kE(e.accessors[l]),interpolation:h,output:kE(e.accessors[g])}}),o=n.channels.map(a=>{let{sampler:l,target:h}=a;return{sampler:s[l],target:e.nodes[h.node],path:h.path}});return new Sj({name:r,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class Mj extends wa{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof Cn?(this.model=e,this._setModelNodeProps(n)):this.model=new Cn(e,n),this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class r3{constructor(e,n){let{attributes:i,material:r,pbrDebug:s,imageBasedLightingEnvironment:o,lights:a,useTangents:l}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Ch(e,pt.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&l,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),r&&this.parseMaterial(r)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},s=e.texture.source.image;let o,a={};s.compressed?(o=s,a={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:s};const l=new hn(this.gl,{id:e.name||e.id,parameters:{...r,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[n]=l,this.defineIfPresent(i,i),this.generatedTextures.push(l)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:i=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,i]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=Boolean(e.unlit),e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(Le.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const Ij=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,Bj=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function NE(t,e){return Xe(t)?`#version 300 es
`.concat(e):e}function Lj(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:s,modelOptions:o}=e,a=new r3(t,e);Le.info(4,"createGLTFModel defines: ",a.defines)();const l=[];l.push(...a.generatedTextures),l.push(...Object.values(s).map(g=>g.buffer));const h=new Mj(t,Object.assign({id:n,drawMode:i,vertexCount:r,modules:[f1],defines:a.defines,parameters:a.parameters,vs:NE(t,Ij),fs:NE(t,Bj),managedResources:l},o));return h.setProps({attributes:s}),h.setUniforms(a.uniforms),h}const Rj={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Oj={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Fj{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},Oj,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new Pj(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(s=>this.createNode(s));return new al({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(s=>this.createNode(s));e.mesh&&i.push(this.createMesh(e.mesh));const r=new al({id:e.name||e.id,children:i});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const s=new ze().fromQuaternion(e.rotation);r.matrix.multiplyRight(s)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((s,o)=>this.createPrimitive(s,o,e)),r=new al({id:e.name||e.id,children:i});e._mesh=r}return e._mesh}getVertexCount(e){Le.warn("getVertexCount() not found")()}createPrimitive(e,n,i){return Lj(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options))}createAttributes(e,n){const i={};return Object.keys(e).forEach(r=>{i[r]=this.createAccessor(e[r],this.createBuffer(e[r],this.gl.ARRAY_BUFFER))}),n&&(i.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),Le.info(4,"glTF Attributes",{attributes:e,indices:n,generated:i})(),i}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new ft(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}createAccessor(e,n){return new Un({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:Rj[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function Dj(t,e,n){const i=new Fj(t,n),r=i.instantiate(e),s=i.createAnimator();return{scenes:r,animator:s}}const kj="3.2.9",Nj="3.2.9",s3="3.2.9",Uj="https://unpkg.com/@loaders.gl/textures@".concat(s3,"/dist/libs/basis_encoder.wasm"),Gj="https://unpkg.com/@loaders.gl/textures@".concat(s3,"/dist/libs/basis_encoder.js");let C0;async function UE(t){const e=t.modules||{};return e.basis?e.basis:(C0=C0||zj(t),await C0)}async function zj(t){let e=null,n=null;return[e,n]=await Promise.all([await qs("basis_transcoder.js","textures",t),await qs("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await Vj(e,n)}function Vj(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),i({BasisFile:s})})})}let x0;async function GE(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(x0=x0||Hj(t),await x0)}async function Hj(t){let e=null,n=null;return[e,n]=await Promise.all([await qs(Gj,"textures",t),await qs(Uj,"textures",t)]),e=e||globalThis.BASIS,await jj(e,n)}function jj(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:l}=r;a(),i({BasisFile:s,KTX2File:o,BasisEncoder:l})})})}const No={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Wj=["","WEBKIT_","MOZ_"],zE={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Tu=null;function Qj(t){if(!Tu){t=t||Xj()||void 0,Tu=new Set;for(const e of Wj)for(const n in zE)if(t&&t.getExtension("".concat(e).concat(n))){const i=zE[n];Tu.add(i)}}return Tu}function Xj(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var VE,HE,jE,WE,QE,XE,JE,YE;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(VE||(VE={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(HE||(HE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(jE||(jE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(WE||(WE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(QE||(QE={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(XE||(XE={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(JE||(JE={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(YE||(YE={}));const Yn=[171,75,84,88,32,50,48,187,13,10,26,10];function Jj(t){const e=new Uint8Array(t);return!(e.byteLength<Yn.length||e[0]!==Yn[0]||e[1]!==Yn[1]||e[2]!==Yn[2]||e[3]!==Yn[3]||e[4]!==Yn[4]||e[5]!==Yn[5]||e[6]!==Yn[6]||e[7]!==Yn[7]||e[8]!==Yn[8]||e[9]!==Yn[9]||e[10]!==Yn[10]||e[11]!==Yn[11])}const Yj={etc1:{basisFormat:0,compressed:!0,format:No.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:No.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:No.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:No.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:No.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:No.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Kj(t,e){if(e.basis.containerFormat==="auto"){if(Jj(t)){const i=await GE(e);return KE(i.KTX2File,t,e)}const{BasisFile:n}=await UE(e);return b0(n,t,e)}switch(e.basis.module){case"encoder":const n=await GE(e);switch(e.basis.containerFormat){case"ktx2":return KE(n.KTX2File,t,e);case"basis":default:return b0(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await UE(e);return b0(i,t,e)}}function b0(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const r=i.getNumImages(),s=[];for(let o=0;o<r;o++){const a=i.getNumLevels(o),l=[];for(let h=0;h<a;h++)l.push(Zj(i,o,h,n));s.push(l)}return s}finally{i.close(),i.delete()}}function Zj(t,e,n,i){const r=t.getImageWidth(e,n),s=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:l,basisFormat:h}=o3(i,o),g=t.getImageTranscodedSizeInBytes(e,n,h),m=new Uint8Array(g);if(!t.transcodeImage(m,e,n,h,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:m,compressed:a,format:l,hasAlpha:o}}function KE(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=i.getLevels(),s=[];for(let o=0;o<r;o++){s.push(qj(i,o,n));break}return[s]}finally{i.close(),i.delete()}}function qj(t,e,n){const{alphaFlag:i,height:r,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:l}=o3(n,i),h=t.getImageTranscodedSizeInBytes(e,0,0,l),g=new Uint8Array(h);if(!t.transcodeImage(g,e,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:g,compressed:o,hasAlpha:i,format:a}}function o3(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=a3()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Yj[n]}function a3(){const t=Qj();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const $j={name:"Basis",id:"basis",module:"textures",version:Nj,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},e7={...$j,parse:Kj};function ti(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function A3(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return i.substr(0,i.lastIndexOf("/")+1)+t}function t7(t,e,n){const i=t.bufferViews[n];ti(i);const r=i.buffer,s=e[r];ti(s);const o=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,i.byteLength)}const ZE=["SCALAR","VEC2","VEC3","VEC4"],n7=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],i7=new Map(n7),r7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},s7={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},o7={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function l3(t){return ZE[t-1]||ZE[0]}function c3(t){const e=i7.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function u3(t,e){const n=o7[t.componentType],i=r7[t.type],r=s7[t.componentType],s=t.count*i,o=t.count*i*r;return ti(o>=0&&o<=e.byteLength),{ArrayType:n,length:s,byteLength:o}}const a7={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class xi{constructor(e){T(this,"gltf",void 0),T(this,"sourceBuffers",void 0),T(this,"byteLength",void 0),this.gltf=e||{json:{...a7},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(r=>r===e),i=this.json.extensions||{};return n?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,i=this.gltf.buffers[n];ti(i);const r=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,{ArrayType:s,length:o}=u3(e,n),a=n.byteOffset+e.byteOffset;return new s(r,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,s=n.byteOffset||0;return new Uint8Array(r,s,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}setObjectExtension(e,n,i){const r=e.extensions||{};r[n]=i}removeObjectExtension(e,n){const i=e.extensions||{},r=i[n];return delete i[n],r}addExtension(e,n={}){return ti(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return ti(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:i}=e;this.json.nodes=this.json.nodes||[];const r={mesh:n};return i&&(r.matrix=i),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:i,material:r,mode:s=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:s}]};if(i){const l=this._addIndices(i);a.primitives[0].indices=l}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,n){const i=jm(e),r=n||(i==null?void 0:i.mimeType),o={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const n=e.byteLength;ti(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=Yl(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const i={bufferView:e,type:l3(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const i=this.addBufferView(e);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,n.size));const s={size:n.size,componentType:c3(e),count:Math.round(e.length/n.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(s,n))}addTexture(e){const{imageIndex:n}=e,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const i=this.byteLength,r=new ArrayBuffer(i),s=new Uint8Array(r);let o=0;for(const a of this.sourceBuffers||[])o=YL(a,s,o);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,n){let i=!0;for(;i;){const r=e.indexOf(n);r>-1?e.splice(r,1):i=!1}}_addAttributes(e={}){const n={};for(const i in e){const r=e[i],s=this._getGltfAttributeName(i),o=this.addBinaryBuffer(r.value,r);n[s]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];const r=e.subarray(0,n);for(const s of r)i.min.push(s),i.max.push(s);for(let s=n;s<e.length;s+=n)for(let o=0;o<n;o++)i.min[0+o]=Math.min(i.min[0+o],e[s+o]),i.max[0+o]=Math.max(i.max[0+o],e[s+o]);return i}}const A7="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",l7="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",c7=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),u7=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),f7={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h7={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function d7(t,e,n,i,r,s="NONE"){const o=await g7();_7(o,o.exports[h7[r]],t,e,n,i,o.exports[f7[s||"NONE"]])}let S0;async function g7(){return S0||(S0=p7()),S0}async function p7(){let t=A7;WebAssembly.validate(c7)&&(t=l7,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(m7(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function m7(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const r=t.charCodeAt(i);e[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let i=0;i<t.length;++i)e[n++]=e[i]<60?u7[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,n)}function _7(t,e,n,i,r,s,o){const a=t.exports.sbrk,l=i+3&-4,h=a(l*r),g=a(s.length),m=new Uint8Array(t.exports.memory.buffer);m.set(s,g);const v=e(h,i,r,g,s.length);if(v===0&&o&&o(h,l,r),n.set(m.subarray(h,h+i*r)),a(h-a(0)),v!==0)throw new Error("Malformed buffer data: ".concat(v))}const U1="EXT_meshopt_compression",y7=U1;async function v7(t,e){var n;const i=new xi(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const r=[];for(const s of t.json.bufferViews||[])r.push(E7(i,s));await Promise.all(r),i.removeExtension(U1)}async function E7(t,e){const n=t.getObjectExtension(e,U1);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:h}=n,g=t.gltf.buffers[h],m=new Uint8Array(g.arrayBuffer,g.byteOffset+i,r),v=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await d7(v,o,s,m,a,l),v}return null}const w7=Object.freeze(Object.defineProperty({__proto__:null,name:y7,decode:v7},Symbol.toStringTag,{value:"Module"})),jo="EXT_texture_webp",T7=jo;function C7(t,e){const n=new xi(t);if(!GO("image/webp")){if(n.getRequiredExtensions().includes(jo))throw new Error("gltf: Required extension ".concat(jo," not supported by browser"));return}const{json:i}=n;for(const r of i.textures||[]){const s=n.getObjectExtension(r,jo);s&&(r.source=s.source),n.removeObjectExtension(r,jo)}n.removeExtension(jo)}const x7=Object.freeze(Object.defineProperty({__proto__:null,name:T7,preprocess:C7},Symbol.toStringTag,{value:"Module"})),sf="KHR_texture_basisu",b7=sf;function S7(t,e){const n=new xi(t),{json:i}=n;for(const r of i.textures||[]){const s=n.getObjectExtension(r,sf);s&&(r.source=s.source),n.removeObjectExtension(r,sf)}n.removeExtension(sf)}const P7=Object.freeze(Object.defineProperty({__proto__:null,name:b7,preprocess:S7},Symbol.toStringTag,{value:"Module"})),M7="3.2.9",I7={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},B7={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:M7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:I7};function G1(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let h=0;h<l;h+=3){const g=a[h],m=a[h+1],v=a[h+2];e=g<e?g:e,n=m<n?m:n,i=v<i?v:i,r=g>r?g:r,s=m>s?m:s,o=v>o?v:o}return[[e,n,i],[r,s,o]]}function L7(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class ua{constructor(e,n){T(this,"fields",void 0),T(this,"metadata",void 0),L7(Array.isArray(e)),R7(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(...e){const n=Object.create(null);for(const r of e)n[r]=!0;const i=this.fields.filter(r=>n[r.name]);return new ua(i,this.metadata)}selectAt(...e){const n=e.map(i=>this.fields[i]).filter(Boolean);return new ua(n,this.metadata)}assign(e){let n,i=this.metadata;if(e instanceof ua){const o=e;n=o.fields,i=qE(qE(new Map,this.metadata),o.metadata)}else n=e;const r=Object.create(null);for(const o of this.fields)r[o.name]=o;for(const o of n)r[o.name]=o;const s=Object.values(r);return new ua(s,i)}}function R7(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function qE(t,e){return new Map([...t||new Map,...e||new Map])}class qf{constructor(e,n,i=!1,r=new Map){T(this,"name",void 0),T(this,"type",void 0),T(this,"nullable",void 0),T(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=i,this.metadata=r}get typeId(){return this.type&&this.type.typeId}clone(){return new qf(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let St;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"})(St||(St={}));let f3,h3,d3;class z1{static isNull(e){return e&&e.typeId===St.Null}static isInt(e){return e&&e.typeId===St.Int}static isFloat(e){return e&&e.typeId===St.Float}static isBinary(e){return e&&e.typeId===St.Binary}static isUtf8(e){return e&&e.typeId===St.Utf8}static isBool(e){return e&&e.typeId===St.Bool}static isDecimal(e){return e&&e.typeId===St.Decimal}static isDate(e){return e&&e.typeId===St.Date}static isTime(e){return e&&e.typeId===St.Time}static isTimestamp(e){return e&&e.typeId===St.Timestamp}static isInterval(e){return e&&e.typeId===St.Interval}static isList(e){return e&&e.typeId===St.List}static isStruct(e){return e&&e.typeId===St.Struct}static isUnion(e){return e&&e.typeId===St.Union}static isFixedSizeBinary(e){return e&&e.typeId===St.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===St.FixedSizeList}static isMap(e){return e&&e.typeId===St.Map}static isDictionary(e){return e&&e.typeId===St.Dictionary}get typeId(){return St.NONE}compareTo(e){return this===e}}f3=Symbol.toStringTag;class Ya extends z1{constructor(e,n){super(),T(this,"isSigned",void 0),T(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return St.Int}get[f3](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class O7 extends Ya{constructor(){super(!0,8)}}class F7 extends Ya{constructor(){super(!0,16)}}class D7 extends Ya{constructor(){super(!0,32)}}class k7 extends Ya{constructor(){super(!1,8)}}class N7 extends Ya{constructor(){super(!1,16)}}class U7 extends Ya{constructor(){super(!1,32)}}const g3={HALF:16,SINGLE:32,DOUBLE:64};h3=Symbol.toStringTag;class p3 extends z1{constructor(e){super(),T(this,"precision",void 0),this.precision=e}get typeId(){return St.Float}get[h3](){return"Float"}toString(){return"Float".concat(this.precision)}}class G7 extends p3{constructor(){super(g3.SINGLE)}}class z7 extends p3{constructor(){super(g3.DOUBLE)}}d3=Symbol.toStringTag;class V7 extends z1{constructor(e,n){super(),T(this,"listSize",void 0),T(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return St.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[d3](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function H7(t){switch(t.constructor){case Int8Array:return new O7;case Uint8Array:return new k7;case Int16Array:return new F7;case Uint16Array:return new N7;case Int32Array:return new D7;case Uint32Array:return new U7;case Float32Array:return new G7;case Float64Array:return new z7;default:throw new Error("array type not supported")}}function j7(t,e,n){const i=H7(e.value),r=n||W7(e);return new qf(t,new V7(e.size,new qf("value",i)),!1,r)}function W7(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function Q7(t,e,n){const i=m3(e.metadata),r=[],s=X7(e.attributes);for(const o in t){const a=t[o],l=$E(o,a,s[o]);r.push(l)}if(n){const o=$E("indices",n);r.push(o)}return new ua(r,i)}function X7(t){const e={};for(const n in t){const i=t[n];e[i.name||"undefined"]=i}return e}function $E(t,e,n){const i=n?m3(n.metadata):void 0;return j7(t,e,i)}function m3(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const ew={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},J7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Y7=4;class K7{constructor(e){T(this,"draco",void 0),T(this,"decoder",void 0),T(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(i),s=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const v="DRACO decompression failed: ".concat(o.error_msg());throw new Error(v)}const a=this._getDracoLoaderData(s,r,n),l=this._getMeshData(s,a,n),h=G1(l.attributes),g=Q7(l.attributes,a,l.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:h},...l,schema:g}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,n,i){const r=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:s}}_getDracoAttributes(e,n){const i={};for(let r=0;r<e.num_attributes();r++){const s=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(s,n);a&&(i[s.unique_id()].quantization_transform=a);const l=this._getOctahedronTransform(s,n);l&&(i[s.unique_id()].octahedron_transform=l)}return i}_getMeshData(e,n,i){const r=this._getMeshAttributes(n,e,i);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,n,i){const r={};for(const s of Object.values(e.attributes)){const o=this._deduceAttributeName(s,i);s.name=o;const{value:a,size:l}=this._getAttributeValues(n,s);r[o]={value:a,size:l,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return r}_getTriangleListIndices(e){const i=e.num_faces()*3,r=i*Y7,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),$7(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const i=J7[n.data_type],r=n.num_components,o=e.num_points()*r,a=o*i.BYTES_PER_ELEMENT,l=Z7(this.draco,i);let h;const g=this.draco._malloc(a);try{const m=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,m,l,a,g),h=new i(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:h,size:r}}_deduceAttributeName(e,n){const i=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===i)return o;const r=e.attribute_type;for(const o in ew)if(this.draco[o]===r)return ew[o];const s=n.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},i=this.metadataQuerier.NumEntries(e);for(let r=0;r<i;r++){const s=this.metadataQuerier.GetEntryName(e,r);n[s]=this._getDracoMetadataField(e,s)}return n}_getDracoMetadataField(e,n){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);const r=q7(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:r}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:i=[]}=e,r=[...n,...i];for(const s of r)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,n){const{quantizedAttributes:i=[]}=n,r=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:i=[]}=n,r=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function Z7(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function q7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}function $7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}const V1="1.4.1",eW="https://www.gstatic.com/draco/versioned/decoders/".concat(V1,"/draco_decoder.js"),tW="https://www.gstatic.com/draco/versioned/decoders/".concat(V1,"/draco_wasm_wrapper.js"),nW="https://www.gstatic.com/draco/versioned/decoders/".concat(V1,"/draco_decoder.wasm");let IA;async function iW(t){const e=t.modules||{};return e.draco3d?IA=IA||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):IA=IA||rW(t),await IA}async function rW(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await qs(eW,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await qs(tW,"draco",t),await qs(nW,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await sW(e,n)}function sW(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t({...n,onModuleLoaded:r=>i({draco:r})})})}const _3={...B7,parse:oW};async function oW(t,e){const{draco:n}=await iW(e),i=new K7(n);try{return i.parseSync(t,e==null?void 0:e.draco)}finally{i.destroy()}}function aW(t){const e={};for(const n in t){const i=t[n];if(n!=="indices"){const r=y3(i);e[n]=r}}return e}function y3(t){const{buffer:e,size:n,count:i}=AW(t);return{value:e,size:n,byteOffset:0,count:i,type:l3(n),componentType:c3(e)}}function AW(t){let e=t,n=1,i=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=lW(e,Float32Array)),i=e.length/n),{buffer:e,size:n,count:i}}function lW(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const uo="KHR_draco_mesh_compression",cW=uo;function uW(t,e,n){const i=new xi(t);for(const r of v3(i))i.getObjectExtension(r,uo)}async function fW(t,e,n){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const r=new xi(t),s=[];for(const o of v3(r))r.getObjectExtension(o,uo)&&s.push(dW(r,o,e,n));await Promise.all(s),r.removeExtension(uo)}function hW(t,e={}){const n=new xi(t);for(const i of n.json.meshes||[])gW(i),n.addRequiredExtension(uo)}async function dW(t,e,n,i){const r=t.getObjectExtension(e,uo);if(!r)return;const s=t.getTypedArrayForBufferView(r.bufferView),o=Um(s.buffer,s.byteOffset),{parse:a}=i,l={...n};delete l["3d-tiles"];const h=await a(o,_3,l,i),g=aW(h.attributes);for(const[m,v]of Object.entries(g))if(m in e.attributes){const w=e.attributes[m],C=t.getAccessor(w);C!=null&&C.min&&C!==null&&C!==void 0&&C.max&&(v.min=C.min,v.max=C.max)}e.attributes=g,h.indices&&(e.indices=y3(h.indices)),pW(e)}function gW(t,e,n=4,i,r){var s;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),a=r==null||(s=r.parseSync)===null||s===void 0?void 0:s.call(r,{attributes:t}),l=i._addFauxAttributes(a.attributes),h=i.addBufferView(o);return{primitives:[{attributes:l,mode:n,extensions:{[uo]:{bufferView:h,attributes:l}}}]}}function pW(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*v3(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const mW=Object.freeze(Object.defineProperty({__proto__:null,name:cW,preprocess:uW,decode:fW,encode:hW},Symbol.toStringTag,{value:"Module"})),Js="KHR_lights_punctual",_W=Js;async function yW(t){const e=new xi(t),{json:n}=e,i=e.getExtension(Js);i&&(e.json.lights=i.lights,e.removeExtension(Js));for(const r of n.nodes||[]){const s=e.getObjectExtension(r,Js);s&&(r.light=s.light),e.removeObjectExtension(r,Js)}}async function vW(t){const e=new xi(t),{json:n}=e;if(n.lights){const i=e.addExtension(Js);ti(!i.lights),i.lights=n.lights,delete n.lights}if(e.json.lights){for(const i of e.json.lights){const r=i.node;e.addObjectExtension(r,Js,i)}delete e.json.lights}}const EW=Object.freeze(Object.defineProperty({__proto__:null,name:_W,decode:yW,encode:vW},Symbol.toStringTag,{value:"Module"})),zl="KHR_materials_unlit",wW=zl;async function TW(t){const e=new xi(t),{json:n}=e;e.removeExtension(zl);for(const i of n.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,zl)}function CW(t){const e=new xi(t),{json:n}=e;if(e.materials)for(const i of n.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,zl,{}),e.addExtension(zl))}const xW=Object.freeze(Object.defineProperty({__proto__:null,name:wW,decode:TW,encode:CW},Symbol.toStringTag,{value:"Module"})),HA="KHR_techniques_webgl",bW=HA;async function SW(t){const e=new xi(t),{json:n}=e,i=e.getExtension(HA);if(i){const r=MW(i,e);for(const s of n.materials||[]){const o=e.getObjectExtension(s,HA);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=IW(s.technique,e)),e.removeObjectExtension(s,HA)}e.removeExtension(HA)}}async function PW(t,e){}function MW(t,e){const{programs:n=[],shaders:i=[],techniques:r=[]}=t,s=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function IW(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in n)&&(n[i]=t.uniforms[i].value)}),Object.keys(n).forEach(i=>{typeof n[i]=="object"&&n[i].index!==void 0&&(n[i].texture=e.getTexture(n[i].index))}),n}const BW=Object.freeze(Object.defineProperty({__proto__:null,name:bW,decode:SW,encode:PW},Symbol.toStringTag,{value:"Module"})),E3=[w7,x7,P7,mW,EW,xW,BW];function LW(t,e={},n){const i=E3.filter(s=>w3(s.name,e));for(const s of i){var r;(r=s.preprocess)===null||r===void 0||r.call(s,t,e,n)}}async function RW(t,e={},n){const i=E3.filter(s=>w3(s.name,e));for(const s of i){var r;await((r=s.decode)===null||r===void 0?void 0:r.call(s,t,e,n))}}function w3(t,e){var n;const i=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in i&&!i[t])}const P0="KHR_binary_glTF";function OW(t){const e=new xi(t),{json:n}=e;for(const i of n.images||[]){const r=e.getObjectExtension(i,P0);r&&Object.assign(i,r),e.removeObjectExtension(i,P0)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(P0)}const tw={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},FW={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class DW{constructor(){T(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),T(this,"json",void 0)}normalize(e,n){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),OW(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in tw)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(const r in i){const s=i[r];s.id=s.id||r;const o=e[n].length;e[n].push(s),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in tw)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:i,indices:r,material:s}=n;for(const o in i)i[o]=this._convertIdToIndex(i[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),s&&(n.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const i of e[n])for(const r in i){const s=i[r],o=this._convertIdToIndex(s,r);i[r]=o}}_convertIdToIndex(e,n){const i=FW[n];if(i in this.idToIndexMap){const r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return r}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const r of e.materials){var n,i;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((n=r.values)===null||n===void 0?void 0:n.tex)||((i=r.values)===null||i===void 0?void 0:i.texture2d_0),o=e.textures.findIndex(a=>a.id===s);o!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:o})}}}function kW(t,e={}){return new DW().normalize(t,e)}const NW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},UW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},hi={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},GW={magFilter:hi.TEXTURE_MAG_FILTER,minFilter:hi.TEXTURE_MIN_FILTER,wrapS:hi.TEXTURE_WRAP_S,wrapT:hi.TEXTURE_WRAP_T},zW={[hi.TEXTURE_MAG_FILTER]:hi.LINEAR,[hi.TEXTURE_MIN_FILTER]:hi.NEAREST_MIPMAP_LINEAR,[hi.TEXTURE_WRAP_S]:hi.REPEAT,[hi.TEXTURE_WRAP_T]:hi.REPEAT};function VW(t){return UW[t]}function HW(t){return NW[t]}class jW{constructor(){T(this,"baseUri",""),T(this,"json",{}),T(this,"buffers",[]),T(this,"images",[])}postProcess(e,n={}){const{json:i,buffers:r=[],images:s=[],baseUri:o=""}=e;return ti(i),this.baseUri=o,this.json=i,this.buffers=r,this.images=s,this._resolveTree(this.json,n),this.json}_resolveTree(e,n={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map((i,r)=>this._resolveBufferView(i,r))),e.images&&(e.images=e.images.map((i,r)=>this._resolveImage(i,r))),e.samplers&&(e.samplers=e.samplers.map((i,r)=>this._resolveSampler(i,r))),e.textures&&(e.textures=e.textures.map((i,r)=>this._resolveTexture(i,r))),e.accessors&&(e.accessors=e.accessors.map((i,r)=>this._resolveAccessor(i,r))),e.materials&&(e.materials=e.materials.map((i,r)=>this._resolveMaterial(i,r))),e.meshes&&(e.meshes=e.meshes.map((i,r)=>this._resolveMesh(i,r))),e.nodes&&(e.nodes=e.nodes.map((i,r)=>this._resolveNode(i,r))),e.skins&&(e.skins=e.skins.map((i,r)=>this._resolveSkin(i,r))),e.scenes&&(e.scenes=e.scenes.map((i,r)=>this._resolveScene(i,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,r)=>{const s=this.getMesh(r);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const r=i.attributes;i.attributes={};for(const s in r)i.attributes[s]=this.getAccessor(r[s]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=VW(e.componentType),e.components=HW(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:r,byteLength:s}=u3(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let a=i.arrayBuffer.slice(o,o+s);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(i,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new r(a)}return e}_getValueFromInterleavedBuffer(e,n,i,r,s){const o=new Uint8Array(s*r);for(let a=0;a<s;a++){const l=n+a*i;o.set(new Uint8Array(e.arrayBuffer.slice(l,l+r)),a*r)}return o.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):zW,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const i in e){const r=this._enumSamplerParameter(i);r!==void 0&&(e.parameters[r]=e[i])}return e}_enumSamplerParameter(e){return GW[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[n];return i&&(e.image=i),e}_resolveBufferView(e,n){const i=e.buffer,r={id:"bufferView-".concat(n),...e,buffer:this.buffers[i]},s=this.buffers[i].arrayBuffer;let o=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),r.data=new Uint8Array(s,o,e.byteLength),r}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function WW(t,e){return new jW().postProcess(t,e)}const nw=1735152710,H1=12,$f=8,QW=1313821514,XW=5130562,JW=0,YW=1,KW=0,Na=!0;function ZW(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function qW(t,e=0,n={}){const i=new DataView(t),{magic:r=nw}=n,s=i.getUint32(e,!1);return s===r||s===nw}function $W(t,e,n=0,i={}){const r=new DataView(e),s=ZW(r,n+0),o=r.getUint32(n+4,Na),a=r.getUint32(n+8,Na);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),n+=H1,t.version){case 1:return eQ(t,r,n);case 2:return tQ(t,r,n,i={});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function eQ(t,e,n){ut(t.header.byteLength>H1+$f);const i=e.getUint32(n+0,Na),r=e.getUint32(n+4,Na);return n+=$f,ut(r===KW),Rp(t,e,n,i),n+=i,n+=Op(t,e,n,t.header.byteLength),n}function tQ(t,e,n,i){return ut(t.header.byteLength>H1+$f),nQ(t,e,n,i),n+t.header.byteLength}function nQ(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,Na),s=e.getUint32(n+4,Na);switch(n+=$f,s){case QW:Rp(t,e,n,r);break;case XW:Op(t,e,n,r);break;case JW:i.strict||Rp(t,e,n,r);break;case YW:i.strict||Op(t,e,n,r);break}n+=Yl(r,4)}return n}function Rp(t,e,n,i){const r=new Uint8Array(e.buffer,n,i),o=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(o),Yl(i,4)}function Op(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),Yl(i,4)}async function iQ(t,e,n=0,i,r){var s,o,a,l;rQ(t,e,n,i),kW(t,{normalize:i==null||(s=i.gltf)===null||s===void 0?void 0:s.normalize}),LW(t,i,r);const h=[];if(i!=null&&(o=i.gltf)!==null&&o!==void 0&&o.loadBuffers&&t.json.buffers&&await sQ(t,i,r),i!=null&&(a=i.gltf)!==null&&a!==void 0&&a.loadImages){const m=oQ(t,i,r);h.push(m)}const g=RW(t,i,r);return h.push(g),await Promise.all(h),i!=null&&(l=i.gltf)!==null&&l!==void 0&&l.postProcess?WW(t,i):t}function rQ(t,e,n,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!qW(e,n,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=WL(e);else if(e instanceof ArrayBuffer){const o={};n=$W(o,e,n,i.glb),ti(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),t._glb=o,t.json=o.json}else ti(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}async function sQ(t,e,n){const i=t.json.buffers||[];for(let o=0;o<i.length;++o){const a=i[o];if(a.uri){var r,s;const{fetch:l}=n;ti(l);const h=A3(a.uri,e),g=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,h)),m=await(g==null||(s=g.arrayBuffer)===null||s===void 0?void 0:s.call(g));t.buffers[o]={arrayBuffer:m,byteOffset:0,byteLength:m.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function oQ(t,e,n){const i=aQ(t),r=t.json.images||[],s=[];for(const o of i)s.push(AQ(t,r[o],o,e,n));return await Promise.all(s)}function aQ(t){const e=new Set,n=t.json.textures||[];for(const i of n)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function AQ(t,e,n,i,r){const{fetch:s,parse:o}=r;let a;if(e.uri){const h=A3(e.uri,i);a=await(await s(h)).arrayBuffer()}if(Number.isFinite(e.bufferView)){const h=t7(t.json,t.buffers,e.bufferView);a=Um(h.buffer,h.byteOffset,h.byteLength)}ti(a,"glTF image has no data");let l=await o(a,[Wm,e7],{mimeType:e.mimeType,basis:i.basis||{format:a3()}},r);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),t.images=t.images||[],t.images[n]=l}const Vl={name:"glTF",id:"gltf",module:"gltf",version:kj,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:lQ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function lQ(t,e={},n){e={...Vl.options,...e},e.gltf={...Vl.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await iQ({},t,i,e,n)}async function cQ(t){const e=[];return t.scenes.forEach(n=>{n.traverse(i=>{Object.values(i.model.getUniforms()).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await uQ(()=>e.some(n=>!n.loaded))}async function uQ(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const fQ=`#version 300 es

// Instance attributes
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;

// Uniforms
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;

// Attributes
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif

// Varying
out vec4 vColor;

// MODULE_PBR contains all the varying definitions needed
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif

// Main
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    // using instancePositions as world coordinates
    // when using globe mode, this branch does not re-orient the model to align with the surface of the earth
    // call project_normal before setting position to avoid rotation
    geometry.normal = project_normal(normal);
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    // set PBR data
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hQ=`#version 300 es

// Uniforms
uniform float opacity;

// Varying
in vec4 vColor;

out vec4 fragmentColor;

// MODULE_PBR contains all the varying definitions needed
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,T3=[255,255,255,255],dQ={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:T3},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Vl]};class j1 extends xn{constructor(...e){super(...e),T(this,"state",void 0)}getShaders(){const e=[Ti,Ci];return this.props._lighting==="pbr"&&e.push(f1),{vs:fQ,fs:hQ,modules:e}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:T3,transition:!0},instanceModelMatrix:n3})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.scenegraph!==i.scenegraph?this._updateScenegraph():n._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let i=null;if(e.scenegraph instanceof wa)i={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,l=Dj(n,a,this._getModelOptions());i={gltf:a,...l},cQ(l).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(De.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=e.scenegraph);const r={layer:this,gl:n},s=e.getScene(i,r),o=e.getAnimator(i,r);s instanceof wa?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,o,e._animations),this.setState({scenegraph:s,animator:o})):s!==null&&De.warn("invalid scenegraph:",s)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(i=>{this._setModelAttributes(i.model,n)})}}_applyAnimationsProp(e,n,i){if(!e||!n||!i)return;const r=n.getAnimations();Object.keys(i).sort().forEach(s=>{const o=i[s];if(s==="*")r.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(s))){const a=Number(s);a>=0&&a<r.length?Object.assign(r[a],o):De.warn("animation ".concat(s," not found"))()}else{const a=r.find(({name:l})=>l===s);a?Object.assign(a,o):De.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof wa&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!Xe(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:i}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:r}=this.context,{sizeScale:s,sizeMinPixels:o,sizeMaxPixels:a,opacity:l,coordinateSystem:h}=this.props,g=this.getNumInstances();this.state.scenegraph.traverse((m,{worldMatrix:v})=>{m.model.setInstanceCount(g),m.updateModuleSettings(e),m.draw({parameters:n,uniforms:{sizeScale:s,opacity:l,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:i3(r,h),sceneModelMatrix:v,u_Camera:m.model.getUniforms().project_uCameraPosition}})})}}T(j1,"defaultProps",dQ);T(j1,"layerName","ScenegraphLayer");const gQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs

// Scale the model
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;

// Primitive attributes
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;

// Instance attributes
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;

// Outputs to fragment shader
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    // https://github.com/Esri/i3s-spec/blob/master/docs/1.7/geometryUVRegion.cmn.md
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    // set PBR data
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {

// NOTE(Tarek): This is necessary because
// headless.gl reports the extension as
// available but does not support it in
// the shader.
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function mQ(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const _Q={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class W1 extends Gl{getShaders(){const e=super.getShaders();return e.modules.push(f1),{...e,vs:gQ,fs:pQ}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;!this.state.model||(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(n)}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:i}=this.props,r=this.parseMaterial(i,e);this.setState({materialParser:r});const s=this.getShaders();return mQ(e.attributes),new Cn(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...s.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:i}=this.props,r=this.parseMaterial(e,i);this.setState({materialParser:r}),n.setUniforms(r.uniforms)}}parseMaterial(e,n){var i;const r=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new r3(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:r,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,i=new Uint8ClampedArray(n.length*e.size),r=[];for(let s=0;s<n.length;s++)this.encodePickingColor(n[s],r),i[s*3]=r[0],i[s*3+1]=r[1],i[s*3+2]=r[2];e.value=i}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}T(W1,"layerName","MeshLayer");T(W1,"defaultProps",_Q);const yQ=6378137,vQ=6378137,EQ=6356752314245179e-9;function Uh(t){return t}new q;function wQ(t,e=[],n=Uh){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function TQ(t,e=[]){return wQ(t,e,Zt._cartographicRadians?Uh:Ok)}function CQ(t,e,n=Uh){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function xQ(t,e){return CQ(t,e,Zt._cartographicRadians?Uh:Fk)}const Uo=new q,bQ=new q,SQ=new q;function PQ(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:s}=e;Uo.from(t);const o=Uo.x,a=Uo.y,l=Uo.z,h=i.x,g=i.y,m=i.z,v=o*o*h*h,w=a*a*g*g,C=l*l*m*m,b=v+w+C,R=Math.sqrt(1/b);if(!Number.isFinite(R))return;const S=bQ;if(S.copy(t).scale(R),b<s)return S.to(n);const P=r.x,M=r.y,F=r.z,H=SQ;H.set(S.x*P*2,S.y*M*2,S.z*F*2);let j=(1-R)*Uo.len()/(.5*H.len()),K=0,ee,X,U,D;do{j-=K,ee=1/(1+j*P),X=1/(1+j*M),U=1/(1+j*F);const ae=ee*ee,re=X*X,te=U*U,oe=ae*ee,ve=re*X,ce=te*U;D=v*ae+w*re+C*te-1;const ne=v*oe*P+w*ve*M+C*ce*F,le=-2*ne;K=D/le}while(Math.abs(D)>Ml.EPSILON12);return Uo.scale([ee,X,U]).to(n)}const iw=1e-14,MQ=new q,rw={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},M0={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},BA={east:new q,north:new q,up:new q,west:new q,south:new q,down:new q},IQ=new q,BQ=new q,LQ=new q;function sw(t,e,n,i,r,s){const o=rw[e]&&rw[e][n];Di(o&&(!i||i===o));let a,l,h;const g=MQ.copy(r);if(ri(g.x,0,iw)&&ri(g.y,0,iw)){const v=Math.sign(g.z);a=IQ.fromArray(M0[e]),e!=="east"&&e!=="west"&&a.scale(v),l=BQ.fromArray(M0[n]),n!=="east"&&n!=="west"&&l.scale(v),h=LQ.fromArray(M0[i]),i!=="east"&&i!=="west"&&h.scale(v)}else{const{up:v,east:w,north:C}=BA;w.set(-g.y,g.x,0).normalize(),t.geodeticSurfaceNormal(g,v),C.copy(v).cross(w);const{down:b,west:R,south:S}=BA;b.copy(v).scale(-1),R.copy(w).scale(-1),S.copy(C).scale(-1),a=BA[e],l=BA[n],h=BA[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=h.x,s[9]=h.y,s[10]=h.z,s[11]=0,s[12]=g.x,s[13]=g.y,s[14]=g.z,s[15]=1,s}const Cu=new q,ow=new q,RQ=new q,Li=new q,OQ=new q,xu=new q;class $t{constructor(e=0,n=0,i=0){T(this,"radii",void 0),T(this,"radiiSquared",void 0),T(this,"radiiToTheFourth",void 0),T(this,"oneOverRadii",void 0),T(this,"oneOverRadiiSquared",void 0),T(this,"minimumRadius",void 0),T(this,"maximumRadius",void 0),T(this,"centerToleranceSquared",Ml.EPSILON1),T(this,"squaredXOverSquaredZ",void 0),Di(e>=0),Di(n>=0),Di(i>=0),this.radii=new q(e,n,i),this.radiiSquared=new q(e*e,n*n,i*i),this.radiiToTheFourth=new q(e*e*e*e,n*n*n*n,i*i*i*i),this.oneOverRadii=new q(e===0?0:1/e,n===0?0:1/n,i===0?0:1/i),this.oneOverRadiiSquared=new q(e===0?0:1/(e*e),n===0?0:1/(n*n),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,n,i),this.maximumRadius=Math.max(e,n,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const i=ow,r=RQ,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(r));return r.scale(1/o),i.scale(s),r.add(i),r.to(n)}cartesianToCartographic(e,n=[0,0,0]){xu.from(e);const i=this.scaleToGeodeticSurface(xu,Li);if(!i)return;const r=this.geodeticSurfaceNormal(i,ow),s=OQ;s.copy(xu).subtract(i);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),l=Math.sign(s1(s,xu))*db(s);return xQ([o,a,l],n)}eastNorthUpToFixedFrame(e,n=new ze){return sw(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,i,r,s=new ze){return sw(this,e,n,i,r,s)}geocentricSurfaceNormal(e,n=[0,0,0]){return Cu.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const i=TQ(e),r=i[0],s=i[1],o=Math.cos(s);return Cu.set(o*Math.cos(r),o*Math.sin(r),Math.sin(s)).normalize(),Cu.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Cu.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return PQ(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){Li.from(e);const i=Li.x,r=Li.y,s=Li.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+r*r*o.y+s*s*o.z);return Li.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return Li.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return Li.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,i=[0,0,0]){Di(ri(this.radii.x,this.radii.y,Ml.EPSILON15)),Di(this.radii.z>0),Li.from(e);const r=Li.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return Li.set(0,0,r).to(i)}}T($t,"WGS84",new $t(yQ,vQ,EQ));class FQ{constructor(e,n,i){T(this,"item",void 0),T(this,"previous",void 0),T(this,"next",void 0),this.item=e,this.previous=n,this.next=i}}class DQ{constructor(){T(this,"head",null),T(this,"tail",null),T(this,"_length",0)}get length(){return this._length}add(e){const n=new FQ(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){!e||(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}function I0(t){return t!=null}class kQ{constructor(){T(this,"_list",void 0),T(this,"_sentinel",void 0),T(this,"_trimTiles",void 0),this._list=new DQ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;I0(n)&&this._list.splice(this._sentinel,n)}add(e,n,i){I0(n._cacheNode)||(n._cacheNode=this._list.add(n),i&&i(e,n))}unloadTile(e,n,i){const r=n._cacheNode;!I0(r)||(this._list.remove(r),n._cacheNode=void 0,i&&i(e,n))}unloadTiles(e,n){const i=this._trimTiles;this._trimTiles=!1;const r=this._list,s=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>s||i);){const l=a.item;a=a.next,this.unloadTile(e,l,n)}}trim(){this._trimTiles=!0}}function NQ(t,e){ut(t),ut(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:s}}=t;let o=new ze(r);switch(n&&o.translate(n),i){case"Z":break;case"Y":const m=new ze().rotateX(Math.PI/2);o=o.multiplyRight(m);break;case"X":const v=new ze().rotateY(-Math.PI/2);o=o.multiplyRight(v);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new q(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const l=$t.WGS84.cartesianToCartographic(a,new q),g=$t.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=g.multiplyRight(o),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const aw=new q,B0=new q,Fp=new ei([new mi,new mi,new mi,new mi,new mi,new mi]);function UQ(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:s}=t.distanceScales,o=of(t,t.center),a=$t.WGS84.eastNorthUpToFixedFrame(o),l=t.unprojectPosition(t.cameraPosition),h=$t.WGS84.cartographicToCartesian(l,new q),g=new q(a.transformAsVector(new q(n).scale(s))).normalize(),m=new q(a.transformAsVector(new q(i).scale(s))).normalize();zQ(t);const v=t.constructor,{longitude:w,latitude:C,width:b,bearing:R,zoom:S}=t,P=new v({longitude:w,latitude:C,height:r,width:b,bearing:R,zoom:S,pitch:0});return{camera:{position:h,direction:g,up:m},viewport:t,topDownViewport:P,height:r,cullingVolume:Fp,frameNumber:e,sseDenominator:1.15}}function GQ(t,e,n){if(n===0||t.length<=n)return[t,[]];const i=[],{longitude:r,latitude:s}=e.viewport;for(const[h,g]of t.entries()){const[m,v]=g.header.mbs,w=Math.abs(r-m),C=Math.abs(s-v),b=Math.sqrt(C*C+w*w);i.push([h,b])}const o=i.sort((h,g)=>h[1]-g[1]),a=[];for(let h=0;h<n;h++)a.push(t[o[h][0]]);const l=[];for(let h=n;h<o.length;h++)l.push(t[o[h][0]]);return[a,l]}function zQ(t){const e=t.getFrustumPlanes(),n=Aw(e.near,t.cameraPosition),i=of(t,n),r=of(t,t.cameraPosition,B0);let s=0;Fp.planes[s++].fromPointNormal(i,aw.copy(i).subtract(r));for(const o in e){if(o==="near")continue;const a=e[o],l=Aw(a,n,B0),h=of(t,l,B0);Fp.planes[s++].fromPointNormal(h,aw.copy(i).subtract(h))}}function Aw(t,e,n=new q){const i=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-i).add(e),n}function of(t,e,n=new q){const i=t.unprojectPosition(e);return $t.WGS84.cartographicToCartesian(i,n)}const VQ=6378137,HQ=6378137,Dp=6356752314245179e-9,lw=new q;function jQ(t,e){if(t instanceof lc){const{halfAxes:n}=t,i=QQ(n);return Math.log2(Dp/(i+e[2]))}else if(t instanceof Ac){const{radius:n}=t;return Math.log2(Dp/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:i}=t,r=Math.log2(VQ/n),s=Math.log2(HQ/i);return(r+s)/2}return 1}function C3(t,e,n){const i=$t.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new q),r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Math.log2(Dp/(r+e[2]))}function WQ(t,e,n){const[i,r,s,o]=t;return C3({xmin:i,xmax:s,ymin:r,ymax:o,zmin:0,zmax:0},e,n)}function QQ(t){t.getColumn(0,lw);const e=t.getColumn(1),n=t.getColumn(2);return lw.add(e).add(n).len()}const Kn={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},wr={ADD:1,REPLACE:2},Ta={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},ir={I3S:"I3S",TILES3D:"TILES3D"},Gh={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},XQ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function x3(t){return t!=null}const JQ=new q,YQ=new q,KQ=new q;function L0(t,e,n){if(ut(t,"3D Tile: boundingVolume must be defined"),t.box)return ZQ(t.box,e,n);if(t.region){const[i,r,s,o,a,l]=t.region,h=$t.WGS84.cartographicToCartesian([GA(i),GA(o),a],YQ),g=$t.WGS84.cartographicToCartesian([GA(s),GA(r),l],KQ),m=new q().addVectors(h,g).multiplyScalar(.5),v=new q().subVectors(h,g).len()/2;return cw([m[0],m[1],m[2],v],new ze)}if(t.sphere)return cw(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ZQ(t,e,n){const i=new q(t[0],t[1],t[2]);e.transform(i,i);let r=[];if(t.length===10){const h=t.slice(3,6),g=new Pl;g.fromArray(t,6);const m=new q([1,0,0]),v=new q([0,1,0]),w=new q([0,0,1]);m.transformByQuaternion(g),m.scale(h[0]),v.transformByQuaternion(g),v.scale(h[1]),w.transformByQuaternion(g),w.scale(h[2]),r=[...m.toArray(),...v.toArray(),...w.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),a=e.transformAsVector(r.slice(6,9)),l=new qt([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return x3(n)?(n.center=i,n.halfAxes=l,n):new lc(i,l)}function cw(t,e,n){const i=new q(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(JQ),s=Math.max(Math.max(r[0],r[1]),r[2]),o=t[3]*s;return x3(n)?(n.center=i,n.radius=o,n):new Ac(i,o)}new q;new q;new ze;new q;new q;new q;function qQ(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function $Q(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return qQ(e,n)*i}return 0}function eX(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?r:t.lodMetricValue;if(s===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:l}=e,{viewDistanceScale:h}=i.options;let g=s*a*(h||1)/(o*l);return g-=$Q(i,o),g}const R0=new q,uw=new q,Yr=new q,fw=new q,tX=new q,O0=new ze,hw=new ze;function nX(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*b3(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function b3(t,e){const{topDownViewport:n}=e,i=t.header.mbs[1],r=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],l=n.unprojectPosition(n.cameraPosition);$t.WGS84.cartographicToCartesian(l,R0),uw.copy(R0).subtract(a).normalize(),$t.WGS84.eastNorthUpToFixedFrame(a,O0),hw.copy(O0).invert(),Yr.copy(R0).transform(hw);const h=Math.sqrt(Yr[0]*Yr[0]+Yr[1]*Yr[1]),g=h*h/Yr[2];fw.copy([Yr[0],Yr[1],g]);const v=fw.transform(O0).subtract(a).normalize(),C=uw.cross(v).normalize().scale(o).add(a),b=$t.WGS84.cartesianToCartographic(C),R=n.project([r,i,s]),S=n.project(b);return tX.copy(R).subtract(S).magnitude()}function iX(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class dw{constructor(e=0){T(this,"_map",new Map),T(this,"_array",void 0),T(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ut(e<this._array.length),this._array[e]}set(e,n){ut(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ut(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ut(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const rX={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class zh{traversalFinished(e){return!0}constructor(e){T(this,"options",void 0),T(this,"root",void 0),T(this,"requestedTiles",void 0),T(this,"selectedTiles",void 0),T(this,"emptyTiles",void 0),T(this,"lastUpdate",new Date().getTime()),T(this,"updateDebounceTime",1e3),T(this,"_traversalStack",void 0),T(this,"_emptyTraversalStack",void 0),T(this,"_frameNumber",void 0),this.options={...rX,...e},this._traversalStack=new dw,this._emptyTraversalStack=new dw,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(e,n,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const s=i.pop();let o=!1;this.canTraverse(s,n)&&(this.updateChildTiles(s,n),o=this.updateAndPushChildren(s,n,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const a=s.parent,l=Boolean(!a||a._shouldRefine),h=!o;s.hasRenderContent?s.refine===wr.ADD?(this.loadTile(s,n),this.selectTile(s,n)):s.refine===wr.REPLACE&&(this.loadTile(s,n),h&&this.selectTile(s,n)):(this.emptyTiles[s.id]=s,this.loadTile(s,n),h&&this.selectTile(s,n)),this.touchTile(s,n),s._shouldRefine=o&&l}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const i=e.children;for(const r of i)this.updateTile(r,n);return!0}updateAndPushChildren(e,n,i,r){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const l=e.refine===wr.REPLACE&&e.hasRenderContent&&!o;let h=!1,g=!0;for(const m of a)if(m._selectionDepth=r,m.isVisibleAndInRequestVolume?(i.find(m)&&i.delete(m),i.push(m),h=!0):(l||s)&&(this.loadTile(m,n),this.touchTile(m,n)),l){let v;if(m._inRequestVolume?m.hasRenderContent?v=m.contentAvailable:v=this.executeEmptyTraversal(m,n):v=!1,g=g&&v,!g)return!1}return h||(g=!1),g}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n,i=!1,r=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n,i){let r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(n,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const i=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&i.push(r);else i.push(n.viewport.id);e.updateVisibility(n,i)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let i=!1;for(const r of e.children)r.updateVisibility(n),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,n){let i=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0&&i;){const s=r.pop();if(this.updateTile(s,n),s.isVisibleAndInRequestVolume||this.loadTile(s,n),this.touchTile(s,n),!s.hasRenderContent&&this.canTraverse(s,n,!1,!0)){const a=s.children;for(const l of a)r.find(l)&&r.delete(l),r.push(l)}else s.contentAvailable||(i=!1)}return i}}const gw=new q;function sX(t){return t!=null}class kp{constructor(e,n,i,r=""){T(this,"tileset",void 0),T(this,"header",void 0),T(this,"id",void 0),T(this,"url",void 0),T(this,"parent",void 0),T(this,"refine",void 0),T(this,"type",void 0),T(this,"contentUrl",void 0),T(this,"lodMetricType",void 0),T(this,"lodMetricValue",void 0),T(this,"boundingVolume",void 0),T(this,"content",void 0),T(this,"contentState",void 0),T(this,"gpuMemoryUsageInBytes",void 0),T(this,"children",void 0),T(this,"depth",void 0),T(this,"viewportIds",void 0),T(this,"transform",void 0),T(this,"extensions",void 0),T(this,"userData",void 0),T(this,"computedTransform",void 0),T(this,"hasEmptyContent",void 0),T(this,"hasTilesetContent",void 0),T(this,"traverser",void 0),T(this,"_cacheNode",void 0),T(this,"_frameNumber",void 0),T(this,"_lodJudge",void 0),T(this,"_expireDate",void 0),T(this,"_expiredContent",void 0),T(this,"_shouldRefine",void 0),T(this,"_distanceToCamera",void 0),T(this,"_centerZDepth",void 0),T(this,"_screenSpaceError",void 0),T(this,"_visibilityPlaneMask",void 0),T(this,"_visible",void 0),T(this,"_inRequestVolume",void 0),T(this,"_stackLength",void 0),T(this,"_selectionDepth",void 0),T(this,"_touchedFrame",void 0),T(this,"_visitedFrame",void 0),T(this,"_selectedFrame",void 0),T(this,"_requestedFrame",void 0),T(this,"_priority",void 0),T(this,"_contentBoundingVolume",void 0),T(this,"_viewerRequestVolume",void 0),T(this,"_initialTransform",void 0),this.header=n,this.tileset=e,this.id=r||n.id,this.url=n.url,this.parent=i,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=Kn.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new zh({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new ze,this.transform=new ze,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Kn.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Kn.UNLOADED}get contentExpired(){return this.contentState===Kn.EXPIRED}get contentFailed(){return this.contentState===Kn.FAILED}getScreenSpaceError(e,n){switch(this.tileset.type){case ir.I3S:return b3(this,e);case ir.TILES3D:return eX(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,i=this.refine===wr.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Kn.UNLOADED)return-1;const r=this.parent,o=r&&(!i||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Kn.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=Kn.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Sr(i,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Kn.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Kn.FAILED,i}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Kn.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const i=this.parent,r=i?i._visibilityPlaneMask:ei.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==ei.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const n=this.boundingVolume;return gw.subVectors(n.center,e.position),e.direction.dot(gw)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(sX(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Kn.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new ze(e.transform):new ze;const n=this.parent,i=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new ze(r).multiplyRight(this.transform);const s=n&&n._initialTransform?n._initialTransform.clone():new ze;this._initialTransform=new ze(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Kn.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ei.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||wr.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(e){this.boundingVolume=L0(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;!n||(n.boundingVolume&&(this._contentBoundingVolume=L0(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=L0(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new ze){const n=e.clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return iX(this.tileset.tileset)}}}class oX extends zh{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const r=e.refine===wr.REPLACE,s=e._optimChildrenWithinParent===XQ.USE_OPTIMIZATION;if(r&&s&&i&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==wr.ADD?!1:!this.shouldRefine(e,n,!0)}}class aX{constructor(){T(this,"frameNumberMap",new Map)}register(e,n){const i=this.frameNumberMap.get(e)||new Map,r=i.get(n)||0;i.set(n,r+1),this.frameNumberMap.set(e,i)}deregister(e,n){const i=this.frameNumberMap.get(e);if(!i)return;const r=i.get(n)||1;i.set(n,r-1)}isZero(e,n){var i;return(((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0)===0}}const F0={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class AX{constructor(){T(this,"_statusMap",void 0),T(this,"pendingTilesRegister",new aX),this._statusMap={}}add(e,n,i,r){if(!this._statusMap[n]){const{frameNumber:s,viewport:{id:o}}=r;this._statusMap[n]={request:e,callback:i,key:n,frameState:r,status:F0.REQUESTED},this.pendingTilesRegister.register(o,s),e().then(a=>{this._statusMap[n].status=F0.COMPLETED;const{frameNumber:l,viewport:{id:h}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(h,l),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=F0.ERROR;const{frameNumber:l,viewport:{id:h}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(h,l),i(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);const{frameNumber:s,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,s),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class lX extends zh{traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}constructor(e){super(e),T(this,"_tileManager",void 0),this._tileManager=new AX}shouldRefine(e,n){return e._lodJudge=nX(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const i=e.header.children||[],r=e.children,s=e.tileset;for(const o of i){const a="".concat(o.id,"-").concat(n.viewport.id),l=r&&r.find(h=>h.id===a);if(l)l&&this.updateTile(l,n);else{let h=()=>this._loadTile(o.id,s);this._tileManager.find(a)?this._tileManager.update(a,n):(s.tileset.nodePages&&(h=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(h,a,m=>this._onTileLoad(m,e,a),n))}}return!1}async _loadTile(e,n){const{loader:i}=n,r=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0,loadContent:!1}};return await Sr(r,i,s)}_onTileLoad(e,n,i){const r=new kp(n.tileset,e,n,i);n.children.push(r);const s=this._tileManager.find(r.id).frameState;this.updateTile(r,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,s)}}const cX={description:"",ellipsoid:$t.WGS84,modelMatrix:new ze,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},bu="Tiles In Tileset(s)",D0="Tiles In Memory",pw="Tiles In View",mw="Tiles To Render",_w="Tiles Loaded",k0="Tiles Loading",yw="Tiles Unloaded",vw="Failed Tile Loads",Ew="Points/Vertices",N0="Tile Memory Use";class uX{constructor(e,n){T(this,"options",void 0),T(this,"loadOptions",void 0),T(this,"type",void 0),T(this,"tileset",void 0),T(this,"loader",void 0),T(this,"url",void 0),T(this,"basePath",void 0),T(this,"modelMatrix",void 0),T(this,"ellipsoid",void 0),T(this,"lodMetricType",void 0),T(this,"lodMetricValue",void 0),T(this,"refine",void 0),T(this,"root",void 0),T(this,"roots",void 0),T(this,"asset",void 0),T(this,"description",void 0),T(this,"properties",void 0),T(this,"extras",void 0),T(this,"attributions",void 0),T(this,"credits",void 0),T(this,"stats",void 0),T(this,"traverseCounter",void 0),T(this,"geometricError",void 0),T(this,"selectedTiles",void 0),T(this,"updatePromise",null),T(this,"tilesetInitializationPromise",void 0),T(this,"cartographicCenter",void 0),T(this,"cartesianCenter",void 0),T(this,"zoom",void 0),T(this,"boundingVolume",void 0),T(this,"gpuMemoryUsageInBytes",void 0),T(this,"dynamicScreenSpaceErrorComputedDensity",void 0),T(this,"_traverser",void 0),T(this,"_cache",void 0),T(this,"_requestScheduler",void 0),T(this,"_frameNumber",void 0),T(this,"_queryParamsString",void 0),T(this,"_queryParams",void 0),T(this,"_extensionsUsed",void 0),T(this,"_tiles",void 0),T(this,"_pendingCount",void 0),T(this,"lastUpdatedVieports",void 0),T(this,"_requestedTiles",void 0),T(this,"_emptyTiles",void 0),T(this,"frameStateData",void 0),T(this,"maximumMemoryUsage",void 0),ut(e),this.options={...cX,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||hx(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new kQ,this._requestScheduler=new fx({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new Kl({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=fX(this._queryParams)),this._queryParamsString}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const i=[];for(const r of n){const s=r.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(const r of n){const s=r.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;const o=UQ(r,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[s,o]=GQ(r,e,this.options.maximumTilesSelected);i.selectedTiles=s;for(const a of o)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const i=new Set(e.map(o=>o.id)),r=new Set(n.map(o=>o.id));let s=e.filter(o=>!r.has(o.id)).length>0;return s=s||n.filter(o=>!i.has(o.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?n+=i.content.pointCount:n+=i.content.vertexCount);this.stats.get(pw).count=this.selectedTiles.length,this.stats.get(mw).count=e,this.stats.get(Ew).count=n}async _initializeTileSet(e){this.type===ir.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===ir.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===ir.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:s,ymin:o,ymax:a,zmin:l,zmax:h}=n;this.cartographicCenter=new q(r+(s-r)/2,o+(a-o)/2,l+(h-l)/2),this.cartesianCenter=$t.WGS84.cartographicToCartesian(this.cartographicCenter,new q),this.zoom=C3(n,this.cartographicCenter,this.cartesianCenter);return}const i=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(i){const[r,s,o,a]=i;this.cartographicCenter=new q(r+(o-r)/2,s+(a-s)/2,0),this.cartesianCenter=$t.WGS84.cartographicToCartesian(this.cartographicCenter,new q),this.zoom=WQ(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new q,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root;ut(e);const{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new q,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=$t.WGS84.cartesianToCartographic(n,new q):this.cartographicCenter=new q(0,0,-$t.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=jQ(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(bu),this.stats.get(k0),this.stats.get(D0),this.stats.get(pw),this.stats.get(mw),this.stats.get(_w),this.stats.get(yw),this.stats.get(vw),this.stats.get(Ew,"memory"),this.stats.get(N0,"memory")}_initializeTileHeaders(e,n){const i=new kp(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===ir.TILES3D){const r=[];for(r.push(i);r.length>0;){const s=r.pop();this.stats.get(bu).incrementCount();const o=s.header.children||[];for(const a of o){const l=new kp(this,a,s);s.children.push(l),l.depth=s.depth+1,r.push(l)}}}return i}_initializeTraverser(){let e;switch(this.type){case ir.TILES3D:e=oX;break;case ir.I3S:e=lX;break;default:e=zh}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(i){this._onTileLoadError(e,i)}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(vw).incrementCount();const i=n.message||n.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,r)}_onTileLoad(e,n){if(!!n){if(this.type===ir.I3S){var i,r;const s=((i=this.tileset)===null||i===void 0||(r=i.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(bu).reset(),this.stats.get(bu).addCount(s)}e&&e.content&&NQ(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(k0).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(k0).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(_w).incrementCount(),this.stats.get(D0).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get(N0).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get(D0).decrementCount(),this.stats.get(yw).incrementCount(),this.stats.get(N0).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const i of n.children)e.push(i);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();for(const r of e.children)i.push(r);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}function fX(t){const e=[];for(const n of Object.keys(t))e.push("".concat(n,"=").concat(t[n]));switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}const S3="3.2.9",LA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function P3(t,e,n){ut(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}function hX(t,e=0){const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const dX={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ht={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},st={...dX,...Ht},U0={[Ht.DOUBLE]:Float64Array,[Ht.FLOAT]:Float32Array,[Ht.UNSIGNED_SHORT]:Uint16Array,[Ht.UNSIGNED_INT]:Uint32Array,[Ht.UNSIGNED_BYTE]:Uint8Array,[Ht.BYTE]:Int8Array,[Ht.SHORT]:Int16Array,[Ht.INT]:Int32Array},gX={DOUBLE:Ht.DOUBLE,FLOAT:Ht.FLOAT,UNSIGNED_SHORT:Ht.UNSIGNED_SHORT,UNSIGNED_INT:Ht.UNSIGNED_INT,UNSIGNED_BYTE:Ht.UNSIGNED_BYTE,BYTE:Ht.BYTE,SHORT:Ht.SHORT,INT:Ht.INT},G0="Failed to convert GL type";class ar{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in U0)if(U0[n]===e)return n;throw new Error(G0)}static fromName(e){const n=gX[e];if(!n)throw new Error(G0);return n}static getArrayType(e){switch(e){case Ht.UNSIGNED_SHORT_5_6_5:case Ht.UNSIGNED_SHORT_4_4_4_4:case Ht.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=U0[e];if(!n)throw new Error(G0);return n}}static getByteSize(e){return ar.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(ar.getArrayType(e))}static createTypedArray(e,n,i=0,r){r===void 0&&(r=(n.byteLength-i)/ar.getByteSize(e));const s=ar.getArrayType(e);return new s(n,i,r)}}function pX(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function mX(t,e=[0,0,0]){const n=t>>11&31,i=t>>5&63,r=t&31;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}new r1;new q;new r1;new r1;function ww(t,e=255){return on(t,0,e)/e*2-1}function Tw(t){return t<0?-1:1}function _X(t,e,n,i){if(pX(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=ww(t,n),i.y=ww(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const r=i.x;i.x=(1-Math.abs(i.y))*Tw(r),i.y=(1-Math.abs(r))*Tw(i.y)}return i.normalize()}function yX(t,e,n){return _X(t,e,255,n)}class Q1{constructor(e,n){T(this,"json",void 0),T(this,"buffer",void 0),T(this,"featuresLength",0),T(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,n=st.UNSIGNED_INT,i=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,r.byteOffset):r}getPropertyArray(e,n,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=ar.fromName(r.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,n,r)}getProperty(e,n,i,r,s){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,i);if(i===1)return a[r];for(let l=0;l<i;++l)s[l]=a[i*r+l];return s}_getTypedArrayFromBinary(e,n,i,r,s){const o=this._cachedTypedArrays;let a=o[e];return a||(a=ar.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+s,r*i),o[e]=a),a}_getTypedArrayFromArray(e,n,i){const r=this._cachedTypedArrays;let s=r[e];return s||(s=ar.createTypedArray(n,i),r[e]=s),s}}const vX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},EX={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},wX={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function TX(t,e,n,i){const{componentType:r}=t;ut(t.componentType);const s=typeof r=="string"?ar.fromName(r):r,o=vX[t.type],a=EX[t.type],l=wX[t.type];return n+=t.byteOffset,{values:ar.createTypedArray(s,e,n,o*i),type:s,size:o,unpacker:a,packer:l}}const or=t=>t!==void 0;function CX(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?xX(i,n):null}function xX(t,e){let n,i,r;const s=t.instancesLength,o=t.classes;let a=t.classIds,l=t.parentCounts,h=t.parentIds,g=s;or(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let m;if(or(l))for(or(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,s)),m=new Uint16Array(s),g=0,n=0;n<s;++n)m[n]=g,g+=l[n];or(h)&&or(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,g));const v=o.length;for(n=0;n<v;++n){const R=o[n].length,S=o[n].instances,P=getBinaryProperties(R,S,e);o[n].instances=combine(P,S)}const w=new Array(v).fill(0),C=new Uint16Array(s);for(n=0;n<s;++n)i=a[n],C[n]=w[i],++w[i];const b={classes:o,classIds:a,classIndexes:C,parentCounts:l,parentIndexes:m,parentIds:h};return PX(b),b}function RA(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?bX(t,e,n):SX(t,e,n)}function bX(t,e,n){const i=t.classIds,r=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const h=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),l[e]===h)continue;l[e]=h;const m=n(t,e);if(or(m))return m;const v=r[e],w=o[e];for(let C=0;C<v;++C){const b=s[w+C];b!==e&&g.push(b)}}return null}function SX(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(or(r))return r;const s=t.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function PX(t){const n=t.classIds.length;for(let i=0;i<n;++i)M3(t,i,stack)}function M3(t,e,n){const i=t.parentCounts,r=t.parentIds,s=t.parentIndexes,a=t.classIds.length;if(!or(r))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const l=or(i)?i[e]:1,h=or(i)?s[e]:e;for(let g=0;g<l;++g){const m=r[h+g];m!==e&&M3(t,m,n)}n.pop(e)}function kn(t){return t!=null}const Su=(t,e)=>t,MX={HIERARCHY:!0,extensions:!0,extras:!0};class I3{constructor(e,n,i,r={}){var s;T(this,"json",void 0),T(this,"binary",void 0),T(this,"featureCount",void 0),T(this,"_extensions",void 0),T(this,"_properties",void 0),T(this,"_binaryProperties",void 0),T(this,"_hierarchy",void 0),ut(i>=0),this.json=e||{},this.binary=n,this.featureCount=i,this._extensions=((s=this.json)===null||s===void 0?void 0:s.extensions)||{},this._properties={};for(const o in this.json)MX[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=CX(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),ut(typeof n=="string",n),this._hierarchy){const i=RA(this._hierarchy,e,(r,s)=>{const o=r.classIds[s];return r.classes[o].name===n});return kn(i)}return!1}isExactClass(e,n){return ut(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),ut(typeof n=="string",n),kn(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=kn(n)?n:[],n.length=0;const i=Object.keys(this._properties);return n.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),ut(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(kn(r))return this._getBinaryProperty(r,e)}const i=this._properties[n];if(kn(i))return Su(i[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,n);if(kn(r))return r}}setProperty(e,n,i){const r=this.featureCount;if(this._checkBatchId(e),ut(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))return;let s=this._properties[n];kn(s)||(this._properties[n]=new Array(r),s=this._properties[n]),s[e]=Su(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,i){e.pack(i,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const i=this._properties[n],r=this._initializeBinaryProperty(n,i);r&&(e=e||{},e[n]=r)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const i=n;ut(this.binary,"Property ".concat(e," requires a batch table binary.")),ut(i.type,"Property ".concat(e," requires a type."));const r=TX(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const i=RA(this._hierarchy,e,(r,s)=>{const o=r.classIds[s],a=r.classes[o].instances;return kn(a[n])});return kn(i)}_getPropertyNamesInHierarchy(e,n){RA(this._hierarchy,e,(i,r)=>{const s=i.classIds[r],o=i.classes[s].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return RA(this._hierarchy,e,(i,r)=>{const s=i.classIds[r],o=i.classes[s],a=i.classIndexes[r],l=o.instances[n];return kn(l)?kn(l.typedArray)?this._getBinaryProperty(l,a):Su(l[a]):null})}_setHierarchyProperty(e,n,i,r){const s=RA(this._hierarchy,n,(o,a)=>{const l=o.classIds[a],h=o.classes[l],g=o.classIndexes[a],m=h.instances[i];return kn(m)?(ut(a===n,'Inherited property "'.concat(i,'" is read-only.')),kn(m.typedArray)?this._setBinaryProperty(m,g,r):m[g]=Su(r),!0):!1});return kn(s)}}const z0=4;function Vh(t,e,n=0){const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=z0,t.version=i.getUint32(n,!0),n+=z0,t.byteLength=i.getUint32(n,!0),n+=z0,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const Go=4,Cw="b3dm tile in legacy format.";function X1(t,e,n){const i=new DataView(e);let r;t.header=t.header||{};let s=i.getUint32(n,!0);n+=Go;let o=i.getUint32(n,!0);n+=Go;let a=i.getUint32(n,!0);n+=Go;let l=i.getUint32(n,!0);return n+=Go,a>=570425344?(n-=Go*2,r=s,a=o,l=0,s=0,o=0,console.warn(Cw)):l>=570425344&&(n-=Go,r=a,a=s,l=o,s=0,o=0,console.warn(Cw)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=l,t.header.batchLength=r,n}function J1(t,e,n,i){return n=IX(t,e,n),n=BX(t,e,n),n}function IX(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},r>0){const a=P3(e,n,r);t.featureTableJson=JSON.parse(a)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,s),n+=s,n}function BX(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=t.header;if(r>0){const o=P3(e,n,r);t.batchTableJson=JSON.parse(o),n+=r,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}function B3(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:i,isRGB565:r,pointCount:s}=t;if(i&&n){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const l=i[a],g=n.getProperty(l,"dimensions").map(m=>m*255);o[a*3]=g[0],o[a*3+1]=g[1],o[a*3+2]=g[2]}return{type:st.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(r){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const l=mX(e[a]);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:st.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===s*3?{type:st.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:st.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const xw=new q;function LX(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let i=0;i<t.pointsLength;i++)yX(e[i*2],e[i*2+1],xw),xw.toArray(n,i*3);return{type:st.FLOAT,size:2,value:n}}return{type:st.FLOAT,size:2,value:e}}function RX(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,OX(t,e)):{type:st.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function OX(t,e){const n=new q,i=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)n.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,r*3);return i}async function FX(t,e,n,i,r){n=Vh(t,e,n),n=X1(t,e,n),n=J1(t,e,n),DX(t);const{featureTable:s,batchTable:o}=kX(t);return await VX(t,s,o,i,r),NX(t,s,i),UX(t,s,o),GX(t,s),n}function DX(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function kX(t){const e=new Q1(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",st.FLOAT,3);const i=zX(t,e);return{featureTable:e,batchTable:i}}function NX(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",st.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",st.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=(1<<16)-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",st.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",st.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=RX(t,i,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function UX(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",st.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",st.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",st.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=B3(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",st.UNSIGNED_BYTE,4))}function GX(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",st.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",st.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=LX(t,n)}}function zX(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",st.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=t;n=new I3(r,s,i)}return n}async function VX(t,e,n,i,r){let s,o,a;const l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const m=h.byteOffset,v=h.byteLength;if(!o||!Number.isFinite(m)||!v)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(m,m+v),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const g={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await HX(t,g,i,r)}async function HX(t,e,n,i){const{parse:r}=i,s={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await r(e.buffer,_3,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,g=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,m=a&&o.attributes.POSITION.value.quantization,v=h&&o.attributes.NORMAL.value.quantization;if(m){const C=o.POSITION.data.quantization,b=C.range;t.quantizedVolumeScale=new q(b,b,b),t.quantizedVolumeOffset=new q(C.minValues),t.quantizedRange=(1<<C.quantizationBits)-1,t.isQuantizedDraco=!0}v&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const w={};if(e.batchTableProperties)for(const C of Object.keys(e.batchTableProperties))o.attributes[C]&&o.attributes[C].value&&(w[C.toLowerCase()]=o.attributes[C].value);t.attributes={positions:a,colors:B3(t,l,void 0),normals:h,batchIds:g,...w}}const Np={URI:0,EMBEDDED:1};function L3(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Um(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function R3(t,e,n,i){const r=n["3d-tiles"]||{};if(jX(t,e),r.loadGLTF){const{parse:s,fetch:o}=i;t.gltfUrl&&(t.gltfArrayBuffer=await o(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await s(t.gltfArrayBuffer,Vl,n,i),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function jX(t,e,n){switch(e){case Np.URI:const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(i);t.gltfUrl=s.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Np.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function WX(t,e,n,i,r){var s;n=QX(t,e,n,i),await R3(t,Np.EMBEDDED,i,r);const o=t==null||(s=t.gltf)===null||s===void 0?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}function QX(t,e,n,i,r){n=Vh(t,e,n),n=X1(t,e,n),n=J1(t,e,n),n=L3(t,e,n,i);const s=new Q1(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",st.FLOAT,3),n}async function XX(t,e,n,i,r){return n=JX(t,e,n,i),await R3(t,t.gltfFormat,i,r),n}function JX(t,e,n,i,r){if(n=Vh(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=X1(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n+=4,n=J1(t,e,n),n=L3(t,e,n,i),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Q1(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",st.FLOAT,3);const l=new I3(t.batchTableJson,t.batchTableBinary,a);return YX(t,o,l,a),n}function YX(t,e,n,i){const s={instances:new Array(i),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new q;new q,new q,new q;const a=new qt,l=new Pl,h=new q,g={},m=new ze,v=[],w=[],C=new q,b=new q;for(let R=0;R<i;R++){let S;if(e.hasProperty("POSITION"))S=e.getProperty("POSITION",st.FLOAT,3,R,o);else if(e.hasProperty("POSITION_QUANTIZED")){S=e.getProperty("POSITION_QUANTIZED",st.UNSIGNED_SHORT,3,R,o);const K=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",st.FLOAT,3,C);if(!K)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ee=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",st.FLOAT,3,b);if(!ee)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const X=65535;for(let U=0;U<3;U++)S[U]=S[U]/X*ee[U]+K[U]}if(!S)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(S),g.translation=o,t.normalUp=e.getProperty("NORMAL_UP",st.FLOAT,3,R,v),t.normalRight=e.getProperty("NORMAL_RIGHT",st.FLOAT,3,R,w),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",st.UNSIGNED_SHORT,2,v),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",st.UNSIGNED_SHORT,2,w),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?($t.WGS84.eastNorthUpToFixedFrame(o,m),m.getRotationMatrix3(a)):a.identity()}l.fromMatrix3(a),g.rotation=l,h.set(1,1,1);const P=e.getProperty("SCALE",st.FLOAT,1,R);Number.isFinite(P)&&h.multiplyByScalar(P);const M=e.getProperty("SCALE_NON_UNIFORM",st.FLOAT,3,R,v);M&&h.scale(M),g.scale=h;let F=e.getProperty("BATCH_ID",st.UNSIGNED_SHORT,1,R);F===void 0&&(F=R);const H=new ze().fromQuaternion(g.rotation);m.identity(),m.translate(g.translation),m.multiplyRight(H),m.scale(g.scale);const j=m.clone();s[R]={modelMatrix:j,batchId:F}}t.instances=s}async function KX(t,e,n,i,r,s){n=Vh(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await s(e,n,i,r,a)}return n}async function ZX(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=i;t.gltf=await r(e,Vl,n,i)}async function O3(t,e=0,n,i,r={}){switch(r.byteOffset=e,r.type=hX(t,e),r.type){case LA.COMPOSITE:return await KX(r,t,e,n,i,O3);case LA.BATCHED_3D_MODEL:return await WX(r,t,e,n,i);case LA.GLTF:return await ZX(r,t,n,i);case LA.INSTANCED_3D_MODEL:return await XX(r,t,e,n,i);case LA.POINT_CLOUD:return await FX(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}const qX=1952609651,$X=1;async function eJ(t){if(new Uint32Array(t.slice(0,4))[0]!==qX)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==$X)throw new Error("Wrong subtree file verson, must be 1");const i=bw(t.slice(8,16)),r=new Uint8Array(t,24,i),o=new TextDecoder("utf8").decode(r),a=JSON.parse(o),l=bw(t.slice(16,24));let h=new ArrayBuffer(0);return l&&(h=t.slice(24+i)),"bufferView"in a.tileAvailability&&(a.tileAvailability.explicitBitstream=await V0(a,"tileAvailability",h)),"bufferView"in a.contentAvailability&&(a.contentAvailability.explicitBitstream=await V0(a,"contentAvailability",h)),"bufferView"in a.childSubtreeAvailability&&(a.childSubtreeAvailability.explicitBitstream=await V0(a,"childSubtreeAvailability",h)),a}async function V0(t,e,n){const i=t[e].bufferView,r=t.bufferViews[i],s=t.buffers[r.buffer];if(s.uri){const a=await(await Xg(s.uri)).arrayBuffer();return new Uint8Array(a,r.byteOffset,r.byteLength)}return new Uint8Array(n,r.byteOffset,r.byteLength)}function bw(t){const e=new DataView(t),n=e.getUint32(0,!0),i=e.getUint32(4,!0);return n+2**32*i}const F3={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:S3,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:eJ,options:{}},tJ=4,nJ=8,iJ={QUADTREE:tJ,OCTREE:nJ};async function D3(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;let{subtree:s,level:o=0}=t;const{subdivisionScheme:a,subtreeLevels:l,maximumLevel:h,contentUrlTemplate:g,subtreesUriTemplate:m,basePath:v}=e,w={children:[],lodMetricValue:0,contentUrl:""},C=iJ[a],b=i&1,R=i>>1&1,S=i>>2&1,P=(C**o-1)/(C-1);let M=Ns(n.mortonIndex,i),F=P+M,H=Ns(n.x,b),j=Ns(n.y,R),K=Ns(n.z,S),ee=!1;o+1>l&&(ee=H0(s.childSubtreeAvailability,M));const X=Ns(r.x,H),U=Ns(r.y,j),D=Ns(r.z,K),ae=o+r.level;if(ee){const ce="".concat(v,"/").concat(m),ne=Up(ce,ae,X,U,D);s=await Sr(ne,F3),r.mortonIndex=M,r.x=H,r.y=j,r.z=K,r.level=o,M=0,F=0,H=0,j=0,K=0,o=0}if(!H0(s.tileAvailability,F)||o>h)return w;H0(s.contentAvailability,F)&&(w.contentUrl=Up(g,ae,X,U,D));const oe=o+1,ve={mortonIndex:M,x:H,y:j,z:K};for(let ce=0;ce<C;ce++){const ne=await D3({subtree:s,options:e,parentData:ve,childIndex:ce,level:oe,globalData:r});if(ne.contentUrl||ne.children.length){const le=ae+1,xe=rJ(ne,le,{childTileX:H,childTileY:j,childTileZ:K},e);w.children.push(xe)}}return w}function H0(t,e){return"constant"in t?Boolean(t.constant):t.explicitBitstream?aJ(e,t.explicitBitstream):!1}function rJ(t,e,n,i){const{basePath:r,refine:s,getRefine:o,lodMetricType:a,getTileType:l,rootLodMetricValue:h,rootBoundingVolume:g}=i,m=t.contentUrl&&t.contentUrl.replace("".concat(r,"/"),""),v=h/2**e,w=sJ(e,g,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:m},id:t.contentUrl,refine:o(s),type:l(t),lodMetricType:a,lodMetricValue:v,boundingVolume:w}}function sJ(t,e,n){if(e.region){const{childTileX:i,childTileY:r,childTileZ:s}=n,[o,a,l,h,g,m]=e.region,v=2**t,w=(l-o)/v,C=(h-a)/v,b=(m-g)/v,[R,S]=[o+w*i,o+w*(i+1)],[P,M]=[a+C*r,a+C*(r+1)],[F,H]=[g+b*s,g+b*(s+1)];return{region:[R,P,S,M,F,H]}}return console.warn("Unsupported bounding volume type: ",e),null}function Ns(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Up(t,e,n,i,r){const s=oJ({level:e,x:n,y:i,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function oJ(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function aJ(t,e){const n=Math.floor(t/8),i=t%8;return(e[n]>>i&1)===1}function Y1(t){if(!t.contentUrl)return Ta.EMPTY;const n=t.contentUrl.split(".").pop();switch(n){case"pnts":return Ta.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ta.SCENEGRAPH;default:return n}}function K1(t){switch(t){case"REPLACE":case"replace":return wr.REPLACE;case"ADD":case"add":return wr.ADD;default:return t}}function Gp(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,"".concat(e,"/"));return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function Sw(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=Gp(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=Gh.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=Y1(t),t.refine=K1(t.refine),t}function AJ(t){const e=t.basePath,n=Sw(t.root,t),i=[];for(i.push(n);i.length>0;){const s=(i.pop()||{}).children||[];for(const o of s)Sw(o,{basePath:e}),i.push(o)}return n}async function lJ(t){if(!t.root)return null;const e=t.basePath,n=t.root.extensions["3DTILES_implicit_tiling"],{subdivisionScheme:i,maximumLevel:r,subtreeLevels:s,subtrees:{uri:o}}=n,a=Up(o,0,0,0,0),l=Gp(a,e),h=await Sr(l,F3),g=Gp(t.root.content.uri,e),m=t.root.refine,v=t.root.geometricError,w=t.root.boundingVolume,C={contentUrlTemplate:g,subtreesUriTemplate:o,subdivisionScheme:i,subtreeLevels:s,maximumLevel:r,refine:m,basePath:e,lodMetricType:Gh.GEOMETRIC_ERROR,rootLodMetricValue:v,rootBoundingVolume:w,getTileType:Y1,getRefine:K1};return await cJ(t.root,h,C)}async function cJ(t,e,n){if(!t)return null;t.lodMetricType=Gh.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await D3({subtree:e,options:n});return r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")}),t.refine=K1(t.refine),t.type=Y1(t),t.children=i,t.id=t.contentUrl,t}const Pw="3DTILES_implicit_tiling",k3={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:S3,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:dJ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function uJ(t){return hx(t.url)}async function fJ(t,e,n){const i={content:{featureIds:null}};return await O3(t,0,e,n,i.content),i.content}async function hJ(t,e,n){var i;const r=JSON.parse(new TextDecoder().decode(t));return r.loader=e.loader||k3,r.url=n.url,r.basePath=uJ(r),r.root=gJ(r)?await lJ(r):AJ(r),r.type=ir.TILES3D,r.lodMetricType=Gh.GEOMETRIC_ERROR,r.lodMetricValue=((i=r.root)===null||i===void 0?void 0:i.lodMetricValue)||0,r}async function dJ(t,e,n){const i=e["3d-tiles"]||{};let r;return i.isTileset==="auto"?r=n.url&&n.url.indexOf(".json")!==-1:r=i.isTileset,r?t=await hJ(t,e,n):t=await fJ(t,e,n),t}function gJ(t){var e,n;return(t==null||(e=t.extensionsRequired)===null||e===void 0?void 0:e.includes(Pw))&&(t==null||(n=t.extensionsUsed)===null||n===void 0?void 0:n.includes(Pw))}const Mw=[0],pJ={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:k3,onTilesetLoad:{type:"function",value:t=>{},compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:(t,e,n)=>{},compare:!1},_getMeshColor:{type:"function",value:t=>[255,255,255],compare:!1}};class N3 extends Or{constructor(...e){super(...e),T(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&De.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:i}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:r}=this.state;for(const s in r)r[s].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,n[e.id]=e;const r=i==null?void 0:i[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const{layerMap:i}=this.state,r=n&&n.id;if(r){const s=r.substring(this.id.length+1),o=s.substring(s.indexOf("-")+1);e.object=i[o]&&i[o].tile}return e}filterSubLayer({layer:e,viewport:n}){const{tile:i}=e.props,{id:r}=n;return i.selected&&i.viewportIds.includes(r)}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const r={loadOptions:{...n}};if(i.preload){const a=await i.preload(e,n);a.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:a.headers}),Object.assign(r,a)}const s=await Sr(e,i,r.loadOptions),o=new uX(s,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:i}=this.context,r=Object.keys(e).length;!i||!r||!n||n.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Ta.POINTCLOUD:return this._makePointCloudLayer(e,n);case Ta.SCENEGRAPH:return this._make3DModelLayer(e);case Ta.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:i,pointCount:r,constantRGBA:s,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:l,normals:h,colors:g}=i;if(!l)return null;const m=n&&n.props.data||{header:{vertexCount:r},attributes:{POSITION:l,NORMAL:h,COLOR_0:g}},{pointSize:v,getPointColor:w}=this.props,C=this.getSubLayerClass("pointcloud",C1);return new C({pointSize:v},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:m,coordinateSystem:Ge.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:s||w,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:i,cartographicOrigin:r,modelMatrix:s}=e.content,o=this.getSubLayerClass("scenegraph",j1);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:i||Mw,scenegraph:n,coordinateSystem:Ge.METER_OFFSETS,coordinateOrigin:r,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const i=e.content,{attributes:r,indices:s,modelMatrix:o,cartographicOrigin:a,coordinateSystem:l=Ge.METER_OFFSETS,material:h,featureIds:g}=i,{_getMeshColor:m}=this.props,v=n&&n.props.mesh||new Bn({drawMode:4,attributes:mJ(r),indices:s}),w=this.getSubLayerClass("mesh",W1);return new w(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:v,data:Mw,getColor:m(e),pbrMaterial:h,modelMatrix:o,coordinateOrigin:a,coordinateSystem:l,featureIds:g,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(i=>{const r=n[i.id]=n[i.id]||{tile:i};let{layer:s}=r;return i.selected&&(s?r.needsUpdate&&(s=this._getSubLayer(i,s),r.needsUpdate=!1):s=this._getSubLayer(i)),r.layer=s,s}).filter(Boolean):null}}T(N3,"defaultProps",pJ);T(N3,"layerName","Tile3DLayer");function mJ(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const _J=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function j0(t){return t>>1^-(t&1)}function yJ(t){let e=0;const n={};for(const[i,r]of _J){const s=r===8?t.getFloat64:t.getFloat32;n[i]=s.call(t,e,!0),e+=r}return{header:n,headerEndPosition:e}}function vJ(t,e){let n=e;const i=3,r=t.getUint32(n,!0),s=new Uint16Array(r*i);n+=Uint32Array.BYTES_PER_ELEMENT;const o=Uint16Array.BYTES_PER_ELEMENT,a=r*o,l=n,h=l+a,g=h+a;let m=0,v=0,w=0;for(let C=0;C<r;C++)m+=j0(t.getUint16(l+o*C,!0)),v+=j0(t.getUint16(h+o*C,!0)),w+=j0(t.getUint16(g+o*C,!0)),s[C]=m,s[C+r]=v,s[C+r*2]=w;return n+=a*3,{vertexData:s,vertexDataEndPosition:n}}function jA(t,e,n,i,r=!0){let s;if(i===2?s=new Uint16Array(t,e,n):s=new Uint32Array(t,e,n),!r)return s;let o=0;for(let a=0;a<s.length;++a){const l=s[a];s[a]=o-l,l===0&&++o}return s}function EJ(t,e,n){let i=n;const r=3,o=e.length/r>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%o!==0&&(i+=o-i%o);const a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const l=a*3,h=jA(t.buffer,i,l,o);return i+=l*o,{triangleIndicesEndPosition:i,triangleIndices:h}}function wJ(t,e,n){let i=n;const r=3,o=e.length/r>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const l=jA(t.buffer,i,a,o,!1);i+=a*o;const h=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const g=jA(t.buffer,i,h,o,!1);i+=h*o;const m=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const v=jA(t.buffer,i,m,o,!1);i+=m*o;const w=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const C=jA(t.buffer,i,w,o,!1);return i+=w*o,{edgeIndicesEndPosition:i,westIndices:l,southIndices:g,eastIndices:v,northIndices:C}}function TJ(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function CJ(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function xJ(t,e){const n={};if(t.byteLength<=e)return{extensions:n,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){const r=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;const s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const o=new DataView(t.buffer,i,s);switch(r){case 1:{n.vertexNormals=TJ(o);break}case 2:{n.waterMask=CJ(o);break}}i+=s}return{extensions:n,extensionsEndPosition:i}}const fa={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},bJ={maxDecodingStep:fa.extensions};function SJ(t,e){const n=Object.assign({},bJ,e),i=new DataView(t),{header:r,headerEndPosition:s}=yJ(i);if(n.maxDecodingStep<fa.vertices)return{header:r};const{vertexData:o,vertexDataEndPosition:a}=vJ(i,s);if(n.maxDecodingStep<fa.triangleIndices)return{header:r,vertexData:o};const{triangleIndices:l,triangleIndicesEndPosition:h}=EJ(i,o,a);if(n.maxDecodingStep<fa.edgeIndices)return{header:r,vertexData:o,triangleIndices:l};const{westIndices:g,southIndices:m,eastIndices:v,northIndices:w,edgeIndicesEndPosition:C}=wJ(i,o,h);if(n.maxDecodingStep<fa.extensions)return{header:r,vertexData:o,triangleIndices:l,westIndices:g,northIndices:w,eastIndices:v,southIndices:m};const{extensions:b}=xJ(i,C);return{header:r,vertexData:o,triangleIndices:l,westIndices:g,northIndices:w,eastIndices:v,southIndices:m,extensions:b}}function U3(t,e,n,i){const r=i?MJ(i,t.POSITION.value):PJ(e),s=new t.POSITION.value.constructor(r.length*6),o=new t.TEXCOORD_0.value.constructor(r.length*4),a=new e.constructor(r.length*6);for(let h=0;h<r.length;h++){const g=r[h];IJ({edge:g,edgeIndex:h,attributes:t,skirtHeight:n,newPosition:s,newTexcoord0:o,newTriangles:a})}t.POSITION.value=Vd(t.POSITION.value,s),t.TEXCOORD_0.value=Vd(t.TEXCOORD_0.value,o);const l=e instanceof Array?e.concat(a):Vd(e,a);return{attributes:t,triangles:l}}function PJ(t){const e=[];for(let o=0;o<t.length;o+=3)e.push([t[o],t[o+1]]),e.push([t[o+1],t[o+2]]),e.push([t[o+2],t[o]]);e.sort((o,a)=>Math.min(...o)-Math.min(...a)||Math.max(...o)-Math.max(...a));const n=[];let i=0;for(;i<e.length;){var r,s;e[i][0]===((r=e[i+1])===null||r===void 0?void 0:r[1])&&e[i][1]===((s=e[i+1])===null||s===void 0?void 0:s[0])?i+=2:(n.push(e[i]),i++)}return n}function MJ(t,e){t.westIndices.sort((i,r)=>e[3*i+1]-e[3*r+1]),t.eastIndices.sort((i,r)=>e[3*r+1]-e[3*i+1]),t.southIndices.sort((i,r)=>e[3*r]-e[3*i]),t.northIndices.sort((i,r)=>e[3*i]-e[3*r]);const n=[];for(const i in t){const r=t[i];for(let s=0;s<r.length-1;s++)n.push([r[s],r[s+1]])}return n}function IJ({edge:t,edgeIndex:e,attributes:n,skirtHeight:i,newPosition:r,newTexcoord0:s,newTriangles:o}){const a=n.POSITION.value.length,l=e*2,h=e*2+1;r.set(n.POSITION.value.subarray(t[0]*3,t[0]*3+3),l*3),r[l*3+2]=r[l*3+2]-i,r.set(n.POSITION.value.subarray(t[1]*3,t[1]*3+3),h*3),r[h*3+2]=r[h*3+2]-i,s.set(n.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),l*2),s.set(n.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),h*2);const g=e*2*3;o[g]=t[0],o[g+1]=a/3+h,o[g+2]=t[1],o[g+3]=a/3+h,o[g+4]=t[0],o[g+5]=a/3+l}function BJ(t,e,n){const{minHeight:i,maxHeight:r}=e,[s,o,a,l]=n||[0,0,1,1],h=a-s,g=l-o,m=r-i,v=t.length/3,w=new Float32Array(v*3),C=new Float32Array(v*2);for(let b=0;b<v;b++){const R=t[b]/32767,S=t[b+v]/32767,P=t[b+v*2]/32767;w[3*b+0]=R*h+s,w[3*b+1]=S*g+o,w[3*b+2]=P*m+i,C[2*b+0]=R,C[2*b+1]=S}return{POSITION:{value:w,size:3},TEXCOORD_0:{value:C,size:2}}}function LJ(t,e){if(!t)return null;const{bounds:n}=e,{header:i,vertexData:r,triangleIndices:s,westIndices:o,northIndices:a,eastIndices:l,southIndices:h}=SJ(t,fa.triangleIndices);let g=s,m=BJ(r,i,n);const v=G1(m);if(e.skirtHeight){const{attributes:w,triangles:C}=U3(m,g,e.skirtHeight,{westIndices:o,northIndices:a,eastIndices:l,southIndices:h});m=w,g=C}return{loaderData:{header:{}},header:{vertexCount:g.length,boundingBox:v},mode:4,indices:{value:g,size:1},attributes:m}}function Iw(t,e){return LJ(t,e["quantized-mesh"])}class RJ{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let r=i+2,s=0,o=0,a=0,l=0,h=0,g=0;for(r&1?a=l=h=n:s=o=g=n;(r>>=1)>1;){const v=s+a>>1,w=o+l>>1;r&1?(a=s,l=o,s=h,o=g):(s=a,o=l,a=h,l=g),h=v,g=w}const m=i*4;this.coords[m+0]=s,this.coords[m+1]=o,this.coords[m+2]=a,this.coords[m+3]=l}}createTile(e){return new OJ(e,this)}}class OJ{constructor(e,n){const i=n.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:i,gridSize:r}=this.martini,{terrain:s,errors:o}=this;for(let a=e-1;a>=0;a--){const l=a*4,h=i[l+0],g=i[l+1],m=i[l+2],v=i[l+3],w=h+m>>1,C=g+v>>1,b=w+C-g,R=C+h-w,S=(s[g*r+h]+s[v*r+m])/2,P=C*r+w,M=Math.abs(S-s[P]);if(o[P]=Math.max(o[P],M),a<n){const F=(g+R>>1)*r+(h+b>>1),H=(v+R>>1)*r+(m+b>>1);o[P]=Math.max(o[P],o[F],o[H])}}}getMesh(e=0){const{gridSize:n,indices:i}=this.martini,{errors:r}=this;let s=0,o=0;const a=n-1;i.fill(0);function l(w,C,b,R,S,P){const M=w+b>>1,F=C+R>>1;Math.abs(w-S)+Math.abs(C-P)>1&&r[F*n+M]>e?(l(S,P,w,C,M,F),l(b,R,S,P,M,F)):(i[C*n+w]=i[C*n+w]||++s,i[R*n+b]=i[R*n+b]||++s,i[P*n+S]=i[P*n+S]||++s,o++)}l(0,0,a,a,a,0),l(a,a,0,0,0,a);const h=new Uint16Array(s*2),g=new Uint32Array(o*3);let m=0;function v(w,C,b,R,S,P){const M=w+b>>1,F=C+R>>1;if(Math.abs(w-S)+Math.abs(C-P)>1&&r[F*n+M]>e)v(S,P,w,C,M,F),v(b,R,S,P,M,F);else{const H=i[C*n+w]-1,j=i[R*n+b]-1,K=i[P*n+S]-1;h[2*H]=w,h[2*H+1]=C,h[2*j]=b,h[2*j+1]=R,h[2*K]=S,h[2*K+1]=P,g[m++]=H,g[m++]=j,g[m++]=K}}return v(0,0,a,a,a,0),v(a,a,0,0,0,a),{vertices:h,triangles:g}}}class FJ{constructor(e,n,i=n){this.data=e,this.width=n,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const r=n-1,s=i-1,o=this._addPoint(0,0),a=this._addPoint(r,0),l=this._addPoint(0,s),h=this._addPoint(r,s),g=this._addTriangle(h,o,l,-1,-1,-1);this._addTriangle(o,h,a,g,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,n){return this.data[this.width*n+e]}_flush(){const e=this.coords;for(let n=0;n<this._pendingLen;n++){const i=this._pending[n],r=2*this.triangles[i*3+0],s=2*this.triangles[i*3+1],o=2*this.triangles[i*3+2];this._findCandidate(e[r],e[r+1],e[s],e[s+1],e[o],e[o+1],i)}this._pendingLen=0}_findCandidate(e,n,i,r,s,o,a){const l=Math.min(e,i,s),h=Math.min(n,r,o),g=Math.max(e,i,s),m=Math.max(n,r,o);let v=Us(i,r,s,o,l,h),w=Us(s,o,e,n,l,h),C=Us(e,n,i,r,l,h);const b=r-n,R=e-i,S=o-r,P=i-s,M=n-o,F=s-e,H=Us(e,n,i,r,s,o),j=this.heightAt(e,n)/H,K=this.heightAt(i,r)/H,ee=this.heightAt(s,o)/H;let X=0,U=0,D=0,ae=0;for(let re=h;re<=m;re++){let te=0;v<0&&S!==0&&(te=Math.max(te,Math.floor(-v/S))),w<0&&M!==0&&(te=Math.max(te,Math.floor(-w/M))),C<0&&b!==0&&(te=Math.max(te,Math.floor(-C/b)));let oe=v+S*te,ve=w+M*te,ce=C+b*te,ne=!1;for(let le=l+te;le<=g;le++){if(oe>=0&&ve>=0&&ce>=0){ne=!0;const he=j*oe+K*ve+ee*ce,xe=Math.abs(he-this.heightAt(le,re));ae+=xe*xe,xe>X&&(X=xe,U=le,D=re)}else if(ne)break;oe+=S,ve+=M,ce+=b}v+=P,w+=F,C+=R}(U===e&&D===n||U===i&&D===r||U===s&&D===o)&&(X=0),this._candidates[2*a]=U,this._candidates[2*a+1]=D,this._rms[a]=ae,this._queuePush(a,X,ae)}_step(){const e=this._queuePop(),n=e*3+0,i=e*3+1,r=e*3+2,s=this.triangles[n],o=this.triangles[i],a=this.triangles[r],l=this.coords[2*s],h=this.coords[2*s+1],g=this.coords[2*o],m=this.coords[2*o+1],v=this.coords[2*a],w=this.coords[2*a+1],C=this._candidates[2*e],b=this._candidates[2*e+1],R=this._addPoint(C,b);if(Us(l,h,g,m,C,b)===0)this._handleCollinear(R,n);else if(Us(g,m,v,w,C,b)===0)this._handleCollinear(R,i);else if(Us(v,w,l,h,C,b)===0)this._handleCollinear(R,r);else{const S=this._halfedges[n],P=this._halfedges[i],M=this._halfedges[r],F=this._addTriangle(s,o,R,S,-1,-1,n),H=this._addTriangle(o,a,R,P,-1,F+1),j=this._addTriangle(a,s,R,M,F+2,H+1);this._legalize(F),this._legalize(H),this._legalize(j)}}_addPoint(e,n){const i=this.coords.length>>1;return this.coords.push(e,n),i}_addTriangle(e,n,i,r,s,o,a=this.triangles.length){const l=a/3;return this.triangles[a+0]=e,this.triangles[a+1]=n,this.triangles[a+2]=i,this._halfedges[a+0]=r,this._halfedges[a+1]=s,this._halfedges[a+2]=o,r>=0&&(this._halfedges[r]=a+0),s>=0&&(this._halfedges[s]=a+1),o>=0&&(this._halfedges[o]=a+2),this._candidates[2*l+0]=0,this._candidates[2*l+1]=0,this._queueIndices[l]=-1,this._rms[l]=0,this._pending[this._pendingLen++]=l,a}_legalize(e){const n=this._halfedges[e];if(n<0)return;const i=e-e%3,r=n-n%3,s=i+(e+1)%3,o=i+(e+2)%3,a=r+(n+2)%3,l=r+(n+1)%3,h=this.triangles[o],g=this.triangles[e],m=this.triangles[s],v=this.triangles[a],w=this.coords;if(!DJ(w[2*h],w[2*h+1],w[2*g],w[2*g+1],w[2*m],w[2*m+1],w[2*v],w[2*v+1]))return;const C=this._halfedges[s],b=this._halfedges[o],R=this._halfedges[a],S=this._halfedges[l];this._queueRemove(i/3),this._queueRemove(r/3);const P=this._addTriangle(h,v,m,-1,R,C,i),M=this._addTriangle(v,h,g,P,b,S,r);this._legalize(P+1),this._legalize(M+2)}_handleCollinear(e,n){const i=n-n%3,r=i+(n+1)%3,s=i+(n+2)%3,o=this.triangles[s],a=this.triangles[n],l=this.triangles[r],h=this._halfedges[r],g=this._halfedges[s],m=this._halfedges[n];if(m<0){const j=this._addTriangle(e,o,a,-1,g,-1,i),K=this._addTriangle(o,e,l,j,-1,h);this._legalize(j+1),this._legalize(K+2);return}const v=m-m%3,w=v+(m+2)%3,C=v+(m+1)%3,b=this.triangles[w],R=this._halfedges[w],S=this._halfedges[C];this._queueRemove(v/3);const P=this._addTriangle(o,a,e,g,-1,-1,i),M=this._addTriangle(a,b,e,S,-1,P+1,v),F=this._addTriangle(b,l,e,R,-1,M+1),H=this._addTriangle(l,o,e,h,P+2,F+1);this._legalize(P),this._legalize(M),this._legalize(F),this._legalize(H)}_queuePush(e,n,i){const r=this._queue.length;this._queueIndices[e]=r,this._queue.push(e),this._errors.push(n),this._rmsSum+=i,this._queueUp(r)}_queuePop(){const e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){const e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){const n=this._queueIndices[e];if(n<0){const r=this._pending.indexOf(e);if(r!==-1)this._pending[r]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const i=this._queue.length-1;i!==n&&(this._queueSwap(n,i),this._queueDown(n,i)||this._queueUp(n)),this._queuePopBack()}_queueLess(e,n){return this._errors[e]>this._errors[n]}_queueSwap(e,n){const i=this._queue[e],r=this._queue[n];this._queue[e]=r,this._queue[n]=i,this._queueIndices[i]=n,this._queueIndices[r]=e;const s=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=s}_queueUp(e){let n=e;for(;;){const i=n-1>>1;if(i===n||!this._queueLess(n,i))break;this._queueSwap(i,n),n=i}}_queueDown(e,n){let i=e;for(;;){const r=2*i+1;if(r>=n||r<0)break;const s=r+1;let o=r;if(s<n&&this._queueLess(s,r)&&(o=s),!this._queueLess(o,i))break;this._queueSwap(i,o),i=o}return i>e}}function Us(t,e,n,i,r,s){return(n-r)*(e-s)-(i-s)*(t-r)}function DJ(t,e,n,i,r,s,o,a){const l=t-o,h=e-a,g=n-o,m=i-a,v=r-o,w=s-a,C=l*l+h*h,b=g*g+m*m,R=v*v+w*w;return l*(m*R-b*w)-h*(g*R-b*v)+C*(g*w-m*v)<0}function Pu(t,e,n,i,r){const{rScaler:s,bScaler:o,gScaler:a,offset:l}=i,h=new Float32Array((e+1)*(n+1));for(let g=0,m=0;m<n;m++)for(let v=0;v<e;v++,g++){const w=g*4,C=t[w+0],b=t[w+1],R=t[w+2];h[g+m]=C*s+b*a+R*o+l}if(r==="martini"){for(let g=(e+1)*e,m=0;m<e;m++,g++)h[g]=h[g-e-1];for(let g=n,m=0;m<n+1;m++,g+=n+1)h[g]=h[g-1]}return h}function kJ(t,e,n,i,r){const s=n+1,o=t.length/2,a=new Float32Array(o*3),l=new Float32Array(o*2),[h,g,m,v]=r||[0,0,n,i],w=(m-h)/n,C=(v-g)/i;for(let b=0;b<o;b++){const R=t[b*2],S=t[b*2+1],P=S*s+R;a[3*b+0]=R*w+h,a[3*b+1]=-S*C+v,a[3*b+2]=e[P],l[2*b+0]=R/n,l[2*b+1]=S/i}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:l,size:2}}}function NJ(t,e){if(t===null)return null;const{meshMaxError:n,bounds:i,elevationDecoder:r}=e,{data:s,width:o,height:a}=t;let l,h;switch(e.tesselator){case"martini":l=Pu(s,o,a,r,e.tesselator),h=Bw(n,o,l);break;case"delatin":l=Pu(s,o,a,r,e.tesselator),h=Lw(n,o,a,l);break;default:o===a&&!(a&o-1)?(l=Pu(s,o,a,r,"martini"),h=Bw(n,o,l)):(l=Pu(s,o,a,r,"delatin"),h=Lw(n,o,a,l));break}const{vertices:g}=h;let{triangles:m}=h,v=kJ(g,l,o,a,i);const w=G1(v);if(e.skirtHeight){const{attributes:C,triangles:b}=U3(v,m,e.skirtHeight);v=C,m=b}return{loaderData:{header:{}},header:{vertexCount:m.length,boundingBox:w},mode:4,indices:{value:Uint32Array.from(m),size:1},attributes:v}}function Bw(t,e,n){const i=e+1,s=new RJ(i).createTile(n),{vertices:o,triangles:a}=s.getMesh(t);return{vertices:o,triangles:a}}function Lw(t,e,n,i){const r=new FJ(i,e+1,n+1);r.run(t);const{coords:s,triangles:o}=r;return{vertices:s,triangles:o}}async function UJ(t,e,n){const i={...e,mimeType:"application/x.image",image:{...e.image,type:"data"}},r=await n.parse(t,i);return NJ(r,e.terrain)}const G3="3.2.9",z3={name:"Terrain",id:"terrain",module:"terrain",version:G3,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}},GJ={name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:G3,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};({...z3});({...GJ});const Rw=[1],zJ={...cc.defaultProps,elevationData:Bp,texture:{...Bp,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:{type:"string",value:null},wireframe:!1,material:!0,loaders:[z3]};function Ow(t){return Array.isArray(t)?t.join(";"):t||""}class V3 extends Or{constructor(...e){super(...e),T(this,"state",void 0)}updateState({props:e,oldProps:n}){const i=e.elevationData!==n.elevationData;if(i){const{elevationData:s}=e,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}const r=i||e.meshMaxError!==n.meshMaxError||e.elevationDecoder!==n.elevationDecoder||e.bounds!==n.bounds;if(!this.state.isTiled&&r){const s=this.loadTerrain(e);this.setState({terrain:s})}e.workerUrl&&De.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:n,elevationDecoder:i,meshMaxError:r,signal:s}){var o;if(!e)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?r*2:0,...(o=a)===null||o===void 0?void 0:o.terrain,bounds:n,meshMaxError:r,elevationDecoder:i}};const{fetch:l}=this.props;return l(e,{propName:"elevationData",layer:this,loadOptions:a,signal:s})}getTiledTerrainData(e){const{elevationData:n,fetch:i,texture:r,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:a}=this.context,l=Yf(n,e),h=r&&Yf(r,e),{signal:g}=e;let m=[0,0],v=[0,0];if(a.isGeospatial){const R=e.bbox;m=a.projectFlat([R.west,R.south]),v=a.projectFlat([R.east,R.north])}else{const R=e.bbox;m=[R.left,R.bottom],v=[R.right,R.top]}const w=[m[0],m[1],v[0],v[1]],C=this.loadTerrain({elevationData:l,bounds:w,elevationDecoder:s,meshMaxError:o,signal:g}),b=h?i(h,{propName:"texture",layer:this,loaders:[],signal:g}).catch(R=>null):Promise.resolve(null);return Promise.all([C,b])}renderSubLayers(e){const n=this.getSubLayerClass("mesh",Gl),{color:i,wireframe:r,material:s}=this.props,{data:o}=e;if(!o)return null;const[a,l]=o;return new n(e,{data:Rw,mesh:a,texture:l,_instanced:!1,coordinateSystem:Ge.CARTESIAN,getPosition:h=>[0,0,0],getColor:i,wireframe:r,material:s})}onViewportLoad(e){if(!e)return;const{zRange:n}=this.state,i=e.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(l=>l[2]));if(i.length===0)return;const r=Math.min(...i.map(o=>o[0])),s=Math.max(...i.map(o=>o[1]));(!n||r<n[0]||s>n[1])&&this.setState({zRange:[r,s]})}renderLayers(){const{color:e,material:n,elevationData:i,texture:r,wireframe:s,meshMaxError:o,elevationDecoder:a,tileSize:l,maxZoom:h,minZoom:g,extent:m,maxRequests:v,onTileLoad:w,onTileUnload:C,onTileError:b,maxCacheSize:R,maxCacheByteSize:S,refinementStrategy:P}=this.props;if(this.state.isTiled)return new cc(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:Ow(i),texture:Ow(r),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:l,maxZoom:h,minZoom:g,extent:m,maxRequests:v,onTileLoad:w,onTileUnload:C,onTileError:b,maxCacheSize:R,maxCacheByteSize:S,refinementStrategy:P});const M=this.getSubLayerClass("mesh",Gl);return new M(this.getSubLayerProps({id:"mesh"}),{data:Rw,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:F=>[0,0,0],getColor:e,material:n,wireframe:s})}}T(V3,"defaultProps",zJ);T(V3,"layerName","TerrainLayer");function VJ(t,e,n){const i=HJ(t),r=Object.keys(i).filter(s=>i[s]!==Array);return jJ(t,{propArrayTypes:i,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array})}function HJ(t){const e={};for(const n of t)if(n.properties)for(const i in n.properties){const r=n.properties[i];e[i]=KJ(r,e[i])}return e}function jJ(t,e,n){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:l,polygonObjectsCount:h,polygonRingsCount:g,polygonFeaturesCount:m,propArrayTypes:v,coordLength:w}=e,{numericPropKeys:C=[],PositionDataType:b=Float32Array}=n,R=t[0]&&"id"in t[0],S=t.length>65535?Uint32Array:Uint16Array,P={type:"Point",positions:new b(i*w),globalFeatureIds:new S(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},M={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new b(s*w),globalFeatureIds:new S(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},F={type:"Polygon",polygonIndices:l>65535?new Uint32Array(h+1):new Uint16Array(h+1),primitivePolygonIndices:l>65535?new Uint32Array(g+1):new Uint16Array(g+1),positions:new b(l*w),triangles:[],globalFeatureIds:new S(l),featureIds:m>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};for(const j of[P,M,F])for(const K of C){const ee=v[K];j.numericProps[K]=new ee(j.positions.length/w)}M.pathIndices[o]=s,F.polygonIndices[h]=l,F.primitivePolygonIndices[g]=l;const H={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const j of t){const K=j.geometry,ee=j.properties||{};switch(K.type){case"Point":WJ(K,P,H,w,ee),P.properties.push(Q0(ee,C)),R&&P.fields.push({id:j.id}),H.pointFeature++;break;case"LineString":QJ(K,M,H,w,ee),M.properties.push(Q0(ee,C)),R&&M.fields.push({id:j.id}),H.lineFeature++;break;case"Polygon":XJ(K,F,H,w,ee),F.properties.push(Q0(ee,C)),R&&F.fields.push({id:j.id}),H.polygonFeature++;break;default:throw new Error("Invalid geometry type")}H.feature++}return YJ(P,M,F,w)}function WJ(t,e,n,i,r){e.positions.set(t.data,n.pointPosition*i);const s=t.data.length/i;Z1(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function QJ(t,e,n,i,r){e.positions.set(t.data,n.linePosition*i);const s=t.data.length/i;Z1(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=t.indices[o],h=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(h-l)/i}}function XJ(t,e,n,i,r){e.positions.set(t.data,n.polygonPosition*i);const s=t.data.length/i;Z1(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=n.polygonPosition;e.polygonIndices[n.polygonObject++]=l;const h=t.areas[o],g=t.indices[o],m=t.indices[o+1];for(let w=0,C=g.length;w<C;++w){const b=g[w],R=w===C-1?m===void 0?t.data.length:m[0]:g[w+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(R-b)/i}const v=n.polygonPosition;JJ(e,h,g,{startPosition:l,endPosition:v,coordLength:i})}}function JJ(t,e,n,{startPosition:i,endPosition:r,coordLength:s}){const o=i*s,a=r*s,l=t.positions.subarray(o,a),h=n[0],g=n.slice(1).map(v=>(v-h)/s),m=Gz(l,g,s,e);for(let v=0,w=m.length;v<w;++v)t.triangles.push(i+m[v])}function W0(t,e){const n={};for(const i in t)n[i]={value:t[i],size:e};return n}function YJ(t,e,n,i){return{points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:W0(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:W0(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:i},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(n.triangles),size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:W0(n.numericProps,1)}}}function Z1(t,e,n,i){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+i)}}function Q0(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function KJ(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function Fw(t,e){const n=e==null?void 0:e.globalFeatureId;return n!==void 0?ZJ(t,n):qJ(t,e==null?void 0:e.type)}function ZJ(t,e){const n=H3(t);for(const i of n){let r=0,s=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){const a=i.featureIds.value[o];if(a!==s){if(e===i.globalFeatureIds.value[r])return eh(i,r,o);r=o,s=a}}if(e===i.globalFeatureIds.value[r])return eh(i,r,i.featureIds.value.length)}throw new Error("featureId:".concat(e," not found"))}function qJ(t,e){const n=H3(t,e);return eY(n)}function $J(t,e,n){switch(t.type){case"Point":return rY(t,e,n);case"LineString":return iY(t,e,n);case"Polygon":return j3(t,e,n);default:const i=t;throw new Error("Unsupported geometry type: ".concat(i==null?void 0:i.type))}}function H3(t,e){if(!Boolean(t.points||t.lines||t.polygons))return t.type=e||sY(t),[t];const i=[];return t.points&&(t.points.type="Point",i.push(t.points)),t.lines&&(t.lines.type="LineString",i.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",i.push(t.polygons)),i}function eY(t){const e=[];for(const n of t){if(n.featureIds.value.length===0)continue;let i=0,r=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const o=n.featureIds.value[s];o!==r&&(e.push(eh(n,i,s)),i=s,r=o)}e.push(eh(n,i,n.featureIds.value.length))}return e}function eh(t,e,n){const i=$J(t,e,n),r=nY(t,e),s=tY(t,e);return{type:"Feature",geometry:i,properties:r,...s}}function tY(t,e=0,n){return t.fields&&t.fields[t.featureIds.value[e]]}function nY(t,e=0,n){const i=Object.assign({},t.properties[t.featureIds.value[e]]);for(const r in t.numericProps)i[r]=t.numericProps[r].value[e];return i}function j3(t,e=-1/0,n=1/0){const{positions:i}=t,r=t.polygonIndices.value.filter(l=>l>=e&&l<=n),s=t.primitivePolygonIndices.value.filter(l=>l>=e&&l<=n);if(!(r.length>2)){const l=[];for(let h=0;h<s.length-1;h++){const g=s[h],m=s[h+1],v=th(i,g,m);l.push(v)}return{type:"Polygon",coordinates:l}}const a=[];for(let l=0;l<r.length-1;l++){const h=r[l],g=r[l+1],m=j3(t,h,g).coordinates;a.push(m)}return{type:"MultiPolygon",coordinates:a}}function iY(t,e=-1/0,n=1/0){const{positions:i}=t,r=t.pathIndices.value.filter(a=>a>=e&&a<=n);if(!(r.length>2)){const a=th(i,r[0],r[1]);return{type:"LineString",coordinates:a}}const o=[];for(let a=0;a<r.length-1;a++){const l=th(i,r[a],r[a+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function rY(t,e,n){const{positions:i}=t,r=th(i,e,n);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function th(t,e,n){e=e||0,n=n||t.value.length/t.size;const i=[];for(let r=e;r<n;r++){const s=Array();for(let o=r*t.size;o<(r+1)*t.size;o++)s.push(Number(t.value[o]));i.push(s)}return i}function sY(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var q1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */q1.read=function(t,e,n,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,h=l>>1,g=-7,m=n?r-1:0,v=n?-1:1,w=t[e+m];for(m+=v,s=w&(1<<-g)-1,w>>=-g,g+=a;g>0;s=s*256+t[e+m],m+=v,g-=8);for(o=s&(1<<-g)-1,s>>=-g,g+=i;g>0;o=o*256+t[e+m],m+=v,g-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:(w?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(w?-1:1)*o*Math.pow(2,s-i)};q1.write=function(t,e,n,i,r,s){var o,a,l,h=s*8-r-1,g=(1<<h)-1,m=g>>1,v=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=i?0:s-1,C=i?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=g):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+m>=1?e+=v/l:e+=v*Math.pow(2,1-m),e*l>=2&&(o++,l/=2),o+m>=g?(a=0,o=g):o+m>=1?(a=(e*l-1)*Math.pow(2,r),o=o+m):(a=e*Math.pow(2,m-1)*Math.pow(2,r),o=0));r>=8;t[n+w]=a&255,w+=C,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;t[n+w]=o&255,w+=C,o/=256,h-=8);t[n+w-C]|=b*128};var W3=At,Mu=q1;function At(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}At.Varint=0;At.Fixed64=1;At.Bytes=2;At.Fixed32=5;var zp=(1<<16)*(1<<16),Dw=1/zp,oY=12,Q3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");At.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Iu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Nw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Iu(this.buf,this.pos)+Iu(this.buf,this.pos+4)*zp;return this.pos+=8,t},readSFixed64:function(){var t=Iu(this.buf,this.pos)+Nw(this.buf,this.pos+4)*zp;return this.pos+=8,t},readFloat:function(){var t=Mu.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Mu.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,i;return i=e[this.pos++],n=i&127,i<128||(i=e[this.pos++],n|=(i&127)<<7,i<128)||(i=e[this.pos++],n|=(i&127)<<14,i<128)||(i=e[this.pos++],n|=(i&127)<<21,i<128)?n:(i=e[this.pos],n|=(i&15)<<28,aY(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=oY&&Q3?EY(this.buf,e,t):vY(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==At.Bytes)return t.push(this.readVarint(e));var n=gr(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==At.Bytes)return t.push(this.readSVarint());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==At.Bytes)return t.push(this.readBoolean());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==At.Bytes)return t.push(this.readFloat());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==At.Bytes)return t.push(this.readDouble());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==At.Bytes)return t.push(this.readFixed32());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==At.Bytes)return t.push(this.readSFixed32());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==At.Bytes)return t.push(this.readFixed64());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==At.Bytes)return t.push(this.readSFixed64());var e=gr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===At.Varint)for(;this.buf[this.pos++]>127;);else if(e===At.Bytes)this.pos=this.readVarint()+this.pos;else if(e===At.Fixed32)this.pos+=4;else if(e===At.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Vo(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Vo(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Vo(this.buf,t&-1,this.pos),Vo(this.buf,Math.floor(t*Dw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Vo(this.buf,t&-1,this.pos),Vo(this.buf,Math.floor(t*Dw),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){AY(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=wY(this.buf,t,this.pos);var n=this.pos-e;n>=128&&kw(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Mu.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Mu.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&kw(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,At.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,uY,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,fY,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,gY,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,hY,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,dY,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,pY,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,mY,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,_Y,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,yY,e)},writeBytesField:function(t,e){this.writeTag(t,At.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,At.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,At.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,At.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,At.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,At.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,At.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,At.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,At.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,At.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function aY(t,e,n){var i=n.buf,r,s;if(s=i[n.pos++],r=(s&112)>>4,s<128||(s=i[n.pos++],r|=(s&127)<<3,s<128)||(s=i[n.pos++],r|=(s&127)<<10,s<128)||(s=i[n.pos++],r|=(s&127)<<17,s<128)||(s=i[n.pos++],r|=(s&127)<<24,s<128)||(s=i[n.pos++],r|=(s&1)<<31,s<128))return zo(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function gr(t){return t.type===At.Bytes?t.readVarint()+t.pos:t.pos+1}function zo(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function AY(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),lY(n,i,e),cY(i,e)}function lY(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function cY(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function kw(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function uY(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function fY(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function hY(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function dY(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function gY(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function pY(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function mY(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function _Y(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function yY(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Iu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function Vo(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Nw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function vY(t,e,n){for(var i="",r=e;r<n;){var s=t[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>n)break;var l,h,g;a===1?s<128&&(o=s):a===2?(l=t[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[r+1],h=t[r+2],(l&192)===128&&(h&192)===128&&(o=(s&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[r+1],h=t[r+2],g=t[r+3],(l&192)===128&&(h&192)===128&&(g&192)===128&&(o=(s&15)<<18|(l&63)<<12|(h&63)<<6|g&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function EY(t,e,n){return Q3.decode(t.subarray(e,n))}function wY(t,e,n){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=r;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=r&63|128)}return n}function TY(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let s=0;s<e;s++){const o=CY(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&n.push(i),n}function CY(t){let e=0;for(let n=0,i=t.length-1,r,s;n<t.length;i=n++)r=t[n],s=t[i],e+=(s[0]-r[0])*(r[1]+s[1]);return e}function xY(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?bY(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function bY(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}class $1{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,n,i,r,s){T(this,"properties",void 0),T(this,"extent",void 0),T(this,"type",void 0),T(this,"id",void 0),T(this,"_pbf",void 0),T(this,"_geometry",void 0),T(this,"_keys",void 0),T(this,"_values",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,e.readFields(xY,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0;const a=[];let l;for(;e.pos<n;){if(r<=0){const h=e.readVarint();i=h&7,r=h>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(l&&a.push(l),l=[]),l&&l.push([s,o]);else if(i===7)l&&l.push(l[0].slice());else throw new Error("unknown command ".concat(i))}return l&&a.push(l),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0,a=1/0,l=-1/0,h=1/0,g=-1/0;for(;e.pos<n;){if(r<=0){const m=e.readVarint();i=m&7,r=m>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>l&&(l=s),o<h&&(h=o),o>g&&(g=o);else if(i!==7)throw new Error("unknown command ".concat(i))}return[a,h,l,g]}_toGeoJSON(e){let n=this.loadGeometry(),i=$1.types[this.type],r,s;switch(this.type){case 1:const a=[];for(r=0;r<n.length;r++)a[r]=n[r][0];n=a,e(n,this);break;case 2:for(r=0;r<n.length;r++)e(n[r],this);break;case 3:for(n=TY(n),r=0;r<n.length;r++)for(s=0;s<n[r].length;s++)e(n[r][s],this);break}n.length===1?n=n[0]:i="Multi".concat(i);const o={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;function l(h){for(let g=0;g<h.length;g++){const m=h[g];m[0]=(m[0]+o)*360/s-180;const v=180-(m[1]+a)*360/s;m[1]=360/Math.PI*Math.atan(Math.exp(v*Math.PI/180))-90}}return this._toGeoJSON(l)}}class SY{constructor(e,n){T(this,"version",void 0),T(this,"name",void 0),T(this,"extent",void 0),T(this,"length",void 0),T(this,"_pbf",void 0),T(this,"_keys",void 0),T(this,"_values",void 0),T(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(PY,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new $1(this._pbf,n,this.extent,this._keys,this._values)}}function PY(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(MY(n)))}function MY(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class IY{constructor(e,n){T(this,"layers",void 0),this.layers=e.readFields(BY,{},n)}}function BY(t,e,n){if(t===3&&n){const i=new SY(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function LY(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[Wf(t.data)]],indices:[t.indices]};const i=[],r=[];let s=[],o=[],a,l=0;for(let h,g=0,m;g<e;g++){m=t.indices[g]-l,h=t.indices[g+1]-l||t.data.length;const v=t.data.slice(m,h),w=Wf(v);if(w===0){const C=t.data.slice(0,m),b=t.data.slice(h);t.data=C.concat(b),l+=h-m;continue}a===void 0&&(a=w<0),a===w<0?(o.length&&(i.push(s),r.push(o)),o=[m],s=[w]):(s.push(w),o.push(m))}return s&&i.push(s),o.length&&r.push(o),{type:n,areas:i,indices:r,data:t.data}}function RY(t,e,n,i){for(let r=0,s=t.length;r<s;r+=2){t[r]=(t[r]+e)*360/i-180;const o=180-(t[r+1]+n)*360/i;t[r+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function OY(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?FY(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function FY(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let Uw,Gs,X0,Bu,J0,Y0,OA;class DY{constructor(e,n,i,r,s,o){T(this,"properties",void 0),T(this,"extent",void 0),T(this,"type",void 0),T(this,"id",void 0),T(this,"_pbf",void 0),T(this,"_geometry",void 0),T(this,"_keys",void 0),T(this,"_values",void 0),T(this,"_geometryInfo",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,this._geometryInfo=o,e.readFields(OY,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,Uw=e.readVarint()+e.pos,Gs=1,Bu=0,J0=0,Y0=0,OA=0;const n=[],i=[];for(;e.pos<Uw;)if(Bu<=0&&(X0=e.readVarint(),Gs=X0&7,Bu=X0>>3),Bu--,Gs===1||Gs===2)J0+=e.readSVarint(),Y0+=e.readSVarint(),Gs===1&&n.push(OA),i.push(J0,Y0),OA+=2;else if(Gs===7){if(OA>0){const r=n[n.length-1];i.push(i[r],i[r+1]),OA+=2}}else throw new Error("unknown command ".concat(Gs));return{data:i,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let i;e(n.data,this);const r=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/r,i={type:"LineString",...n};break;case 3:i=LY(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/r;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;return this._toBinaryCoordinates(l=>RY(l,o,a,s))}}class kY{constructor(e,n){T(this,"version",void 0),T(this,"name",void 0),T(this,"extent",void 0),T(this,"length",void 0),T(this,"_pbf",void 0),T(this,"_keys",void 0),T(this,"_values",void 0),T(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(NY,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new DY(this._pbf,i,this.extent,this._keys,this._values,n)}}function NY(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(UY(n)))}function UY(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class GY{constructor(e,n){T(this,"layers",void 0),this.layers=e.readFields(zY,{},n)}}function zY(t,e,n){if(t===3&&n){const i=new kY(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function Gw(t,e){var n,i;const r=HY(e),s=(e==null||(n=e.gis)===null||n===void 0?void 0:n.format)||(e==null||(i=e.mvt)===null||i===void 0?void 0:i.shape);switch(s){case"columnar-table":return{shape:"columnar-table",data:K0(t,r)};case"geojson-row-table":return{shape:"geojson-row-table",data:zw(t,r)};case"geojson":return zw(t,r);case"binary-geometry":return K0(t,r);case"binary":return K0(t,r);default:throw new Error(s)}}function K0(t,e){const[n,i]=VY(t,e),r=VJ(n,i);return r.byteLength=t.byteLength,r}function VY(t,e){const n=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,i];const r=new GY(new W3(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(!!a)for(let l=0;l<a.length;l++){const h=a.feature(l,i),g=WY(h,e,o);n.push(g)}}),[n,i]}function zw(t,e){if(t.byteLength<=0)return[];const n=[],i=new IY(new W3(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{const o=i.layers[s];if(!!o)for(let a=0;a<o.length;a++){const l=o.feature(a),h=jY(l,e,s);n.push(h)}}),n}function HY(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const n=((e=t.mvt)===null||e===void 0?void 0:e.coordinates)==="wgs84",{tileIndex:i}=t.mvt,r=i&&Number.isFinite(i.x)&&Number.isFinite(i.y)&&Number.isFinite(i.z);if(n&&!r)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function jY(t,e,n){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:QY);return e.layerProperty&&(i.properties[e.layerProperty]=n),i}function WY(t,e,n){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:XY);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=n),i}function QY(t,e){const{extent:n}=e;for(let i=0;i<t.length;i++){const r=t[i];r[0]/=n,r[1]/=n}}function XY(t,e){const{extent:n}=e;for(let i=0,r=t.length;i<r;++i)t[i]/=n}const JY="3.2.9",YY={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},X3={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:JY,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:YY};({...X3});const J3={clipBounds:[0,0,1,1]},Y3=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,KY={name:"clip-vs",vs:Y3},ZY={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},qY={name:"clip-fs",fs:Y3},$Y={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class e_ extends uS{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(e=this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[KY],inject:ZY}:{modules:[qY],inject:$Y}}draw({uniforms:e}){const{clipBounds:n=J3.clipBounds}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const i=this.projectPosition([n[0],n[1],0]),r=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[0],r[0]),Math.max(i[1],r[1])]}}}T(e_,"defaultProps",J3);T(e_,"extensionName","ClipExtension");const eK={Point:K3,MultiPoint:tK,LineString:Z3,MultiLineString:nK,Polygon:q3,MultiPolygon:iK};function K3([t,e],[n,i],r){const s=Vi(n[0],i[0],t),o=Vi(n[1],i[1],e);return r.unprojectFlat([s,o])}function t_(t,e,n){return t.map(i=>K3(i,e,n))}function tK(t,e,n){return t_(t,e,n)}function Z3(t,e,n){return t_(t,e,n)}function nK(t,e,n){return t.map(i=>Z3(i,e,n))}function q3(t,e,n){return t.map(i=>t_(i,e,n))}function iK(t,e,n){return t.map(i=>q3(i,e,n))}function rK(t,e,n){const i=n.projectFlat([e.west,e.north]),r=n.projectFlat([e.east,e.south]),s=[i,r];return{...t,coordinates:eK[t.type](t.coordinates,s,n)}}const sK=["points","lines","polygons"];function oK(t,e,n,i){for(const r of sK){const s=t[r]&&aK(t[r],e,n,i);if(s>=0)return s}return-1}function aK(t,e,n,i){const r=t.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(i){const l=AK(t,i);if(l)s=l[0],o=l[1]+1;else return-1}let a=-1;if(e in t.numericProps){const l=t.numericProps[e].value.findIndex((h,g)=>h===n&&r[g]>=s&&r[g]<o);return l>=0?t.globalFeatureIds.value[l]:-1}else e?a=Vw(t.properties,l=>l[e]===n,s,o):t.fields&&(a=Vw(t.fields,l=>l.id===n,s,o));return a>=0?lK(t,a):-1}function AK(t,e){if(!t.__layers){const n={},{properties:i}=t;for(let r=0;r<i.length;r++){const{layerName:s}=i[r];s&&(n[s]?n[s][1]=r:n[s]=[r,r])}t.__layers=n}return t.__layers[e]}function lK(t,e){if(!t.__ids){const n=[],i=t.featureIds.value,r=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)n[i[s]]=r[s];t.__ids=n}return t.__ids[e]}function Vw(t,e,n,i){for(let r=n;r<i;r++)if(e(t[r],r))return r;return-1}const Z0=512,cK={...ac.defaultProps,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[X3],binary:!0};class $3 extends cc{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:e,oldProps:n,context:i,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!==null&&s!==void 0&&s.data&&(super.updateState({props:e,oldProps:n,context:i,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==n.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,n=null;if(typeof e=="string"&&!SH(e)){const{onDataLoad:i,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{n=await r(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(n,{propName:"data",layer:this})}else e.tilejson&&(n=e);n&&(e=n.tiles),this.setState({data:e,tileJSON:n})}_getTilesetOptions(){const e=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:i,maxZoom:r}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>i&&(e.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(r)||n.maxzoom<r)&&(e.maxZoom=n.maxzoom)),e}renderLayers(){var e;return(e=this.state)!==null&&e!==void 0&&e.data?super.renderLayers():null}getTileData(e){var n;const{data:i,binary:r}=this.state,{index:s,signal:o}=e,a=Yf(i,e);if(!a)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:h}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...(n=l)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:r?{format:"binary"}:{}},h(a,{propName:"data",layer:this,loadOptions:l,signal:o})}renderSubLayers(e){const{x:n,y:i,z:r}=e.tile.index,s=Math.pow(2,r),o=Z0/s,a=-o,l=Z0*n/s,h=Z0*(1-i/s),g=new ze().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=g,e.coordinateOrigin=[l,h,0],e.coordinateSystem=Ge.CARTESIAN,e.extensions=[...e.extensions||[],new e_]);const m=super.renderSubLayers(e);return this.state.binary&&!(m instanceof ac)&&De.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),m}_updateAutoHighlight(e){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:r}=this.state,s=e.object;let o,a;s&&(o=q0(s,n),a=Hw(s));let{highlightColor:l}=this.props;typeof l=="function"&&(l=l(e)),(i!==o||r!==a)&&this.setState({highlightColor:l,hoveredFeatureId:o,hoveredFeatureLayerName:a})}getPickingInfo(e){const n=super.getPickingInfo(e),i=Boolean(this.context.viewport.resolution);if(this.state.binary&&n.index!==-1){const{data:r}=e.sourceLayer.props;n.object=Fw(r,{globalFeatureId:n.index})}return n.object&&!i&&(n.object=Ww(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n,hoveredFeatureLayerName:i,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,a=e.content,l=jw(o);if(!(jw(n)||l))return-1;const g=l?o:n;return Array.isArray(a)?a.findIndex(m=>{const v=q0(m,s)===g,w=l||Hw(m)===i;return v&&w}):a&&r?oK(a,s,g,l?"":i):-1}_pickObjects(e){const{deck:n,viewport:i}=this.context,r=i.width,s=i.height,o=i.x,a=i.y,l=[this.id];return n.pickObjects({x:o,y:a,width:r,height:s,layerIds:l,maxObjects:e})}getRenderedFeatures(e=null){const n=this._pickObjects(e),i=new Set,r=[];for(const s of n){const o=q0(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):i.has(o)||(i.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:r}=i;if(i._contentWGS84===void 0&&PH(r)){const s=this.state.binary?Fw(i.content):i.content;i._contentWGS84=s.map(o=>Ww(o,r,this.context.viewport))}return i._contentWGS84}})})}}T($3,"layerName","MVTLayer");T($3,"defaultProps",cK);function q0(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function Hw(t){var e;return((e=t.properties)===null||e===void 0?void 0:e.layerName)||null}function jw(t){return t!=null&&t!==""}function Ww(t,e,n){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>rK(t.geometry,e,n).coordinates}),i}const Qw="0123456789bcdefghjkmnpqrstuvwxyz",eP={};for(let t=0;t<Qw.length;t++)eP[Qw.charAt(t)]=t;const uK=-90,fK=90,hK=-180,dK=180;function gK(t){let e=!0,n=fK,i=uK,r=dK,s=hK,o,a=0;for(let l=0,h=t.length;l<h;l++){const g=t[l].toLowerCase();a=eP[g];for(let m=4;m>=0;m--){const v=a>>m&1;e?(o=(r+s)/2,v===1?s=o:r=o):(o=(n+i)/2,v===1?i=o:n=o),e=!e}}return[i,s,n,r]}function pK(t){const[e,n,i,r]=gK(t);return[r,i,r,e,n,e,n,i,r,i]}const mK={getGeohash:{type:"accessor",value:t=>t.geohash}};class tP extends Xa{indexToBounds(){const{data:e,getGeohash:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>pK(n(i,r))}}}T(tP,"layerName","GeohashLayer");T(tP,"defaultProps",mK);const _K="pk.eyJ1IjoibWF5cTA0MjIiLCJhIjoiY2phamMwOHV4MjllajMzbnFyeTMwcmZvYiJ9.aFMw4Aws5zY9Y4NwYqFMlQ",yK=new Ub({color:[255,255,255],intensity:1}),vK=new rU({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),EK=new p1({ambientLight:yK,pointLight:vK}),wK={ambient:.1,diffuse:.6,shininess:32,specularColor:[60,64,70]},TK={buildingColor:[74,80,87],trailColor0:[253,128,93],trailColor1:[23,184,190],material:wK,effects:[EK]},CK={longitude:104.392,latitude:36.067,zoom:4,pitch:0,bearing:0},xK="mapbox://styles/mapbox/dark-v10";function bK(t,e="CN"){t.setFilter("admin-0-boundary-disputed",["all",["==",["get","disputed"],"true"],["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]]),t.setFilter("admin-0-boundary",["all",["==",["get","admin_level"],0],["==",["get","disputed"],"false"],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]]),t.setFilter("admin-0-boundary-bg",["all",["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]])}var n_={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Jw,function(){var n=1e3,i=6e4,r=36e5,s="millisecond",o="second",a="minute",l="hour",h="day",g="week",m="month",v="quarter",w="year",C="date",b="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,P={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},M=function(re,te,oe){var ve=String(re);return!ve||ve.length>=te?re:""+Array(te+1-ve.length).join(oe)+re},F={s:M,z:function(re){var te=-re.utcOffset(),oe=Math.abs(te),ve=Math.floor(oe/60),ce=oe%60;return(te<=0?"+":"-")+M(ve,2,"0")+":"+M(ce,2,"0")},m:function re(te,oe){if(te.date()<oe.date())return-re(oe,te);var ve=12*(oe.year()-te.year())+(oe.month()-te.month()),ce=te.clone().add(ve,m),ne=oe-ce<0,le=te.clone().add(ve+(ne?-1:1),m);return+(-(ve+(oe-ce)/(ne?ce-le:le-ce))||0)},a:function(re){return re<0?Math.ceil(re)||0:Math.floor(re)},p:function(re){return{M:m,y:w,w:g,d:h,D:C,h:l,m:a,s:o,ms:s,Q:v}[re]||String(re||"").toLowerCase().replace(/s$/,"")},u:function(re){return re===void 0}},H="en",j={};j[H]=P;var K=function(re){return re instanceof D},ee=function re(te,oe,ve){var ce;if(!te)return H;if(typeof te=="string"){var ne=te.toLowerCase();j[ne]&&(ce=ne),oe&&(j[ne]=oe,ce=ne);var le=te.split("-");if(!ce&&le.length>1)return re(le[0])}else{var he=te.name;j[he]=te,ce=he}return!ve&&ce&&(H=ce),ce||!ve&&H},X=function(re,te){if(K(re))return re.clone();var oe=typeof te=="object"?te:{};return oe.date=re,oe.args=arguments,new D(oe)},U=F;U.l=ee,U.i=K,U.w=function(re,te){return X(re,{locale:te.$L,utc:te.$u,x:te.$x,$offset:te.$offset})};var D=function(){function re(oe){this.$L=ee(oe.locale,null,!0),this.parse(oe)}var te=re.prototype;return te.parse=function(oe){this.$d=function(ve){var ce=ve.date,ne=ve.utc;if(ce===null)return new Date(NaN);if(U.u(ce))return new Date;if(ce instanceof Date)return new Date(ce);if(typeof ce=="string"&&!/Z$/i.test(ce)){var le=ce.match(R);if(le){var he=le[2]-1||0,xe=(le[7]||"0").substring(0,3);return ne?new Date(Date.UTC(le[1],he,le[3]||1,le[4]||0,le[5]||0,le[6]||0,xe)):new Date(le[1],he,le[3]||1,le[4]||0,le[5]||0,le[6]||0,xe)}}return new Date(ce)}(oe),this.$x=oe.x||{},this.init()},te.init=function(){var oe=this.$d;this.$y=oe.getFullYear(),this.$M=oe.getMonth(),this.$D=oe.getDate(),this.$W=oe.getDay(),this.$H=oe.getHours(),this.$m=oe.getMinutes(),this.$s=oe.getSeconds(),this.$ms=oe.getMilliseconds()},te.$utils=function(){return U},te.isValid=function(){return this.$d.toString()!==b},te.isSame=function(oe,ve){var ce=X(oe);return this.startOf(ve)<=ce&&ce<=this.endOf(ve)},te.isAfter=function(oe,ve){return X(oe)<this.startOf(ve)},te.isBefore=function(oe,ve){return this.endOf(ve)<X(oe)},te.$g=function(oe,ve,ce){return U.u(oe)?this[ve]:this.set(ce,oe)},te.unix=function(){return Math.floor(this.valueOf()/1e3)},te.valueOf=function(){return this.$d.getTime()},te.startOf=function(oe,ve){var ce=this,ne=!!U.u(ve)||ve,le=U.p(oe),he=function(dn,Ke){var Et=U.w(ce.$u?Date.UTC(ce.$y,Ke,dn):new Date(ce.$y,Ke,dn),ce);return ne?Et:Et.endOf(h)},xe=function(dn,Ke){return U.w(ce.toDate()[dn].apply(ce.toDate("s"),(ne?[0,0,0,0]:[23,59,59,999]).slice(Ke)),ce)},Ie=this.$W,Ze=this.$M,Ft=this.$D,An="set"+(this.$u?"UTC":"");switch(le){case w:return ne?he(1,0):he(31,11);case m:return ne?he(1,Ze):he(0,Ze+1);case g:var tn=this.$locale().weekStart||0,dt=(Ie<tn?Ie+7:Ie)-tn;return he(ne?Ft-dt:Ft+(6-dt),Ze);case h:case C:return xe(An+"Hours",0);case l:return xe(An+"Minutes",1);case a:return xe(An+"Seconds",2);case o:return xe(An+"Milliseconds",3);default:return this.clone()}},te.endOf=function(oe){return this.startOf(oe,!1)},te.$set=function(oe,ve){var ce,ne=U.p(oe),le="set"+(this.$u?"UTC":""),he=(ce={},ce[h]=le+"Date",ce[C]=le+"Date",ce[m]=le+"Month",ce[w]=le+"FullYear",ce[l]=le+"Hours",ce[a]=le+"Minutes",ce[o]=le+"Seconds",ce[s]=le+"Milliseconds",ce)[ne],xe=ne===h?this.$D+(ve-this.$W):ve;if(ne===m||ne===w){var Ie=this.clone().set(C,1);Ie.$d[he](xe),Ie.init(),this.$d=Ie.set(C,Math.min(this.$D,Ie.daysInMonth())).$d}else he&&this.$d[he](xe);return this.init(),this},te.set=function(oe,ve){return this.clone().$set(oe,ve)},te.get=function(oe){return this[U.p(oe)]()},te.add=function(oe,ve){var ce,ne=this;oe=Number(oe);var le=U.p(ve),he=function(Ze){var Ft=X(ne);return U.w(Ft.date(Ft.date()+Math.round(Ze*oe)),ne)};if(le===m)return this.set(m,this.$M+oe);if(le===w)return this.set(w,this.$y+oe);if(le===h)return he(1);if(le===g)return he(7);var xe=(ce={},ce[a]=i,ce[l]=r,ce[o]=n,ce)[le]||1,Ie=this.$d.getTime()+oe*xe;return U.w(Ie,this)},te.subtract=function(oe,ve){return this.add(-1*oe,ve)},te.format=function(oe){var ve=this,ce=this.$locale();if(!this.isValid())return ce.invalidDate||b;var ne=oe||"YYYY-MM-DDTHH:mm:ssZ",le=U.z(this),he=this.$H,xe=this.$m,Ie=this.$M,Ze=ce.weekdays,Ft=ce.months,An=function(Ke,Et,Xi,li){return Ke&&(Ke[Et]||Ke(ve,ne))||Xi[Et].slice(0,li)},tn=function(Ke){return U.s(he%12||12,Ke,"0")},dt=ce.meridiem||function(Ke,Et,Xi){var li=Ke<12?"AM":"PM";return Xi?li.toLowerCase():li},dn={YY:String(this.$y).slice(-2),YYYY:this.$y,M:Ie+1,MM:U.s(Ie+1,2,"0"),MMM:An(ce.monthsShort,Ie,Ft,3),MMMM:An(Ft,Ie),D:this.$D,DD:U.s(this.$D,2,"0"),d:String(this.$W),dd:An(ce.weekdaysMin,this.$W,Ze,2),ddd:An(ce.weekdaysShort,this.$W,Ze,3),dddd:Ze[this.$W],H:String(he),HH:U.s(he,2,"0"),h:tn(1),hh:tn(2),a:dt(he,xe,!0),A:dt(he,xe,!1),m:String(xe),mm:U.s(xe,2,"0"),s:String(this.$s),ss:U.s(this.$s,2,"0"),SSS:U.s(this.$ms,3,"0"),Z:le};return ne.replace(S,function(Ke,Et){return Et||dn[Ke]||le.replace(":","")})},te.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},te.diff=function(oe,ve,ce){var ne,le=U.p(ve),he=X(oe),xe=(he.utcOffset()-this.utcOffset())*i,Ie=this-he,Ze=U.m(this,he);return Ze=(ne={},ne[w]=Ze/12,ne[m]=Ze,ne[v]=Ze/3,ne[g]=(Ie-xe)/6048e5,ne[h]=(Ie-xe)/864e5,ne[l]=Ie/r,ne[a]=Ie/i,ne[o]=Ie/n,ne)[le]||Ie,ce?Ze:U.a(Ze)},te.daysInMonth=function(){return this.endOf(m).$D},te.$locale=function(){return j[this.$L]},te.locale=function(oe,ve){if(!oe)return this.$L;var ce=this.clone(),ne=ee(oe,ve,!0);return ne&&(ce.$L=ne),ce},te.clone=function(){return U.w(this.$d,this)},te.toDate=function(){return new Date(this.valueOf())},te.toJSON=function(){return this.isValid()?this.toISOString():null},te.toISOString=function(){return this.$d.toISOString()},te.toString=function(){return this.$d.toUTCString()},re}(),ae=D.prototype;return X.prototype=ae,[["$ms",s],["$s",o],["$m",a],["$H",l],["$W",h],["$M",m],["$y",w],["$D",C]].forEach(function(re){ae[re[1]]=function(te){return this.$g(te,re[0],re[1])}}),X.extend=function(re,te){return re.$i||(re(te,D,X),re.$i=!0),X},X.locale=ee,X.isDayjs=K,X.unix=function(re){return X(1e3*re)},X.en=j[H],X.Ls=j,X.p={},X})})(n_);const SK=n_.exports,Vp=Xw({__proto__:null,default:SK},[n_.exports]),PK=Vp("2022-07-31T00:00:00.000+08:00"),nP=[165921696e4,165928242e4],MK=new URLSearchParams(window.location.search),iP={isTimeShifting:!1};iP.isTimeShifting=MK.has("time-shifting");function rP(){let t=Vp();iP.isTimeShifting&&(t=t.subtract(12,"hour"));let e=Vp(PK).hour(t.hour()).minute(t.minute()).second(t.second());return console.log(e.format("YYYY-MM-DD HH:mm:ss")),e}function IK(t,e,n){return n=n.replace(/$/,""),t.filter(r=>{var a;const s=r.waypoints.findIndex(l=>l.station===n);if(s===-1)return!1;let o=r.waypoints[s];return o.station===((a=r.waypoints[s+1])==null?void 0:a.station)&&(o=r.waypoints[s+1]),!(o.timestamp>rP()||r.waypoints.at(-1).timestamp-o.timestamp<e)})}const BK={time:nP[0],playing:!1,timeLength:1*3600*1e3,routeList:[],stationMap:{},stationList:[],filteredRouteList:[],selectedRoute:[]};function LK(t,e){switch(e.type){case"loadData":const{routeList:n,stationMap:i}=e.payload,r=Object.entries(i).map(([o,a])=>({name:o,...a}));return n.forEach(o=>{o.waypoints.forEach(a=>{const l=i[`${a.station}\u7AD9`];l&&(a.coords=l.location)})}),{...t,routeList:n,stationMap:i,stationList:r,playing:!0};case"setTime":return{...t,time:e.payload};case"setTimeLength":return{...t,timeLength:e.payload};case"setSelectedStation":const s=e.payload;return{...t,filteredRouteList:IK(t.routeList,t.timeLength,s)};case"setSelectedRoute":return{...t,selectedRoute:e.payload};default:throw new Error}}const sP=Ee.exports.createContext({});function RK({time:t=nP[0],stationList:e,filteredRouteList:n,selectedRoute:i}){const r=Ee.exports.useContext(sP),s=Ee.exports.useRef(),o=Ee.exports.useRef(new Set),a=i.length!==0,l=Ee.exports.useCallback(()=>{const w=s.current.getMap();bK(w)},[]),h=w=>{var b;if(!((b=w.object)!=null&&b.name))return;console.log(w.object.name);const C=w.object.name;r({type:"setSelectedStation",payload:C})},g=w=>{!w.object||(console.log(w.object.trainCode),r({type:"setSelectedRoute",payload:[w.object]}),o.current=new Set(w.object.waypoints.map(C=>C.station+"\u7AD9")))},m=[new Ao({id:"selectedRoutePathLayer",data:i,pickable:!0,visible:a,autoHighlight:!0,highlightColor:[255,235,59],widthScale:20,widthMinPixels:1,getPath:w=>w.waypoints.map(C=>C.coords),getColor:[255,235,59],opacity:.05}),new D1({id:"selectedRouteTripsLayer",data:i,visible:a,getPath:w=>w.waypoints.map(C=>C.coords),getTimestamps:w=>w.waypoints.map(C=>C.timestamp),getColor:[255,200,100],opacity:1,widthMinPixels:6,capRounded:!0,jointRounded:!0,fadeTrail:!0,trailLength:5e6,currentTime:t,shadowEnabled:!1}),new Ao({id:"filteredRouteListLayer",data:n,pickable:!0,visible:!a,autoHighlight:!0,highlightColor:[255,235,59],widthScale:20,widthMinPixels:2,getPath:w=>w.waypoints.map(C=>C.coords),getColor:[0,187,144],opacity:.3,onClick:g}),new Lh({id:"stationLayer",data:e,pickable:!0,autoHighlight:!0,highlightColor:[255,200,100],opacity:.5,stroked:!1,filled:!0,radiusScale:6,radiusMinPixels:2,radiusMaxPixels:10,lineWidthMinPixels:1,getPosition:w=>w.location,getRadius:500,getFillColor:w=>a?o.current.has(w.name)?[255,255,0,200]:[255,140,0,50]:[255,140,0,100],onHover:h})],v=w=>{const{layer:C,object:b}=w;if(!b)return null;const R=C==null?void 0:C.id;if(R==="stationLayer")return b.name;if(R==="filteredRouteListLayer"||R==="selectedRoutePathLayer"){const S=b.waypoints.map(P=>P.station).join(" -> ");return`${b.trainCode}
${S}`}return null};return ps(gS,{layers:m,effects:TK.effects,initialViewState:CK,controller:!0,getTooltip:v,children:ps(km,{reuseMaps:!0,ref:s,onLoad:l,mapStyle:xK,mapboxAccessToken:_K})})}function OK(){const[t,e]=Ee.exports.useReducer(LK,BK),n=Ee.exports.useRef(!1),i=Ee.exports.useRef(0);Ee.exports.useEffect(()=>{(async()=>{if(n.current)return;n.current=!0;const h=fetch("routes.json").then(w=>w.json()),g=fetch("stations.json").then(w=>w.json()),[m,v]=await Promise.all([h,g]);e({type:"loadData",payload:{routeList:m,stationMap:v}}),n.current=!1})()},[]);const r=()=>{t.playing&&e({type:"setTime",payload:Number(rP())}),i.current=window.requestAnimationFrame(r)};Ee.exports.useEffect(()=>(i.current=window.requestAnimationFrame(r),()=>{window.cancelAnimationFrame(i.current),i.current=0}),[t.playing]);const{time:s,stationList:o,filteredRouteList:a,selectedRoute:l}=t;return ps(sP.Provider,{value:e,children:ps(RK,{time:s,stationList:o,filteredRouteList:a,selectedRoute:l})})}$0.createRoot(document.getElementById("root")).render(ps(HM.StrictMode,{children:ps(OK,{})}));export{Jw as c};
