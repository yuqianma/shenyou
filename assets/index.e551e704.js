function Mw(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var MN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Iw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var k={exports:{}},K={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var io=Symbol.for("react.element"),Rw=Symbol.for("react.portal"),Ow=Symbol.for("react.fragment"),kw=Symbol.for("react.strict_mode"),Nw=Symbol.for("react.profiler"),Fw=Symbol.for("react.provider"),Dw=Symbol.for("react.context"),zw=Symbol.for("react.forward_ref"),Uw=Symbol.for("react.suspense"),Bw=Symbol.for("react.memo"),Vw=Symbol.for("react.lazy"),Hd=Symbol.iterator;function jw(t){return t===null||typeof t!="object"?null:(t=Hd&&t[Hd]||t["@@iterator"],typeof t=="function"?t:null)}var E0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x0=Object.assign,T0={};function Or(t,e,n){this.props=t,this.context=e,this.refs=T0,this.updater=n||E0}Or.prototype.isReactComponent={};Or.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Or.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function S0(){}S0.prototype=Or.prototype;function Zf(t,e,n){this.props=t,this.context=e,this.refs=T0,this.updater=n||E0}var $f=Zf.prototype=new S0;$f.constructor=Zf;x0($f,Or.prototype);$f.isPureReactComponent=!0;var Xd=Array.isArray,P0=Object.prototype.hasOwnProperty,Kf={current:null},b0={key:!0,ref:!0,__self:!0,__source:!0};function A0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)P0.call(e,i)&&!b0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:io,type:t,key:s,ref:o,props:r,_owner:Kf.current}}function Gw(t,e){return{$$typeof:io,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function qf(t){return typeof t=="object"&&t!==null&&t.$$typeof===io}function Ww(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Yd=/\/+/g;function pc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ww(""+t.key):e.toString(36)}function fa(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case io:case Rw:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+pc(o,0):i,Xd(r)?(n="",t!=null&&(n=t.replace(Yd,"$&/")+"/"),fa(r,e,n,"",function(c){return c})):r!=null&&(qf(r)&&(r=Gw(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Yd,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Xd(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+pc(s,a);o+=fa(s,e,n,l,r)}else if(l=jw(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+pc(s,a++),o+=fa(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Io(t,e,n){if(t==null)return t;var i=[],r=0;return fa(t,i,"","",function(s){return e.call(n,s,r++)}),i}function Hw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var He={current:null},ha={transition:null},Xw={ReactCurrentDispatcher:He,ReactCurrentBatchConfig:ha,ReactCurrentOwner:Kf};K.Children={map:Io,forEach:function(t,e,n){Io(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Io(t,function(){e++}),e},toArray:function(t){return Io(t,function(e){return e})||[]},only:function(t){if(!qf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};K.Component=Or;K.Fragment=Ow;K.Profiler=Nw;K.PureComponent=Zf;K.StrictMode=kw;K.Suspense=Uw;K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xw;K.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=x0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Kf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)P0.call(e,l)&&!b0.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:io,type:t.type,key:r,ref:s,props:i,_owner:o}};K.createContext=function(t){return t={$$typeof:Dw,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Fw,_context:t},t.Consumer=t};K.createElement=A0;K.createFactory=function(t){var e=A0.bind(null,t);return e.type=t,e};K.createRef=function(){return{current:null}};K.forwardRef=function(t){return{$$typeof:zw,render:t}};K.isValidElement=qf;K.lazy=function(t){return{$$typeof:Vw,_payload:{_status:-1,_result:t},_init:Hw}};K.memo=function(t,e){return{$$typeof:Bw,type:t,compare:e===void 0?null:e}};K.startTransition=function(t){var e=ha.transition;ha.transition={};try{t()}finally{ha.transition=e}};K.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};K.useCallback=function(t,e){return He.current.useCallback(t,e)};K.useContext=function(t){return He.current.useContext(t)};K.useDebugValue=function(){};K.useDeferredValue=function(t){return He.current.useDeferredValue(t)};K.useEffect=function(t,e){return He.current.useEffect(t,e)};K.useId=function(){return He.current.useId()};K.useImperativeHandle=function(t,e,n){return He.current.useImperativeHandle(t,e,n)};K.useInsertionEffect=function(t,e){return He.current.useInsertionEffect(t,e)};K.useLayoutEffect=function(t,e){return He.current.useLayoutEffect(t,e)};K.useMemo=function(t,e){return He.current.useMemo(t,e)};K.useReducer=function(t,e,n){return He.current.useReducer(t,e,n)};K.useRef=function(t){return He.current.useRef(t)};K.useState=function(t){return He.current.useState(t)};K.useSyncExternalStore=function(t,e,n){return He.current.useSyncExternalStore(t,e,n)};K.useTransition=function(){return He.current.useTransition()};K.version="18.2.0";(function(t){t.exports=K})(k);const Yw=Iw(k.exports);var Eu={},Sl={exports:{}},dt={},C0={exports:{}},L0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,j){var W=D.length;D.push(j);e:for(;0<W;){var le=W-1>>>1,oe=D[le];if(0<r(oe,j))D[le]=j,D[W]=oe,W=le;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var j=D[0],W=D.pop();if(W!==j){D[0]=W;e:for(var le=0,oe=D.length,Fi=oe>>>1;le<Fi;){var At=2*(le+1)-1,Br=D[At],rn=At+1,me=D[rn];if(0>r(Br,W))rn<oe&&0>r(me,Br)?(D[le]=me,D[rn]=W,le=rn):(D[le]=Br,D[At]=W,le=At);else if(rn<oe&&0>r(me,W))D[le]=me,D[rn]=W,le=rn;else break e}}return j}function r(D,j){var W=D.sortIndex-j.sortIndex;return W!==0?W:D.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,d=!1,p=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(D){for(var j=n(c);j!==null;){if(j.callback===null)i(c);else if(j.startTime<=D)i(c),j.sortIndex=j.expirationTime,e(l,j);else break;j=n(c)}}function T(D){if(w=!1,_(D),!p)if(n(l)!==null)p=!0,ri(P);else{var j=n(c);j!==null&&Pn(T,j.startTime-D)}}function P(D,j){p=!1,w&&(w=!1,y(M),M=-1),d=!0;var W=h;try{for(_(j),f=n(l);f!==null&&(!(f.expirationTime>j)||D&&!U());){var le=f.callback;if(typeof le=="function"){f.callback=null,h=f.priorityLevel;var oe=le(f.expirationTime<=j);j=t.unstable_now(),typeof oe=="function"?f.callback=oe:f===n(l)&&i(l),_(j)}else i(l);f=n(l)}if(f!==null)var Fi=!0;else{var At=n(c);At!==null&&Pn(T,At.startTime-j),Fi=!1}return Fi}finally{f=null,h=W,d=!1}}var b=!1,C=null,M=-1,R=5,O=-1;function U(){return!(t.unstable_now()-O<R)}function G(){if(C!==null){var D=t.unstable_now();O=D;var j=!0;try{j=C(!0,D)}finally{j?V():(b=!1,C=null)}}else b=!1}var V;if(typeof m=="function")V=function(){m(G)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Ye=X.port2;X.port1.onmessage=G,V=function(){Ye.postMessage(null)}}else V=function(){x(G,0)};function ri(D){C=D,b||(b=!0,V())}function Pn(D,j){M=x(function(){D(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){p||d||(p=!0,ri(P))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var W=h;h=j;try{return D()}finally{h=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,j){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var W=h;h=D;try{return j()}finally{h=W}},t.unstable_scheduleCallback=function(D,j,W){var le=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?le+W:le):W=le,D){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=W+oe,D={id:u++,callback:j,priorityLevel:D,startTime:W,expirationTime:oe,sortIndex:-1},W>le?(D.sortIndex=W,e(c,D),n(l)===null&&D===n(c)&&(w?(y(M),M=-1):w=!0,Pn(T,W-le))):(D.sortIndex=oe,e(l,D),p||d||(p=!0,ri(P))),D},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(D){var j=h;return function(){var W=h;h=j;try{return D.apply(this,arguments)}finally{h=W}}}})(L0);(function(t){t.exports=L0})(C0);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0=k.exports,ft=C0.exports;function I(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var I0=new Set,Ms={};function Ii(t,e){mr(t,e),mr(t+"Capture",e)}function mr(t,e){for(Ms[t]=e,t=0;t<e.length;t++)I0.add(e[t])}var pn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xu=Object.prototype.hasOwnProperty,Zw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zd={},$d={};function $w(t){return xu.call($d,t)?!0:xu.call(Zd,t)?!1:Zw.test(t)?$d[t]=!0:(Zd[t]=!0,!1)}function Kw(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function qw(t,e,n,i){if(e===null||typeof e>"u"||Kw(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Re={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Re[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Re[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Re[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Re[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Re[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Re[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Re[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Re[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Re[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Qf=/[\-:]([a-z])/g;function Jf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Qf,Jf);Re[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Qf,Jf);Re[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Qf,Jf);Re[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Re[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Re.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Re[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function eh(t,e,n,i){var r=Re.hasOwnProperty(e)?Re[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qw(e,n,r,i)&&(n=null),i||r===null?$w(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var xn=M0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ro=Symbol.for("react.element"),Xi=Symbol.for("react.portal"),Yi=Symbol.for("react.fragment"),th=Symbol.for("react.strict_mode"),Tu=Symbol.for("react.profiler"),R0=Symbol.for("react.provider"),O0=Symbol.for("react.context"),nh=Symbol.for("react.forward_ref"),Su=Symbol.for("react.suspense"),Pu=Symbol.for("react.suspense_list"),ih=Symbol.for("react.memo"),On=Symbol.for("react.lazy"),k0=Symbol.for("react.offscreen"),Kd=Symbol.iterator;function Zr(t){return t===null||typeof t!="object"?null:(t=Kd&&t[Kd]||t["@@iterator"],typeof t=="function"?t:null)}var he=Object.assign,mc;function cs(t){if(mc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);mc=e&&e[1]||""}return`
`+mc+t}var vc=!1;function yc(t,e){if(!t||vc)return"";vc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{vc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?cs(t):""}function Qw(t){switch(t.tag){case 5:return cs(t.type);case 16:return cs("Lazy");case 13:return cs("Suspense");case 19:return cs("SuspenseList");case 0:case 2:case 15:return t=yc(t.type,!1),t;case 11:return t=yc(t.type.render,!1),t;case 1:return t=yc(t.type,!0),t;default:return""}}function bu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Yi:return"Fragment";case Xi:return"Portal";case Tu:return"Profiler";case th:return"StrictMode";case Su:return"Suspense";case Pu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case O0:return(t.displayName||"Context")+".Consumer";case R0:return(t._context.displayName||"Context")+".Provider";case nh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ih:return e=t.displayName||null,e!==null?e:bu(t.type)||"Memo";case On:e=t._payload,t=t._init;try{return bu(t(e))}catch{}}return null}function Jw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return bu(e);case 8:return e===th?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function N0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eE(t){var e=N0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Oo(t){t._valueTracker||(t._valueTracker=eE(t))}function F0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=N0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Na(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Au(t,e){var n=e.checked;return he({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function qd(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function D0(t,e){e=e.checked,e!=null&&eh(t,"checked",e,!1)}function Cu(t,e){D0(t,e);var n=qn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Lu(t,e.type,n):e.hasOwnProperty("defaultValue")&&Lu(t,e.type,qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Qd(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Lu(t,e,n){(e!=="number"||Na(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var us=Array.isArray;function ar(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+qn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Mu(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(I(91));return he({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jd(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(I(92));if(us(n)){if(1<n.length)throw Error(I(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:qn(n)}}function z0(t,e){var n=qn(e.value),i=qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function eg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function U0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Iu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?U0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ko,B0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ko=ko||document.createElement("div"),ko.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ko.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Is(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ms={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tE=["Webkit","ms","Moz","O"];Object.keys(ms).forEach(function(t){tE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ms[e]=ms[t]})});function V0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ms.hasOwnProperty(t)&&ms[t]?(""+e).trim():e+"px"}function j0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=V0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var nE=he({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ru(t,e){if(e){if(nE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(I(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(I(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(I(61))}if(e.style!=null&&typeof e.style!="object")throw Error(I(62))}}function Ou(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ku=null;function rh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Nu=null,lr=null,cr=null;function tg(t){if(t=oo(t)){if(typeof Nu!="function")throw Error(I(280));var e=t.stateNode;e&&(e=Ll(e),Nu(t.stateNode,t.type,e))}}function G0(t){lr?cr?cr.push(t):cr=[t]:lr=t}function W0(){if(lr){var t=lr,e=cr;if(cr=lr=null,tg(t),e)for(t=0;t<e.length;t++)tg(e[t])}}function H0(t,e){return t(e)}function X0(){}var _c=!1;function Y0(t,e,n){if(_c)return t(e,n);_c=!0;try{return H0(t,e,n)}finally{_c=!1,(lr!==null||cr!==null)&&(X0(),W0())}}function Rs(t,e){var n=t.stateNode;if(n===null)return null;var i=Ll(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(I(231,e,typeof n));return n}var Fu=!1;if(pn)try{var $r={};Object.defineProperty($r,"passive",{get:function(){Fu=!0}}),window.addEventListener("test",$r,$r),window.removeEventListener("test",$r,$r)}catch{Fu=!1}function iE(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var vs=!1,Fa=null,Da=!1,Du=null,rE={onError:function(t){vs=!0,Fa=t}};function sE(t,e,n,i,r,s,o,a,l){vs=!1,Fa=null,iE.apply(rE,arguments)}function oE(t,e,n,i,r,s,o,a,l){if(sE.apply(this,arguments),vs){if(vs){var c=Fa;vs=!1,Fa=null}else throw Error(I(198));Da||(Da=!0,Du=c)}}function Ri(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Z0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ng(t){if(Ri(t)!==t)throw Error(I(188))}function aE(t){var e=t.alternate;if(!e){if(e=Ri(t),e===null)throw Error(I(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return ng(r),t;if(s===i)return ng(r),e;s=s.sibling}throw Error(I(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(I(189))}}if(n.alternate!==i)throw Error(I(190))}if(n.tag!==3)throw Error(I(188));return n.stateNode.current===n?t:e}function $0(t){return t=aE(t),t!==null?K0(t):null}function K0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=K0(t);if(e!==null)return e;t=t.sibling}return null}var q0=ft.unstable_scheduleCallback,ig=ft.unstable_cancelCallback,lE=ft.unstable_shouldYield,cE=ft.unstable_requestPaint,pe=ft.unstable_now,uE=ft.unstable_getCurrentPriorityLevel,sh=ft.unstable_ImmediatePriority,Q0=ft.unstable_UserBlockingPriority,za=ft.unstable_NormalPriority,fE=ft.unstable_LowPriority,J0=ft.unstable_IdlePriority,Pl=null,qt=null;function hE(t){if(qt&&typeof qt.onCommitFiberRoot=="function")try{qt.onCommitFiberRoot(Pl,t,void 0,(t.current.flags&128)===128)}catch{}}var Nt=Math.clz32?Math.clz32:pE,dE=Math.log,gE=Math.LN2;function pE(t){return t>>>=0,t===0?32:31-(dE(t)/gE|0)|0}var No=64,Fo=4194304;function fs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ua(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=fs(a):(s&=o,s!==0&&(i=fs(s)))}else o=n&~r,o!==0?i=fs(o):s!==0&&(i=fs(s));if(i===0)return 0;if(e!==0&&e!==i&&(e&r)===0&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if((i&4)!==0&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Nt(e),r=1<<n,i|=t[n],e&=~r;return i}function mE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vE(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Nt(s),a=1<<o,l=r[o];l===-1?((a&n)===0||(a&i)!==0)&&(r[o]=mE(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function zu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ev(){var t=No;return No<<=1,(No&4194240)===0&&(No=64),t}function wc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ro(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Nt(e),t[e]=n}function yE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Nt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function oh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Nt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var Q=0;function tv(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var nv,ah,iv,rv,sv,Uu=!1,Do=[],jn=null,Gn=null,Wn=null,Os=new Map,ks=new Map,Nn=[],_E="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rg(t,e){switch(t){case"focusin":case"focusout":jn=null;break;case"dragenter":case"dragleave":Gn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":Os.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ks.delete(e.pointerId)}}function Kr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=oo(e),e!==null&&ah(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function wE(t,e,n,i,r){switch(e){case"focusin":return jn=Kr(jn,t,e,n,i,r),!0;case"dragenter":return Gn=Kr(Gn,t,e,n,i,r),!0;case"mouseover":return Wn=Kr(Wn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Os.set(s,Kr(Os.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ks.set(s,Kr(ks.get(s)||null,t,e,n,i,r)),!0}return!1}function ov(t){var e=gi(t.target);if(e!==null){var n=Ri(e);if(n!==null){if(e=n.tag,e===13){if(e=Z0(n),e!==null){t.blockedOn=e,sv(t.priority,function(){iv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function da(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Bu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);ku=i,n.target.dispatchEvent(i),ku=null}else return e=oo(n),e!==null&&ah(e),t.blockedOn=n,!1;e.shift()}return!0}function sg(t,e,n){da(t)&&n.delete(e)}function EE(){Uu=!1,jn!==null&&da(jn)&&(jn=null),Gn!==null&&da(Gn)&&(Gn=null),Wn!==null&&da(Wn)&&(Wn=null),Os.forEach(sg),ks.forEach(sg)}function qr(t,e){t.blockedOn===e&&(t.blockedOn=null,Uu||(Uu=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,EE)))}function Ns(t){function e(r){return qr(r,t)}if(0<Do.length){qr(Do[0],t);for(var n=1;n<Do.length;n++){var i=Do[n];i.blockedOn===t&&(i.blockedOn=null)}}for(jn!==null&&qr(jn,t),Gn!==null&&qr(Gn,t),Wn!==null&&qr(Wn,t),Os.forEach(e),ks.forEach(e),n=0;n<Nn.length;n++)i=Nn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Nn.length&&(n=Nn[0],n.blockedOn===null);)ov(n),n.blockedOn===null&&Nn.shift()}var ur=xn.ReactCurrentBatchConfig,Ba=!0;function xE(t,e,n,i){var r=Q,s=ur.transition;ur.transition=null;try{Q=1,lh(t,e,n,i)}finally{Q=r,ur.transition=s}}function TE(t,e,n,i){var r=Q,s=ur.transition;ur.transition=null;try{Q=4,lh(t,e,n,i)}finally{Q=r,ur.transition=s}}function lh(t,e,n,i){if(Ba){var r=Bu(t,e,n,i);if(r===null)Mc(t,e,i,Va,n),rg(t,i);else if(wE(r,t,e,n,i))i.stopPropagation();else if(rg(t,i),e&4&&-1<_E.indexOf(t)){for(;r!==null;){var s=oo(r);if(s!==null&&nv(s),s=Bu(t,e,n,i),s===null&&Mc(t,e,i,Va,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Mc(t,e,i,null,n)}}var Va=null;function Bu(t,e,n,i){if(Va=null,t=rh(i),t=gi(t),t!==null)if(e=Ri(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Z0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Va=t,null}function av(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uE()){case sh:return 1;case Q0:return 4;case za:case fE:return 16;case J0:return 536870912;default:return 16}default:return 16}}var zn=null,ch=null,ga=null;function lv(){if(ga)return ga;var t,e=ch,n=e.length,i,r="value"in zn?zn.value:zn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return ga=r.slice(t,1<i?1-i:void 0)}function pa(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function zo(){return!0}function og(){return!1}function gt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?zo:og,this.isPropagationStopped=og,this}return he(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=zo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=zo)},persist:function(){},isPersistent:zo}),e}var kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uh=gt(kr),so=he({},kr,{view:0,detail:0}),SE=gt(so),Ec,xc,Qr,bl=he({},so,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Qr&&(Qr&&t.type==="mousemove"?(Ec=t.screenX-Qr.screenX,xc=t.screenY-Qr.screenY):xc=Ec=0,Qr=t),Ec)},movementY:function(t){return"movementY"in t?t.movementY:xc}}),ag=gt(bl),PE=he({},bl,{dataTransfer:0}),bE=gt(PE),AE=he({},so,{relatedTarget:0}),Tc=gt(AE),CE=he({},kr,{animationName:0,elapsedTime:0,pseudoElement:0}),LE=gt(CE),ME=he({},kr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),IE=gt(ME),RE=he({},kr,{data:0}),lg=gt(RE),OE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NE[t])?!!e[t]:!1}function fh(){return FE}var DE=he({},so,{key:function(t){if(t.key){var e=OE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=pa(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fh,charCode:function(t){return t.type==="keypress"?pa(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?pa(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zE=gt(DE),UE=he({},bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cg=gt(UE),BE=he({},so,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fh}),VE=gt(BE),jE=he({},kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),GE=gt(jE),WE=he({},bl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HE=gt(WE),XE=[9,13,27,32],hh=pn&&"CompositionEvent"in window,ys=null;pn&&"documentMode"in document&&(ys=document.documentMode);var YE=pn&&"TextEvent"in window&&!ys,cv=pn&&(!hh||ys&&8<ys&&11>=ys),ug=String.fromCharCode(32),fg=!1;function uv(t,e){switch(t){case"keyup":return XE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zi=!1;function ZE(t,e){switch(t){case"compositionend":return fv(e);case"keypress":return e.which!==32?null:(fg=!0,ug);case"textInput":return t=e.data,t===ug&&fg?null:t;default:return null}}function $E(t,e){if(Zi)return t==="compositionend"||!hh&&uv(t,e)?(t=lv(),ga=ch=zn=null,Zi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cv&&e.locale!=="ko"?null:e.data;default:return null}}var KE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!KE[t.type]:e==="textarea"}function hv(t,e,n,i){G0(i),e=ja(e,"onChange"),0<e.length&&(n=new uh("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var _s=null,Fs=null;function qE(t){Tv(t,0)}function Al(t){var e=qi(t);if(F0(e))return t}function QE(t,e){if(t==="change")return e}var dv=!1;if(pn){var Sc;if(pn){var Pc="oninput"in document;if(!Pc){var dg=document.createElement("div");dg.setAttribute("oninput","return;"),Pc=typeof dg.oninput=="function"}Sc=Pc}else Sc=!1;dv=Sc&&(!document.documentMode||9<document.documentMode)}function gg(){_s&&(_s.detachEvent("onpropertychange",gv),Fs=_s=null)}function gv(t){if(t.propertyName==="value"&&Al(Fs)){var e=[];hv(e,Fs,t,rh(t)),Y0(qE,e)}}function JE(t,e,n){t==="focusin"?(gg(),_s=e,Fs=n,_s.attachEvent("onpropertychange",gv)):t==="focusout"&&gg()}function ex(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Al(Fs)}function tx(t,e){if(t==="click")return Al(e)}function nx(t,e){if(t==="input"||t==="change")return Al(e)}function ix(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zt=typeof Object.is=="function"?Object.is:ix;function Ds(t,e){if(zt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!xu.call(e,r)||!zt(t[r],e[r]))return!1}return!0}function pg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function mg(t,e){var n=pg(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pg(n)}}function pv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mv(){for(var t=window,e=Na();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Na(t.document)}return e}function dh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function rx(t){var e=mv(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&pv(n.ownerDocument.documentElement,n)){if(i!==null&&dh(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=mg(n,s);var o=mg(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sx=pn&&"documentMode"in document&&11>=document.documentMode,$i=null,Vu=null,ws=null,ju=!1;function vg(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ju||$i==null||$i!==Na(i)||(i=$i,"selectionStart"in i&&dh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ws&&Ds(ws,i)||(ws=i,i=ja(Vu,"onSelect"),0<i.length&&(e=new uh("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=$i)))}function Uo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ki={animationend:Uo("Animation","AnimationEnd"),animationiteration:Uo("Animation","AnimationIteration"),animationstart:Uo("Animation","AnimationStart"),transitionend:Uo("Transition","TransitionEnd")},bc={},vv={};pn&&(vv=document.createElement("div").style,"AnimationEvent"in window||(delete Ki.animationend.animation,delete Ki.animationiteration.animation,delete Ki.animationstart.animation),"TransitionEvent"in window||delete Ki.transitionend.transition);function Cl(t){if(bc[t])return bc[t];if(!Ki[t])return t;var e=Ki[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in vv)return bc[t]=e[n];return t}var yv=Cl("animationend"),_v=Cl("animationiteration"),wv=Cl("animationstart"),Ev=Cl("transitionend"),xv=new Map,yg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ti(t,e){xv.set(t,e),Ii(e,[t])}for(var Ac=0;Ac<yg.length;Ac++){var Cc=yg[Ac],ox=Cc.toLowerCase(),ax=Cc[0].toUpperCase()+Cc.slice(1);ti(ox,"on"+ax)}ti(yv,"onAnimationEnd");ti(_v,"onAnimationIteration");ti(wv,"onAnimationStart");ti("dblclick","onDoubleClick");ti("focusin","onFocus");ti("focusout","onBlur");ti(Ev,"onTransitionEnd");mr("onMouseEnter",["mouseout","mouseover"]);mr("onMouseLeave",["mouseout","mouseover"]);mr("onPointerEnter",["pointerout","pointerover"]);mr("onPointerLeave",["pointerout","pointerover"]);Ii("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ii("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ii("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ii("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ii("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ii("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lx=new Set("cancel close invalid load scroll toggle".split(" ").concat(hs));function _g(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,oE(i,e,void 0,t),t.currentTarget=null}function Tv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;_g(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;_g(r,a,c),s=l}}}if(Da)throw t=Du,Da=!1,Du=null,t}function re(t,e){var n=e[Yu];n===void 0&&(n=e[Yu]=new Set);var i=t+"__bubble";n.has(i)||(Sv(e,t,2,!1),n.add(i))}function Lc(t,e,n){var i=0;e&&(i|=4),Sv(n,t,i,e)}var Bo="_reactListening"+Math.random().toString(36).slice(2);function zs(t){if(!t[Bo]){t[Bo]=!0,I0.forEach(function(n){n!=="selectionchange"&&(lx.has(n)||Lc(n,!1,t),Lc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Bo]||(e[Bo]=!0,Lc("selectionchange",!1,e))}}function Sv(t,e,n,i){switch(av(e)){case 1:var r=xE;break;case 4:r=TE;break;default:r=lh}n=r.bind(null,e,n,t),r=void 0,!Fu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Mc(t,e,n,i,r){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=gi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Y0(function(){var c=s,u=rh(n),f=[];e:{var h=xv.get(t);if(h!==void 0){var d=uh,p=t;switch(t){case"keypress":if(pa(n)===0)break e;case"keydown":case"keyup":d=zE;break;case"focusin":p="focus",d=Tc;break;case"focusout":p="blur",d=Tc;break;case"beforeblur":case"afterblur":d=Tc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=ag;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=bE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=VE;break;case yv:case _v:case wv:d=LE;break;case Ev:d=GE;break;case"scroll":d=SE;break;case"wheel":d=HE;break;case"copy":case"cut":case"paste":d=IE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=cg}var w=(e&4)!==0,x=!w&&t==="scroll",y=w?h!==null?h+"Capture":null:h;w=[];for(var m=c,_;m!==null;){_=m;var T=_.stateNode;if(_.tag===5&&T!==null&&(_=T,y!==null&&(T=Rs(m,y),T!=null&&w.push(Us(m,T,_)))),x)break;m=m.return}0<w.length&&(h=new d(h,p,null,n,u),f.push({event:h,listeners:w}))}}if((e&7)===0){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==ku&&(p=n.relatedTarget||n.fromElement)&&(gi(p)||p[mn]))break e;if((d||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=c,p=p?gi(p):null,p!==null&&(x=Ri(p),p!==x||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=c),d!==p)){if(w=ag,T="onMouseLeave",y="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(w=cg,T="onPointerLeave",y="onPointerEnter",m="pointer"),x=d==null?h:qi(d),_=p==null?h:qi(p),h=new w(T,m+"leave",d,n,u),h.target=x,h.relatedTarget=_,T=null,gi(u)===c&&(w=new w(y,m+"enter",p,n,u),w.target=_,w.relatedTarget=x,T=w),x=T,d&&p)t:{for(w=d,y=p,m=0,_=w;_;_=zi(_))m++;for(_=0,T=y;T;T=zi(T))_++;for(;0<m-_;)w=zi(w),m--;for(;0<_-m;)y=zi(y),_--;for(;m--;){if(w===y||y!==null&&w===y.alternate)break t;w=zi(w),y=zi(y)}w=null}else w=null;d!==null&&wg(f,h,d,w,!1),p!==null&&x!==null&&wg(f,x,p,w,!0)}}e:{if(h=c?qi(c):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var P=QE;else if(hg(h))if(dv)P=nx;else{P=ex;var b=JE}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(P=tx);if(P&&(P=P(t,c))){hv(f,P,n,u);break e}b&&b(t,h,c),t==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&Lu(h,"number",h.value)}switch(b=c?qi(c):window,t){case"focusin":(hg(b)||b.contentEditable==="true")&&($i=b,Vu=c,ws=null);break;case"focusout":ws=Vu=$i=null;break;case"mousedown":ju=!0;break;case"contextmenu":case"mouseup":case"dragend":ju=!1,vg(f,n,u);break;case"selectionchange":if(sx)break;case"keydown":case"keyup":vg(f,n,u)}var C;if(hh)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Zi?uv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(cv&&n.locale!=="ko"&&(Zi||M!=="onCompositionStart"?M==="onCompositionEnd"&&Zi&&(C=lv()):(zn=u,ch="value"in zn?zn.value:zn.textContent,Zi=!0)),b=ja(c,M),0<b.length&&(M=new lg(M,t,null,n,u),f.push({event:M,listeners:b}),C?M.data=C:(C=fv(n),C!==null&&(M.data=C)))),(C=YE?ZE(t,n):$E(t,n))&&(c=ja(c,"onBeforeInput"),0<c.length&&(u=new lg("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=C))}Tv(f,e)})}function Us(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ja(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Rs(t,n),s!=null&&i.unshift(Us(t,s,r)),s=Rs(t,e),s!=null&&i.push(Us(t,s,r))),t=t.return}return i}function zi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function wg(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Rs(n,s),l!=null&&o.unshift(Us(n,l,a))):r||(l=Rs(n,s),l!=null&&o.push(Us(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var cx=/\r\n?/g,ux=/\u0000|\uFFFD/g;function Eg(t){return(typeof t=="string"?t:""+t).replace(cx,`
`).replace(ux,"")}function Vo(t,e,n){if(e=Eg(e),Eg(t)!==e&&n)throw Error(I(425))}function Ga(){}var Gu=null,Wu=null;function Hu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Xu=typeof setTimeout=="function"?setTimeout:void 0,fx=typeof clearTimeout=="function"?clearTimeout:void 0,xg=typeof Promise=="function"?Promise:void 0,hx=typeof queueMicrotask=="function"?queueMicrotask:typeof xg<"u"?function(t){return xg.resolve(null).then(t).catch(dx)}:Xu;function dx(t){setTimeout(function(){throw t})}function Ic(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Ns(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Ns(e)}function Hn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Tg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Nr=Math.random().toString(36).slice(2),Zt="__reactFiber$"+Nr,Bs="__reactProps$"+Nr,mn="__reactContainer$"+Nr,Yu="__reactEvents$"+Nr,gx="__reactListeners$"+Nr,px="__reactHandles$"+Nr;function gi(t){var e=t[Zt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[mn]||n[Zt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Tg(t);t!==null;){if(n=t[Zt])return n;t=Tg(t)}return e}t=n,n=t.parentNode}return null}function oo(t){return t=t[Zt]||t[mn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function qi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(I(33))}function Ll(t){return t[Bs]||null}var Zu=[],Qi=-1;function ni(t){return{current:t}}function se(t){0>Qi||(t.current=Zu[Qi],Zu[Qi]=null,Qi--)}function ne(t,e){Qi++,Zu[Qi]=t.current,t.current=e}var Qn={},Ue=ni(Qn),qe=ni(!1),xi=Qn;function vr(t,e){var n=t.type.contextTypes;if(!n)return Qn;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Qe(t){return t=t.childContextTypes,t!=null}function Wa(){se(qe),se(Ue)}function Sg(t,e,n){if(Ue.current!==Qn)throw Error(I(168));ne(Ue,e),ne(qe,n)}function Pv(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(I(108,Jw(t)||"Unknown",r));return he({},n,i)}function Ha(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qn,xi=Ue.current,ne(Ue,t),ne(qe,qe.current),!0}function Pg(t,e,n){var i=t.stateNode;if(!i)throw Error(I(169));n?(t=Pv(t,e,xi),i.__reactInternalMemoizedMergedChildContext=t,se(qe),se(Ue),ne(Ue,t)):se(qe),ne(qe,n)}var un=null,Ml=!1,Rc=!1;function bv(t){un===null?un=[t]:un.push(t)}function mx(t){Ml=!0,bv(t)}function ii(){if(!Rc&&un!==null){Rc=!0;var t=0,e=Q;try{var n=un;for(Q=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}un=null,Ml=!1}catch(r){throw un!==null&&(un=un.slice(t+1)),q0(sh,ii),r}finally{Q=e,Rc=!1}}return null}var Ji=[],er=0,Xa=null,Ya=0,yt=[],_t=0,Ti=null,hn=1,dn="";function fi(t,e){Ji[er++]=Ya,Ji[er++]=Xa,Xa=t,Ya=e}function Av(t,e,n){yt[_t++]=hn,yt[_t++]=dn,yt[_t++]=Ti,Ti=t;var i=hn;t=dn;var r=32-Nt(i)-1;i&=~(1<<r),n+=1;var s=32-Nt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,hn=1<<32-Nt(e)+r|n<<r|i,dn=s+t}else hn=1<<s|n<<r|i,dn=t}function gh(t){t.return!==null&&(fi(t,1),Av(t,1,0))}function ph(t){for(;t===Xa;)Xa=Ji[--er],Ji[er]=null,Ya=Ji[--er],Ji[er]=null;for(;t===Ti;)Ti=yt[--_t],yt[_t]=null,dn=yt[--_t],yt[_t]=null,hn=yt[--_t],yt[_t]=null}var ct=null,at=null,ae=!1,Rt=null;function Cv(t,e){var n=wt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function bg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ct=t,at=Hn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ct=t,at=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ti!==null?{id:hn,overflow:dn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ct=t,at=null,!0):!1;default:return!1}}function $u(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ku(t){if(ae){var e=at;if(e){var n=e;if(!bg(t,e)){if($u(t))throw Error(I(418));e=Hn(n.nextSibling);var i=ct;e&&bg(t,e)?Cv(i,n):(t.flags=t.flags&-4097|2,ae=!1,ct=t)}}else{if($u(t))throw Error(I(418));t.flags=t.flags&-4097|2,ae=!1,ct=t}}}function Ag(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ct=t}function jo(t){if(t!==ct)return!1;if(!ae)return Ag(t),ae=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Hu(t.type,t.memoizedProps)),e&&(e=at)){if($u(t))throw Lv(),Error(I(418));for(;e;)Cv(t,e),e=Hn(e.nextSibling)}if(Ag(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(I(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){at=Hn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}at=null}}else at=ct?Hn(t.stateNode.nextSibling):null;return!0}function Lv(){for(var t=at;t;)t=Hn(t.nextSibling)}function yr(){at=ct=null,ae=!1}function mh(t){Rt===null?Rt=[t]:Rt.push(t)}var vx=xn.ReactCurrentBatchConfig;function Mt(t,e){if(t&&t.defaultProps){e=he({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Za=ni(null),$a=null,tr=null,vh=null;function yh(){vh=tr=$a=null}function _h(t){var e=Za.current;se(Za),t._currentValue=e}function qu(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function fr(t,e){$a=t,vh=tr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Ke=!0),t.firstContext=null)}function Tt(t){var e=t._currentValue;if(vh!==t)if(t={context:t,memoizedValue:e,next:null},tr===null){if($a===null)throw Error(I(308));tr=t,$a.dependencies={lanes:0,firstContext:t}}else tr=tr.next=t;return e}var pi=null;function wh(t){pi===null?pi=[t]:pi.push(t)}function Mv(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,wh(e)):(n.next=r.next,r.next=n),e.interleaved=n,vn(t,i)}function vn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var kn=!1;function Eh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Iv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Xn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,(q&2)!==0){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,vn(t,n)}return r=i.interleaved,r===null?(e.next=e,wh(i)):(e.next=r.next,r.next=e),i.interleaved=e,vn(t,n)}function ma(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,oh(t,n)}}function Cg(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ka(t,e,n,i){var r=t.updateQueue;kn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,w=a;switch(h=e,d=n,w.tag){case 1:if(p=w.payload,typeof p=="function"){f=p.call(d,f,h);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=w.payload,h=typeof p=="function"?p.call(d,f,h):p,h==null)break e;f=he({},f,h);break e;case 2:kn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=f):u=u.next=d,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=f),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Pi|=o,t.lanes=o,t.memoizedState=f}}function Lg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(I(191,r));r.call(i)}}}var Rv=new M0.Component().refs;function Qu(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:he({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Il={isMounted:function(t){return(t=t._reactInternals)?Ri(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=Zn(t),s=gn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Ft(e,t,r,i),ma(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=Zn(t),s=gn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Ft(e,t,r,i),ma(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),i=Zn(t),r=gn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Xn(t,r,i),e!==null&&(Ft(e,t,i,n),ma(e,t,i))}};function Mg(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ds(n,i)||!Ds(r,s):!0}function Ov(t,e,n){var i=!1,r=Qn,s=e.contextType;return typeof s=="object"&&s!==null?s=Tt(s):(r=Qe(e)?xi:Ue.current,i=e.contextTypes,s=(i=i!=null)?vr(t,r):Qn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Il,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Ig(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Il.enqueueReplaceState(e,e.state,null)}function Ju(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=Rv,Eh(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Tt(s):(s=Qe(e)?xi:Ue.current,r.context=vr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Qu(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Il.enqueueReplaceState(r,r.state,null),Ka(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Jr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(I(309));var i=n.stateNode}if(!i)throw Error(I(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===Rv&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(I(284));if(!n._owner)throw Error(I(290,t))}return t}function Go(t,e){throw t=Object.prototype.toString.call(e),Error(I(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Rg(t){var e=t._init;return e(t._payload)}function kv(t){function e(y,m){if(t){var _=y.deletions;_===null?(y.deletions=[m],y.flags|=16):_.push(m)}}function n(y,m){if(!t)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function i(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function r(y,m){return y=$n(y,m),y.index=0,y.sibling=null,y}function s(y,m,_){return y.index=_,t?(_=y.alternate,_!==null?(_=_.index,_<m?(y.flags|=2,m):_):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,m,_,T){return m===null||m.tag!==6?(m=Uc(_,y.mode,T),m.return=y,m):(m=r(m,_),m.return=y,m)}function l(y,m,_,T){var P=_.type;return P===Yi?u(y,m,_.props.children,T,_.key):m!==null&&(m.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===On&&Rg(P)===m.type)?(T=r(m,_.props),T.ref=Jr(y,m,_),T.return=y,T):(T=xa(_.type,_.key,_.props,null,y.mode,T),T.ref=Jr(y,m,_),T.return=y,T)}function c(y,m,_,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==_.containerInfo||m.stateNode.implementation!==_.implementation?(m=Bc(_,y.mode,T),m.return=y,m):(m=r(m,_.children||[]),m.return=y,m)}function u(y,m,_,T,P){return m===null||m.tag!==7?(m=_i(_,y.mode,T,P),m.return=y,m):(m=r(m,_),m.return=y,m)}function f(y,m,_){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Uc(""+m,y.mode,_),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ro:return _=xa(m.type,m.key,m.props,null,y.mode,_),_.ref=Jr(y,null,m),_.return=y,_;case Xi:return m=Bc(m,y.mode,_),m.return=y,m;case On:var T=m._init;return f(y,T(m._payload),_)}if(us(m)||Zr(m))return m=_i(m,y.mode,_,null),m.return=y,m;Go(y,m)}return null}function h(y,m,_,T){var P=m!==null?m.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return P!==null?null:a(y,m,""+_,T);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ro:return _.key===P?l(y,m,_,T):null;case Xi:return _.key===P?c(y,m,_,T):null;case On:return P=_._init,h(y,m,P(_._payload),T)}if(us(_)||Zr(_))return P!==null?null:u(y,m,_,T,null);Go(y,_)}return null}function d(y,m,_,T,P){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(_)||null,a(m,y,""+T,P);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Ro:return y=y.get(T.key===null?_:T.key)||null,l(m,y,T,P);case Xi:return y=y.get(T.key===null?_:T.key)||null,c(m,y,T,P);case On:var b=T._init;return d(y,m,_,b(T._payload),P)}if(us(T)||Zr(T))return y=y.get(_)||null,u(m,y,T,P,null);Go(m,T)}return null}function p(y,m,_,T){for(var P=null,b=null,C=m,M=m=0,R=null;C!==null&&M<_.length;M++){C.index>M?(R=C,C=null):R=C.sibling;var O=h(y,C,_[M],T);if(O===null){C===null&&(C=R);break}t&&C&&O.alternate===null&&e(y,C),m=s(O,m,M),b===null?P=O:b.sibling=O,b=O,C=R}if(M===_.length)return n(y,C),ae&&fi(y,M),P;if(C===null){for(;M<_.length;M++)C=f(y,_[M],T),C!==null&&(m=s(C,m,M),b===null?P=C:b.sibling=C,b=C);return ae&&fi(y,M),P}for(C=i(y,C);M<_.length;M++)R=d(C,y,M,_[M],T),R!==null&&(t&&R.alternate!==null&&C.delete(R.key===null?M:R.key),m=s(R,m,M),b===null?P=R:b.sibling=R,b=R);return t&&C.forEach(function(U){return e(y,U)}),ae&&fi(y,M),P}function w(y,m,_,T){var P=Zr(_);if(typeof P!="function")throw Error(I(150));if(_=P.call(_),_==null)throw Error(I(151));for(var b=P=null,C=m,M=m=0,R=null,O=_.next();C!==null&&!O.done;M++,O=_.next()){C.index>M?(R=C,C=null):R=C.sibling;var U=h(y,C,O.value,T);if(U===null){C===null&&(C=R);break}t&&C&&U.alternate===null&&e(y,C),m=s(U,m,M),b===null?P=U:b.sibling=U,b=U,C=R}if(O.done)return n(y,C),ae&&fi(y,M),P;if(C===null){for(;!O.done;M++,O=_.next())O=f(y,O.value,T),O!==null&&(m=s(O,m,M),b===null?P=O:b.sibling=O,b=O);return ae&&fi(y,M),P}for(C=i(y,C);!O.done;M++,O=_.next())O=d(C,y,M,O.value,T),O!==null&&(t&&O.alternate!==null&&C.delete(O.key===null?M:O.key),m=s(O,m,M),b===null?P=O:b.sibling=O,b=O);return t&&C.forEach(function(G){return e(y,G)}),ae&&fi(y,M),P}function x(y,m,_,T){if(typeof _=="object"&&_!==null&&_.type===Yi&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Ro:e:{for(var P=_.key,b=m;b!==null;){if(b.key===P){if(P=_.type,P===Yi){if(b.tag===7){n(y,b.sibling),m=r(b,_.props.children),m.return=y,y=m;break e}}else if(b.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===On&&Rg(P)===b.type){n(y,b.sibling),m=r(b,_.props),m.ref=Jr(y,b,_),m.return=y,y=m;break e}n(y,b);break}else e(y,b);b=b.sibling}_.type===Yi?(m=_i(_.props.children,y.mode,T,_.key),m.return=y,y=m):(T=xa(_.type,_.key,_.props,null,y.mode,T),T.ref=Jr(y,m,_),T.return=y,y=T)}return o(y);case Xi:e:{for(b=_.key;m!==null;){if(m.key===b)if(m.tag===4&&m.stateNode.containerInfo===_.containerInfo&&m.stateNode.implementation===_.implementation){n(y,m.sibling),m=r(m,_.children||[]),m.return=y,y=m;break e}else{n(y,m);break}else e(y,m);m=m.sibling}m=Bc(_,y.mode,T),m.return=y,y=m}return o(y);case On:return b=_._init,x(y,m,b(_._payload),T)}if(us(_))return p(y,m,_,T);if(Zr(_))return w(y,m,_,T);Go(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,m!==null&&m.tag===6?(n(y,m.sibling),m=r(m,_),m.return=y,y=m):(n(y,m),m=Uc(_,y.mode,T),m.return=y,y=m),o(y)):n(y,m)}return x}var _r=kv(!0),Nv=kv(!1),ao={},Qt=ni(ao),Vs=ni(ao),js=ni(ao);function mi(t){if(t===ao)throw Error(I(174));return t}function xh(t,e){switch(ne(js,e),ne(Vs,t),ne(Qt,ao),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Iu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Iu(e,t)}se(Qt),ne(Qt,e)}function wr(){se(Qt),se(Vs),se(js)}function Fv(t){mi(js.current);var e=mi(Qt.current),n=Iu(e,t.type);e!==n&&(ne(Vs,t),ne(Qt,n))}function Th(t){Vs.current===t&&(se(Qt),se(Vs))}var ce=ni(0);function qa(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Oc=[];function Sh(){for(var t=0;t<Oc.length;t++)Oc[t]._workInProgressVersionPrimary=null;Oc.length=0}var va=xn.ReactCurrentDispatcher,kc=xn.ReactCurrentBatchConfig,Si=0,fe=null,Ee=null,Se=null,Qa=!1,Es=!1,Gs=0,yx=0;function Oe(){throw Error(I(321))}function Ph(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zt(t[n],e[n]))return!1;return!0}function bh(t,e,n,i,r,s){if(Si=s,fe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,va.current=t===null||t.memoizedState===null?xx:Tx,t=n(i,r),Es){s=0;do{if(Es=!1,Gs=0,25<=s)throw Error(I(301));s+=1,Se=Ee=null,e.updateQueue=null,va.current=Sx,t=n(i,r)}while(Es)}if(va.current=Ja,e=Ee!==null&&Ee.next!==null,Si=0,Se=Ee=fe=null,Qa=!1,e)throw Error(I(300));return t}function Ah(){var t=Gs!==0;return Gs=0,t}function Yt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Se===null?fe.memoizedState=Se=t:Se=Se.next=t,Se}function St(){if(Ee===null){var t=fe.alternate;t=t!==null?t.memoizedState:null}else t=Ee.next;var e=Se===null?fe.memoizedState:Se.next;if(e!==null)Se=e,Ee=t;else{if(t===null)throw Error(I(310));Ee=t,t={memoizedState:Ee.memoizedState,baseState:Ee.baseState,baseQueue:Ee.baseQueue,queue:Ee.queue,next:null},Se===null?fe.memoizedState=Se=t:Se=Se.next=t}return Se}function Ws(t,e){return typeof e=="function"?e(t):e}function Nc(t){var e=St(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=Ee,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Si&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,fe.lanes|=u,Pi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,zt(i,e.memoizedState)||(Ke=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,fe.lanes|=s,Pi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fc(t){var e=St(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);zt(s,e.memoizedState)||(Ke=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Dv(){}function zv(t,e){var n=fe,i=St(),r=e(),s=!zt(i.memoizedState,r);if(s&&(i.memoizedState=r,Ke=!0),i=i.queue,Ch(Vv.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Se!==null&&Se.memoizedState.tag&1){if(n.flags|=2048,Hs(9,Bv.bind(null,n,i,r,e),void 0,null),be===null)throw Error(I(349));(Si&30)!==0||Uv(n,e,r)}return r}function Uv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=fe.updateQueue,e===null?(e={lastEffect:null,stores:null},fe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Bv(t,e,n,i){e.value=n,e.getSnapshot=i,jv(e)&&Gv(t)}function Vv(t,e,n){return n(function(){jv(e)&&Gv(t)})}function jv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zt(t,n)}catch{return!0}}function Gv(t){var e=vn(t,1);e!==null&&Ft(e,t,1,-1)}function Og(t){var e=Yt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:t},e.queue=t,t=t.dispatch=Ex.bind(null,fe,t),[e.memoizedState,t]}function Hs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=fe.updateQueue,e===null?(e={lastEffect:null,stores:null},fe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Wv(){return St().memoizedState}function ya(t,e,n,i){var r=Yt();fe.flags|=t,r.memoizedState=Hs(1|e,n,void 0,i===void 0?null:i)}function Rl(t,e,n,i){var r=St();i=i===void 0?null:i;var s=void 0;if(Ee!==null){var o=Ee.memoizedState;if(s=o.destroy,i!==null&&Ph(i,o.deps)){r.memoizedState=Hs(e,n,s,i);return}}fe.flags|=t,r.memoizedState=Hs(1|e,n,s,i)}function kg(t,e){return ya(8390656,8,t,e)}function Ch(t,e){return Rl(2048,8,t,e)}function Hv(t,e){return Rl(4,2,t,e)}function Xv(t,e){return Rl(4,4,t,e)}function Yv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Zv(t,e,n){return n=n!=null?n.concat([t]):null,Rl(4,4,Yv.bind(null,e,t),n)}function Lh(){}function $v(t,e){var n=St();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ph(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Kv(t,e){var n=St();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ph(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function qv(t,e,n){return(Si&21)===0?(t.baseState&&(t.baseState=!1,Ke=!0),t.memoizedState=n):(zt(n,e)||(n=ev(),fe.lanes|=n,Pi|=n,t.baseState=!0),e)}function _x(t,e){var n=Q;Q=n!==0&&4>n?n:4,t(!0);var i=kc.transition;kc.transition={};try{t(!1),e()}finally{Q=n,kc.transition=i}}function Qv(){return St().memoizedState}function wx(t,e,n){var i=Zn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Jv(t))ey(e,n);else if(n=Mv(t,e,n,i),n!==null){var r=Ge();Ft(n,t,i,r),ty(n,e,i)}}function Ex(t,e,n){var i=Zn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jv(t))ey(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,zt(a,o)){var l=e.interleaved;l===null?(r.next=r,wh(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=Mv(t,e,r,i),n!==null&&(r=Ge(),Ft(n,t,i,r),ty(n,e,i))}}function Jv(t){var e=t.alternate;return t===fe||e!==null&&e===fe}function ey(t,e){Es=Qa=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ty(t,e,n){if((n&4194240)!==0){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,oh(t,n)}}var Ja={readContext:Tt,useCallback:Oe,useContext:Oe,useEffect:Oe,useImperativeHandle:Oe,useInsertionEffect:Oe,useLayoutEffect:Oe,useMemo:Oe,useReducer:Oe,useRef:Oe,useState:Oe,useDebugValue:Oe,useDeferredValue:Oe,useTransition:Oe,useMutableSource:Oe,useSyncExternalStore:Oe,useId:Oe,unstable_isNewReconciler:!1},xx={readContext:Tt,useCallback:function(t,e){return Yt().memoizedState=[t,e===void 0?null:e],t},useContext:Tt,useEffect:kg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ya(4194308,4,Yv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ya(4194308,4,t,e)},useInsertionEffect:function(t,e){return ya(4,2,t,e)},useMemo:function(t,e){var n=Yt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Yt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=wx.bind(null,fe,t),[i.memoizedState,t]},useRef:function(t){var e=Yt();return t={current:t},e.memoizedState=t},useState:Og,useDebugValue:Lh,useDeferredValue:function(t){return Yt().memoizedState=t},useTransition:function(){var t=Og(!1),e=t[0];return t=_x.bind(null,t[1]),Yt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=fe,r=Yt();if(ae){if(n===void 0)throw Error(I(407));n=n()}else{if(n=e(),be===null)throw Error(I(349));(Si&30)!==0||Uv(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,kg(Vv.bind(null,i,s,t),[t]),i.flags|=2048,Hs(9,Bv.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Yt(),e=be.identifierPrefix;if(ae){var n=dn,i=hn;n=(i&~(1<<32-Nt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Gs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=yx++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Tx={readContext:Tt,useCallback:$v,useContext:Tt,useEffect:Ch,useImperativeHandle:Zv,useInsertionEffect:Hv,useLayoutEffect:Xv,useMemo:Kv,useReducer:Nc,useRef:Wv,useState:function(){return Nc(Ws)},useDebugValue:Lh,useDeferredValue:function(t){var e=St();return qv(e,Ee.memoizedState,t)},useTransition:function(){var t=Nc(Ws)[0],e=St().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:zv,useId:Qv,unstable_isNewReconciler:!1},Sx={readContext:Tt,useCallback:$v,useContext:Tt,useEffect:Ch,useImperativeHandle:Zv,useInsertionEffect:Hv,useLayoutEffect:Xv,useMemo:Kv,useReducer:Fc,useRef:Wv,useState:function(){return Fc(Ws)},useDebugValue:Lh,useDeferredValue:function(t){var e=St();return Ee===null?e.memoizedState=t:qv(e,Ee.memoizedState,t)},useTransition:function(){var t=Fc(Ws)[0],e=St().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:zv,useId:Qv,unstable_isNewReconciler:!1};function Er(t,e){try{var n="",i=e;do n+=Qw(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Dc(t,e,n){return{value:t,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function ef(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Px=typeof WeakMap=="function"?WeakMap:Map;function ny(t,e,n){n=gn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){tl||(tl=!0,ff=i),ef(t,e)},n}function iy(t,e,n){n=gn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){ef(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){ef(t,e),typeof i!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ng(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Px;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Ux.bind(null,t,e,n),e.then(t,t))}function Fg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Dg(t,e,n,i,r){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=gn(-1,1),e.tag=2,Xn(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var bx=xn.ReactCurrentOwner,Ke=!1;function Ve(t,e,n,i){e.child=t===null?Nv(e,null,n,i):_r(e,t.child,n,i)}function zg(t,e,n,i,r){n=n.render;var s=e.ref;return fr(e,r),i=bh(t,e,n,i,s,r),n=Ah(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,yn(t,e,r)):(ae&&n&&gh(e),e.flags|=1,Ve(t,e,i,r),e.child)}function Ug(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Dh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ry(t,e,s,i,r)):(t=xa(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&r)===0){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ds,n(o,i)&&t.ref===e.ref)return yn(t,e,r)}return e.flags|=1,t=$n(s,i),t.ref=e.ref,t.return=e,e.child=t}function ry(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ds(s,i)&&t.ref===e.ref)if(Ke=!1,e.pendingProps=i=s,(t.lanes&r)!==0)(t.flags&131072)!==0&&(Ke=!0);else return e.lanes=t.lanes,yn(t,e,r)}return tf(t,e,n,i,r)}function sy(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ne(ir,rt),rt|=n;else{if((n&1073741824)===0)return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ne(ir,rt),rt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,ne(ir,rt),rt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ne(ir,rt),rt|=i;return Ve(t,e,r,n),e.child}function oy(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function tf(t,e,n,i,r){var s=Qe(n)?xi:Ue.current;return s=vr(e,s),fr(e,r),n=bh(t,e,n,i,s,r),i=Ah(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,yn(t,e,r)):(ae&&i&&gh(e),e.flags|=1,Ve(t,e,n,r),e.child)}function Bg(t,e,n,i,r){if(Qe(n)){var s=!0;Ha(e)}else s=!1;if(fr(e,r),e.stateNode===null)_a(t,e),Ov(e,n,i),Ju(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Tt(c):(c=Qe(n)?xi:Ue.current,c=vr(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Ig(e,o,i,c),kn=!1;var h=e.memoizedState;o.state=h,Ka(e,i,o,r),l=e.memoizedState,a!==i||h!==l||qe.current||kn?(typeof u=="function"&&(Qu(e,n,u,i),l=e.memoizedState),(a=kn||Mg(e,n,a,i,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Iv(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Mt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Tt(l):(l=Qe(n)?xi:Ue.current,l=vr(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Ig(e,o,i,l),kn=!1,h=e.memoizedState,o.state=h,Ka(e,i,o,r);var p=e.memoizedState;a!==f||h!==p||qe.current||kn?(typeof d=="function"&&(Qu(e,n,d,i),p=e.memoizedState),(c=kn||Mg(e,n,c,i,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return nf(t,e,n,i,s,r)}function nf(t,e,n,i,r,s){oy(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Pg(e,n,!1),yn(t,e,s);i=e.stateNode,bx.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=_r(e,t.child,null,s),e.child=_r(e,null,a,s)):Ve(t,e,a,s),e.memoizedState=i.state,r&&Pg(e,n,!0),e.child}function ay(t){var e=t.stateNode;e.pendingContext?Sg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Sg(t,e.context,!1),xh(t,e.containerInfo)}function Vg(t,e,n,i,r){return yr(),mh(r),e.flags|=256,Ve(t,e,n,i),e.child}var rf={dehydrated:null,treeContext:null,retryLane:0};function sf(t){return{baseLanes:t,cachePool:null,transitions:null}}function ly(t,e,n){var i=e.pendingProps,r=ce.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ne(ce,r&1),t===null)return Ku(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},(i&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Nl(o,i,0,null),t=_i(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=sf(n),e.memoizedState=rf,t):Mh(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Ax(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=$n(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=$n(a,s):(s=_i(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?sf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=rf,i}return s=t.child,t=s.sibling,i=$n(s,{mode:"visible",children:i.children}),(e.mode&1)===0&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Mh(t,e){return e=Nl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Wo(t,e,n,i){return i!==null&&mh(i),_r(e,t.child,null,n),t=Mh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ax(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Dc(Error(I(422))),Wo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Nl({mode:"visible",children:i.children},r,0,null),s=_i(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,(e.mode&1)!==0&&_r(e,t.child,null,o),e.child.memoizedState=sf(o),e.memoizedState=rf,s);if((e.mode&1)===0)return Wo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(I(419)),i=Dc(s,i,void 0),Wo(t,e,o,i)}if(a=(o&t.childLanes)!==0,Ke||a){if(i=be,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=(r&(i.suspendedLanes|o))!==0?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,vn(t,r),Ft(i,t,r,-1))}return Fh(),i=Dc(Error(I(421))),Wo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Bx.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,at=Hn(r.nextSibling),ct=e,ae=!0,Rt=null,t!==null&&(yt[_t++]=hn,yt[_t++]=dn,yt[_t++]=Ti,hn=t.id,dn=t.overflow,Ti=e),e=Mh(e,i.children),e.flags|=4096,e)}function jg(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),qu(t.return,e,n)}function zc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function cy(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ve(t,e,i.children,n),i=ce.current,(i&2)!==0)i=i&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&jg(t,n,e);else if(t.tag===19)jg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ne(ce,i),(e.mode&1)===0)e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&qa(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),zc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&qa(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}zc(e,!0,n,null,s);break;case"together":zc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _a(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function yn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pi|=e.lanes,(n&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(I(153));if(e.child!==null){for(t=e.child,n=$n(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$n(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Cx(t,e,n){switch(e.tag){case 3:ay(e),yr();break;case 5:Fv(e);break;case 1:Qe(e.type)&&Ha(e);break;case 4:xh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ne(Za,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ne(ce,ce.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?ly(t,e,n):(ne(ce,ce.current&1),t=yn(t,e,n),t!==null?t.sibling:null);ne(ce,ce.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&128)!==0){if(i)return cy(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ne(ce,ce.current),i)break;return null;case 22:case 23:return e.lanes=0,sy(t,e,n)}return yn(t,e,n)}var uy,of,fy,hy;uy=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};of=function(){};fy=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,mi(Qt.current);var s=null;switch(n){case"input":r=Au(t,r),i=Au(t,i),s=[];break;case"select":r=he({},r,{value:void 0}),i=he({},i,{value:void 0}),s=[];break;case"textarea":r=Mu(t,r),i=Mu(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Ga)}Ru(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ms.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ms.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&re("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};hy=function(t,e,n,i){n!==i&&(e.flags|=4)};function es(t,e){if(!ae)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ke(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Lx(t,e,n){var i=e.pendingProps;switch(ph(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ke(e),null;case 1:return Qe(e.type)&&Wa(),ke(e),null;case 3:return i=e.stateNode,wr(),se(qe),se(Ue),Sh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(jo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Rt!==null&&(gf(Rt),Rt=null))),of(t,e),ke(e),null;case 5:Th(e);var r=mi(js.current);if(n=e.type,t!==null&&e.stateNode!=null)fy(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(I(166));return ke(e),null}if(t=mi(Qt.current),jo(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Zt]=e,i[Bs]=s,t=(e.mode&1)!==0,n){case"dialog":re("cancel",i),re("close",i);break;case"iframe":case"object":case"embed":re("load",i);break;case"video":case"audio":for(r=0;r<hs.length;r++)re(hs[r],i);break;case"source":re("error",i);break;case"img":case"image":case"link":re("error",i),re("load",i);break;case"details":re("toggle",i);break;case"input":qd(i,s),re("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},re("invalid",i);break;case"textarea":Jd(i,s),re("invalid",i)}Ru(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Vo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Vo(i.textContent,a,t),r=["children",""+a]):Ms.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&re("scroll",i)}switch(n){case"input":Oo(i),Qd(i,s,!0);break;case"textarea":Oo(i),eg(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Ga)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=U0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Zt]=e,t[Bs]=i,uy(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ou(n,i),n){case"dialog":re("cancel",t),re("close",t),r=i;break;case"iframe":case"object":case"embed":re("load",t),r=i;break;case"video":case"audio":for(r=0;r<hs.length;r++)re(hs[r],t);r=i;break;case"source":re("error",t),r=i;break;case"img":case"image":case"link":re("error",t),re("load",t),r=i;break;case"details":re("toggle",t),r=i;break;case"input":qd(t,i),r=Au(t,i),re("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=he({},i,{value:void 0}),re("invalid",t);break;case"textarea":Jd(t,i),r=Mu(t,i),re("invalid",t);break;default:r=i}Ru(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?j0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&B0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Is(t,l):typeof l=="number"&&Is(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ms.hasOwnProperty(s)?l!=null&&s==="onScroll"&&re("scroll",t):l!=null&&eh(t,s,l,o))}switch(n){case"input":Oo(t),Qd(t,i,!1);break;case"textarea":Oo(t),eg(t);break;case"option":i.value!=null&&t.setAttribute("value",""+qn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ar(t,!!i.multiple,s,!1):i.defaultValue!=null&&ar(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Ga)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ke(e),null;case 6:if(t&&e.stateNode!=null)hy(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(I(166));if(n=mi(js.current),mi(Qt.current),jo(e)){if(i=e.stateNode,n=e.memoizedProps,i[Zt]=e,(s=i.nodeValue!==n)&&(t=ct,t!==null))switch(t.tag){case 3:Vo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Vo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Zt]=e,e.stateNode=i}return ke(e),null;case 13:if(se(ce),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ae&&at!==null&&(e.mode&1)!==0&&(e.flags&128)===0)Lv(),yr(),e.flags|=98560,s=!1;else if(s=jo(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(I(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(I(317));s[Zt]=e}else yr(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;ke(e),s=!1}else Rt!==null&&(gf(Rt),Rt=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(ce.current&1)!==0?xe===0&&(xe=3):Fh())),e.updateQueue!==null&&(e.flags|=4),ke(e),null);case 4:return wr(),of(t,e),t===null&&zs(e.stateNode.containerInfo),ke(e),null;case 10:return _h(e.type._context),ke(e),null;case 17:return Qe(e.type)&&Wa(),ke(e),null;case 19:if(se(ce),s=e.memoizedState,s===null)return ke(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)es(s,!1);else{if(xe!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(o=qa(t),o!==null){for(e.flags|=128,es(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ne(ce,ce.current&1|2),e.child}t=t.sibling}s.tail!==null&&pe()>xr&&(e.flags|=128,i=!0,es(s,!1),e.lanes=4194304)}else{if(!i)if(t=qa(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),es(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ae)return ke(e),null}else 2*pe()-s.renderingStartTime>xr&&n!==1073741824&&(e.flags|=128,i=!0,es(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=pe(),e.sibling=null,n=ce.current,ne(ce,i?n&1|2:n&1),e):(ke(e),null);case 22:case 23:return Nh(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&(e.mode&1)!==0?(rt&1073741824)!==0&&(ke(e),e.subtreeFlags&6&&(e.flags|=8192)):ke(e),null;case 24:return null;case 25:return null}throw Error(I(156,e.tag))}function Mx(t,e){switch(ph(e),e.tag){case 1:return Qe(e.type)&&Wa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return wr(),se(qe),se(Ue),Sh(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return Th(e),null;case 13:if(se(ce),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(I(340));yr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return se(ce),null;case 4:return wr(),null;case 10:return _h(e.type._context),null;case 22:case 23:return Nh(),null;case 24:return null;default:return null}}var Ho=!1,De=!1,Ix=typeof WeakSet=="function"?WeakSet:Set,z=null;function nr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ge(t,e,i)}else n.current=null}function af(t,e,n){try{n()}catch(i){ge(t,e,i)}}var Gg=!1;function Rx(t,e){if(Gu=Ba,t=mv(),dh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var d;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wu={focusedElem:t,selectionRange:n},Ba=!1,z=e;z!==null;)if(e=z,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,z=t;else for(;z!==null;){e=z;try{var p=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var w=p.memoizedProps,x=p.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?w:Mt(e.type,w),x);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(I(163))}}catch(T){ge(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}return p=Gg,Gg=!1,p}function xs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&af(e,n,s)}r=r.next}while(r!==i)}}function Ol(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function lf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dy(t){var e=t.alternate;e!==null&&(t.alternate=null,dy(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Zt],delete e[Bs],delete e[Yu],delete e[gx],delete e[px])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gy(t){return t.tag===5||t.tag===3||t.tag===4}function Wg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gy(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function cf(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ga));else if(i!==4&&(t=t.child,t!==null))for(cf(t,e,n),t=t.sibling;t!==null;)cf(t,e,n),t=t.sibling}function uf(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(uf(t,e,n),t=t.sibling;t!==null;)uf(t,e,n),t=t.sibling}var Le=null,It=!1;function An(t,e,n){for(n=n.child;n!==null;)py(t,e,n),n=n.sibling}function py(t,e,n){if(qt&&typeof qt.onCommitFiberUnmount=="function")try{qt.onCommitFiberUnmount(Pl,n)}catch{}switch(n.tag){case 5:De||nr(n,e);case 6:var i=Le,r=It;Le=null,An(t,e,n),Le=i,It=r,Le!==null&&(It?(t=Le,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Le.removeChild(n.stateNode));break;case 18:Le!==null&&(It?(t=Le,n=n.stateNode,t.nodeType===8?Ic(t.parentNode,n):t.nodeType===1&&Ic(t,n),Ns(t)):Ic(Le,n.stateNode));break;case 4:i=Le,r=It,Le=n.stateNode.containerInfo,It=!0,An(t,e,n),Le=i,It=r;break;case 0:case 11:case 14:case 15:if(!De&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&((s&2)!==0||(s&4)!==0)&&af(n,e,o),r=r.next}while(r!==i)}An(t,e,n);break;case 1:if(!De&&(nr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ge(n,e,a)}An(t,e,n);break;case 21:An(t,e,n);break;case 22:n.mode&1?(De=(i=De)||n.memoizedState!==null,An(t,e,n),De=i):An(t,e,n);break;default:An(t,e,n)}}function Hg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Ix),e.forEach(function(i){var r=Vx.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Lt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Le=a.stateNode,It=!1;break e;case 3:Le=a.stateNode.containerInfo,It=!0;break e;case 4:Le=a.stateNode.containerInfo,It=!0;break e}a=a.return}if(Le===null)throw Error(I(160));py(s,o,r),Le=null,It=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){ge(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)my(e,t),e=e.sibling}function my(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Lt(e,t),Gt(t),i&4){try{xs(3,t,t.return),Ol(3,t)}catch(w){ge(t,t.return,w)}try{xs(5,t,t.return)}catch(w){ge(t,t.return,w)}}break;case 1:Lt(e,t),Gt(t),i&512&&n!==null&&nr(n,n.return);break;case 5:if(Lt(e,t),Gt(t),i&512&&n!==null&&nr(n,n.return),t.flags&32){var r=t.stateNode;try{Is(r,"")}catch(w){ge(t,t.return,w)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&D0(r,s),Ou(a,o);var c=Ou(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?j0(r,f):u==="dangerouslySetInnerHTML"?B0(r,f):u==="children"?Is(r,f):eh(r,u,f,c)}switch(a){case"input":Cu(r,s);break;case"textarea":z0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?ar(r,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?ar(r,!!s.multiple,s.defaultValue,!0):ar(r,!!s.multiple,s.multiple?[]:"",!1))}r[Bs]=s}catch(w){ge(t,t.return,w)}}break;case 6:if(Lt(e,t),Gt(t),i&4){if(t.stateNode===null)throw Error(I(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(w){ge(t,t.return,w)}}break;case 3:if(Lt(e,t),Gt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Ns(e.containerInfo)}catch(w){ge(t,t.return,w)}break;case 4:Lt(e,t),Gt(t);break;case 13:Lt(e,t),Gt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Oh=pe())),i&4&&Hg(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(De=(c=De)||u,Lt(e,t),De=c):Lt(e,t),Gt(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&(t.mode&1)!==0)for(z=t,u=t.child;u!==null;){for(f=z=u;z!==null;){switch(h=z,d=h.child,h.tag){case 0:case 11:case 14:case 15:xs(4,h,h.return);break;case 1:nr(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(w){ge(i,n,w)}}break;case 5:nr(h,h.return);break;case 22:if(h.memoizedState!==null){Yg(f);continue}}d!==null?(d.return=h,z=d):Yg(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{r=f.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=V0("display",o))}catch(w){ge(t,t.return,w)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(w){ge(t,t.return,w)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Lt(e,t),Gt(t),i&4&&Hg(t);break;case 21:break;default:Lt(e,t),Gt(t)}}function Gt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(gy(n)){var i=n;break e}n=n.return}throw Error(I(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Is(r,""),i.flags&=-33);var s=Wg(t);uf(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Wg(t);cf(t,a,o);break;default:throw Error(I(161))}}catch(l){ge(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ox(t,e,n){z=t,vy(t)}function vy(t,e,n){for(var i=(t.mode&1)!==0;z!==null;){var r=z,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Ho;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||De;a=Ho;var c=De;if(Ho=o,(De=l)&&!c)for(z=r;z!==null;)o=z,l=o.child,o.tag===22&&o.memoizedState!==null?Zg(r):l!==null?(l.return=o,z=l):Zg(r);for(;s!==null;)z=s,vy(s),s=s.sibling;z=r,Ho=a,De=c}Xg(t)}else(r.subtreeFlags&8772)!==0&&s!==null?(s.return=r,z=s):Xg(t)}}function Xg(t){for(;z!==null;){var e=z;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:De||Ol(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!De)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Mt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Lg(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Lg(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&Ns(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(I(163))}De||e.flags&512&&lf(e)}catch(h){ge(e,e.return,h)}}if(e===t){z=null;break}if(n=e.sibling,n!==null){n.return=e.return,z=n;break}z=e.return}}function Yg(t){for(;z!==null;){var e=z;if(e===t){z=null;break}var n=e.sibling;if(n!==null){n.return=e.return,z=n;break}z=e.return}}function Zg(t){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ol(4,e)}catch(l){ge(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){ge(e,r,l)}}var s=e.return;try{lf(e)}catch(l){ge(e,s,l)}break;case 5:var o=e.return;try{lf(e)}catch(l){ge(e,o,l)}}}catch(l){ge(e,e.return,l)}if(e===t){z=null;break}var a=e.sibling;if(a!==null){a.return=e.return,z=a;break}z=e.return}}var kx=Math.ceil,el=xn.ReactCurrentDispatcher,Ih=xn.ReactCurrentOwner,Et=xn.ReactCurrentBatchConfig,q=0,be=null,ye=null,Ie=0,rt=0,ir=ni(0),xe=0,Xs=null,Pi=0,kl=0,Rh=0,Ts=null,$e=null,Oh=0,xr=1/0,cn=null,tl=!1,ff=null,Yn=null,Xo=!1,Un=null,nl=0,Ss=0,hf=null,wa=-1,Ea=0;function Ge(){return(q&6)!==0?pe():wa!==-1?wa:wa=pe()}function Zn(t){return(t.mode&1)===0?1:(q&2)!==0&&Ie!==0?Ie&-Ie:vx.transition!==null?(Ea===0&&(Ea=ev()),Ea):(t=Q,t!==0||(t=window.event,t=t===void 0?16:av(t.type)),t)}function Ft(t,e,n,i){if(50<Ss)throw Ss=0,hf=null,Error(I(185));ro(t,n,i),((q&2)===0||t!==be)&&(t===be&&((q&2)===0&&(kl|=n),xe===4&&Fn(t,Ie)),Je(t,i),n===1&&q===0&&(e.mode&1)===0&&(xr=pe()+500,Ml&&ii()))}function Je(t,e){var n=t.callbackNode;vE(t,e);var i=Ua(t,t===be?Ie:0);if(i===0)n!==null&&ig(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&ig(n),e===1)t.tag===0?mx($g.bind(null,t)):bv($g.bind(null,t)),hx(function(){(q&6)===0&&ii()}),n=null;else{switch(tv(i)){case 1:n=sh;break;case 4:n=Q0;break;case 16:n=za;break;case 536870912:n=J0;break;default:n=za}n=Py(n,yy.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function yy(t,e){if(wa=-1,Ea=0,(q&6)!==0)throw Error(I(327));var n=t.callbackNode;if(hr()&&t.callbackNode!==n)return null;var i=Ua(t,t===be?Ie:0);if(i===0)return null;if((i&30)!==0||(i&t.expiredLanes)!==0||e)e=il(t,i);else{e=i;var r=q;q|=2;var s=wy();(be!==t||Ie!==e)&&(cn=null,xr=pe()+500,yi(t,e));do try{Dx();break}catch(a){_y(t,a)}while(1);yh(),el.current=s,q=r,ye!==null?e=0:(be=null,Ie=0,e=xe)}if(e!==0){if(e===2&&(r=zu(t),r!==0&&(i=r,e=df(t,r))),e===1)throw n=Xs,yi(t,0),Fn(t,i),Je(t,pe()),n;if(e===6)Fn(t,i);else{if(r=t.current.alternate,(i&30)===0&&!Nx(r)&&(e=il(t,i),e===2&&(s=zu(t),s!==0&&(i=s,e=df(t,s))),e===1))throw n=Xs,yi(t,0),Fn(t,i),Je(t,pe()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(I(345));case 2:hi(t,$e,cn);break;case 3:if(Fn(t,i),(i&130023424)===i&&(e=Oh+500-pe(),10<e)){if(Ua(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ge(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Xu(hi.bind(null,t,$e,cn),e);break}hi(t,$e,cn);break;case 4:if(Fn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Nt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=pe()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*kx(i/1960))-i,10<i){t.timeoutHandle=Xu(hi.bind(null,t,$e,cn),i);break}hi(t,$e,cn);break;case 5:hi(t,$e,cn);break;default:throw Error(I(329))}}}return Je(t,pe()),t.callbackNode===n?yy.bind(null,t):null}function df(t,e){var n=Ts;return t.current.memoizedState.isDehydrated&&(yi(t,e).flags|=256),t=il(t,e),t!==2&&(e=$e,$e=n,e!==null&&gf(e)),t}function gf(t){$e===null?$e=t:$e.push.apply($e,t)}function Nx(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!zt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fn(t,e){for(e&=~Rh,e&=~kl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Nt(e),i=1<<n;t[n]=-1,e&=~i}}function $g(t){if((q&6)!==0)throw Error(I(327));hr();var e=Ua(t,0);if((e&1)===0)return Je(t,pe()),null;var n=il(t,e);if(t.tag!==0&&n===2){var i=zu(t);i!==0&&(e=i,n=df(t,i))}if(n===1)throw n=Xs,yi(t,0),Fn(t,e),Je(t,pe()),n;if(n===6)throw Error(I(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hi(t,$e,cn),Je(t,pe()),null}function kh(t,e){var n=q;q|=1;try{return t(e)}finally{q=n,q===0&&(xr=pe()+500,Ml&&ii())}}function bi(t){Un!==null&&Un.tag===0&&(q&6)===0&&hr();var e=q;q|=1;var n=Et.transition,i=Q;try{if(Et.transition=null,Q=1,t)return t()}finally{Q=i,Et.transition=n,q=e,(q&6)===0&&ii()}}function Nh(){rt=ir.current,se(ir)}function yi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,fx(n)),ye!==null)for(n=ye.return;n!==null;){var i=n;switch(ph(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Wa();break;case 3:wr(),se(qe),se(Ue),Sh();break;case 5:Th(i);break;case 4:wr();break;case 13:se(ce);break;case 19:se(ce);break;case 10:_h(i.type._context);break;case 22:case 23:Nh()}n=n.return}if(be=t,ye=t=$n(t.current,null),Ie=rt=e,xe=0,Xs=null,Rh=kl=Pi=0,$e=Ts=null,pi!==null){for(e=0;e<pi.length;e++)if(n=pi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}pi=null}return t}function _y(t,e){do{var n=ye;try{if(yh(),va.current=Ja,Qa){for(var i=fe.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Qa=!1}if(Si=0,Se=Ee=fe=null,Es=!1,Gs=0,Ih.current=null,n===null||n.return===null){xe=1,Xs=e,ye=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ie,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if((u.mode&1)===0&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=Fg(o);if(d!==null){d.flags&=-257,Dg(d,o,a,s,e),d.mode&1&&Ng(s,c,e),e=d,l=c;var p=e.updateQueue;if(p===null){var w=new Set;w.add(l),e.updateQueue=w}else p.add(l);break e}else{if((e&1)===0){Ng(s,c,e),Fh();break e}l=Error(I(426))}}else if(ae&&a.mode&1){var x=Fg(o);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),Dg(x,o,a,s,e),mh(Er(l,a));break e}}s=l=Er(l,a),xe!==4&&(xe=2),Ts===null?Ts=[s]:Ts.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=ny(s,l,e);Cg(s,y);break e;case 1:a=l;var m=s.type,_=s.stateNode;if((s.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Yn===null||!Yn.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=iy(s,a,e);Cg(s,T);break e}}s=s.return}while(s!==null)}xy(n)}catch(P){e=P,ye===n&&n!==null&&(ye=n=n.return);continue}break}while(1)}function wy(){var t=el.current;return el.current=Ja,t===null?Ja:t}function Fh(){(xe===0||xe===3||xe===2)&&(xe=4),be===null||(Pi&268435455)===0&&(kl&268435455)===0||Fn(be,Ie)}function il(t,e){var n=q;q|=2;var i=wy();(be!==t||Ie!==e)&&(cn=null,yi(t,e));do try{Fx();break}catch(r){_y(t,r)}while(1);if(yh(),q=n,el.current=i,ye!==null)throw Error(I(261));return be=null,Ie=0,xe}function Fx(){for(;ye!==null;)Ey(ye)}function Dx(){for(;ye!==null&&!lE();)Ey(ye)}function Ey(t){var e=Sy(t.alternate,t,rt);t.memoizedProps=t.pendingProps,e===null?xy(t):ye=e,Ih.current=null}function xy(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&32768)===0){if(n=Lx(n,e,rt),n!==null){ye=n;return}}else{if(n=Mx(n,e),n!==null){n.flags&=32767,ye=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xe=6,ye=null;return}}if(e=e.sibling,e!==null){ye=e;return}ye=e=t}while(e!==null);xe===0&&(xe=5)}function hi(t,e,n){var i=Q,r=Et.transition;try{Et.transition=null,Q=1,zx(t,e,n,i)}finally{Et.transition=r,Q=i}return null}function zx(t,e,n,i){do hr();while(Un!==null);if((q&6)!==0)throw Error(I(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(I(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(yE(t,s),t===be&&(ye=be=null,Ie=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Xo||(Xo=!0,Py(za,function(){return hr(),null})),s=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||s){s=Et.transition,Et.transition=null;var o=Q;Q=1;var a=q;q|=4,Ih.current=null,Rx(t,n),my(n,t),rx(Wu),Ba=!!Gu,Wu=Gu=null,t.current=n,Ox(n),cE(),q=a,Q=o,Et.transition=s}else t.current=n;if(Xo&&(Xo=!1,Un=t,nl=r),s=t.pendingLanes,s===0&&(Yn=null),hE(n.stateNode),Je(t,pe()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(tl)throw tl=!1,t=ff,ff=null,t;return(nl&1)!==0&&t.tag!==0&&hr(),s=t.pendingLanes,(s&1)!==0?t===hf?Ss++:(Ss=0,hf=t):Ss=0,ii(),null}function hr(){if(Un!==null){var t=tv(nl),e=Et.transition,n=Q;try{if(Et.transition=null,Q=16>t?16:t,Un===null)var i=!1;else{if(t=Un,Un=null,nl=0,(q&6)!==0)throw Error(I(331));var r=q;for(q|=4,z=t.current;z!==null;){var s=z,o=s.child;if((z.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(z=c;z!==null;){var u=z;switch(u.tag){case 0:case 11:case 15:xs(8,u,s)}var f=u.child;if(f!==null)f.return=u,z=f;else for(;z!==null;){u=z;var h=u.sibling,d=u.return;if(dy(u),u===c){z=null;break}if(h!==null){h.return=d,z=h;break}z=d}}}var p=s.alternate;if(p!==null){var w=p.child;if(w!==null){p.child=null;do{var x=w.sibling;w.sibling=null,w=x}while(w!==null)}}z=s}}if((s.subtreeFlags&2064)!==0&&o!==null)o.return=s,z=o;else e:for(;z!==null;){if(s=z,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:xs(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,z=y;break e}z=s.return}}var m=t.current;for(z=m;z!==null;){o=z;var _=o.child;if((o.subtreeFlags&2064)!==0&&_!==null)_.return=o,z=_;else e:for(o=m;z!==null;){if(a=z,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Ol(9,a)}}catch(P){ge(a,a.return,P)}if(a===o){z=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,z=T;break e}z=a.return}}if(q=r,ii(),qt&&typeof qt.onPostCommitFiberRoot=="function")try{qt.onPostCommitFiberRoot(Pl,t)}catch{}i=!0}return i}finally{Q=n,Et.transition=e}}return!1}function Kg(t,e,n){e=Er(n,e),e=ny(t,e,1),t=Xn(t,e,1),e=Ge(),t!==null&&(ro(t,1,e),Je(t,e))}function ge(t,e,n){if(t.tag===3)Kg(t,t,n);else for(;e!==null;){if(e.tag===3){Kg(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Yn===null||!Yn.has(i))){t=Er(n,t),t=iy(e,t,1),e=Xn(e,t,1),t=Ge(),e!==null&&(ro(e,1,t),Je(e,t));break}}e=e.return}}function Ux(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,be===t&&(Ie&n)===n&&(xe===4||xe===3&&(Ie&130023424)===Ie&&500>pe()-Oh?yi(t,0):Rh|=n),Je(t,e)}function Ty(t,e){e===0&&((t.mode&1)===0?e=1:(e=Fo,Fo<<=1,(Fo&130023424)===0&&(Fo=4194304)));var n=Ge();t=vn(t,e),t!==null&&(ro(t,e,n),Je(t,n))}function Bx(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ty(t,n)}function Vx(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(I(314))}i!==null&&i.delete(e),Ty(t,n)}var Sy;Sy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qe.current)Ke=!0;else{if((t.lanes&n)===0&&(e.flags&128)===0)return Ke=!1,Cx(t,e,n);Ke=(t.flags&131072)!==0}else Ke=!1,ae&&(e.flags&1048576)!==0&&Av(e,Ya,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;_a(t,e),t=e.pendingProps;var r=vr(e,Ue.current);fr(e,n),r=bh(null,e,i,t,r,n);var s=Ah();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(i)?(s=!0,Ha(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Eh(e),r.updater=Il,e.stateNode=r,r._reactInternals=e,Ju(e,i,t,n),e=nf(null,e,i,!0,s,n)):(e.tag=0,ae&&s&&gh(e),Ve(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(_a(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Gx(i),t=Mt(i,t),r){case 0:e=tf(null,e,i,t,n);break e;case 1:e=Bg(null,e,i,t,n);break e;case 11:e=zg(null,e,i,t,n);break e;case 14:e=Ug(null,e,i,Mt(i.type,t),n);break e}throw Error(I(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),tf(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),Bg(t,e,i,r,n);case 3:e:{if(ay(e),t===null)throw Error(I(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Iv(t,e),Ka(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Er(Error(I(423)),e),e=Vg(t,e,i,n,r);break e}else if(i!==r){r=Er(Error(I(424)),e),e=Vg(t,e,i,n,r);break e}else for(at=Hn(e.stateNode.containerInfo.firstChild),ct=e,ae=!0,Rt=null,n=Nv(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yr(),i===r){e=yn(t,e,n);break e}Ve(t,e,i,n)}e=e.child}return e;case 5:return Fv(e),t===null&&Ku(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Hu(i,r)?o=null:s!==null&&Hu(i,s)&&(e.flags|=32),oy(t,e),Ve(t,e,o,n),e.child;case 6:return t===null&&Ku(e),null;case 13:return ly(t,e,n);case 4:return xh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=_r(e,null,i,n):Ve(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),zg(t,e,i,r,n);case 7:return Ve(t,e,e.pendingProps,n),e.child;case 8:return Ve(t,e,e.pendingProps.children,n),e.child;case 12:return Ve(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ne(Za,i._currentValue),i._currentValue=o,s!==null)if(zt(s.value,o)){if(s.children===r.children&&!qe.current){e=yn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=gn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),qu(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(I(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),qu(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ve(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,fr(e,n),r=Tt(r),i=i(r),e.flags|=1,Ve(t,e,i,n),e.child;case 14:return i=e.type,r=Mt(i,e.pendingProps),r=Mt(i.type,r),Ug(t,e,i,r,n);case 15:return ry(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),_a(t,e),e.tag=1,Qe(i)?(t=!0,Ha(e)):t=!1,fr(e,n),Ov(e,i,r),Ju(e,i,r,n),nf(null,e,i,!0,t,n);case 19:return cy(t,e,n);case 22:return sy(t,e,n)}throw Error(I(156,e.tag))};function Py(t,e){return q0(t,e)}function jx(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,n,i){return new jx(t,e,n,i)}function Dh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Gx(t){if(typeof t=="function")return Dh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===nh)return 11;if(t===ih)return 14}return 2}function $n(t,e){var n=t.alternate;return n===null?(n=wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function xa(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Dh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Yi:return _i(n.children,r,s,e);case th:o=8,r|=8;break;case Tu:return t=wt(12,n,e,r|2),t.elementType=Tu,t.lanes=s,t;case Su:return t=wt(13,n,e,r),t.elementType=Su,t.lanes=s,t;case Pu:return t=wt(19,n,e,r),t.elementType=Pu,t.lanes=s,t;case k0:return Nl(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case R0:o=10;break e;case O0:o=9;break e;case nh:o=11;break e;case ih:o=14;break e;case On:o=16,i=null;break e}throw Error(I(130,t==null?t:typeof t,""))}return e=wt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function _i(t,e,n,i){return t=wt(7,t,i,e),t.lanes=n,t}function Nl(t,e,n,i){return t=wt(22,t,i,e),t.elementType=k0,t.lanes=n,t.stateNode={isHidden:!1},t}function Uc(t,e,n){return t=wt(6,t,null,e),t.lanes=n,t}function Bc(t,e,n){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Wx(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wc(0),this.expirationTimes=wc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wc(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zh(t,e,n,i,r,s,o,a,l){return t=new Wx(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Eh(s),t}function Hx(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function by(t){if(!t)return Qn;t=t._reactInternals;e:{if(Ri(t)!==t||t.tag!==1)throw Error(I(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(I(171))}if(t.tag===1){var n=t.type;if(Qe(n))return Pv(t,n,e)}return e}function Ay(t,e,n,i,r,s,o,a,l){return t=zh(n,i,!0,t,r,s,o,a,l),t.context=by(null),n=t.current,i=Ge(),r=Zn(n),s=gn(i,r),s.callback=e!=null?e:null,Xn(n,s,r),t.current.lanes=r,ro(t,r,i),Je(t,i),t}function Fl(t,e,n,i){var r=e.current,s=Ge(),o=Zn(r);return n=by(n),e.context===null?e.context=n:e.pendingContext=n,e=gn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Xn(r,e,o),t!==null&&(Ft(t,r,o,s),ma(t,r,o)),o}function rl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function qg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Uh(t,e){qg(t,e),(t=t.alternate)&&qg(t,e)}function Xx(){return null}var Cy=typeof reportError=="function"?reportError:function(t){console.error(t)};function Bh(t){this._internalRoot=t}Dl.prototype.render=Bh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(I(409));Fl(t,e,null,null)};Dl.prototype.unmount=Bh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bi(function(){Fl(null,t,null,null)}),e[mn]=null}};function Dl(t){this._internalRoot=t}Dl.prototype.unstable_scheduleHydration=function(t){if(t){var e=rv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Nn.length&&e!==0&&e<Nn[n].priority;n++);Nn.splice(n,0,t),n===0&&ov(t)}};function Vh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function zl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Qg(){}function Yx(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=rl(o);s.call(c)}}var o=Ay(e,i,t,0,null,!1,!1,"",Qg);return t._reactRootContainer=o,t[mn]=o.current,zs(t.nodeType===8?t.parentNode:t),bi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=rl(l);a.call(c)}}var l=zh(t,0,!1,null,null,!1,!1,"",Qg);return t._reactRootContainer=l,t[mn]=l.current,zs(t.nodeType===8?t.parentNode:t),bi(function(){Fl(e,l,n,i)}),l}function Ul(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=rl(o);a.call(l)}}Fl(e,o,t,r)}else o=Yx(n,e,t,r,i);return rl(o)}nv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=fs(e.pendingLanes);n!==0&&(oh(e,n|1),Je(e,pe()),(q&6)===0&&(xr=pe()+500,ii()))}break;case 13:bi(function(){var i=vn(t,1);if(i!==null){var r=Ge();Ft(i,t,1,r)}}),Uh(t,1)}};ah=function(t){if(t.tag===13){var e=vn(t,134217728);if(e!==null){var n=Ge();Ft(e,t,134217728,n)}Uh(t,134217728)}};iv=function(t){if(t.tag===13){var e=Zn(t),n=vn(t,e);if(n!==null){var i=Ge();Ft(n,t,e,i)}Uh(t,e)}};rv=function(){return Q};sv=function(t,e){var n=Q;try{return Q=t,e()}finally{Q=n}};Nu=function(t,e,n){switch(e){case"input":if(Cu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ll(i);if(!r)throw Error(I(90));F0(i),Cu(i,r)}}}break;case"textarea":z0(t,n);break;case"select":e=n.value,e!=null&&ar(t,!!n.multiple,e,!1)}};H0=kh;X0=bi;var Zx={usingClientEntryPoint:!1,Events:[oo,qi,Ll,G0,W0,kh]},ts={findFiberByHostInstance:gi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},$x={bundleType:ts.bundleType,version:ts.version,rendererPackageName:ts.rendererPackageName,rendererConfig:ts.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$0(t),t===null?null:t.stateNode},findFiberByHostInstance:ts.findFiberByHostInstance||Xx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yo.isDisabled&&Yo.supportsFiber)try{Pl=Yo.inject($x),qt=Yo}catch{}}dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zx;dt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vh(e))throw Error(I(200));return Hx(t,e,null,n)};dt.createRoot=function(t,e){if(!Vh(t))throw Error(I(299));var n=!1,i="",r=Cy;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=zh(t,1,!1,null,null,n,!1,i,r),t[mn]=e.current,zs(t.nodeType===8?t.parentNode:t),new Bh(e)};dt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(I(188)):(t=Object.keys(t).join(","),Error(I(268,t)));return t=$0(e),t=t===null?null:t.stateNode,t};dt.flushSync=function(t){return bi(t)};dt.hydrate=function(t,e,n){if(!zl(e))throw Error(I(200));return Ul(null,t,e,!0,n)};dt.hydrateRoot=function(t,e,n){if(!Vh(t))throw Error(I(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Cy;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ay(e,null,t,1,n!=null?n:null,r,!1,s,o),t[mn]=e.current,zs(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Dl(e)};dt.render=function(t,e,n){if(!zl(e))throw Error(I(200));return Ul(null,t,e,!1,n)};dt.unmountComponentAtNode=function(t){if(!zl(t))throw Error(I(40));return t._reactRootContainer?(bi(function(){Ul(null,null,t,!1,function(){t._reactRootContainer=null,t[mn]=null})}),!0):!1};dt.unstable_batchedUpdates=kh;dt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!zl(n))throw Error(I(200));if(t==null||t._reactInternals===void 0)throw Error(I(38));return Ul(t,e,n,!1,i)};dt.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=dt})(Sl);var Jg=Sl.exports;Eu.createRoot=Jg.createRoot,Eu.hydrateRoot=Jg.hydrateRoot;const Kx="modulepreload",qx=function(t){return"/"+t},ep={},Qx=function(e,n,i){return!n||n.length===0?e():Promise.all(n.map(r=>{if(r=qx(r),r in ep)return;ep[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":Kx,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())};var jh={exports:{}},Bl={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx=k.exports,eT=Symbol.for("react.element"),tT=Symbol.for("react.fragment"),nT=Object.prototype.hasOwnProperty,iT=Jx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rT={key:!0,ref:!0,__self:!0,__source:!0};function Ly(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)nT.call(e,i)&&!rT.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:eT,type:t,key:s,ref:o,props:r,_owner:iT.current}}Bl.Fragment=tT;Bl.jsx=Ly;Bl.jsxs=Ly;(function(t){t.exports=Bl})(jh);const sT=jh.exports.Fragment,Jn=jh.exports.jsx,oT=k.exports.createContext(null);function aT(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function tp(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function np(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const lT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ip(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let s=null;if("interactive"in i&&(s={...i},delete s.interactive),r){s=s||{...i},delete s.ref;for(const o of lT)o in r&&(s[o]=r[o])}return s||i});return{...t,layers:n}}function cT(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function Dn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Dn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!Dn(t[r],e[r]))return!1;return!0}return!1}const rp={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Vc={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},sp={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},uT=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],fT=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Tr{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[sp[r.type]];s&&s(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[rp[r.type]];if(s){if(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"){const o=this._hoveredFeatures||this._map.queryRenderedFeatures(r.point,{layers:this.props.interactiveLayerIds});r.features=o}s(r),delete r.features}},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[Vc[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Tr.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n,i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:o}=e;return o&&(o.bounds?r.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):i._updateViewState(o,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||hT()||null,container:e,style:ip(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,n.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),this._createShadowTransform(s);const o=s._render;s._render=c=>{this._inRender=!0,o.call(s,c),this._inRender=!1};const a=s._renderTaskQueue.run;s._renderTaskQueue.run=c=>{a.call(s._renderTaskQueue,c),this._onBeforeRepaint()},s.on("render",()=>this._onAfterRepaint());const l=s.fire;s.fire=this._fireEvent.bind(this,l),s.on("resize",()=>{this._renderTransform.resize(s.transform.width,s.transform.height)}),s.on("styledata",()=>this._updateStyleComponents(this.props,{})),s.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const c in rp)s.on(c,this._onPointerEvent);for(const c in Vc)s.on(c,this._onCameraEvent);for(const c in sp)s.on(c,this._onEvent);this._map=s}recycle(){Tr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=aT(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,l=i.isMoving();l&&(r.cameraElevationReference="sea");const c=np(r,{...tp(i.transform),...e});if(l&&(r.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==r.zoom),u.rotate||(u.rotate=a!==r.bearing),u.pitch||(u.pitch=o!==r.pitch)}return l||np(i.transform,e),c}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of uT)s in e&&!Dn(e[s],n[s])&&(r=!0,i[`set${s[0].toUpperCase()}${s.slice(1)}`](e[s]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(ip(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!Dn(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!Dn(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!Dn(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const s of fT){const o=e[s];Dn(o,n[s])||(r=!0,o?i[s].enable(o):i[s].disable())}return r}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let a;if(s==="mousemove")try{a=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{a=[]}else a=[];const l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Vc&&(typeof n=="object"&&(n.viewState=tp(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}Tr.savedMaps=[];function hT(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||process.env.MapboxAccessToken}catch{}try{t=t||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const dT=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function gT(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,s)=>{const o=n.transform;n.transform=t.transform;const a=n.queryTerrainElevation(r,s);return n.transform=o,a}};for(const r of pT(n))!(r in i)&&!dT.includes(r)&&(i[r]=n[r].bind(n));return i}function pT(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const mT=typeof document<"u"?k.exports.useLayoutEffect:k.exports.useEffect,vT=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function yT(t,e){for(const n of vT)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Vl=k.exports.createContext(null),_T={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Gh=k.exports.forwardRef((t,e)=>{const n=k.exports.useContext(oT),[i,r]=k.exports.useState(null),s=k.exports.useRef(),{current:o}=k.exports.useRef({mapLib:null,map:null});k.exports.useEffect(()=>{const l=t.mapLib;let c=!0,u;return Promise.resolve(l||Qx(()=>import("./mapbox-gl.0af286d8.js").then(f=>f.m),[])).then(f=>{if(!!c){if(f.Map||(f=f.default),!f||!f.Map)throw new Error("Invalid mapLib");if(f.supported(t))yT(f,t),t.reuseMaps&&(u=Tr.reuse(t,s.current)),u||(u=new Tr(f.Map,t,s.current)),o.map=gT(u,f),o.mapLib=f,r(u),n==null||n.onMapMount(o.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(f=>{t.onError({type:"error",target:null,originalEvent:null,error:f})}),()=>{c=!1,u&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?u.recycle():u.destroy())}},[]),mT(()=>{i&&i.setProps(t)}),k.exports.useImperativeHandle(e,()=>o.map,[i]);const a=k.exports.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return Jn("div",{id:t.id,ref:s,style:a,children:i&&Jn(Vl.Provider,{value:o,children:t.children})})});Gh.displayName="Map";Gh.defaultProps=_T;const wT=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Oi(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!wT.test(i)?n[i]=`${r}px`:n[i]=r}}const ET={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function My(t){const{map:e,mapLib:n}=k.exports.useContext(Vl),i=k.exports.useRef({props:t});i.current.props=t;const r=k.exports.useMemo(()=>{let s=!1;k.exports.Children.forEach(t.children,l=>{l&&(s=!0)});const o={...t,element:s?document.createElement("div"):null},a=new n.Marker(o).setLngLat([t.longitude,t.latitude]);return a.getElement().addEventListener("click",l=>{var c,u;(u=(c=i.current.props).onClick)===null||u===void 0||u.call(c,{type:"click",target:a,originalEvent:l})}),a.on("dragstart",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDragStart)===null||u===void 0||u.call(c,f)}),a.on("drag",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDrag)===null||u===void 0||u.call(c,f)}),a.on("dragend",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDragEnd)===null||u===void 0||u.call(c,f)}),a},[]);return k.exports.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),k.exports.useEffect(()=>{Oi(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!cT(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),Sl.exports.createPortal(t.children,r.getElement())}My.defaultProps=ET;k.exports.memo(My);function op(t){return new Set(t?t.trim().split(/\s+/):[])}function xT(t){const{map:e,mapLib:n}=k.exports.useContext(Vl),i=k.exports.useMemo(()=>document.createElement("div"),[]),r=k.exports.useRef({props:t});r.current.props=t;const s=k.exports.useMemo(()=>{const o={...t},a=new n.Popup(o).setLngLat([t.longitude,t.latitude]);return a.once("open",l=>{var c,u;(u=(c=r.current.props).onOpen)===null||u===void 0||u.call(c,l)}),a},[]);if(k.exports.useEffect(()=>{const o=a=>{var l,c;(c=(l=r.current.props).onClose)===null||c===void 0||c.call(l,a)};return s.on("close",o),s.setDOMContent(i).addTo(e.getMap()),()=>{s.off("close",o),s.isOpen()&&s.remove()}},[]),k.exports.useEffect(()=>{Oi(s.getElement(),t.style)},[t.style]),s.isOpen()&&((s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!Dn(s.options.offset,t.offset)&&s.setOffset(t.offset),(s.options.anchor!==t.anchor||s.options.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth)),s.options.className!==t.className)){const o=op(s.options.className),a=op(t.className);for(const l of o)a.has(l)||s.removeClassName(l);for(const l of a)o.has(l)||s.addClassName(l);s.options.className=t.className}return Sl.exports.createPortal(t.children,i)}k.exports.memo(xT);function lo(t,e,n,i){const r=k.exports.useContext(Vl),s=k.exports.useMemo(()=>t(r),[]);return k.exports.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=r;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{l&&l(r),c.hasControl(s)&&c.removeControl(s)}},[]),s}function TT(t){const e=lo(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return k.exports.useEffect(()=>{Oi(e._container,t.style)},[t.style]),null}k.exports.memo(TT);function ST(t){const e=lo(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return k.exports.useEffect(()=>{Oi(e._controlContainer,t.style)},[t.style]),null}k.exports.memo(ST);const Iy=k.exports.forwardRef((t,e)=>{const n=k.exports.useRef({props:t}),i=lo(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,k.exports.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),k.exports.useEffect(()=>{Oi(i._container,t.style)},[t.style]),null});Iy.displayName="GeolocateControl";k.exports.memo(Iy);function PT(t){const e=lo(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return k.exports.useEffect(()=>{Oi(e._container,t.style)},[t.style]),null}k.exports.memo(PT);const bT={unit:"metric",maxWidth:100};function Ry(t){const e=lo(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),k.exports.useEffect(()=>{Oi(e._container,t.style)},[t.style]),null}Ry.defaultProps=bT;k.exports.memo(Ry);function sl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Wh=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),ap=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ap&&parseFloat(ap[1]);const AT="3.2.9";function _n(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ta=typeof process!="object"||String(process)!=="[object process]"||process.browser,CT=typeof window<"u"&&typeof window.orientation<"u",lp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);lp&&parseFloat(lp[1]);function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class LT{constructor(e,n){g(this,"name",void 0),g(this,"workerThread",void 0),g(this,"isRunning",!0),g(this,"result",void 0),g(this,"_resolve",()=>{}),g(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){_n(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){_n(this.isRunning),this.isRunning=!1,this._reject(e)}}class jc{}const Gc=new Map;function MT(t){_n(t.source&&!t.url||!t.source&&t.url);let e=Gc.get(t.source||t.url);return e||(t.url&&(e=IT(t.url),Gc.set(t.url,e)),t.source&&(e=Oy(t.source),Gc.set(t.source,e))),_n(e),e}function IT(t){if(!t.startsWith("http"))return t;const e=RT(t);return Oy(e)}function Oy(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function RT(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function ky(t,e=!0,n){const i=n||new Set;if(t){if(cp(t))i.add(t);else if(cp(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)ky(t[r],e,i)}}return n===void 0?Array.from(i):[]}function cp(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Wc=()=>{};class pf{static isSupported(){return typeof Worker<"u"&&Ta||typeof jc<"u"&&!Ta}constructor(e){g(this,"name",void 0),g(this,"source",void 0),g(this,"url",void 0),g(this,"terminated",!1),g(this,"worker",void 0),g(this,"onMessage",void 0),g(this,"onError",void 0),g(this,"_loadableURL","");const{name:n,source:i,url:r}=e;_n(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Wc,this.onError=s=>console.log(s),this.worker=Ta?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Wc,this.onError=Wc,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||ky(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=MT({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new jc(i,{eval:!1})}else if(this.source)e=new jc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class OT{static isSupported(){return pf.isSupported()}constructor(e){g(this,"name","unnamed"),g(this,"source",void 0),g(this,"url",void 0),g(this,"maxConcurrency",1),g(this,"maxMobileConcurrency",1),g(this,"onDebug",()=>{}),g(this,"reuseWorkers",!0),g(this,"props",{}),g(this,"jobQueue",[]),g(this,"idleQueue",[]),g(this,"count",0),g(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new LT(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new pf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return CT?this.maxMobileConcurrency:this.maxConcurrency}}const kT={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class fn{static isSupported(){return pf.isSupported()}static getWorkerFarm(e={}){return fn._workerFarm=fn._workerFarm||new fn({}),fn._workerFarm.setProps(e),fn._workerFarm}constructor(e){g(this,"props",void 0),g(this,"workerPools",new Map),this.props={...kT},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new OT({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}g(fn,"_workerFarm",void 0);const NT="latest";function FT(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=NT);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return _n(r),r}function DT(t,e=AT){_n(t,"no worker provided");const n=t.version;return!(!e||!n)}function zT(t,e){return!fn.isSupported()||!Ta&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function UT(t,e,n,i,r){const s=t.id,o=FT(t,n),l=fn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",BT.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function BT(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Ny(t){return t&&typeof t=="object"&&t.isBuffer}function VT(t){return Ny(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function Fy(t){if(Ny(t))return VT(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function jT(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function GT(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function WT(t){const e=[];for await(const n of t)e.push(n);return GT(...e)}function up(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class fp{constructor(e,n){g(this,"name",void 0),g(this,"type",void 0),g(this,"sampleSize",1),g(this,"time",void 0),g(this,"count",void 0),g(this,"samples",void 0),g(this,"lastTiming",void 0),g(this,"lastSampleTime",void 0),g(this,"lastSampleCount",void 0),g(this,"_count",0),g(this,"_time",0),g(this,"_samples",0),g(this,"_startTime",0),g(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=up(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(up()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hh{constructor(e){g(this,"id",void 0),g(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof fp?this.stats[n]=e:this.stats[n]=new fp(n,i)),this.stats[n]}}let HT="";const hp={};function XT(t){for(const e in hp)if(t.startsWith(e)){const n=hp[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(HT).concat(t)),t}function YT(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const ZT=t=>typeof t=="boolean",Ps=t=>typeof t=="function",co=t=>t!==null&&typeof t=="object",dp=t=>co(t)&&t.constructor==={}.constructor,$T=t=>t&&typeof t[Symbol.iterator]=="function",KT=t=>t&&typeof t[Symbol.asyncIterator]=="function",Fr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Dr=t=>typeof Blob<"u"&&t instanceof Blob,qT=t=>t&&typeof t=="object"&&t.isBuffer,QT=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||co(t)&&Ps(t.tee)&&Ps(t.cancel)&&Ps(t.getReader),JT=t=>co(t)&&Ps(t.read)&&Ps(t.pipe)&&ZT(t.readable),Dy=t=>QT(t)||JT(t),eS=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,tS=/^([-\w.]+\/[-\w.+]+)/;function nS(t){const e=tS.exec(t);return e?e[1]:t}function gp(t){const e=eS.exec(t);return e?e[1]:""}const iS=/\?.*/;function jl(t){if(Fr(t)){const e=Hc(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:nS(n)||gp(e)}}return Dr(t)?{url:Hc(t.name||""),type:t.type||""}:typeof t=="string"?{url:Hc(t),type:gp(t)}:{url:"",type:""}}function rS(t){return Fr(t)?t.headers["content-length"]||-1:Dr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Hc(t){return t.replace(iS,"")}async function zy(t){if(Fr(t))return t;const e={},n=rS(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=jl(t);r&&(e["content-type"]=r);const s=await aS(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function sS(t){if(!t.ok){const e=await oS(t);throw new Error(e)}}async function oS(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function aS(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=lS(n);return"data:base64,".concat(i)}return null}function lS(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function pp(t,e){if(typeof t=="string"){t=XT(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await zy(t)}function Uy(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Tn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Uy()}const Sa={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Zo=Sa.window||Sa.self||Sa.global,ns=Sa.process||{},By=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Tn();const Xc=globalThis;function Vy(t){if(!t&&!Tn())return"Node";if(Uy(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":Xc.chrome?"Chrome":Xc.safari?"Safari":Xc.mozInnerScreenX?"Firefox":"Unknown"}function cS(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class uS{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";g(this,"storage",void 0),g(this,"id",void 0),g(this,"config",{}),this.storage=cS(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function fS(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function hS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Yc(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let ol;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ol||(ol={}));function mp(t){return typeof t=="string"?ol[t.toUpperCase()]||ol.WHITE:t}function dS(t,e,n){return!Tn&&typeof t=="string"&&(e&&(e=mp(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=mp(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function gS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function al(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ui(){let t;if(Tn&&"performance"in Zo){var e,n;t=Zo==null||(e=Zo.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ns){var i;const r=ns==null||(i=ns.hrtime)===null||i===void 0?void 0:i.call(ns);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Bi={debug:Tn&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},pS={enabled:!0,level:0};function vt(){}const vp={},yp={once:!0};class uo{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};g(this,"id",void 0),g(this,"VERSION",By),g(this,"_startTs",Ui()),g(this,"_deltaTs",Ui()),g(this,"_storage",void 0),g(this,"userData",{}),g(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new uS("__probe-".concat(this.id,"__"),pS),this.userData={},this.timeStamp("".concat(this.id," started")),gS(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ui()-this._startTs).toPrecision(10))}getDelta(){return Number((Ui()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){al(e,n)}warn(e){return this._getLogFunction(0,e,Bi.warn,arguments,yp)}error(e){return this._getLogFunction(0,e,Bi.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Bi.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Bi.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,Bi.debug||Bi.info,arguments,yp)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||vt,i&&[i],{tag:_S(n)}):vt}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?Tn?yS({image:r,message:s,scale:o}):vS({image:r,message:s,scale:o}):vt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||vt)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=_p({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||vt)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=jy(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=_p({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,al(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ui();const o=s.tag||s.message;if(s.once)if(!vp[o])vp[o]=Ui();else return vt;return n=mS(this.id,s.message,s),i.bind(console,n,...s.args)}return vt}}g(uo,"VERSION",By);function jy(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return al(Number.isFinite(e)&&e>=0),e}function _p(t){const{logLevel:e,message:n}=t;t.logLevel=jy(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return al(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function mS(t,e,n){if(typeof e=="string"){const i=n.time?hS(fS(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=dS(e,n.color,n.background)}return e}function vS(t){let{image:e,message:n="",scale:i=1}=t;return(void 0)({image:e,message:n,scale:i}),vt}function yS(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Yc(s,n,i);console.log(...o)},s.src=e,vt}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Yc(e,n,i)),vt;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Yc(s,n,i)),s.src=e.toDataURL(),vt}return vt}function _S(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const wp=new uo({id:"loaders.gl"});class wS{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ES{constructor(){g(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Gy={fetch:null,mimeType:void 0,nothrow:!1,log:new ES,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Wh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},xS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Wy(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Hy=()=>{const t=Wy();return t.globalOptions=t.globalOptions||{...Gy},t.globalOptions};function TS(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],SS(t,n),bS(e,t,i)}function Xy(t,e){const n=Hy(),i=t||n;return typeof i.fetch=="function"?i.fetch:co(i.fetch)?r=>pp(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:pp}function SS(t,e){Ep(t,null,Gy,xS,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ep(i,n.id,r,s,e)}}function Ep(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&co(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)wp.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const f=PS(a,r);wp.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function PS(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function bS(t,e,n){const r={...t.options||{}};return AS(r,n),r.log===null&&(r.log=new wS),xp(r,Hy()),xp(r,e),r}function xp(t,e){for(const n in e)if(n in e){const i=e[n];dp(i)&&dp(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function AS(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Xh(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Yh(t){var e,n;sl(t,"null loader"),sl(Xh(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Yy=()=>{const t=Wy();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function CS(t){const e=Yy();t=Array.isArray(t)?t:[t];for(const n of t){const i=Yh(n);e.find(r=>i===r)||e.unshift(i)}}function LS(){return Yy()}const MS=new uo({id:"loaders.gl"}),IS=/\.([^.]+)$/;async function RS(t,e=[],n,i){if(!Zy(t))return null;let r=Tp(t,e,{...n,nothrow:!0},i);if(r)return r;if(Dr(t)&&(t=await t.slice(0,10).arrayBuffer(),r=Tp(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error($y(t));return r}function Tp(t,e=[],n,i){if(!Zy(t))return null;if(e&&!Array.isArray(e))return Yh(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...LS()),kS(r);const s=OS(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error($y(t));return s}function OS(t,e,n,i){const{url:r,type:s}=jl(t),o=r||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Zc(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||NS(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Zc(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||DS(e,t),l=l||(a?"matched initial data ".concat(Ky(t)):""),a=a||Zc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;MS.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function Zy(t){return!(t instanceof Response&&t.status===204)}function $y(t){const{url:e,type:n}=jl(t);let i="No valid loader found (";i+=e?"".concat(YT(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Ky(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function kS(t){for(const e of t)Yh(e)}function NS(t,e){const n=e&&IS.exec(e),i=n&&n[1];return i?FS(t,i):null}function FS(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Zc(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function DS(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(zS(e,n))return n}else if(ArrayBuffer.isView(e)){if(Sp(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Sp(e,0,n))return n;return null}function zS(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Sp(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>US(t,e,n,r))}function US(t,e,n,i){if(i instanceof ArrayBuffer)return jT(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=mf(t,e,i.length);return i===r;default:return!1}}function Ky(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?mf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?mf(t,0,e):""}function mf(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const BS=256*1024;function*VS(t,e){const n=(e==null?void 0:e.chunkSize)||BS;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const jS=256*1024;function*GS(t,e={}){const{chunkSize:n=jS}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const WS=1024*1024;async function*HS(t,e){const n=(e==null?void 0:e.chunkSize)||WS;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function Pp(t,e){return Wh?XS(t,e):YS(t)}async function*XS(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield Fy(o)}}catch{n.releaseLock()}}async function*YS(t,e){for await(const n of t)yield Fy(n)}function ZS(t,e){if(typeof t=="string")return VS(t,e);if(t instanceof ArrayBuffer)return GS(t,e);if(Dr(t))return HS(t,e);if(Dy(t))return Pp(t,e);if(Fr(t))return Pp(t.body,e);throw new Error("makeIterator")}const qy="Cannot convert supplied data type";function $S(t,e,n){if(e.text&&typeof t=="string")return t;if(qT(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(qy)}async function KS(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return $S(t,e);if(Dr(t)&&(t=await zy(t)),Fr(t)){const r=t;return await sS(r),e.binary?await r.arrayBuffer():await r.text()}if(Dy(t)&&(t=ZS(t,n)),$T(t)||KT(t))return WT(t);throw new Error(qy)}function qS(t,e,n=null){if(n)return n;const i={fetch:Xy(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function QS(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Zh(t,e,n,i){_n(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Xh(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=jl(t),o=QS(e,i),a=await RS(t,o,n);return a?(n=TS(n,a,o,r),i=qS({url:r,parse:Zh,loaders:o},n,i),await JS(a,t,n,i)):null}async function JS(t,e,n,i){if(DT(t),Fr(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=r,f=Object.fromEntries(r.headers.entries());i.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await KS(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(zT(t,n))return await UT(t,e,n,i,Zh);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw _n(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function ll(t,e,n,i){!Array.isArray(e)&&!Xh(e)&&(n=e,e=void 0);const r=Xy(n);let s=t;return typeof t=="string"&&(s=await r(t)),Dr(t)&&(s=await r(t)),await Zh(s,e,n)}const eP="3.2.9",{_parseImageNode:tP}=globalThis,vf=typeof Image<"u",yf=typeof ImageBitmap<"u",nP=Boolean(tP),_f=Wh?!0:nP;function iP(t){switch(t){case"auto":return yf||vf||_f;case"imagebitmap":return yf;case"image":return vf;case"data":return _f;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function rP(){if(yf)return"imagebitmap";if(vf)return"image";if(_f)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function sP(t){const e=aP(t);if(!e)throw new Error("Not an image");return e}function oP(t){switch(sP(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function aP(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const lP=/^data:image\/svg\+xml/,cP=/\.svg((\?|#).*)?$/;function $h(t){return t&&(lP.test(t)||cP.test(t))}function uP(t,e){if($h(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Qy(t,e)}function Qy(t,e){if($h(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Jy(t,e,n){const i=uP(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await fP(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function fP(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const hP={};let bp=!0;async function dP(t,e,n){let i;$h(n)?i=await Jy(t,e,n):i=Qy(t,n);const r=e&&e.imagebitmap;return await gP(i,r)}async function gP(t,e=null){if((pP(e)||!bp)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),bp=!1}return await createImageBitmap(t)}function pP(t){for(const e in t||hP)return!1;return!0}const $t=!1,bs=!0;function e_(t){const e=fo(t);return mP(e)||_P(e)||vP(e)||yP(e)}function mP(t){const e=fo(t);return e.byteLength>=24&&e.getUint32(0,$t)===2303741511?{mimeType:"image/png",width:e.getUint32(16,$t),height:e.getUint32(20,$t)}:null}function vP(t){const e=fo(t);return e.byteLength>=10&&e.getUint32(0,$t)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,bs),height:e.getUint16(8,bs)}:null}function yP(t){const e=fo(t);return e.byteLength>=14&&e.getUint16(0,$t)===16973&&e.getUint32(2,bs)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,bs),height:e.getUint32(22,bs)}:null}function _P(t){const e=fo(t);if(!(e.byteLength>=3&&e.getUint16(0,$t)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=wP();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,$t);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,$t),width:e.getUint16(s+7,$t)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,$t)}return null}function wP(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function fo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function EP(t,e){const{mimeType:n}=e_(t)||{},i=globalThis._parseImageNode;return sl(i),await i(t,n)}async function xP(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=TP(r);let a;switch(o){case"imagebitmap":a=await dP(t,e,s);break;case"image":a=await Jy(t,e,s);break;case"data":a=await EP(t);break;default:sl(!1)}return r==="data"&&(a=oP(a)),a}function TP(t){switch(t){case"auto":case"data":return rP();default:return iP(t),t}}const SP=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],PP=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],bP={image:{type:"auto",decode:!0}},t_={id:"image",module:"images",name:"Images",version:eP,mimeTypes:PP,extensions:SP,parse:xP,tests:[t=>Boolean(e_(new DataView(t)))],options:bP},H=new uo({id:"deck"});let wf={};function AP(t){wf=t}function Fe(t,e,n,i){H.level>0&&wf[t]&&wf[t].call(null,e,n,i)}function CP(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const LP={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:CP,parseTextSync:JSON.parse},As="8.8.11",Pa=globalThis.deck&&globalThis.deck.VERSION;if(Pa&&Pa!==As)throw new Error("deck.gl - multiple versions detected: ".concat(Pa," vs ").concat(As));Pa||(H.log(1,"deck.gl ".concat(As))(),globalThis.deck={...globalThis.deck,VERSION:As,version:As,log:H,_registerLoggers:AP},CS([LP,[t_,{imagebitmap:{premultiplyAlpha:"none"}}]]));const MP=globalThis.deck,B=new uo({id:"luma.gl"});function je(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const IP="Invalid WebGLRenderingContext",RP="Requires WebGL2";function Gl(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function Z(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function OP(t){return Z(t)?t:null}function Wl(t){return je(Gl(t),IP),t}function ze(t){return je(Z(t),RP),t}const ds={};function kP(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function NP(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function FP(t,e){ds[t]=!0,e!==void 0&&kP(e)}function DP(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(ds[i]=!0);while(i!==0);for(i in ds)if(ds[i])return delete ds[i],parseInt(i,10);return 0}}const ho=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};ho.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};ho.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ki=function(e){const n=this;this.gl=e,DP(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=c,h.offset=u,h.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{NP("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};ki.prototype.VERTEX_ARRAY_BINDING_OES=34229;ki.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new ho(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};ki.prototype.createVertexArrayOES=function(){const e=new ho(this);return this.vertexArrayObjects.push(e),e};ki.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};ki.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof ho&&e.hasBeenBound&&e.ext===this)};ki.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){FP(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=r?r.attribs[l]:null;if((!r||c.enabled!==u.enabled)&&(c.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),c.enabled){let f=!1;(!r||c.buffer!==u.buffer)&&(o!==c.buffer&&(i.bindBuffer.call(n,34962,c.buffer),o=c.buffer),f=!0),(f||c.cached!==u.cached)&&i.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function zP(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ki(this)),this.__OESVertexArrayObject))}}const Ap="OES_element_index",Cp="WEBGL_draw_buffers",UP="EXT_disjoint_timer_query",BP="EXT_disjoint_timer_query_webgl2",VP="EXT_texture_filter_anisotropic",Lp="WEBGL_debug_renderer_info",jP=35723,GP=4352,WP=36795,HP=34047,XP=37445,YP=37446,ee=t=>Z(t)?void 0:0,ZP={[3074]:t=>Z(t)?void 0:36064,[jP]:t=>Z(t)?void 0:GP,[35977]:ee,[32937]:ee,[WP]:(t,e)=>{const n=Z(t)?t.getExtension(BP):t.getExtension(UP);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[XP]:(t,e)=>{const n=t.getExtension(Lp);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[YP]:(t,e)=>{const n=t.getExtension(Lp);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[HP]:(t,e)=>{const n=t.luma.extensions[VP];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:ee,[35071]:ee,[37447]:ee,[36063]:(t,e)=>{if(!Z(t)){const n=t.getExtension(Cp);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:ee,[35374]:ee,[35377]:ee,[34852]:t=>{if(!Z(t)){const e=t.getExtension(Cp);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Ap)?2147483647:65535,[33001]:t=>t.getExtension(Ap)?16777216:65535,[33e3]:t=>16777216,[37157]:ee,[35373]:ee,[35657]:ee,[36183]:ee,[37137]:ee,[34045]:ee,[35978]:ee,[35979]:ee,[35968]:ee,[35376]:ee,[35375]:ee,[35659]:ee,[37154]:ee,[35371]:ee,[35658]:ee,[35076]:ee,[35077]:ee,[35380]:ee};function $P(t,e,n){const i=ZP[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const KP="OES_vertex_array_object",n_="ANGLE_instanced_arrays",qP="WEBGL_draw_buffers",QP="EXT_disjoint_timer_query",JP="EXT_texture_filter_anisotropic",eb="VertexArray requires WebGL2 or OES_vertex_array_object extension";function tb(t,e){return{webgl2:Z(t),ext:t.getExtension(e)}}const i_={[KP]:{meta:{suffix:"OES"},createVertexArray:()=>{je(!1,eb)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[n_]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){je(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[qP]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{je(!1)}},[QP]:{meta:{suffix:"EXT"},createQuery:()=>{je(!1)},deleteQuery:()=>{je(!1)},beginQuery:()=>{je(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},$c={readBuffer:(t,e,n)=>{Z(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=tb(t,n_);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Z(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Z(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[JP];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:$P,hint(t,e,n,i){return e(n,i)}};function nb(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(zP(t),ib(t),sb(t,i_),rb(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=nb;function ib(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function rb(t,e){let{target:n,target2:i}=e;Object.keys($c).forEach(r=>{if(typeof $c[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=$c[r].bind(null,t,s);n[r]=o,i[r]=o}})}function sb(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&ob(t,{extension:n,target:t.luma,target2:t})}function ob(t,e){let{extension:n,target:i,target2:r}=e;const s=i_[n];je(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const u="".concat(c).concat(a);let f=null;c==="meta"||typeof t[c]=="function"||(l&&typeof l[u]=="function"?f=function(){return l[u](...arguments)}:typeof s[c]=="function"&&(f=s[c].bind(i))),f&&(i[c]=f,r[c]=f)}}const Kh={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Cn=(t,e,n)=>e?t.enable(n):t.disable(n),Mp=(t,e,n)=>t.hint(n,e),tt=(t,e,n)=>t.pixelStorei(n,e),ab=(t,e)=>{const n=Z(t)?36009:36160;return t.bindFramebuffer(n,e)},lb=(t,e)=>t.bindFramebuffer(36008,e);function is(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const cb={[3042]:Cn,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Cn,[2885]:(t,e)=>t.cullFace(e),[2929]:Cn,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Cn,[35723]:Mp,[36006]:ab,[2886]:(t,e)=>t.frontFace(e),[33170]:Mp,[2849]:(t,e)=>t.lineWidth(e),[32823]:Cn,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Cn,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Cn,[3088]:(t,e)=>t.scissor(...e),[2960]:Cn,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:tt,[3317]:tt,[37440]:tt,[37441]:tt,[37443]:tt,[3330]:tt,[3332]:tt,[3331]:tt,[36010]:lb,[3314]:tt,[32878]:tt,[3316]:tt,[3315]:tt,[32877]:tt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=is(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=is(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=is(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=is(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=is(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function de(t,e,n){return e[t]!==void 0?e[t]:n[t]}const ub={blendEquation:(t,e,n)=>t.blendEquationSeparate(de(32777,e,n),de(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(de(32969,e,n),de(32968,e,n),de(32971,e,n),de(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(de(32824,e,n),de(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(de(32938,e,n),de(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,de(2962,e,n),de(2967,e,n),de(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,de(34816,e,n),de(36003,e,n),de(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,de(2964,e,n),de(2965,e,n),de(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,de(34817,e,n),de(34818,e,n),de(34819,e,n))},Ip={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},Wt=(t,e)=>t.isEnabled(e),Rp={[3042]:Wt,[2884]:Wt,[2929]:Wt,[3024]:Wt,[32823]:Wt,[32926]:Wt,[32928]:Wt,[3089]:Wt,[2960]:Wt,[35977]:Wt};function r_(t){for(const e in t)return!1;return!0}function fb(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Op(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function hb(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:c}=n(t.state._updateCache,...o);return l&&i(...o),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function db(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class gb{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?mb(e):Object.assign({},Kh),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){je(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];wn(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){je(s!==void 0);const o=e[s],a=this.cache[s];fb(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function s_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(je(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new gb(t,{copyState:i}),db(t);for(const s in Ip){const o=Ip[s];hb(t,s,o)}Op(t,"getParameter"),Op(t,"isEnabled")}return t.state.enable=n,t}function pb(t){t.state||s_(t,{copyState:!1}),t.state.push()}function kp(t){je(t.state),t.state.pop()}function wn(t,e){if(je(Gl(t),"setParameters requires a WebGL context"),r_(e))return;const n={};for(const r in e){const s=Number(r),o=cb[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=ub[r];s(t,e,i)}}function mb(t,e){if(e=e||Kh,typeof e=="number"){const r=e,s=Rp[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=Rp[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function vb(t){wn(t,Kh)}function xt(t,e,n){if(r_(e))return n(t);const{nocatch:i=!0}=e;pb(t),wn(t,e);let r;if(i)r=n(t),kp(t);else try{r=n(t)}finally{kp(t)}return r}function Sr(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Kc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Sr(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return _b(e,i,r,s,n)}function yb(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function _b(t,e,n,i,r){const s=Np(t[0],e,n);let o=Fp(t[1],e,i,r),a=Np(t[0]+1,e,n);const l=a===n-1?a:a-1;a=Fp(t[1]+1,e,i,r);let c;return r?(a=a===0?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function Np(t,e,n){return Math.min(Math.round(t*e),n-1)}function Fp(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const qh=Tn(),wb=qh&&typeof document<"u",o_={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function a_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};je(qh,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},o_,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=Sb({canvas:s,width:e,height:n,onError:i});return r=Tb(o,t),r?(r=Qh(r,t),Pb(r),r):null}function Qh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||bb(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},o_,e);const{manageState:n,debug:i}=e;return n&&s_(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return B.log(1,...s)()}}),qh&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),B.level=Math.max(B.level,1)):B.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function Eb(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function xb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=yb(e.useDevicePixels);Ab(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function Tb(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function Sb(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(wb&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function Pb(t){const e=Z(t)?"WebGL2":"WebGL1",n=Eb(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";B.info(1,"".concat(e).concat(r," context ").concat(i))()}function bb(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function Ab(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(B.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(B.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const Cs="8.5.16",Cb="set luma.log.level=1 (or higher) to trace rendering";class l_{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Hh({id:e})),this.stats.get(e)}}const vi=new l_;if(globalThis.luma&&globalThis.luma.VERSION!==Cs)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Cs));globalThis.luma||(Tn()&&B.log(1,"luma.gl ".concat(Cs," - ").concat(Cb))(),globalThis.luma=globalThis.luma||{VERSION:Cs,version:Cs,log:B,stats:vi,globals:{modules:{},nodeIO:{}}});function Lb(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Mb(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function N(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function qc(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return N(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Kn(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Qc={};function Jt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Qc[t]=Qc[t]||1;const e=Qc[t]++;return"".concat(t,"-").concat(e)}function Dp(t){return N(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Pr(t){let e=!0;for(const n in t){e=!1;break}return e}function c_(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw B.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const Vi="Resource subclass must define virtual methods";class Sn{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wl(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||Jt(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=qc(this.gl,e),N(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Z(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Z(this.gl),o={},a=n||Object.keys(r);for(const l of a){const c=r[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const f=i?Kn(this.gl,l):l;o[f]=this.getParameter(l,e),i&&c.type==="GLenum"&&(o[f]=Kn(this.gl,o[f]))}}return o}setParameter(e,n){e=qc(this.gl,e),N(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Z(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=qc(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return c_(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Vi)}_deleteHandle(){throw new Error(Vi)}_bindHandle(e){throw new Error(Vi)}_getOptsFromHandle(){throw new Error(Vi)}_getParameter(e,n){throw new Error(Vi)}_setParameter(e,n){throw new Error(Vi)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new l_}_addStats(){const e=this[Symbol.toStringTag],n=vi.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];vi.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(e,n),this._doTrackAllocatedMemory(e,n,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(e),this._doTrackDeallocatedMemory(e,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.get("Memory Usage");n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}}const Ib="Failed to deduce GL constant from typed array";function Ef(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Ib)}}function Ys(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Rb(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const l=a*o,c=(i-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,c,c+o),e.set(s,c)}}function Ob(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let l=0;l<r;l++)for(let c=0;c<4;c++)o[(a*r+l)*4+c]=e[(a*2*n+l*2)*4+c];return{data:o,width:r,height:s}}function xf(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?"".concat(t,".").concat(i[a]):"N/A";B.removed("".concat(t,".").concat(a),c)()}for(const a in r)if(a in e){const l=r[a];B.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];B.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const kb={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Nb={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ot{static getBytesPerElement(e){return Ys(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return N(e.size),Ys(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ot(kb,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ot.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ot.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=xf("Accessor",e,Nb),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const zp=10,u_={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Fb={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:u_},Db={removedProps:u_};class J extends Sn{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ot.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ot.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=xf("Buffer",e,Fb),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=xf("Buffer",e,Db),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ot(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;N(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(ze(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return ze(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ze(this.gl);const s=Ys(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,r||o),c=a+l);const u=Math.min(o,l);return r=r||u,N(r<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(N(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(zp,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;N(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,zp),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=Ef(e);return N(s),this.setAccessor(new ot(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;N(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Ys(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ot(this.accessor,{type:Ef(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return B.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return B.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return B.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return B.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ot(this.accessor,e),this}}const Jh={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},f_={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},h_={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function zb(t,e){const n=Jh[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Z(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function Ub(t,e){const n=Jh[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const Bb=[9729,9728],Up=globalThis.WebGLBuffer||function(){};class Ai extends Sn{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&zb(e,i),s=s&&(!r||Ub(e,i))),s}constructor(e,n){const{id:i=Jt("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=r);let{width:f,height:h,dataFormat:d,type:p,compressed:w=!1,mipmaps:x=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:w,dataFormat:d,type:p}=this._deduceParameters({format:s,type:p,dataFormat:d,compressed:w,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=p,this.dataFormat=d,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),x&&this._isNPOT()&&(B.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),x=!1,this._updateForNPOT(l)),this.mipmaps=x,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:p,dataFormat:d,border:o,mipmaps:x,parameters:c,compressed:w}),x&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(B.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),xt(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=e;c||(c=i),{type:u,dataFormat:d,compressed:p,width:f,height:h}=this._deduceParameters({format:s,type:u,dataFormat:d,compressed:p,data:c,width:f,height:h});const{gl:w}=this;w.bindTexture(this.target,this.handle);let x=null;({data:c,dataType:x}=this._getDataType({data:c,compressed:p}));let y,m=0;if(xt(this.gl,l,()=>{switch(x){case"null":w.texImage2D(n,r,s,f,h,o,d,u,c);break;case"typed-array":w.texImage2D(n,r,s,f,h,o,d,u,c,a);break;case"buffer":y=ze(w),y.bindBuffer(35052,c.handle||c),y.texImage2D(n,r,s,f,h,o,d,u,a),y.bindBuffer(35052,null);break;case"browser-object":Z(w)?w.texImage2D(n,r,s,f,h,o,d,u,c):w.texImage2D(n,r,s,d,u,c);break;case"compressed":for(const[_,T]of c.entries())w.compressedTexImage2D(n,_,T.format,T.width,T.height,o,T.data),m+=T.levelSize;break;default:N(!1,"Unknown image data type")}}),x==="compressed")this._trackAllocatedMemory(m,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const _=f_[this.dataFormat]||4,T=h_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*_*T,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,format:u=this.format,type:f=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:p=0,border:w=this.border,parameters:x={}}=e;if({type:f,dataFormat:h,compressed:d,width:a,height:l}=this._deduceParameters({format:u,type:f,dataFormat:h,compressed:d,data:r,width:a,height:l}),N(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const y=r;r=y.data,a=y.shape[0],l=y.shape[1]}r instanceof J&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),xt(this.gl,x,()=>{if(d)this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,r);else if(r===null)this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,c,s,o,a,l,h,f,r,p);else if(r instanceof Up){const y=ze(this.gl);y.bindBuffer(35052,r),y.texSubImage2D(n,c,s,o,a,l,h,f,p),y.bindBuffer(35052,null)}else Z(this.gl)?ze(this.gl).texSubImage2D(n,c,s,o,a,l,h,f,r):this.gl.texSubImage2D(n,c,s,o,h,f,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof J?{data:n.handle,dataType:"buffer"}:n instanceof Up?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const c=Jh[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},N(r,"Could not deduced texture size"),N(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),N(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:N(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Z(this.gl)||!this.width||!this.height?!1:!Dp(this.width)||!Dp(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:Bb.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let Vb="";function jb(t,e){return N(typeof t=="string"),t=Vb+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class We extends Ai{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ai.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wl(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:jb(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Tf=[34069,34070,34071,34072,34073,34074];class d_ extends Ai{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wl(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:c}=this,u=r||s,f=await Promise.all(Tf.map(h=>{const d=u[h];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),Tf.forEach((h,d)=>{f[d].length>1&&this.opts.mipmaps!==!1&&B.warn("".concat(this.id," has mipmap and multiple LODs."))(),f[d].forEach((p,w)=>{n&&i?c.texImage2D(h,w,a,n,i,o,a,l,p):c.texImage2D(h,w,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?u.texImage2D(n,0,l,i,r,a,l,c,f):u.texImage2D(n,0,l,l,c,f),this}}d_.FACES=Tf;class Gb extends Ai{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ze(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:l,type:c=5121,offset:u=0,data:f,parameters:h={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),xt(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,f),f instanceof J&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,u))}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const d=f_[this.dataFormat]||4,p=h_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*d*p,"Texture")}return this.loaded=!0,this}}const li="EXT_color_buffer_float",Bp={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:li,bpp:2},[33327]:{gl2:li,bpp:4},[34842]:{gl2:li,bpp:8},[33326]:{gl2:li,bpp:4},[33328]:{gl2:li,bpp:8},[34836]:{gl2:li,bpp:16},[35898]:{gl2:li,bpp:4}};function Wb(t,e,n){const i=n[e];if(!i)return!1;const r=Z(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class rr extends Sn{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||Wb(e,n,Bp)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return N(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Z(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Bp[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const Hb=256,Xb=1024,Yb=16384,Vp=6144,jp=6145,Gp=6146,Wp=34041,g_="clear: bad arguments";function ed(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=Yb,n!==!0&&(s.clearColor=n)),i&&(o|=Hb,i!==!0&&(s.clearDepth=i)),r&&(o|=Xb,i!==!0&&(s.clearStencil=i)),N(o!==0,g_),xt(t,s,()=>{t.clear(o)})}function Zb(t){let{framebuffer:e=null,buffer:n=Vp,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ze(t),xt(t,{framebuffer:e},()=>{switch(n){case Vp:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case jp:t.clearBufferfv(jp,0,[r]);break;case Gp:t.clearBufferiv(Gp,0,[r]);break;case Wp:const[s,o]=r;t.clearBufferfi(Wp,0,s,o);break;default:N(!1,g_)}})}function $b(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return N(!1),0}}function Hl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:f}=p_(t);N(u);const{gl:h,handle:d,attachments:p}=u;a=a||u.width,l=l||u.height,s===36064&&d===null&&(s=1028),N(p[s]),c=c||p[s].type,o=qb(o,c,r,a,l),c=c||Ef(o);const w=h.bindFramebuffer(36160,d);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,w||null),f&&u.delete(),o}function Hp(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Hl(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=Ob({data:i,width:r,height:s}));Rb({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function Kb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:f}=n;const{framebuffer:h,deleteFramebuffer:d}=p_(t);N(h);const{gl:p,handle:w}=h,x=typeof a<"u"||typeof l<"u"||typeof c<"u";a=a||0,l=l||0,c=c||0;const y=p.bindFramebuffer(36160,w);N(e);let m=null;if(e instanceof Ai&&(m=e,u=Number.isFinite(u)?u:m.width,f=Number.isFinite(f)?f:m.height,m.bind(0),e=m.target),!x)p.copyTexImage2D(e,s,o,i,r,u,f,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,i,r,u,f);break;case 35866:case 32879:ze(p).copyTexSubImage3D(e,s,a,l,c,i,r,u,f);break}return m&&m.unbind(),p.bindFramebuffer(36160,y||null),d&&h.delete(),m}function p_(t){return t instanceof _e?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:oA(t),deleteFramebuffer:!0}}function qb(t,e,n,i,r){if(t)return t;e=e||5121;const s=Ys(e,{clamped:!1}),o=$b(n);return new s(i*r*o)}const te={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Qb(t){const e=new We(t,{format:6408,type:5126,dataFormat:6408}),n=new _e(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const m_={[te.WEBGL2]:[!1,!0],[te.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[te.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[te.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[te.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[te.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[te.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[te.FLOAT_BLEND]:["EXT_float_blend"],[te.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[te.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[te.TEXTURE_FLOAT]:["OES_texture_float",!0],[te.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[te.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[te.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[te.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[te.COLOR_ATTACHMENT_RGBA32F]:[Qb,"EXT_color_buffer_float"],[te.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[te.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[te.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[te.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[te.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[te.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},Jb=2;function v_(t,e){return td(t,e)}function td(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>y_(t,n))}function eA(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in m_)t.luma.caps[e]===void 0&&(t.luma.caps[e]=y_(t,e));return t.luma.caps}function y_(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=tA(t,e)),t.luma.caps[e]||B.log(Jb,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function tA(t,e){const n=m_[e];N(n,e);let i;const r=Z(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(t.getExtension(s))}else typeof r=="string"?i=Boolean(t.getExtension(r)):typeof r=="boolean"?i=r:N(!1);return i}const Xp="Multiple render targets not supported";class _e extends Sn{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new _e(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=ze(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=ze(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:u=void 0}=e;if(N(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const f in r){const h=r[f];(Array.isArray(h)?h[0]:h).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:c,drawBuffers:u}),r&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return N(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&B.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){N(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let c=l;if(!c)this._unattach(a);else if(c instanceof rr)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,f=0,h=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:f,level:h})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(iA(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&ed(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{Zb(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return B.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return B.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return B.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return B.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return B.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return B.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=ze(this.gl),l=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=Kn(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?Kn(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?Kn(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(Hp(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>B.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Hp(this,{targetMaxHeight:100});return B.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new We(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new rr(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new rr(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&N(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof rr?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:ze(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const l=nA(r);o.framebufferTexture2D(36160,n,l,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:N(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=OP(this.gl);n?n.readBuffer(e):N(e===36064||e===1029,Xp),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=ze(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):N(e.length===1&&(e[0]===36064||e[0]===1029),Xp)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=eA(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function nA(t){return t<34069?t+34069:t}function iA(t){return(_e.STATUS||{})[t]||"Framebuffer error ".concat(t)}const rA=[36049,36048,33296,33298,33299,33300,33301,33302,33303];_e.ATTACHMENT_PARAMETERS=rA;function sA(t,e){N(t instanceof We||t instanceof d_||t instanceof Gb);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,f=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(i,f)}function oA(t,e){const{gl:n,width:i,height:r,id:s}=t;return new _e(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:t}}))}function ba(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const aA=35632,lA=35633;function cA(t){switch(t){case aA:return"fragment";case lA:return"vertex";default:return"unknown type"}}function uA(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||ba(e)||"(unnamed)",l="".concat(cA(n)," shader ").concat(a);for(let u=0;u<r.length;u++){const f=r[u];if(f.length<=1)continue;const h=f.split(":"),d=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));d!=="WARNING"?s[p]=f:o[p]=f}const c=fA(e);return{shaderName:l,errors:Yp(s,c),warnings:Yp(o,c)}}function Yp(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=__("^^^ ".concat(a,": ").concat(c,`

`),l)}}return n}function fA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return __(a,r-l)+n+s})}function __(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function w_(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const hA="Shader: GLSL source code must be a JavaScript string";class Zs extends Sn{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return N(!1),"unknown"}}constructor(e,n){Wl(e),N(typeof n.source=="string",hA);const i=ba(n.source,null)||n.id||Jt("unnamed ".concat(Zs.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=ba(n,null);i&&(this.id=Jt(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Zs.getTypeName(this.shaderType),":").concat(this.id)}getName(){return ba(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=uA(i,this.source,this.shaderType,this.id);throw B.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),B.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Jc extends Zs{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class eu extends Zs{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const dA={[5126]:ie.bind(null,"uniform1fv",nt,1,Ne),[35664]:ie.bind(null,"uniform2fv",nt,2,Ne),[35665]:ie.bind(null,"uniform3fv",nt,3,Ne),[35666]:ie.bind(null,"uniform4fv",nt,4,Ne),[5124]:ie.bind(null,"uniform1iv",Ln,1,Ne),[35667]:ie.bind(null,"uniform2iv",Ln,2,Ne),[35668]:ie.bind(null,"uniform3iv",Ln,3,Ne),[35669]:ie.bind(null,"uniform4iv",Ln,4,Ne),[35670]:ie.bind(null,"uniform1iv",Ln,1,Ne),[35671]:ie.bind(null,"uniform2iv",Ln,2,Ne),[35672]:ie.bind(null,"uniform3iv",Ln,3,Ne),[35673]:ie.bind(null,"uniform4iv",Ln,4,Ne),[35674]:ie.bind(null,"uniformMatrix2fv",nt,4,ln),[35675]:ie.bind(null,"uniformMatrix3fv",nt,9,ln),[35676]:ie.bind(null,"uniformMatrix4fv",nt,16,ln),[35678]:Ce,[35680]:Ce,[5125]:ie.bind(null,"uniform1uiv",$o,1,Ne),[36294]:ie.bind(null,"uniform2uiv",$o,2,Ne),[36295]:ie.bind(null,"uniform3uiv",$o,3,Ne),[36296]:ie.bind(null,"uniform4uiv",$o,4,Ne),[35685]:ie.bind(null,"uniformMatrix2x3fv",nt,6,ln),[35686]:ie.bind(null,"uniformMatrix2x4fv",nt,8,ln),[35687]:ie.bind(null,"uniformMatrix3x2fv",nt,6,ln),[35688]:ie.bind(null,"uniformMatrix3x4fv",nt,12,ln),[35689]:ie.bind(null,"uniformMatrix4x2fv",nt,8,ln),[35690]:ie.bind(null,"uniformMatrix4x3fv",nt,12,ln),[35678]:Ce,[35680]:Ce,[35679]:Ce,[35682]:Ce,[36289]:Ce,[36292]:Ce,[36293]:Ce,[36298]:Ce,[36299]:Ce,[36300]:Ce,[36303]:Ce,[36306]:Ce,[36307]:Ce,[36308]:Ce,[36311]:Ce},gA={},pA={},mA={},Zp=[0];function nd(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Zp[0]=t,t=Zp);const r=t.length;if(r%e&&B.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function nt(t,e){return nd(t,e,Float32Array,gA)}function Ln(t,e){return nd(t,e,Int32Array,pA)}function $o(t,e){return nd(t,e,Uint32Array,mA)}function $p(t,e,n){const i=dA[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function vA(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function yA(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!_A(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function _A(t){return Array.isArray(t)||ArrayBuffer.isView(t)?EA(t):isFinite(t)||t===!0||t===!1||t instanceof Ai||t instanceof rr?!0:t instanceof _e?Boolean(t.texture):!1}function wA(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function EA(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ce(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function ie(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let f=!1;if(r===null)r=new Float32Array(u),s=u,f=!0;else{N(s===u,"Uniform length cannot change.");for(let h=0;h<u;++h)if(c[h]!==r[h]){f=!0;break}}return f&&(i(o,t,a,c),r.set(c)),f}}function Ne(t,e,n,i){t[e](n,i)}function ln(t,e,n,i){t[e](n,!1,i)}const xA=5120,TA=5121,SA=5122,PA=5123,Kp=0,Ko=1,bA=2,AA=3,qo=4,CA=5,LA=6,we=5126,MA=35664,IA=35665,RA=35666,rs=5124,OA=35667,kA=35668,NA=35669,ss=5125,FA=36294,DA=36295,zA=36296,UA=35670,BA=35671,VA=35672,jA=35673,GA=35674,WA=35675,HA=35676,XA=35685,YA=35686,ZA=35687,$A=35688,KA=35689,qA=35690,Sf={[we]:[we,1,"float"],[MA]:[we,2,"vec2"],[IA]:[we,3,"vec3"],[RA]:[we,4,"vec4"],[rs]:[rs,1,"int"],[OA]:[rs,2,"ivec2"],[kA]:[rs,3,"ivec3"],[NA]:[rs,4,"ivec4"],[ss]:[ss,1,"uint"],[FA]:[ss,2,"uvec2"],[DA]:[ss,3,"uvec3"],[zA]:[ss,4,"uvec4"],[UA]:[we,1,"bool"],[BA]:[we,2,"bvec2"],[VA]:[we,3,"bvec3"],[jA]:[we,4,"bvec4"],[GA]:[we,8,"mat2"],[XA]:[we,8,"mat2x3"],[YA]:[we,8,"mat2x4"],[WA]:[we,12,"mat3"],[ZA]:[we,12,"mat3x2"],[$A]:[we,12,"mat3x4"],[HA]:[we,16,"mat4"],[KA]:[we,16,"mat4x2"],[qA]:[we,16,"mat4x3"]};function QA(t){switch(t){case Kp:return Kp;case Ko:return Ko;case AA:return Ko;case bA:return Ko;case qo:return qo;case CA:return qo;case LA:return qo;default:return N(!1),0}}function qp(t){const e=Sf[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function E_(t,e){switch(t){case xA:case TA:case SA:case PA:t=we;break}for(const n in Sf){const[i,r,s]=Sf[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class JA{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Z(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=qp(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new ot(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=qp(i),a=new ot({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const Qp=4,eC=35981,tC=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class x_ extends Sn{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",tC),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=eC}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Jc(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new eu(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,N(this.vs instanceof Jc),N(this.fs instanceof eu),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(ze(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new JA(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:c=5123,instanceCount:u=0,isInstanced:f=u>0,vertexArray:h=null,transformFeedback:d,framebuffer:p,parameters:w={},uniforms:x,samplers:y}=e;if((x||y)&&(B.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(x||{})),B.priority>=n){const m=p?p.id:"default",_="mode=".concat(Kn(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(Kn(this.gl,c)," ")+"isInstanced=".concat(f," isIndexed=").concat(l," ")+"Framebuffer=".concat(m);B.log(n,_)()}return N(h),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||f&&u===0?!1:(h.bindForDraw(r,u,()=>{if(p!==void 0&&(w=Object.assign({},w,{framebuffer:p})),d){const m=QA(i);d.begin(m)}this._bindTextures(),xt(this.gl,w,()=>{l&&f?this.gl2.drawElementsInstanced(i,r,c,s,u):l&&Z(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,c,s):l?this.gl.drawElements(i,r,c,s):f?this.gl2.drawArraysInstanced(i,s,r,u):this.gl.drawArrays(i,s,r)}),d&&d.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};B.priority>=2&&yA(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof _e&&(s=s.texture),s instanceof Ai)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&wA(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Jc({handle:r});break;case 35632:i.fs=new eu({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Jt(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),B.time(Qp,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),B.timeEnd(Qp,"linkProgram for ".concat(this._getName()))(),e.debug||B.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=vA(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=$p(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=$p(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const nC=34918,iC=34919,rC=35007,sC=36795,oC=35976,aC=35887,lC=36202;class cl extends Sn{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Z(e),r=td(e,te.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:N(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(rC)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?lC:aC)}beginTransformFeedbackQuery(){return this.begin(oC)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,iC);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(sC)}getResult(){return this.gl2.getQueryParameter(this.handle,nC)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return cl.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class T_ extends Sn{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ze(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Pr(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,B.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof J?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Qo=null;function cC(t){return(!Qo||Qo.byteLength<t)&&(Qo=new ArrayBuffer(t)),Qo}function uC(t,e){const n=cC(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function fC(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const hC="elements must be GL.ELEMENT_ARRAY_BUFFER";class it extends Sn{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Z(e)||Vy()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new it(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return it.MAX_ATTRIBUTES=it.MAX_ATTRIBUTES||e.getParameter(34921),it.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:it._setConstantFloatArray(e,n,i);break;case Int32Array:it._setConstantIntArray(e,n,i);break;case Uint32Array:it._setConstantUintArray(e,n,i);break;default:N(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return it.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return N(!e||e.target===34963,hC),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=i,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),c?(N(Z(f)),h.vertexAttribIPointer(e,r,s,o,a)):f.vertexAttribPointer(e,r,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!it.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new J(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=uC(n.constructor,s);fC({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:N(!1)}}static _setConstantIntArray(e,n,i){switch(N(Z(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:N(!1)}}static _setConstantUintArray(e,n,i){switch(N(Z(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:N(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return N(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const dC="VertexArray: attributes must be Buffers or constants (i.e. typed array)",gC=/^(.+)__LOCATION_([0-9]+)$/,pC=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class mC{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new it(e),c_(this,"VertexArray","v6.0",pC),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new J(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof J&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof J&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,B.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=ot.resolve(l.accessor,c,i,r),{size:f,type:h}=u;return N(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=gC.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof J)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof J){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof J){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(dC)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(it.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){it.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof J){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return B.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function vC(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=$s(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function $s(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return vC(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Jp(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;N(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},c=Object.keys(a).sort();let u=0;for(const d of c)!d.match(s)&&!d.match(o)&&tu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)d.match(o)&&tu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)l[d]||tu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;let f=0;const h={};if(!r)for(const d in i){const p=i[d];l[d]||(f++,h[d]={Type:"NOT USED: ".concat(p),[e]:$s(p)})}return{table:l,count:u,unusedTable:h,unusedCount:f}}function tu(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=yC(o);return!s||!a?(e[r]={[n]:a?$s(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function yC(t){return t!=null}function _C(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=em(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(wC(o.name,l))),i[a]=em(e,r[s],l,n)}}return i}function em(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof J){const h=e,{data:d,changed:p}=h.getDebugData();u=p?"*":"",f=d,l=h.byteLength,a=l/d.BYTES_PER_ELEMENT/o;let w;if(n){const x=n.divisor>0;w="".concat(x?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(Kn(r,s),")")}else c=!0,w="".concat(l," bytes");return{[i]:"".concat(u).concat($s(f,{size:o,isInteger:c})),"Format ":w}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[i]:"".concat($s(f,{size:o,isInteger:c})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function wC(t,e){const{type:n,size:i}=e,r=E_(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function EC(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=tm(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=tm(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function tm(t){const{type:e,size:n}=t.accessor,i=E_(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const nm=Tn()&&typeof document<"u";let xC=0;class TC{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=x=>a_(x),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:p=vi.get("animation-loop-".concat(xC++))}=e;let{useDevicePixels:w=!0}=e;"useDevicePixelRatio"in e&&(B.deprecated("useDevicePixelRatio","useDevicePixels")(),w=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:w}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return N(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=cl.isSupported(this.gl,["timers"])?new cl(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return B.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=nm?new Promise((e,n)=>{if(nm&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):Mb(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):Lb(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Qh(this.props.gl,e):this.onCreateContext(e),!Gl(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");vb(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&xb(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new _e(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const go="vs",id="fs";function ut(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const nu={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function SC(t){const e={};for(const n in t){const i=t[n],r=PC(i);e[n]=r}return e}function PC(t){let e=im(t);return e==="object"?t?"type"in t?Object.assign({},t,nu[t.type]):"value"in t?(e=im(t.value),Object.assign({type:e},t,nu[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},nu[e])}function im(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const bC="vs",AC="fs";class rm{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:c={},inject:u={},vertexShader:f,fragmentShader:h}=e;ut(typeof n=="string"),this.name=n,this.vs=i||f,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=CC(u),o&&(this.uniforms=SC(o))}getModuleSource(e){let n;switch(e){case bC:n=this.vs||"";break;case AC:n=this.fs||"";break;default:ut(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ut(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function CC(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function LC(t){return MC(P_(t))}function MC(t){const e={},n={};return S_({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function S_(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&S_({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function P_(t,e){return t.map(n=>(n instanceof rm||(ut(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ut(n.name,"shader module has no name"),n=new rm(n),n.dependencies=P_(n.dependencies)),n))}function IC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const RC=7936,OC=7937,kC=7938,NC=35724,rd={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},di={};Object.keys(rd).forEach(t=>{di[t]=t});function FC(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function DC(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||RC),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||OC);return{gpuVendor:zC(n,i),vendor:n,renderer:i,version:t.getParameter(kC),shadingLanguageVersion:t.getParameter(NC)}}function zC(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const iu={};function sm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=rd[e];if(ut(i,e),!IC(n))return!0;if(e in iu)return iu[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),iu[e]=l,l}function UC(t,e){const n=rd[e];ut(n,e);const i=FC(t)&&n[1]||n[0],r=typeof i=="string"?Boolean(t.getExtension(i)):i;return ut(r===!1||r===!0),r}function Jo(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>UC(t,n))}function BC(t){switch(DC(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function VC(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Jo(t,di.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Jo(t,di.GLSL_DERIVATIVES)&&sm(t,di.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Jo(t,di.GLSL_FRAG_DATA)&&sm(t,di.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Jo(t,di.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const jC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,GC=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,WC={[go]:jC,[id]:GC},Aa="__LUMA_INJECT_DECLARATIONS__",om=/void\s+main\s*\([^)]*\)\s*\{\n?/,am=/}\n?[^{}]*$/,ru=[];function lm(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===go;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),ru.length=o.length;for(let l=0,c=o.length;l<c;++l)ru[l]=o[l].injection;const a="".concat(ru.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(Aa,a));break;case"vs:#main-start":r&&(t=t.replace(om,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(am,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Aa,a));break;case"fs:#main-start":r||(t=t.replace(om,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(am,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Aa,""),i&&(t=t.replace(/\}\s*$/,s=>s+WC[e])),t}function Pf(t){const e={};return ut(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function br(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const b_=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],HC=[...b_,[br("attribute"),"in $1"],[br("varying"),"out $1"]],XC=[...b_,[br("varying"),"in $1"]],A_=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],YC=[...A_,[br("in"),"attribute $1"],[br("out"),"varying $1"]],ZC=[...A_,[br("in"),"varying $1"]],bf="gl_FragColor",Af=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,$C=/void\s+main\s*\([^)]*\)\s*\{\n?/;function KC(t,e,n){switch(e){case 300:return n?ul(t,HC):qC(t);case 100:return n?ul(t,YC):QC(t);default:throw new Error("unknown GLSL version ".concat(e))}}function ul(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function qC(t){t=ul(t,XC);const e=t.match(Af);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(bf,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace($C,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(bf,"\\b"),"g"),n)}return t}function QC(t){t=ul(t,ZC);const e=t.match(Af);if(e){const n=e[1];t=t.replace(Af,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),bf)}return t}const JC=`

`.concat(Aa,`

`),C_={[go]:"vertex",[id]:"fragment"},eL=`precision highp float;

`;function tL(t,e){const{vs:n,fs:i}=e,r=LC(e.modules||[]);return{gl:t,vs:cm(t,Object.assign({},e,{source:n,type:go,modules:r})),fs:cm(t,Object.assign({},e,{source:i,type:id,modules:r})),getUniforms:nL(r)}}function cm(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:f}=e;ut(typeof i=="string","shader source must be a string");const h=r===go,d=i.split(`
`);let p=100,w="",x=i;d[0].indexOf("#version ")===0?(p=300,w=d[0],x=d.slice(1).join(`
`)):w="#version ".concat(p);const y={};s.forEach(C=>{Object.assign(y,C.getDefines())}),Object.assign(y,o);let m=u?"".concat(w,`
`).concat(rL({id:n,source:i,type:r}),`
`).concat(iL({type:r}),`
`).concat(BC(t),`
`).concat(VC(t),`
`).concat(sL(y),`
`).concat(h?"":eL,`
`):"".concat(w,`
`);const _=aL(a),T={},P={},b={};for(const C in l){const M=typeof l[C]=="string"?{injection:l[C],order:0}:l[C],R=C.match(/^(v|f)s:(#)?([\w-]+)$/);if(R){const O=R[2],U=R[3];O?U==="decl"?P[C]=[M]:b[C]=[M]:T[C]=[M]}else b[C]=[M]}for(const C of s){f&&C.checkDeprecations(x,f),m+=C.getModuleSource(r,p);const R=C.injections[r];for(const O in R){const U=O.match(/^(v|f)s:#([\w-]+)$/);if(U){const V=U[2]==="decl"?P:b;V[O]=V[O]||[],V[O].push(R[O])}else T[O]=T[O]||[],T[O].push(R[O])}}return m+=JC,m=lm(m,r,P),m+=oL(_[r],T),m+=x,m=lm(m,r,b),m=KC(m,c?100:p,h),m}function nL(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function iL(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(C_[e].toUpperCase(),`
`)}function rL(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(C_[i],`

`):""}function sL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function oL(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function aL(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const lL="void main() {gl_FragColor = vec4(0);}",L_=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,cL=`#version 300 es
`.concat(L_);function M_(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function I_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?cL:e>300?"#version ".concat(e,`
`).concat(L_):lL;const s=hL(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function uL(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ut(!1),null}}function fL(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ut(!1),null}}function hL(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ut(!1),null}}const dL=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,gL={name:"fp32",vs:dL,fs:null};function um(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const lt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function pL(t,{precision:e=lt.precision}={}){return t=mL(t),"".concat(parseFloat(t.toPrecision(e)))}function Ar(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Me(t,e,n){return yL(t,i=>Math.max(e,Math.min(n,i)))}function wi(t,e,n){return Ar(t)?t.map((i,r)=>wi(i,e[r],n)):n*e+(1-n)*t}function Cr(t,e,n){const i=lt.EPSILON;n&&(lt.EPSILON=n);try{if(t===e)return!0;if(Ar(t)&&Ar(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Cr(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=lt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{lt.EPSILON=i}}function mL(t){return Math.round(t/lt.EPSILON)*lt.EPSILON}function vL(t){return t.clone?t.clone():new Array(t.length)}function yL(t,e,n){if(Ar(t)){const i=t;n=n||vL(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function _L(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class R_ extends _L(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ar(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(lt)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+pL(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Cr(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(lt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function wL(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function st(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function su(t,e,n=""){if(lt.debug&&!wL(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class EL extends R_{get x(){return this[0]}set x(e){this[0]=st(e)}get y(){return this[1]}set y(e){this[1]=st(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return st(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return st(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return um(e>=0&&e<this.ELEMENTS,"index is out of range"),st(this[e])}setComponent(e,n){return um(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Ca=1e-6,Lr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function xL(){var t=new Lr(2);return Lr!=Float32Array&&(t[0]=0,t[1]=0),t}function fl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function O_(t,e){return t[0]=-e[0],t[1]=-e[1],t}function k_(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function TL(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=xL();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function SL(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function N_(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function PL(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function bL(){var t=new Lr(3);return Lr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function AL(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function CL(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function LL(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ML(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function F_(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function IL(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function RL(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,f=s*a-i*c,h=i*l-r*a,d=r*h-s*f,p=s*u-i*h,w=i*f-r*u,x=o*2;return u*=x,f*=x,h*=x,d*=2,p*=2,w*=2,t[0]=a+u+d,t[1]=l+f+p,t[2]=c+h+w,t}function OL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function kL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function NL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function FL(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),c=Math.sqrt(s*s+o*o+a*a),u=l*c,f=u&&LL(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}var DL=AL;(function(){var t=bL();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const ou=[0,0,0];let ea;class en extends EL{static get ZERO(){return ea||(ea=new en(0,0,0),Object.freeze(ea)),ea}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Ar(e)?this.copy(e):(lt.debug&&(st(e),st(n),st(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return lt.debug&&(st(e.x),st(e.y),st(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=st(e)}angle(e){return FL(this,e)}cross(e){return ML(this,this,e),this.check()}rotateX({radians:e,origin:n=ou}){return OL(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ou}){return kL(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ou}){return NL(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return F_(this,this,e),this.check()}transformAsVector(e){return N_(this,this,e),this.check()}transformByMatrix3(e){return IL(this,this,e),this.check()}transformByMatrix2(e){return PL(this,this,e),this.check()}transformByQuaternion(e){return RL(this,this,e),this.check()}}class zL extends R_{toString(){let e="[";if(lt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=st(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function UL(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function BL(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Cf(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],w=e[13],x=e[14],y=e[15],m=n*a-i*o,_=n*l-r*o,T=n*c-s*o,P=i*l-r*a,b=i*c-s*a,C=r*c-s*l,M=u*w-f*p,R=u*x-h*p,O=u*y-d*p,U=f*x-h*w,G=f*y-d*w,V=h*y-d*x,X=m*V-_*G+T*U+P*O-b*R+C*M;return X?(X=1/X,t[0]=(a*V-l*G+c*U)*X,t[1]=(r*G-i*V-s*U)*X,t[2]=(w*C-x*b+y*P)*X,t[3]=(h*b-f*C-d*P)*X,t[4]=(l*O-o*V-c*R)*X,t[5]=(n*V-r*O+s*R)*X,t[6]=(x*T-p*C-y*_)*X,t[7]=(u*C-h*T+d*_)*X,t[8]=(o*G-a*O+c*M)*X,t[9]=(i*O-n*G-s*M)*X,t[10]=(p*b-w*T+y*m)*X,t[11]=(f*T-u*b-d*m)*X,t[12]=(a*R-o*U-l*M)*X,t[13]=(n*U-i*R+r*M)*X,t[14]=(w*_-p*P-x*m)*X,t[15]=(u*P-f*_+h*m)*X,t):null}function VL(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],d=t[12],p=t[13],w=t[14],x=t[15],y=e*o-n*s,m=e*a-i*s,_=e*l-r*s,T=n*a-i*o,P=n*l-r*o,b=i*l-r*a,C=c*p-u*d,M=c*w-f*d,R=c*x-h*d,O=u*w-f*p,U=u*x-h*p,G=f*x-h*w;return y*G-m*U+_*O+T*R-P*M+b*C}function Ei(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],d=e[10],p=e[11],w=e[12],x=e[13],y=e[14],m=e[15],_=n[0],T=n[1],P=n[2],b=n[3];return t[0]=_*i+T*a+P*f+b*w,t[1]=_*r+T*l+P*h+b*x,t[2]=_*s+T*c+P*d+b*y,t[3]=_*o+T*u+P*p+b*m,_=n[4],T=n[5],P=n[6],b=n[7],t[4]=_*i+T*a+P*f+b*w,t[5]=_*r+T*l+P*h+b*x,t[6]=_*s+T*c+P*d+b*y,t[7]=_*o+T*u+P*p+b*m,_=n[8],T=n[9],P=n[10],b=n[11],t[8]=_*i+T*a+P*f+b*w,t[9]=_*r+T*l+P*h+b*x,t[10]=_*s+T*c+P*d+b*y,t[11]=_*o+T*u+P*p+b*m,_=n[12],T=n[13],P=n[14],b=n[15],t[12]=_*i+T*a+P*f+b*w,t[13]=_*r+T*l+P*h+b*x,t[14]=_*s+T*c+P*d+b*y,t[15]=_*o+T*u+P*p+b*m,t}function hl(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,c,u,f,h,d,p,w,x,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],d=e[7],p=e[8],w=e[9],x=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=d,t[8]=p,t[9]=w,t[10]=x,t[11]=y,t[12]=o*i+u*r+p*s+e[12],t[13]=a*i+f*r+w*s+e[13],t[14]=l*i+h*r+x*s+e[14],t[15]=c*i+d*r+y*s+e[15]),t}function sd(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function jL(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,c,u,f,h,d,p,w,x,y,m,_,T,P,b,C,M,R,O,U,G,V,X,Ye;return a<Ca?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,f=e[0],h=e[1],d=e[2],p=e[3],w=e[4],x=e[5],y=e[6],m=e[7],_=e[8],T=e[9],P=e[10],b=e[11],C=r*r*u+c,M=s*r*u+o*l,R=o*r*u-s*l,O=r*s*u-o*l,U=s*s*u+c,G=o*s*u+r*l,V=r*o*u+s*l,X=s*o*u-r*l,Ye=o*o*u+c,t[0]=f*C+w*M+_*R,t[1]=h*C+x*M+T*R,t[2]=d*C+y*M+P*R,t[3]=p*C+m*M+b*R,t[4]=f*O+w*U+_*G,t[5]=h*O+x*U+T*G,t[6]=d*O+y*U+P*G,t[7]=p*O+m*U+b*G,t[8]=f*V+w*X+_*Ye,t[9]=h*V+x*X+T*Ye,t[10]=d*V+y*X+P*Ye,t[11]=p*V+m*X+b*Ye,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function D_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+f*i,t[7]=l*r+h*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=f*r-a*i,t[11]=h*r-l*i,t}function GL(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-f*i,t[3]=l*r-h*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+f*r,t[11]=l*i+h*r,t}function z_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+f*i,t[3]=l*r+h*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=f*r-a*i,t[7]=h*r-l*i,t}function WL(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,d=r*a,p=r*l,w=s*o,x=s*a,y=s*l;return t[0]=1-f-p,t[1]=u+y,t[2]=h-x,t[3]=0,t[4]=u-y,t[5]=1-c-p,t[6]=d+w,t[7]=0,t[8]=h+x,t[9]=d-w,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function HL(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function XL(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var YL=XL;function ZL(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}var $L=ZL;function KL(t,e,n,i){var r,s,o,a,l,c,u,f,h,d,p=e[0],w=e[1],x=e[2],y=i[0],m=i[1],_=i[2],T=n[0],P=n[1],b=n[2];return Math.abs(p-T)<Ca&&Math.abs(w-P)<Ca&&Math.abs(x-b)<Ca?UL(t):(u=p-T,f=w-P,h=x-b,d=1/Math.hypot(u,f,h),u*=d,f*=d,h*=d,r=m*h-_*f,s=_*u-y*h,o=y*f-m*u,d=Math.hypot(r,s,o),d?(d=1/d,r*=d,s*=d,o*=d):(r=0,s=0,o=0),a=f*o-h*s,l=h*r-u*o,c=u*s-f*r,d=Math.hypot(a,l,c),d?(d=1/d,a*=d,l*=d,c*=d):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(r*p+s*w+o*x),t[13]=-(a*p+l*w+c*x),t[14]=-(u*p+f*w+h*x),t[15]=1,t)}function qL(){var t=new Lr(4);return Lr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function QL(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function po(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}(function(){var t=qL();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Lf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Lf||(Lf={}));const JL=45*Math.PI/180,e2=1,au=.1,lu=500,t2=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Pt extends zL{static get IDENTITY(){return i2()}static get ZERO(){return n2()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Lf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,f,h,d,p,w,x){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=w,this[15]=x,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,f,h,d,p,w,x){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=f,this[11]=w,this[12]=r,this[13]=l,this[14]=h,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(t2)}fromObject(e){return this.check()}fromQuaternion(e){return WL(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=au,far:a=lu}=e;return a===1/0?r2(this,n,i,r,s,o):HL(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return KL(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=au,far:a=lu}=e;return $L(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=JL,aspect:i=e2,focalDistance:r=1,near:s=au,far:o=lu}=e;fm(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return fm(n),YL(this,n,i,r,s),this.check()}determinant(){return VL(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return BL(this,this),this.check()}invert(){return Cf(this,this),this.check()}multiplyLeft(e){return Ei(this,e,this),this.check()}multiplyRight(e){return Ei(this,this,e),this.check()}rotateX(e){return D_(this,this,e),this.check()}rotateY(e){return GL(this,this,e),this.check()}rotateZ(e){return z_(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return jL(this,this,e,n),this.check()}scale(e){return sd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return hl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=po(n||[-0,-0,-0,-0],e,this),su(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=TL(n||[-0,-0],e,this);break;case 3:r=F_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=SL(n||[-0,-0],e,this);break;case 3:i=N_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let ta,na;function n2(){return ta||(ta=new Pt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ta)),ta}function i2(){return na||(na=new Pt,Object.freeze(na)),na}function fm(t){if(t>Math.PI*2)throw Error("expected radians")}function r2(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const hm=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,s2={lightSources:{}};function cu(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function o2(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=cu(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=cu(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=cu(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function U_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s2;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},o2({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return U_({lightSources:e})}return{}}const B_={name:"lights",vs:hm,fs:hm,getUniforms:U_,defines:{MAX_LIGHTS:3}},a2=new Uint8Array([0,255,255,255]),l2={pickingSelectedColor:null,pickingHighlightColor:a2,pickingActive:!1,pickingAttribute:!1};function c2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:l2;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const u2=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,f2=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,h2={name:"picking",vs:u2,fs:f2,getUniforms:c2},V_=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,d2={};function g2(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function j_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d2;if(!("material"in t))return{};const{material:e}=t;return e?g2(e):{lighting_uEnabled:!1}}const od={name:"gouraud-lighting",dependencies:[B_],vs:V_,defines:{LIGHTING_VERTEX:1},getUniforms:j_},p2={name:"phong-lighting",dependencies:[B_],fs:V_,defines:{LIGHTING_FRAGMENT:1},getUniforms:j_},m2=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,v2={name:"transform",vs:m2,fs:null};class mo{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new mo(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),f=this._getHash(i),h=c.map(_=>this._getHash(_.name)).sort(),d=o.map(_=>this._getHash(_)),p=Object.keys(r).sort(),w=Object.keys(s).sort(),x=[],y=[];for(const _ of p)x.push(this._getHash(_)),x.push(this._getHash(r[_]));for(const _ of w)y.push(this._getHash(_)),y.push(this._getHash(s[_]));const m="".concat(u,"/").concat(f,"D").concat(x.join("/"),"M").concat(h.join("/"),"I").concat(y.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[m]){const _=tL(this.gl,{vs:n,fs:i,modules:c,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[m]=new x_(this.gl,{hash:m,vs:_.vs,fs:_.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=_.getUniforms||(T=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const y2={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function _2(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=w2(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,c={...o};delete c.value,i[a]=[new J(t,l),c],E2(s,c)}}if(r){const s=r.value||r;N(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new J(t,{data:s,target:34963}),o]}return i}function w2(t,e){const{attributeMap:n=y2}=e||{};return n&&n[t]||t}function E2(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}N(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const ji=2,x2=1e4,T2="Model needs drawMode and vertexCount",dm=()=>{},S2={};class bt{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Jt("model")}=n;N(Gl(e)),this.id=i,this.gl=e,this.id=n.id||Jt("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||mo.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},N(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),T2)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return N(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return N(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=_2(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Pr(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return ed(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let c;B.priority>=ji&&(c=this._logDrawCallStart(ji));const u=this.vertexArray.getDrawParams(),{isIndexed:f=u.isIndexed,indexType:h=u.indexType,indexOffset:d=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&B.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:w,instanceCount:x}=this,{onBeforeRender:y=dm,onAfterRender:m=dm}=this.props;y(),this.program.setUniforms(this.uniforms);const _=this.program.draw(Object.assign(S2,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:w,instanceCount:x,offset:f?d:0}));return m(),B.priority>=ji&&this._logDrawCallEnd(c,l,i),_}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return B.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}N(n instanceof x_,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new mC(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof J&&n.delete()}}_setAnimationProps(e){this.animated&&N(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Pr(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new T_(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:x2;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),B.group(ji,">>> DRAWING MODEL ".concat(this.id),{collapsed:B.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=_C({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Jp({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:u}=Jp({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&B.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&B.log("UNUSED UNIFORMS",Object.keys(a))();const f=EC(this.vertexArray.configuration);B.table(e,s)(),B.table(e,o)(),B.table(e+1,f)(),r&&r.log({logLevel:ji,message:"Rendered to ".concat(r.id)}),B.groupEnd(ji)()}}class P2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof J?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&N(Z(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:c})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new T_(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],N(i[s]instanceof J)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new J(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const b2="transform_uSampler_",dl="transform_uSize_",gm="transform_position";function A2(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const l={};let c=e,u={};if(o>0||i){const f=c.split(`
`),h=f.slice();if(f.forEach((d,p,w)=>{if(o>0){const x=R2(d,n);if(x){const{updatedLine:y,inject:m}=x;h[p]=y,u=Pf([u,m]),Object.assign(l,x.samplerTextureMap),o--}}i&&!a&&(a=I2(d,i))}),i){N(r);const d="".concat(dl).concat(i),p="uniform vec2 ".concat(d,`;
`),w="     vec2 ".concat(gm," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(gm,`, 0, 1.);
`);u=Pf([u,{"vs:#decl":p,"vs:#main-start":w}])}c=h.join(`
`)}return{vs:c,targetTextureType:a,inject:u,samplerTextureMap:l}}function C2(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(dl).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(dl).concat(a)]=[s,o];return r}function L2(t){return M_(t,["attribute","in"])}function M2(t){const e="".concat(b2).concat(t),n="".concat(dl).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function I2(t,e){const n=M_(t,["varying","out"]);return n&&n.name===e?n.type:null}function R2(t,e){const n={},i=L2(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:c}=M2(s),u=uL(r),f="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}const O2={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},k2="transform_output";class N2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=i[h]}this._setSourceTextureParameters();const u=C2({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Hl(n);if(!e)return i;const r=i.constructor,s=fL(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<s;c++)o[a++]=i[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof We)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new J(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new _e(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(O2)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=sA(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=A2({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=Pf([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||I_({version:w_(r),input:this.targetTextureVarying,inputType:o,output:k2}),f=this.hasSourceTextures||this.targetTextureVarying?[v2].concat(e.modules||[]):e.modules;return{vs:r,fs:u,modules:f,uniforms:s,inject:c}}}class ad{static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();N(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new bt(n,Object.assign({},e,{fs:e.fs||I_({version:w_(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){F2(n)&&(this.bufferTransform=new P2(e,n)),D2(n)&&(this.textureTransform=new N2(e,n)),N(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function F2(t){return!!(!Pr(t.feedbackBuffers)||!Pr(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function D2(t){return!!(!Pr(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const pm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Ut{static get DRAW_MODE(){return pm}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Jt("geometry"),drawMode:i=pm.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,N(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(N(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return N(Number.isFinite(i)),i}}const z2=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),U2=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),B2=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),V2=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),j2={POSITION:{size:3,value:new Float32Array(U2)},NORMAL:{size:3,value:new Float32Array(B2)},TEXCOORD_0:{size:2,value:new Float32Array(V2)}};class G2 extends Ut{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Jt("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(z2)},attributes:{...j2,...e.attributes}})}}let W2=1,H2=1;class G_{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=W2++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=H2++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const W_="#define SMOOTH_EDGE_RADIUS 0.5",X2=`
`.concat(W_,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Y2=`
`.concat(W_,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Z2={name:"geometry",vs:X2,fs:Y2},$={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty($,"IDENTITY",{get:()=>(H.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Kt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ht={common:0,meters:1,pixels:2},mm={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},vo={DRAW:"draw",MASK:"mask"},$2=Object.keys($).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat($[t],";")).join(""),K2=Object.keys(Kt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Kt[t],";")).join(""),q2=Object.keys(ht).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ht[t],";")).join(""),Q2="".concat($2,`
`).concat(K2,`
`).concat(q2,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);
      return 1.0 / cos(radians(y));
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}
//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size(position_world.z),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function J2(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Xl(t){let e={},n;return i=>{for(const r in i)if(!J2(i[r],e[r])){n=t(i),e=i;break}return n}}const vm=[0,0,0,0],e3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],H_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t3=[0,0,0],X_=[0,0,0],n3=Xl(s3);function Y_(t,e,n=X_){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===$.LNGLAT_OFFSETS||e===$.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Kt.WEB_MERCATOR:(e===$.LNGLAT||e===$.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Kt.WEB_MERCATOR_AUTO_OFFSET:e===$.LNGLAT?i=r:e===$.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Kt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Kt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function i3(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=vm,l=vm,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=Y_(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=po([],l,o),s=i||s,o=Ei([],r,s),o=Ei([],o,e3)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function r3({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=$.DEFAULT,coordinateOrigin:r=X_,autoWrapLongitude:s=!1}){i===$.DEFAULT&&(i=t.isGeospatial?$.LNGLAT:$.CARTESIAN);const o=n3({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||H_,o}function s3({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=i3(t,n,i),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=po([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:t3,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:H_,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case $.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case $.LNGLAT:case $.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case $.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const o3={};function a3(t=o3){return"viewport"in t?r3(t):{}}const ld={name:"project",dependencies:[gL,Z2],vs:Q2,getUniforms:a3},l3=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,tn={name:"project32",dependencies:[ld],vs:l3};function c3(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dr(t,e){const n=po([],e,t);return QL(n,n,1/n[3]),n}function ym(t,e){const n=t%e;return n<0?e+n:n}function Mf(t,e,n){return t<e?e:t>n?n:t}function u3(t){return Math.log(t)*Math.LOG2E}const cd=Math.log2||u3;function En(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ot=Math.PI,Z_=Ot/4,Dt=Ot/180,If=180/Ot,Ks=512,Rf=4003e4,ia=85.051129,f3=1.5;function h3(t){return cd(t)}function Mr(t){const[e,n]=t;En(Number.isFinite(e)),En(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Dt,r=n*Dt,s=Ks*(i+Ot)/(2*Ot),o=Ks*(Ot+Math.log(Math.tan(Z_+r*.5)))/(2*Ot);return[s,o]}function Ir(t){const[e,n]=t,i=e/Ks*(2*Ot)-Ot,r=2*(Math.atan(Math.exp(n/Ks*(2*Ot)-Ot))-Z_);return[i*If,r*If]}function d3(t){const{latitude:e}=t;En(Number.isFinite(e));const n=Math.cos(e*Dt);return h3(Rf*n)-9}function Of(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;En(Number.isFinite(e)&&Number.isFinite(n));const r=Ks,s=Math.cos(e*Dt),o=r/360,a=o/s,l=r/Rf/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=Dt*Math.tan(e*Dt)/s,f=o*u/2,h=r/Rf*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function $_(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Of({longitude:n,latitude:i,highPrecision:!0}),u=Mr(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=Ir(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[f[0],f[1],h]:f}function g3(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=c3();hl(a,a,[0,0,-r]),D_(a,a,-n*Dt),z_(a,a,i*Dt);const l=s/e;return sd(a,a,[l,l,l]),o&&hl(a,a,CL([],o)),a}function p3(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=gl(f3)}=t;i!==void 0&&(u=gl(i));const f=u*Dt,h=r*Dt,d=K_(u);let p=d;o&&(p+=o[2]*a/Math.cos(h)/n);const w=f*(.5+(s?s[1]:0)/n),x=Math.sin(w)*p/Math.sin(Mf(Math.PI/2-h-w,.01,Math.PI-.01)),y=Math.sin(h)*x+p,m=p*10,_=Math.min(y*c,m);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:_}}function gl(t){return 2*Math.atan(.5/t)*If}function K_(t){return .5/Math.tan(.5*t*Dt)}function q_(t,e){const[n,i,r=0]=t;return En(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),dr(e,[n,i,r,1])}function Yl(t,e,n=0){const[i,r,s]=t;if(En(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return dr(e,[i,r,s,1]);const o=dr(e,[i,r,0,1]),a=dr(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return k_([],o,a,u)}function Q_(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,f=m3(t.padding),h=Mr([a,Mf(u,-ia,ia)]),d=Mr([c,Mf(l,-ia,ia)]),p=[Math.max(Math.abs(d[0]-h[0]),r),Math.max(Math.abs(d[1]-h[1]),r)],w=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];En(w[0]>0&&w[1]>0);const x=w[0]/p[0],y=w[1]/p[1],m=(f.right-f.left)/2/x,_=(f.top-f.bottom)/2/y,T=[(d[0]+h[0])/2+m,(d[1]+h[1])/2+_],P=Ir(T),b=Math.min(s,cd(Math.abs(Math.min(x,y))));return En(Number.isFinite(b)),{longitude:P[0],latitude:P[1],zoom:b}}function m3(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(En(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const _m=Math.PI/180;function v3(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*_m:Math.atan(.5/t.altitude),f=(90-t.pitch)*_m;return u>f-.01?(l=wm(t,0,e),c=wm(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function wm(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=dr(i,[e,0,1,1]),s=dr(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=k_([],r,s,a),c=Ir(l);return c.push(n),c}const Em=512;function y3(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=ym(r+180,360)-180),(a<-180||a>180)&&(a=ym(a+180,360)-180);const l=cd(n/Em);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Ir([0,c])[1];if(s<u)s=u;else{const f=Ir([0,Em-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const _3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,w3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,E3=Xl(b3),x3=Xl(A3),T3=[0,0,0,1],S3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function P3(t,e){const[n,i,r]=t,s=Yl([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function b3({viewport:t,center:e}){return new Pt(t.viewProjectionMatrix).invert().transform(e)}function A3({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>P3(o,i));for(const o of e){const a=o.clone().translate(new en(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Pt().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function C3(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||T3,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=E3({viewport:t.viewport,center:e.project_uCenter}),s=[],o=x3({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new en(t.viewport.center).negate());e.project_uCoordinateSystem===$.LNGLAT&&e.project_uProjectionMode===Kt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight(S3),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const uu={name:"shadow",dependencies:[ld],vs:_3,fs:w3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?C3(t,e):{}},nn={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...h2},L3=[ld],M3=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function I3(t){const e=mo.getDefaultProgramManager(t);for(const n of L3)e.addDefaultModule(n);for(const n of M3)e.addShaderHook(n);return e}const R3=[255,255,255],O3=1;let k3=0;class J_{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","ambient");const{color:n=R3}=e,{intensity:i=O3}=e;this.id=e.id||"ambient-".concat(k3++),this.color=n,this.intensity=i}}const N3=[255,255,255],F3=1,D3=[0,0,-1];let z3=0;class xm{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","directional"),g(this,"direction",void 0),g(this,"shadow",void 0);const{color:n=N3}=e,{intensity:i=F3}=e,{direction:r=D3}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(z3++),this.color=n,this.intensity=i,this.type="directional",this.direction=new en(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class U3{constructor(e,n={id:"pass"}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Zl extends U3{constructor(...e){super(...e),g(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return wn(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const c=this.gl;l&&V3(c),a&&(this._lastRenderIndex=-1);const u=[];for(const f of r){const h=s&&s[f.id];o(f);const d=this._getDrawLayerParams(f,e),p=f.subViewports||[f];for(const w of p){const x=this._drawLayersInViewport(c,{target:n,moduleParameters:i,viewport:w,view:h,pass:e.pass,layers:e.layers},d);u.push(x)}}return u}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const l=[],c=e1(this._lastRenderIndex+1),u={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},f={};for(let h=0;h<n.length;h++){const d=n[h],p=this._shouldDrawLayer(d,u,r,f),w={shouldDrawLayer:p};p&&(w.layerRenderIndex=c(d,p),w.moduleParameters=this._getModuleParameters(d,o,i,a),w.layerParameters=this.getLayerParameters(d,h,e)),l[h]=w}return l}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=B3(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;xt(e,{scissorTest:!0,scissor:c},()=>ed(e,f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};wn(e,{viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:w,layerParameters:x}=l[f];if(d&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),w.viewport=o;try{h._drawLayer({moduleParameters:w,uniforms:{layerIndex:p},parameters:x})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(r))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Sr(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function e1(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||e1(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function B3(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Sr(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function V3(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;wn(t,{viewport:[0,0,e,n]}),t.clear(16640)}class j3 extends Zl{constructor(e,n){super(e,n),g(this,"shadowMap",void 0),g(this,"depthBuffer",void 0),g(this,"fbo",void 0),this.shadowMap=new We(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new rr(e,{format:33189,width:1,height:1}),this.fbo=new _e(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;xt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Sr(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const G3={color:[255,255,255],intensity:1},Tm=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],W3=[0,0,0,200/255];class ud{constructor(e={}){g(this,"id","lighting-effect"),g(this,"props",null),g(this,"shadowColor",W3),g(this,"shadow",void 0),g(this,"ambientLight",null),g(this,"directionalLights",[]),g(this,"pointLights",[]),g(this,"shadowPasses",[]),g(this,"shadowMaps",[]),g(this,"dummyShadowMap",null),g(this,"programManager",void 0),g(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=mo.getDefaultProgramManager(e),uu&&this.programManager.addDefaultModule(uu)),this.dummyShadowMap||(this.dummyShadowMap=new We(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(uu),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Pt().lookAt({eye:new en(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new j3(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new J_(G3),this.directionalLights.push(new xm(Tm[0]),new xm(Tm[1])))}}class H3{constructor(e={}){g(this,"_pool",[]),g(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*i+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const Rr=new H3;function gs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function X3(t,e){const n=t%e;return n<0?e+n:n}function Y3(t){return[t[12],t[13],t[14]]}function Z3(t){return{left:Gi(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Gi(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Gi(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Gi(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Gi(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Gi(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Sm=new en;function Gi(t,e,n,i){Sm.set(t,e,n);const r=Sm.len();return{distance:i/r,normal:new en(-t/r,-e/r,-n/r)}}function $3(t){return t-Math.fround(t)}let os;function fu(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;os=Rr.allocate(os,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];os[a+l]=c,os[a+l+n]=$3(c)}a+=n*2}return os.subarray(0,s*n*2)}const K3=Math.PI/180,q3=gs(),Pm=[0,0,0],Q3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function J3({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new Pt().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new Pt().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:d=0}=s,p=Me((u+t-f)/2,0,t)-t/2,w=Me((h+e-d)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=w*2/e}return c}class Ni{constructor(e={}){g(this,"id",void 0),g(this,"x",void 0),g(this,"y",void 0),g(this,"width",void 0),g(this,"height",void 0),g(this,"isGeospatial",void 0),g(this,"zoom",void 0),g(this,"focalDistance",void 0),g(this,"position",void 0),g(this,"modelMatrix",void 0),g(this,"distanceScales",void 0),g(this,"scale",void 0),g(this,"center",void 0),g(this,"cameraPosition",void 0),g(this,"projectionMatrix",void 0),g(this,"viewMatrix",void 0),g(this,"viewMatrixUncentered",void 0),g(this,"viewMatrixInverse",void 0),g(this,"viewProjectionMatrix",void 0),g(this,"pixelProjectionMatrix",void 0),g(this,"pixelUnprojectionMatrix",void 0),g(this,"resolution",void 0),g(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.distanceScales=e.distanceScales||Q3,this.focalDistance=e.focalDistance||1,this.position=e.position||Pm,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Kt.WEB_MERCATOR:Kt.WEB_MERCATOR_AUTO_OFFSET:Kt.IDENTITY}equals(e){return e instanceof Ni?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Cr(e.projectionMatrix,this.projectionMatrix)&&Cr(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=q_(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=Yl([r,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Mr(e);return n[1]=Me(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Ir(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Of({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Z3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=d3({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Of({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=Pm;if(s&&(a=o?new Pt(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new en(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=q3,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Pt().multiplyRight(n).translate(new en(this.center).negate()),this.projectionMatrix=i||J3({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*K3,focalDistance:u,padding:c,near:a,far:l});const f=gs();Ei(f,f,this.projectionMatrix),Ei(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Cf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Y3(this.viewMatrixInverse);const h=gs(),d=gs();sd(h,h,[this.width/2,-this.height/2,1]),hl(h,h,[1,-1,0]),Ei(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Cf(gs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||H.warn("Pixel project matrix not invertible")()}}g(Ni,"displayName","Viewport");const eM=512,tM=4003e4,nM=Math.PI/180;function bm(t){const e=Math.cos(t*nM);return eM/tM/e}class ei extends Ni{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,orthographic:c=!1,projectionMatrix:u,repeat:f=!1,worldOffset:h=0,legacyMeterSizes:d=!1}=e;let{width:p,height:w,altitude:x=1.5}=e;const y=Math.pow(2,r);p=p||1,w=w||1;let m,_=null;u?(x=u[5]/2,m=gl(x)):(e.fovy?(m=e.fovy,x=K_(m)):m=gl(x),_=p3({width:p,height:w,pitch:s,fovy:m,nearZMultiplier:a,farZMultiplier:l}));let T=g3({height:w,pitch:s,bearing:o,scale:y,altitude:x});h&&(T=new Pt().translate([512*h,0,0]).multiplyLeft(T)),super({...e,width:p,height:w,viewMatrix:T,longitude:i,latitude:n,zoom:r,..._,fovy:m,focalDistance:x}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"pitch",void 0),g(this,"bearing",void 0),g(this,"altitude",void 0),g(this,"fovy",void 0),g(this,"orthographic",void 0),g(this,"_subViewports",void 0),g(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=x,this.fovy=m,this.orthographic=c,this._subViewports=f?[]:null,this._pseudoMeters=d,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new ei({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*bm(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/bm(i);return[n,i,r]}addMetersToLngLat(e,n){return $_(e,n)}panByPosition(e,n){const i=Yl(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=fl([],r,O_([],i)),o=fl([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=v3(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=Q_({width:i,height:r,bounds:e,...n});return new ei({width:i,height:r,longitude:s,latitude:o,zoom:a})}}g(ei,"displayName","WebMercatorViewport");function hu(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof ei){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function iM(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===$.DEFAULT&&(r=e.isGeospatial?$.LNGLAT:$.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function t1(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=po([],[o,a,l,1],n)),i){case $.LNGLAT:return hu([o,a,l],e,s);case $.LNGLAT_OFFSETS:return hu([o+r[0],a+r[1],l+(r[2]||0)],e,s);case $.METER_OFFSETS:return hu($_(r,[o,a,l]),e,s);case $.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function n1(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=iM(e),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=Y_(n,i,r),f=t1(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const h=n.projectPosition(l||c);DL(f,f,h)}return f}const rM=[255,255,255],sM=1,oM=[0,0,1],aM=[0,0,1];let lM=0;class cM{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","point"),g(this,"position",void 0),g(this,"attenuation",void 0),g(this,"projectedLight",void 0);const{color:n=rM}=e,{intensity:i=sM}=e,{position:r=aM}=e;this.id=e.id||"point-".concat(lM++),this.color=n,this.intensity=i,this.type="point",this.position=r,this.attenuation=uM(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,i=e.context.viewport,{coordinateSystem:r,coordinateOrigin:s}=e.props,o=n1(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:s,fromCoordinateSystem:i.isGeospatial?$.LNGLAT:$.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function uM(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:oM}const Hi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},pl=Symbol.for("component"),gr=Symbol.for("asyncPropDefaults"),Ci=Symbol.for("asyncPropOriginal"),Bn=Symbol.for("asyncPropResolved");function fd(t,e=()=>!0){return Array.isArray(t)?i1(t,e,[]):e(t)?[t]:[]}function i1(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?i1(r,e,n):e(r)&&n.push(r)}return n}function fM({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class hM{constructor(e,n,i){g(this,"id",void 0),g(this,"context",void 0),g(this,"isLoaded",void 0),g(this,"persistent",void 0),g(this,"_loadCount",0),g(this,"_subscribers",new Set),g(this,"_data",void 0),g(this,"_loader",void 0),g(this,"_error",void 0),g(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=ll(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class dM{constructor({gl:e,protocol:n}){g(this,"protocol",void 0),g(this,"_context",void 0),g(this,"_resources",void 0),g(this,"_consumers",void 0),g(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new hM(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const gM="layerManager.setLayers",pM="layerManager.activateViewport";class mM{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){g(this,"layers",void 0),g(this,"context",void 0),g(this,"resourceManager",void 0),g(this,"_lastRenderedLayers",[]),g(this,"_needsRedraw",!1),g(this,"_needsUpdate",!1),g(this,"_nextLayers",null),g(this,"_debug",!1),g(this,"activateViewport",o=>{Fe(pM,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new dM({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&I3(e),stats:i||new Hh({id:"deck.gl"}),viewport:r||new Ni({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new G_,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Fe(gM,this,n,e),this._lastRenderedLayers=e;const i=fd(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?H.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&H.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Hi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Hi.MATCHED,n!==e&&(e.lifecycle=Hi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Hi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Hi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function zr(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&zr(i,r)))return!1}return!0}class vM{constructor(e){g(this,"width",void 0),g(this,"height",void 0),g(this,"views",void 0),g(this,"viewState",void 0),g(this,"controllers",void 0),g(this,"timeline",void 0),g(this,"_viewports",void 0),g(this,"_viewportMap",void 0),g(this,"_isUpdating",void 0),g(this,"_needsRedraw",void 0),g(this,"_needsUpdate",void 0),g(this,"_eventManager",void 0),g(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=fd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!zr(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):H.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=Boolean(s.controller);c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const yM=/([0-9]+\.?[0-9]*)(%|px)/;function Mn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=yM.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function In(t,e){return t.relative?Math.round(t.position*e):t.position}function Pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Li{constructor(e){g(this,"id",void 0),g(this,"viewportInstance",void 0),g(this,"_x",void 0),g(this,"_y",void 0),g(this,"_width",void 0),g(this,"_height",void 0),g(this,"_padding",void 0),g(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Pe(!l||l instanceof Ni),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Mn(i),this._y=Mn(r),this._width=Mn(s),this._height=Mn(o),this._padding=a&&{left:Mn(a.left||0),right:Mn(a.right||0),top:Mn(a.top||0),bottom:Mn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&zr(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:In(this._x,e),y:In(this._y,n),width:In(this._width,e),height:In(this._height,n)};return this._padding&&(i.padding={left:In(this._padding.left,e),top:In(this._padding.top,n),right:In(this._padding.right,e),bottom:In(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class yo{constructor(e){g(this,"_inProgress",void 0),g(this,"_handle",void 0),g(this,"_timeline",void 0),g(this,"time",void 0),g(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Am=()=>{},kf={BREAK:1,SNAP_TO_END:2,IGNORE:3},_M=t=>t,wM=kf.BREAK;class EM{constructor(e){g(this,"getControllerState",void 0),g(this,"props",void 0),g(this,"propsInTransition",void 0),g(this,"transition",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new yo(e.timeline),this.onViewStateChange=e.onViewStateChange||Am,this.onStateChange=e.onStateChange||Am}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===kf.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===kf.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||_M,interpolator:s,interruption:n.transitionInterruption||wM,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class xM{constructor(e){g(this,"_propsToCompare",void 0),g(this,"_propsToExtract",void 0),g(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Cr(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Pe(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const TM=["longitude","latitude","zoom","bearing","pitch"],SM=["longitude","latitude","zoom"];class hd extends xM{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:TM,required:SM},super(i.transitionProps),g(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=wi(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,wi(e.around,n.around,i)))}return r}}const Rn={transitionDuration:0},PM=300,ra=t=>1-(1-t)*(1-t),Wi={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ci={};class r1{constructor(e){g(this,"props",void 0),g(this,"state",{}),g(this,"transitionManager",void 0),g(this,"eventManager",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"makeViewport",void 0),g(this,"_controllerState",void 0),g(this,"_events",{}),g(this,"_interactionState",{isDragging:!1}),g(this,"_customEvents",[]),g(this,"_eventStartBlocked",null),g(this,"_panMove",!1),g(this,"invertPan",!1),g(this,"dragMode","rotate"),g(this,"inertia",0),g(this,"scrollZoom",!0),g(this,"dragPan",!0),g(this,"dragRotate",!0),g(this,"doubleClickZoom",!0),g(this,"touchZoom",!0),g(this,"touchRotate",!1),g(this,"keyboard",!0),this.transitionManager=new EM({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?PM:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=Boolean(this.onViewStateChange);this.toggleEvents(Wi.WHEEL,u&&i),this.toggleEvents(Wi.PAN,u&&(r||s)),this.toggleEvents(Wi.PINCH,u&&(a||l)),this.toggleEvents(Wi.TRIPLE_PAN,u&&l),this.toggleEvents(Wi.DOUBLE_TAP,u&&o),this.toggleEvents(Wi.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Rn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Rn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ra},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Rn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ra},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Rn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Rn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ra},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ci._startPinchRotation=e.rotation,ci._lastPinchEvent=e,this.updateViewport(i,Rn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:ci._startPinchRotation-i})}return this.updateViewport(n,Rn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ci._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=ci;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:ra},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ci._startPinchRotation=null,ci._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Rn:e?{...n,transitionInterpolator:new hd({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class s1{constructor(e,n){g(this,"_viewportProps",void 0),g(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Cm=5,bM=1.2;class AM extends s1{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T,normalize:P=!0}=e;Pe(Number.isFinite(s)),Pe(Number.isFinite(r)),Pe(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:P,position:u},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T}),g(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=Me(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=Me(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Me(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,y3(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Cm&&(h=o/(l-u)*bM):o<0&&l>Cm&&(h=1-a/l),h=Me(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),w=r+180*f;let x=i;return h>0?x=i+h*(p-i):h<0&&(x=i-h*(d-i)),{pitch:x,bearing:w}}}class CM extends r1{constructor(...e){super(...e),g(this,"ControllerState",AM),g(this,"transition",{transitionDuration:300,transitionInterpolator:new hd({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),g(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class o1 extends Li{get ViewportType(){return ei}get ControllerType(){return CM}}g(o1,"displayName","MapView");class LM extends Zl{constructor(e,n){super(e,n),g(this,"maskMap",void 0),g(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new We(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new _e(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,xt(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===vo.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const MM=new Pt().lookAt({eye:[0,0,1]});function IM({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,l=e/2;if(r){const{left:c=0,right:u=0,top:f=0,bottom:h=0}=r,d=Me((c+t-u)/2,0,t)-t/2,p=Me((f+e-h)/2,0,e)-e/2;s-=d,o-=d,a+=p,l+=p}return new Pt().ortho({left:s,right:o,bottom:a,top:l,near:n,far:i})}class RM extends Ni{constructor(e){const{width:n,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:c=!0}=e,u=Array.isArray(o)?o[0]:o,f=Array.isArray(o)?o[1]:o,h=Math.min(u,f),d=Math.pow(2,h);let p;if(u!==f){const w=Math.pow(2,u),x=Math.pow(2,f);p={unitsPerMeter:[w/d,x/d,1],metersPerUnit:[d/w,d/x,1]}}super({...e,longitude:void 0,position:a,viewMatrix:MM.clone().scale([d,d*(c?-1:1),d]),projectionMatrix:IM({width:n||1,height:i||1,padding:l,near:r,far:s}),zoom:h,distanceScales:p})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=Yl(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=fl([],r,O_([],i)),o=fl([],this.center,s);return{target:this.unprojectFlat(o)}}}class OM extends s1{constructor(e){const{width:n,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:u=-1/0,maxZoom:f=1/0,startPanPosition:h,startRotatePos:d,startRotationX:p,startRotationOrbit:w,startZoomPosition:x,startZoom:y}=e;super({width:n,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:c,minZoom:u,maxZoom:f},{startPanPosition:h,startRotatePos:d,startRotationX:p,startRotationOrbit:w,startZoomPosition:x,startZoom:y}),g(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let c;if(e){let u=(e[0]-r[0])/a;const f=(e[1]-r[1])/l;(s<-90||s>90)&&(u*=-1),c={rotationX:s+f*180,rotationOrbit:o+u*180}}else c={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-n.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return Me(s,r,i)}_panFromCenter(e){const{width:n,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(r)?[Me(r[0],i,n),Me(r[1],i,n)]:Me(r,i,n),e.rotationX=Me(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=X3(a+180,360)-180),e}}class kM extends OM{constructor(e){super(e),g(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[o,a]=n;switch(this.zoomAxis){case"X":o=Me(o+s,r,i);break;case"Y":a=Me(a+s,r,i);break;default:let l=Math.min(o+s,a+s);l<r&&(s+=r-l),l=Math.max(o+s,a+s),l>i&&(s+=i-l),o+=s,a+=s}return[o,a]}return Me(n+s,r,i)}}class NM extends r1{constructor(...e){super(...e),g(this,"ControllerState",kM),g(this,"transition",{transitionDuration:300,transitionInterpolator:new hd(["target","zoom"])}),g(this,"dragMode","pan")}_onPanRotate(){return!1}}class a1 extends Li{get ViewportType(){return RM}get ControllerType(){return NM}}g(a1,"displayName","OrthographicView");function FM({layers:t,viewport:e}){let n=null;for(const s of t){const o=s.getBounds();o&&(n?(n[0]=Math.min(n[0],o[0][0]),n[1]=Math.min(n[1],o[0][1]),n[2]=Math.max(n[2],o[1][0]),n[3]=Math.max(n[3],o[1][1])):n=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=e.getBounds();if(!n)return i;const r=zM(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}function DM({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const r=1;if(n-=r*2,i-=r*2,e instanceof ei){const{longitude:a,latitude:l,zoom:c}=Q_({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new ei({longitude:a,latitude:l,zoom:c,x:r,y:r,width:n,height:i})}const s=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],o=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new a1({x:r,y:r}).makeViewport({width:n,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function zM(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class UM{constructor(){g(this,"id","mask-effect"),g(this,"props",null),g(this,"useInPicking",!0),g(this,"dummyMaskMap",void 0),g(this,"channels",[]),g(this,"masks",null),g(this,"maskPass",void 0),g(this,"maskMap",void 0),g(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new We(e,{width:1,height:1}));const a=n.filter(f=>f.props.visible&&f.props.operation===vo.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new LM(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const l=this._sortMaskChannels(a),c=r[0],u=!this.lastViewport||!this.lastViewport.equals(c);for(const f in l)this._renderChannel(l[f],{layerFilter:i,onViewportActive:s,views:o,viewport:c,viewportChanged:u})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[e.index];if(!a)return;const l=e===a||a.layers.length!==e.layers.length||e.layerBounds.some((c,u)=>c!==a.layerBounds[u]);if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,(l||o)&&(this.lastViewport=s,e.bounds=FM({layers:e.layers,viewport:s}),l||!Cr(e.bounds,a.bounds))){const{maskPass:c,maskMap:u}=this,f=DM({bounds:e.bounds,viewport:s,width:u.width,height:u.height});e.maskBounds=f?f.getBounds():[0,0,1,1],c.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:f?[f]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const r of e){const{id:s}=r.root;let o=n[s];if(!o){if(++i>4){H.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},n[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in n))&&(this.channels[r]=null)}for(const r in n){const s=n[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const BM=new ud;class VM{constructor(){g(this,"effects",void 0),g(this,"_internalEffects",void 0),g(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!zr(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new UM),e.some(n=>n instanceof ud)||this._internalEffects.push(BM)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class jM extends Zl{shouldDrawLayer(e){return e.props.operation===vo.DRAW}}const Lm={blendFunc:[1,0,32771,0],blendEquation:32774};class l1 extends Zl{constructor(...e){super(...e),g(this,"pickZ",void 0),g(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p}){const w=this.gl;this.pickZ=p;const x=p?null:{byLayer:new Map,byAlpha:[]};this._colors=x;const y=xt(w,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Lm,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(_=>_.useInPicking),pass:d}));return this._colors=null,{decodePickingColor:x&&WM.bind(null,x),stats:y}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===vo.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,Lm),r.blend=!0,r.blendColor=GM(this._colors,e,i)):r.blend=!1,r}}function GM(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(H.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function WM(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const HM="deckRenderer.renderLayers";class XM{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new jM(e),this.pickLayersPass=new l1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||_e.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,Fe(HM,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const r of e)r.preRender(this.gl,n),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new _e(this.gl),new _e(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const YM={pickedColor:null,pickedObjectIndex:-1};function ZM({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,f=-1,h=0;for(let d=0;d<c;d++){const p=d+a-i,w=p*p;if(w>u)h+=4*l;else for(let x=0;x<l;x++){if(t[h+3]-1>=0){const m=x+o-n,_=m*m+w;_<=u&&(u=_,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),p=e(d);if(p){const w=Math.floor(f/4/l),x=f/4-w*l;return{...p,pickedColor:d,pickedX:o+x,pickedY:a+w}}H.error("Picked non-existent layer. Is picking buffer corrupt?")()}return YM}function $M({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):H.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function c1({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=qM((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function KM(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const p=r.find(w=>w.props.id===h);p&&l.unshift(p)}n.layerId=d,n.index=a,n.info=null}}const c=c1(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=u1({layer:f,info:h,mode:i});const d=h.layer;f===o&&i==="hover"&&(n.info=h),u.set(d.id,h),i==="hover"&&d.updateAutoHighlight(h)}),u}function u1({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function qM(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class QM{constructor(e){g(this,"gl",void 0),g(this,"pickingFBO",void 0),g(this,"depthFBO",void 0),g(this,"pickLayersPass",void 0),g(this,"layerFilter",void 0),g(this,"lastPickedInfo",void 0),g(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new l1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(h=>h.id===o):null,c=a&&r.find(h=>h.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new _e(i),_e.isSupported(i,{colorBufferFloat:!0}))){const r=new _e(i);r.attach({[36064]:new We(i,{format:Z(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this._getPickable(e),d=Sr(this.gl);if(!h)return{result:[],emptyInfo:c1({viewports:i,x:r,y:s,pixelRatio:d})};this._resizeBuffer();const p=Kc(this.gl,[r,s],!0),w=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],x=Math.round(o*d),{width:y,height:m}=this.pickingFBO,_=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:y,deviceHeight:m}),T={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let P;const b=[],C=new Set;for(let M=0;M<a;M++){let R;if(_){const U=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:_,cullRect:T,effects:f,pass:"picking:".concat(l)});R=ZM({...U,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:_})}else R={pickedColor:null,pickedObjectIndex:-1};let O;R.pickedLayer&&c&&this.depthFBO&&(O=this._drawAndSample({layers:[R.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:T,effects:f,pass:"picking:".concat(l,":z")},!0).pickedColors[0]),R.pickedLayer&&M+1<a&&(C.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),P=KM({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:i,x:r,y:s,z:O,pixelRatio:d});for(const U of P.values())U.layer&&b.push(U);if(!R.pickedColor)break}for(const M of C)M.restorePickingColors();return{result:b,emptyInfo:P.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const d=Sr(this.gl),p=Kc(this.gl,[r,s],!0),w=p.x,x=p.y+p.height,y=Kc(this.gl,[r+o,s+a],!0),m=y.x+y.width,_=y.y,T={x:w,y:_,width:m-w,height:x-_},P=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:T,cullRect:{x:r,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),b=$M(P),C=new Map,M=Number.isFinite(c);for(let R=0;R<b.length&&!(M&&c&&C.size>=c);R++){const O=b[R];let U={color:O.pickedColor,layer:null,index:O.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};U=u1({layer:O.pickedLayer,info:U,mode:l}),C.has(U.object)||C.set(U.object,U)}return Array.from(C.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,{decodePickingColor:f}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c}),{x:h,y:d,width:p,height:w}=s,x=new(c?Float32Array:Uint8Array)(p*w*4);return Hl(u,{sourceX:h,sourceY:d,sourceWidth:p,sourceHeight:w,target:x}),{pickedColors:x,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const JM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class eI{constructor(e){g(this,"el",null),g(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,JM),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(!!r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Ur={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(v,E,S){return setTimeout(_(v,S),E)}function h(v,E,S){return Array.isArray(v)?(d(v,S[E],S),!0):!1}function d(v,E,S){var A;if(!!v)if(v.forEach)v.forEach(E,S);else if(v.length!==r)for(A=0;A<v.length;)E.call(S,v[A],A,v),A++;else for(A in v)v.hasOwnProperty(A)&&E.call(S,v[A],A,v)}function p(v,E,S){var A="DEPRECATED METHOD: "+E+`
`+S+` AT 
`;return function(){var L=new Error("get-stack-trace"),F=L&&L.stack?L.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Y=e.console&&(e.console.warn||e.console.log);return Y&&Y.call(e.console,A,F),v.apply(this,arguments)}}var w;typeof Object.assign!="function"?w=function(E){if(E===r||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(E),A=1;A<arguments.length;A++){var L=arguments[A];if(L!==r&&L!==null)for(var F in L)L.hasOwnProperty(F)&&(S[F]=L[F])}return S}:w=Object.assign;var x=p(function(E,S,A){for(var L=Object.keys(S),F=0;F<L.length;)(!A||A&&E[L[F]]===r)&&(E[L[F]]=S[L[F]]),F++;return E},"extend","Use `assign`."),y=p(function(E,S){return x(E,S,!0)},"merge","Use `assign`.");function m(v,E,S){var A=E.prototype,L;L=v.prototype=Object.create(A),L.constructor=v,L._super=A,S&&w(L,S)}function _(v,E){return function(){return v.apply(E,arguments)}}function T(v,E){return typeof v==a?v.apply(E&&E[0]||r,E):v}function P(v,E){return v===r?E:v}function b(v,E,S){d(O(E),function(A){v.addEventListener(A,S,!1)})}function C(v,E,S){d(O(E),function(A){v.removeEventListener(A,S,!1)})}function M(v,E){for(;v;){if(v==E)return!0;v=v.parentNode}return!1}function R(v,E){return v.indexOf(E)>-1}function O(v){return v.trim().split(/\s+/g)}function U(v,E,S){if(v.indexOf&&!S)return v.indexOf(E);for(var A=0;A<v.length;){if(S&&v[A][S]==E||!S&&v[A]===E)return A;A++}return-1}function G(v){return Array.prototype.slice.call(v,0)}function V(v,E,S){for(var A=[],L=[],F=0;F<v.length;){var Y=E?v[F][E]:v[F];U(L,Y)<0&&A.push(v[F]),L[F]=Y,F++}return S&&(E?A=A.sort(function(Ae,Be){return Ae[E]>Be[E]}):A=A.sort()),A}function X(v,E){for(var S,A,L=E[0].toUpperCase()+E.slice(1),F=0;F<s.length;){if(S=s[F],A=S?S+L:E,A in v)return A;F++}return r}var Ye=1;function ri(){return Ye++}function Pn(v){var E=v.ownerDocument||v;return E.defaultView||E.parentWindow||e}var D=/mobile|tablet|ip(ad|hone|od)|android/i,j="ontouchstart"in e,W=X(e,"PointerEvent")!==r,le=j&&D.test(navigator.userAgent),oe="touch",Fi="pen",At="mouse",Br="kinect",rn=25,me=1,si=2,ve=4,Ze=8,Eo=1,Vr=2,jr=4,Gr=8,Wr=16,Bt=Vr|jr,oi=Gr|Wr,bd=Bt|oi,Ad=["x","y"],xo=["clientX","clientY"];function pt(v,E){var S=this;this.manager=v,this.callback=E,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(A){T(v.options.enable,[v])&&S.handler(A)},this.init()}pt.prototype={handler:function(){},init:function(){this.evEl&&b(this.element,this.evEl,this.domHandler),this.evTarget&&b(this.target,this.evTarget,this.domHandler),this.evWin&&b(Pn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(Pn(this.element),this.evWin,this.domHandler)}};function iw(v){var E,S=v.options.inputClass;return S?E=S:W?E=oc:le?E=Po:j?E=ac:E=So,new E(v,rw)}function rw(v,E,S){var A=S.pointers.length,L=S.changedPointers.length,F=E&me&&A-L===0,Y=E&(ve|Ze)&&A-L===0;S.isFirst=!!F,S.isFinal=!!Y,F&&(v.session={}),S.eventType=E,sw(v,S),v.emit("hammer.input",S),v.recognize(S),v.session.prevInput=S}function sw(v,E){var S=v.session,A=E.pointers,L=A.length;S.firstInput||(S.firstInput=Cd(E)),L>1&&!S.firstMultiple?S.firstMultiple=Cd(E):L===1&&(S.firstMultiple=!1);var F=S.firstInput,Y=S.firstMultiple,Te=Y?Y.center:F.center,Ae=E.center=Ld(A);E.timeStamp=u(),E.deltaTime=E.timeStamp-F.timeStamp,E.angle=sc(Te,Ae),E.distance=To(Te,Ae),ow(S,E),E.offsetDirection=Id(E.deltaX,E.deltaY);var Be=Md(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=Be.x,E.overallVelocityY=Be.y,E.overallVelocity=c(Be.x)>c(Be.y)?Be.x:Be.y,E.scale=Y?cw(Y.pointers,A):1,E.rotation=Y?lw(Y.pointers,A):0,E.maxPointers=S.prevInput?E.pointers.length>S.prevInput.maxPointers?E.pointers.length:S.prevInput.maxPointers:E.pointers.length,aw(S,E);var jt=v.element;M(E.srcEvent.target,jt)&&(jt=E.srcEvent.target),E.target=jt}function ow(v,E){var S=E.center,A=v.offsetDelta||{},L=v.prevDelta||{},F=v.prevInput||{};(E.eventType===me||F.eventType===ve)&&(L=v.prevDelta={x:F.deltaX||0,y:F.deltaY||0},A=v.offsetDelta={x:S.x,y:S.y}),E.deltaX=L.x+(S.x-A.x),E.deltaY=L.y+(S.y-A.y)}function aw(v,E){var S=v.lastInterval||E,A=E.timeStamp-S.timeStamp,L,F,Y,Te;if(E.eventType!=Ze&&(A>rn||S.velocity===r)){var Ae=E.deltaX-S.deltaX,Be=E.deltaY-S.deltaY,jt=Md(A,Ae,Be);F=jt.x,Y=jt.y,L=c(jt.x)>c(jt.y)?jt.x:jt.y,Te=Id(Ae,Be),v.lastInterval=E}else L=S.velocity,F=S.velocityX,Y=S.velocityY,Te=S.direction;E.velocity=L,E.velocityX=F,E.velocityY=Y,E.direction=Te}function Cd(v){for(var E=[],S=0;S<v.pointers.length;)E[S]={clientX:l(v.pointers[S].clientX),clientY:l(v.pointers[S].clientY)},S++;return{timeStamp:u(),pointers:E,center:Ld(E),deltaX:v.deltaX,deltaY:v.deltaY}}function Ld(v){var E=v.length;if(E===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var S=0,A=0,L=0;L<E;)S+=v[L].clientX,A+=v[L].clientY,L++;return{x:l(S/E),y:l(A/E)}}function Md(v,E,S){return{x:E/v||0,y:S/v||0}}function Id(v,E){return v===E?Eo:c(v)>=c(E)?v<0?Vr:jr:E<0?Gr:Wr}function To(v,E,S){S||(S=Ad);var A=E[S[0]]-v[S[0]],L=E[S[1]]-v[S[1]];return Math.sqrt(A*A+L*L)}function sc(v,E,S){S||(S=Ad);var A=E[S[0]]-v[S[0]],L=E[S[1]]-v[S[1]];return Math.atan2(L,A)*180/Math.PI}function lw(v,E){return sc(E[1],E[0],xo)+sc(v[1],v[0],xo)}function cw(v,E){return To(E[0],E[1],xo)/To(v[0],v[1],xo)}var uw={mousedown:me,mousemove:si,mouseup:ve},fw="mousedown",hw="mousemove mouseup";function So(){this.evEl=fw,this.evWin=hw,this.pressed=!1,pt.apply(this,arguments)}m(So,pt,{handler:function(E){var S=uw[E.type];S&me&&E.button===0&&(this.pressed=!0),S&si&&E.which!==1&&(S=ve),this.pressed&&(S&ve&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[E],changedPointers:[E],pointerType:At,srcEvent:E}))}});var dw={pointerdown:me,pointermove:si,pointerup:ve,pointercancel:Ze,pointerout:Ze},gw={2:oe,3:Fi,4:At,5:Br},Rd="pointerdown",Od="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Rd="MSPointerDown",Od="MSPointerMove MSPointerUp MSPointerCancel");function oc(){this.evEl=Rd,this.evWin=Od,pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(oc,pt,{handler:function(E){var S=this.store,A=!1,L=E.type.toLowerCase().replace("ms",""),F=dw[L],Y=gw[E.pointerType]||E.pointerType,Te=Y==oe,Ae=U(S,E.pointerId,"pointerId");F&me&&(E.button===0||Te)?Ae<0&&(S.push(E),Ae=S.length-1):F&(ve|Ze)&&(A=!0),!(Ae<0)&&(S[Ae]=E,this.callback(this.manager,F,{pointers:S,changedPointers:[E],pointerType:Y,srcEvent:E}),A&&S.splice(Ae,1))}});var pw={touchstart:me,touchmove:si,touchend:ve,touchcancel:Ze},mw="touchstart",vw="touchstart touchmove touchend touchcancel";function kd(){this.evTarget=mw,this.evWin=vw,this.started=!1,pt.apply(this,arguments)}m(kd,pt,{handler:function(E){var S=pw[E.type];if(S===me&&(this.started=!0),!!this.started){var A=yw.call(this,E,S);S&(ve|Ze)&&A[0].length-A[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:A[0],changedPointers:A[1],pointerType:oe,srcEvent:E})}}});function yw(v,E){var S=G(v.touches),A=G(v.changedTouches);return E&(ve|Ze)&&(S=V(S.concat(A),"identifier",!0)),[S,A]}var _w={touchstart:me,touchmove:si,touchend:ve,touchcancel:Ze},ww="touchstart touchmove touchend touchcancel";function Po(){this.evTarget=ww,this.targetIds={},pt.apply(this,arguments)}m(Po,pt,{handler:function(E){var S=_w[E.type],A=Ew.call(this,E,S);!A||this.callback(this.manager,S,{pointers:A[0],changedPointers:A[1],pointerType:oe,srcEvent:E})}});function Ew(v,E){var S=G(v.touches),A=this.targetIds;if(E&(me|si)&&S.length===1)return A[S[0].identifier]=!0,[S,S];var L,F,Y=G(v.changedTouches),Te=[],Ae=this.target;if(F=S.filter(function(Be){return M(Be.target,Ae)}),E===me)for(L=0;L<F.length;)A[F[L].identifier]=!0,L++;for(L=0;L<Y.length;)A[Y[L].identifier]&&Te.push(Y[L]),E&(ve|Ze)&&delete A[Y[L].identifier],L++;if(!!Te.length)return[V(F.concat(Te),"identifier",!0),Te]}var xw=2500,Nd=25;function ac(){pt.apply(this,arguments);var v=_(this.handler,this);this.touch=new Po(this.manager,v),this.mouse=new So(this.manager,v),this.primaryTouch=null,this.lastTouches=[]}m(ac,pt,{handler:function(E,S,A){var L=A.pointerType==oe,F=A.pointerType==At;if(!(F&&A.sourceCapabilities&&A.sourceCapabilities.firesTouchEvents)){if(L)Tw.call(this,S,A);else if(F&&Sw.call(this,A))return;this.callback(E,S,A)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Tw(v,E){v&me?(this.primaryTouch=E.changedPointers[0].identifier,Fd.call(this,E)):v&(ve|Ze)&&Fd.call(this,E)}function Fd(v){var E=v.changedPointers[0];if(E.identifier===this.primaryTouch){var S={x:E.clientX,y:E.clientY};this.lastTouches.push(S);var A=this.lastTouches,L=function(){var F=A.indexOf(S);F>-1&&A.splice(F,1)};setTimeout(L,xw)}}function Sw(v){for(var E=v.srcEvent.clientX,S=v.srcEvent.clientY,A=0;A<this.lastTouches.length;A++){var L=this.lastTouches[A],F=Math.abs(E-L.x),Y=Math.abs(S-L.y);if(F<=Nd&&Y<=Nd)return!0}return!1}var Dd=X(o.style,"touchAction"),zd=Dd!==r,Ud="compute",Bd="auto",lc="manipulation",ai="none",Hr="pan-x",Xr="pan-y",bo=bw();function cc(v,E){this.manager=v,this.set(E)}cc.prototype={set:function(v){v==Ud&&(v=this.compute()),zd&&this.manager.element.style&&bo[v]&&(this.manager.element.style[Dd]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return d(this.manager.recognizers,function(E){T(E.options.enable,[E])&&(v=v.concat(E.getTouchAction()))}),Pw(v.join(" "))},preventDefaults:function(v){var E=v.srcEvent,S=v.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var A=this.actions,L=R(A,ai)&&!bo[ai],F=R(A,Xr)&&!bo[Xr],Y=R(A,Hr)&&!bo[Hr];if(L){var Te=v.pointers.length===1,Ae=v.distance<2,Be=v.deltaTime<250;if(Te&&Ae&&Be)return}if(!(Y&&F)&&(L||F&&S&Bt||Y&&S&oi))return this.preventSrc(E)},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function Pw(v){if(R(v,ai))return ai;var E=R(v,Hr),S=R(v,Xr);return E&&S?ai:E||S?E?Hr:Xr:R(v,lc)?lc:Bd}function bw(){if(!zd)return!1;var v={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){v[S]=E?e.CSS.supports("touch-action",S):!0}),v}var Ao=1,mt=2,Di=4,bn=8,sn=bn,Yr=16,Vt=32;function on(v){this.options=w({},this.defaults,v||{}),this.id=ri(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Ao,this.simultaneous={},this.requireFail=[]}on.prototype={defaults:{},set:function(v){return w(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(h(v,"recognizeWith",this))return this;var E=this.simultaneous;return v=Co(v,this),E[v.id]||(E[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return h(v,"dropRecognizeWith",this)?this:(v=Co(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(h(v,"requireFailure",this))return this;var E=this.requireFail;return v=Co(v,this),U(E,v)===-1&&(E.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(h(v,"dropRequireFailure",this))return this;v=Co(v,this);var E=U(this.requireFail,v);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var E=this,S=this.state;function A(L){E.manager.emit(L,v)}S<bn&&A(E.options.event+Vd(S)),A(E.options.event),v.additionalEvent&&A(v.additionalEvent),S>=bn&&A(E.options.event+Vd(S))},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=Vt},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(Vt|Ao)))return!1;v++}return!0},recognize:function(v){var E=w({},v);if(!T(this.options.enable,[this,E])){this.reset(),this.state=Vt;return}this.state&(sn|Yr|Vt)&&(this.state=Ao),this.state=this.process(E),this.state&(mt|Di|bn|Yr)&&this.tryEmit(E)},process:function(v){},getTouchAction:function(){},reset:function(){}};function Vd(v){return v&Yr?"cancel":v&bn?"end":v&Di?"move":v&mt?"start":""}function jd(v){return v==Wr?"down":v==Gr?"up":v==Vr?"left":v==jr?"right":""}function Co(v,E){var S=E.manager;return S?S.get(v):v}function Ct(){on.apply(this,arguments)}m(Ct,on,{defaults:{pointers:1},attrTest:function(v){var E=this.options.pointers;return E===0||v.pointers.length===E},process:function(v){var E=this.state,S=v.eventType,A=E&(mt|Di),L=this.attrTest(v);return A&&(S&Ze||!L)?E|Yr:A||L?S&ve?E|bn:E&mt?E|Di:mt:Vt}});function Lo(){Ct.apply(this,arguments),this.pX=null,this.pY=null}m(Lo,Ct,{defaults:{event:"pan",threshold:10,pointers:1,direction:bd},getTouchAction:function(){var v=this.options.direction,E=[];return v&Bt&&E.push(Xr),v&oi&&E.push(Hr),E},directionTest:function(v){var E=this.options,S=!0,A=v.distance,L=v.direction,F=v.deltaX,Y=v.deltaY;return L&E.direction||(E.direction&Bt?(L=F===0?Eo:F<0?Vr:jr,S=F!=this.pX,A=Math.abs(v.deltaX)):(L=Y===0?Eo:Y<0?Gr:Wr,S=Y!=this.pY,A=Math.abs(v.deltaY))),v.direction=L,S&&A>E.threshold&&L&E.direction},attrTest:function(v){return Ct.prototype.attrTest.call(this,v)&&(this.state&mt||!(this.state&mt)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var E=jd(v.direction);E&&(v.additionalEvent=this.options.event+E),this._super.emit.call(this,v)}});function uc(){Ct.apply(this,arguments)}m(uc,Ct,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ai]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&mt)},emit:function(v){if(v.scale!==1){var E=v.scale<1?"in":"out";v.additionalEvent=this.options.event+E}this._super.emit.call(this,v)}});function fc(){on.apply(this,arguments),this._timer=null,this._input=null}m(fc,on,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bd]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,A=v.distance<E.threshold,L=v.deltaTime>E.time;if(this._input=v,!A||!S||v.eventType&(ve|Ze)&&!L)this.reset();else if(v.eventType&me)this.reset(),this._timer=f(function(){this.state=sn,this.tryEmit()},E.time,this);else if(v.eventType&ve)return sn;return Vt},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===sn&&(v&&v.eventType&ve?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function hc(){Ct.apply(this,arguments)}m(hc,Ct,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ai]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&mt)}});function dc(){Ct.apply(this,arguments)}m(dc,Ct,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Bt|oi,pointers:1},getTouchAction:function(){return Lo.prototype.getTouchAction.call(this)},attrTest:function(v){var E=this.options.direction,S;return E&(Bt|oi)?S=v.overallVelocity:E&Bt?S=v.overallVelocityX:E&oi&&(S=v.overallVelocityY),this._super.attrTest.call(this,v)&&E&v.offsetDirection&&v.distance>this.options.threshold&&v.maxPointers==this.options.pointers&&c(S)>this.options.velocity&&v.eventType&ve},emit:function(v){var E=jd(v.offsetDirection);E&&this.manager.emit(this.options.event+E,v),this.manager.emit(this.options.event,v)}});function Mo(){on.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Mo,on,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[lc]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,A=v.distance<E.threshold,L=v.deltaTime<E.time;if(this.reset(),v.eventType&me&&this.count===0)return this.failTimeout();if(A&&L&&S){if(v.eventType!=ve)return this.failTimeout();var F=this.pTime?v.timeStamp-this.pTime<E.interval:!0,Y=!this.pCenter||To(this.pCenter,v.center)<E.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!Y||!F?this.count=1:this.count+=1,this._input=v;var Te=this.count%E.taps;if(Te===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=sn,this.tryEmit()},E.interval,this),mt):sn}return Vt},failTimeout:function(){return this._timer=f(function(){this.state=Vt},this.options.interval,this),Vt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==sn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function an(v,E){return E=E||{},E.recognizers=P(E.recognizers,an.defaults.preset),new gc(v,E)}an.VERSION="2.0.7",an.defaults={domEvents:!1,touchAction:Ud,enable:!0,inputTarget:null,inputClass:null,preset:[[hc,{enable:!1}],[uc,{enable:!1},["rotate"]],[dc,{direction:Bt}],[Lo,{direction:Bt},["swipe"]],[Mo],[Mo,{event:"doubletap",taps:2},["tap"]],[fc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Aw=1,Gd=2;function gc(v,E){this.options=w({},an.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=v,this.input=iw(this),this.touchAction=new cc(this,this.options.touchAction),Wd(this,!0),d(this.options.recognizers,function(S){var A=this.add(new S[0](S[1]));S[2]&&A.recognizeWith(S[2]),S[3]&&A.requireFailure(S[3])},this)}gc.prototype={set:function(v){return w(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?Gd:Aw},recognize:function(v){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(v);var S,A=this.recognizers,L=E.curRecognizer;(!L||L&&L.state&sn)&&(L=E.curRecognizer=null);for(var F=0;F<A.length;)S=A[F],E.stopped!==Gd&&(!L||S==L||S.canRecognizeWith(L))?S.recognize(v):S.reset(),!L&&S.state&(mt|Di|bn)&&(L=E.curRecognizer=S),F++}},get:function(v){if(v instanceof on)return v;for(var E=this.recognizers,S=0;S<E.length;S++)if(E[S].options.event==v)return E[S];return null},add:function(v){if(h(v,"add",this))return this;var E=this.get(v.options.event);return E&&this.remove(E),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(h(v,"remove",this))return this;if(v=this.get(v),v){var E=this.recognizers,S=U(E,v);S!==-1&&(E.splice(S,1),this.touchAction.update())}return this},on:function(v,E){if(v!==r&&E!==r){var S=this.handlers;return d(O(v),function(A){S[A]=S[A]||[],S[A].push(E)}),this}},off:function(v,E){if(v!==r){var S=this.handlers;return d(O(v),function(A){E?S[A]&&S[A].splice(U(S[A],E),1):delete S[A]}),this}},emit:function(v,E){this.options.domEvents&&Cw(v,E);var S=this.handlers[v]&&this.handlers[v].slice();if(!(!S||!S.length)){E.type=v,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var A=0;A<S.length;)S[A](E),A++}},destroy:function(){this.element&&Wd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Wd(v,E){var S=v.element;if(!!S.style){var A;d(v.options.cssProps,function(L,F){A=X(S.style,F),E?(v.oldCssProps[A]=S.style[A],S.style[A]=L):S.style[A]=v.oldCssProps[A]||""}),E||(v.oldCssProps={})}}function Cw(v,E){var S=n.createEvent("Event");S.initEvent(v,!0,!0),S.gesture=E,E.target.dispatchEvent(S)}w(an,{INPUT_START:me,INPUT_MOVE:si,INPUT_END:ve,INPUT_CANCEL:Ze,STATE_POSSIBLE:Ao,STATE_BEGAN:mt,STATE_CHANGED:Di,STATE_ENDED:bn,STATE_RECOGNIZED:sn,STATE_CANCELLED:Yr,STATE_FAILED:Vt,DIRECTION_NONE:Eo,DIRECTION_LEFT:Vr,DIRECTION_RIGHT:jr,DIRECTION_UP:Gr,DIRECTION_DOWN:Wr,DIRECTION_HORIZONTAL:Bt,DIRECTION_VERTICAL:oi,DIRECTION_ALL:bd,Manager:gc,Input:pt,TouchAction:cc,TouchInput:Po,MouseInput:So,PointerEventInput:oc,TouchMouseInput:ac,SingleTouchInput:kd,Recognizer:on,AttrRecognizer:Ct,Tap:Mo,Pan:Lo,Swipe:dc,Pinch:uc,Rotate:hc,Press:fc,on:b,off:C,each:d,merge:y,extend:x,assign:w,inherit:m,bindFn:_,prefixed:X});var Lw=typeof e<"u"?e:typeof self<"u"?self:{};Lw.Hammer=an,typeof r=="function"&&r.amd?r(function(){return an}):t.exports?t.exports=an:e[i]=an})(window,document,"Hammer")})(Ur);const tI=Ur.exports,Ht=Mw({__proto__:null,default:tI},[Ur.exports]),f1=1,h1=2,Nf=4,nI={mousedown:f1,mousemove:h1,mouseup:Nf};function iI(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function rI(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(iI(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function sI(t){t.prototype.handler=function(n){let i=nI[n.type];i&f1&&n.button>=0&&(this.pressed=!0),i&h1&&n.which===0&&(i=Nf),this.pressed&&(i&Nf&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}rI(Ur.exports.PointerEventInput);sI(Ur.exports.MouseInput);const oI=Ur.exports.Manager;class $l{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const aI=Ht?[[Ht.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ht.Rotate,{enable:!1}],[Ht.Pinch,{enable:!1}],[Ht.Swipe,{enable:!1}],[Ht.Pan,{threshold:0,enable:!1}],[Ht.Press,{enable:!1}],[Ht.Tap,{event:"doubletap",taps:2,enable:!1}],[Ht.Tap,{event:"anytap",enable:!1}],[Ht.Tap,{enable:!1}]]:null,Mm={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},lI={doubletap:["tap"]},cI={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},dd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},uI={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Im={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},fI=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",sr=typeof window<"u"?window:global;let Ff=!1;try{const t={get passive(){return Ff=!0,!0}};sr.addEventListener("test",null,t),sr.removeEventListener("test",null)}catch{Ff=!1}const hI=fI.indexOf("firefox")!==-1,{WHEEL_EVENTS:dI}=dd,Rm="wheel",Om=4.000244140625,gI=40,pI=.25;class mI extends $l{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;sr.WheelEvent&&(hI&&r.deltaMode===sr.WheelEvent.DOM_DELTA_PIXEL&&(s/=sr.devicePixelRatio),r.deltaMode===sr.WheelEvent.DOM_DELTA_LINE&&(s*=gI)),s!==0&&s%Om===0&&(s=Math.floor(s/Om)),r.shiftKey&&s&&(s=s*pI),this.callback({type:Rm,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(dI),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Ff?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Rm&&(this.options.enable=n)}}const{MOUSE_EVENTS:vI}=dd,km="pointermove",Nm="pointerover",Fm="pointerout",Dm="pointerenter",zm="pointerleave";class yI extends $l{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(vI),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===km&&(this.enableMoveEvent=n),e===Nm&&(this.enableOverEvent=n),e===Fm&&(this.enableOutEvent=n),e===Dm&&(this.enableEnterEvent=n),e===zm&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Nm,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Fm,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Dm,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(zm,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(km,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:_I}=dd,Um="keydown",Bm="keyup";class wI extends $l{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:Um,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:Bm,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(_I),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Um&&(this.enableDownEvent=n),e===Bm&&(this.enableUpEvent=n)}}const Vm="contextmenu";class EI extends $l{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:Vm,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Vm&&(this.options.enable=n)}}const Df=1,ml=2,zf=4,xI={pointerdown:Df,pointermove:ml,pointerup:zf,mousedown:Df,mousemove:ml,mouseup:zf},TI=1,SI=2,PI=3,bI=0,AI=1,CI=2,LI=1,MI=2,II=4;function RI(t){const e=xI[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===zf||e===ml&&!Number.isFinite(n)?(s=r===TI,o=r===SI,a=r===PI):e===ml?(s=Boolean(n&LI),o=Boolean(n&II),a=Boolean(n&MI)):e===Df&&(s=i===bI,o=i===AI,a=i===CI),{leftButton:s,middleButton:o,rightButton:a}}function OI(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const du={srcElement:"root",priority:0};class kI{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=du;typeof i=="string"||i&&i.addEventListener?l={...du,srcElement:i}:i&&(l={...du,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:f}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...RI(e),...OI(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const NI={events:null,recognizers:null,recognizerOptions:{},Manager:oI,touchAction:"none",tabIndex:0};class FI{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=cI[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...NI,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||aI}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Mm).forEach(r=>{const s=this.manager.get(r);s&&Mm[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new mI(e,this._onOtherEvent,{enable:!1}),this.moveInput=new yI(e,this._onOtherEvent,{enable:!1}),this.keyInput=new wI(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new EI(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=lI[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=Im[e]||e;let c=a.get(l);c||(c=new kI(this),a.set(l,c),c.recognizerName=uI[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=Im[e]||e,s=i.get(r);if(!!s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ui(){}const DI=({isDragging:t})=>t?"grabbing":"grab",d1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ui,onResize:ui,onViewStateChange:ui,onInteractionStateChange:ui,onBeforeRender:ui,onAfterRender:ui,onLoad:ui,onError:t=>H.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:DI,getTooltip:null,debug:!1,drawPickingColors:!1};class Kl{constructor(e){g(this,"props",void 0),g(this,"width",0),g(this,"height",0),g(this,"userData",{}),g(this,"canvas",null),g(this,"viewManager",null),g(this,"layerManager",null),g(this,"effectManager",null),g(this,"deckRenderer",null),g(this,"deckPicker",null),g(this,"eventManager",null),g(this,"tooltip",null),g(this,"metrics",void 0),g(this,"animationLoop",void 0),g(this,"stats",void 0),g(this,"viewState",void 0),g(this,"cursorState",void 0),g(this,"_needsRedraw",void 0),g(this,"_pickRequest",void 0),g(this,"_lastPointerDownInfo",null),g(this,"_metricsCounter",void 0),g(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),g(this,"_onEvent",n=>{const i=mm[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),c=this.props[i.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),g(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...d1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&H.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Vy()==="IE"&&H.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Hh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Rr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&H.removed("onLayerHover","onHover")(),"onLayerClick"in e&&H.removed("onLayerClick","onClick")(),e.initialViewState&&!zr(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pe(this.viewManager),this.viewManager.views}getViewports(e){return Pe(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){Pe(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new TC({width:n,height:i,useDevicePixels:u,autoResizeViewport:!1,gl:r,onCreateContext:f=>a_({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new o1({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Qh(e,{enable:!0,copyState:!0})),this.tooltip=new eI(this.canvas),wn(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new G_;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new FI(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in mm)this.eventManager.on(r,this._onEvent);this.viewManager=new vM({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new mM(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new VM,this.deckRenderer=new XM(e),this.deckPicker=new QM(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;wn(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),H.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=vi.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}g(Kl,"defaultProps",d1);g(Kl,"VERSION",MP.VERSION);class gu{constructor(e,n){g(this,"opts",void 0),g(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function zI(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function La(t){return t.stride||t.size*t.bytesPerElement}function g1(t,e){e.offset&&H.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=La(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function UI(t,e){const n=g1(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class BI{constructor(e,n,i){g(this,"gl",void 0),g(this,"id",void 0),g(this,"size",void 0),g(this,"settings",void 0),g(this,"value",void 0),g(this,"doublePrecision",void 0),g(this,"_buffer",void 0),g(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&v_(e,te.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=zI(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new J(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*La(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Rr.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=UI(this.getAccessor(),n||{});return i[e]=new gu(this,s.high),i["".concat(e,"64Low")]=r?new gu(this,s.low):new Float32Array(this.size),i}if(n){const i=g1(this.getAccessor(),n);return{[e]:new gu(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof J?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=La(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=La(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=fu(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?fu(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Rr.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?fu(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&H.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=r[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const jm=[],Gm=[];function _o(t,e=0,n=1/0){let i=jm;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Gm.length=t.length,i=Gm):i=jm,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function p1(t){return t&&t[Symbol.asyncIterator]}function m1(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:d})=>{if(!s){const y=h*l+c;for(let m=0;m<n;m++)d[m]=t[y+m];return d}const p=s[h],w=s[h+1]||u;let x;if(o){x=new Array(w-p);for(let y=p;y<w;y++){const m=y*l+c;d=new Array(n);for(let _=0;_<n;_++)d[_]=t[m+_];x[y-p]=d}}else if(l===n)x=t.subarray(p*n+c,w*n+c);else{x=new t.constructor((w-p)*n);let y=0;for(let m=p;m<w;m++){const _=m*l+c;for(let T=0;T<n;T++)x[y++]=t[_+T]}}return x}}const VI=[],Ma=[[0,1/0]];function jI(t,e){if(t===Ma||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function pu(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<r;f++)n[i+c]=u[f]||0,c++}}function GI({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return pu({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,f)=>i(u+a,f)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const f=r[u]*n,h=s[u]*n;pu({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&pu({source:[],target:e,start:a,size:n,getData:l}),e}const WI={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function v1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...WI[n],...e,...t,type:n}}function y1(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function _1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function w1(t){t.push(t.shift())}function gd(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function E1({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,f=gd(n,e),h=n.isConstant;if(!u&&i>=f)return;const d=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(m,_)=>n.normalizeConstant(y(m,_))}const p=h?(y,m)=>s(d,m):(y,m)=>s(d.subarray(y,y+a),m),w=t.getData({length:i}),x=new Float32Array(f);GI({source:w,target:x,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),t.byteLength<x.byteLength+l&&t.reallocate(x.byteLength+l),t.subData({data:x,offset:l})}class pd extends BI{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ma}),g(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return v1(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=jI(this.state.updateRanges,[i,r])}else this.state.updateRanges=Ma}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=VI}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Ma),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Pe(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=m1(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:s[h]);Pe(typeof p=="function",'accessor "'.concat(h,'" is not a function'));let w=e.getVertexOffset(i);const{iterable:x,objectInfo:y}=_o(n,i,r);for(const m of x){y.index++;let _=p(m,y);if(d&&(_=d.call(this,_)),f){const T=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(_&&Array.isArray(_[0])){let P=w;for(const b of _)e._normalizeValue(b,c,P),P+=u}else _&&_.length>u?c.set(_,w):(e._normalizeValue(_,y.target,0),fM({target:c,source:y.target,start:w,count:T}));w+=T*u}else e._normalizeValue(_,c,w),w+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class HI{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","interpolation"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.transition=new yo(i),this.attribute=n,this.attributeInTransition=new pd(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=YI(e,n);const r={byteLength:0,usage:35050};this.buffers=[new J(e,r),new J(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;w1(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)E1({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=gd(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:y1(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const XI=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function YI(t,e){const n=_1(e.size);return new ad(t,{vs:XI,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class ZI{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","spring"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"texture",void 0),g(this,"framebuffer",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new yo(i),this.attribute=n,this.attributeInTransition=new pd(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=KI(e),this.framebuffer=qI(e,this.texture),this.transform=$I(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new J(e,r),new J(e,r),new J(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)E1({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=gd(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:y1(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),w1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Hl(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function $I(t,e,n){const i=_1(e.size);return new ad(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function KI(t){return new We(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function qI(t,e){return new _e(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const QI={interpolation:HI,spring:ZI};class JI{constructor(e,{id:n,timeline:i}){g(this,"id",void 0),g(this,"isSupported",void 0),g(this,"gl",void 0),g(this,"timeline",void 0),g(this,"transitions",void 0),g(this,"needsRedraw",void 0),g(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ad.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);!o||this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){H.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=QI[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(H.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Wm="attributeManager.invalidate",eR="attributeManager.updateStart",tR="attributeManager.updateEnd",nR="attribute.updateStart",iR="attribute.allocate",rR="attribute.updateEnd";class sR{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"attributes",void 0),g(this,"updateTriggers",void 0),g(this,"needsRedraw",void 0),g(this,"userData",void 0),g(this,"stats",void 0),g(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new JI(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Fe(Wm,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Fe(Wm,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;Fe(eR,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&H.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Fe(tR,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new pd(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Fe(nR,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Fe(iR,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Fe(rR,n,i))}}class oR extends yo{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=wi(n,i,o)}}const Hm=1e-5;function Xm(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function aR(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Xm(t[o],e[o],n[o],i,r);return s}return Xm(t,e,n,i,r)}function Ym(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class lR extends yo{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=aR(s,o,n,i,r);const l=Ym(a,n),c=Ym(a,o);l<Hm&&c<Hm&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const cR={interpolation:oR,spring:lR};class uR{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=v1(r),!r)return;const o=cR[r.type];if(!o){H.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function fR(t){const e=md(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function hR(t,e){const n=x1({newProps:t,oldProps:e,propTypes:md(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=gR(t,e);let r=!1;return i||(r=pR(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:mR(t,e),transitionsChanged:dR(t,e)}}function dR(t,e){if(!t.transitions)return!1;const n={},i=md(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Uf(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function x1({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=Uf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=Uf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function Uf(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function gR(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function pR(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Zm(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&Zm(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function mR(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function Zm(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let r=e.updateTriggers[n];return r=r==null?{}:r,x1({oldProps:r,newProps:i,triggerName:n})}function md(t){const e=t[pl],n=e&&e.constructor;return n?n._propTypes:{}}const vR="count(): argument not an object",yR="count(): argument not a container";function _R(t){if(!ER(t))throw new Error(vR);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(wR(t))return Object.keys(t).length;throw new Error(yR)}function wR(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function ER(t){return t!==null&&typeof t=="object"}function xR(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const TR={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Bf={};function SR(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof We)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new We(n,{...e,parameters:{...TR,...i,...t.props.textureParameters}});return Bf[r.id]=!0,r}function PR(t){!t||!(t instanceof We)||Bf[t.id]&&(t.delete(),delete Bf[t.id])}const bR={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||qs(t)&&(t.length===3||t.length===4)},equal(t,e,n){return mu(t,e)}},accessor:{validate(t,e){const n=vl(t);return n==="function"||n===vl(e.value)},equal(t,e,n){return typeof e=="function"?!0:mu(t,e)}},array:{validate(t,e){return e.optional&&!t||qs(t)},equal(t,e,n){return n.compare?mu(t,e):t===e}},object:{equal(t,e,n){return n.compare?zr(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>SR(n,t),release:t=>{PR(t)}}};function mu(t,e){if(t===e)return!0;if(!qs(t)||!qs(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function AR(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=CR(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function CR(t,e){switch(vl(e)){case"object":return as(t,e);case"array":return as(t,{type:"array",value:e,compare:!1});case"boolean":return as(t,{type:"boolean",value:e});case"number":return as(t,{type:"number",value:e});case"function":return as(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function as(t,e){return"type"in e?{name:t,...bR[e.type],...e}:"value"in e?{name:t,type:vl(e.value),...e}:{name:t,type:"object",value:e}}function qs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function vl(t){return qs(t)?"array":t===null?"null":typeof t}function LR(t,e){const n=T1(t.constructor),i=Object.create(n);i[pl]=t,i[Ci]={},i[Bn]={};for(let r=0;r<e.length;++r){const s=e[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function T1(t){const e=yl(t,"_mergedDefaultProps");return e||(MR(t),t._mergedDefaultProps)}function MR(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=T1(n),r=yl(t,"defaultProps")||{},s=AR(r),o=IR(s.defaultProps,i,t),a={...n._propTypes,...s.propTypes};OR(o,a);const l={...n._deprecatedProps,...s.deprecatedProps};RR(o,l),t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=l}function IR(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=NR(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function RR(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])S1(this,s)||(this[s]=i);H.deprecated(r,e[n].join("/"))()}})}function OR(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=kR(o))}t[gr]=n,t[Ci]={},Object.defineProperties(t,i)}function kR(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||p1(e)?this[Ci][t]=e:this[Bn][t]=e},get(){if(this[Bn]){if(t in this[Bn])return this[Bn][t]||this[gr][t];if(t in this[Ci]){const e=this[pl]&&this[pl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[gr][t]}}return this[gr][t]}}}function S1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yl(t,e){return S1(t,e)&&t[e]}function NR(t){const e=yl(t,"layerName")||yl(t,"componentName");return e||H.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let FR=0;class vd{constructor(...e){g(this,"id",void 0),g(this,"props",void 0),g(this,"count",void 0),this.props=LR(this,e),this.id=this.props.id,this.count=FR++}clone(e){const{props:n}=this,i={};for(const r in n[gr])r in n[Bn]?i[r]=n[Bn][r]:r in n[Ci]&&(i[r]=n[Ci][r]);return new this.constructor({...n,...i,...e})}}g(vd,"componentName","Component");g(vd,"defaultProps",{});const DR=Object.freeze({});class zR{constructor(e){g(this,"component",void 0),g(this,"onAsyncPropUpdated",void 0),g(this,"asyncProps",void 0),g(this,"oldProps",void 0),g(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||DR}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[Bn]||{},i=e[Ci]||e,r=e[gr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(p1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class UR extends zR{constructor({attributeManager:e,layer:n}){super(n),g(this,"attributeManager",void 0),g(this,"needsRedraw",void 0),g(this,"needsUpdate",void 0),g(this,"subLayers",void 0),g(this,"usesPickingColorCache",void 0),g(this,"changeFlags",void 0),g(this,"viewport",void 0),g(this,"uniformTransitions",void 0),g(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const BR="layer.changeFlag",VR="layer.initialize",jR="layer.update",GR="layer.finalize",WR="layer.matched",$m=2**24-1,HR=Object.freeze([]),XR=Xl(({oldViewport:t,viewport:e})=>t.equals(e));let Xt=new Uint8ClampedArray(0);const YR={data:{type:"data",value:HR,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:ll(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):ll(t,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:vo.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:$.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class et extends vd{constructor(...e){super(...e),g(this,"internalState",null),g(this,"lifecycle",Hi.NO_STATE),g(this,"context",void 0),g(this,"state",void 0),g(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Pe(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=t1(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=q_(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Pe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pe(this.internalState);const i=this.internalState.viewport||this.context.viewport;return n1(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===$.DEFAULT||e===$.LNGLAT||e===$.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pe(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:_R(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:r}=n.attributes;return(e=i||r)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=xR(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const l of i)n.invalidateAll(l);else n.invalidateAll();const{props:r,oldProps:s}=e,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&n){const{pickingColors:l,instancePickingColors:c}=n.attributes,u=l||c;u&&(a&&u.constant&&(u.constant=!1,n.invalidate(u.id)),!u.value&&!a&&(u.constant=!0,u.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!XR({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Xt.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>$m&&H.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Xt=Rr.allocate(Xt,n,{size:3,copy:!0,maxCount:Math.max(n,$m)});const r=Math.floor(Xt.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Xt[o*3+0]=s[0],Xt[o*3+1]=s[1],Xt[o*3+2]=s[2]}e.value=Xt.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Xt.buffer&&(i.value=Xt.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Pe(!this.internalState),Pe(Number.isFinite(this.props.coordinateSystem)),Fe(VR,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new UR({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(H.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new uR(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Fe(WR,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Fe(jR,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Fe(GR,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];wn(s.gl,{polygonOffset:l}),xt(s.gl,i,()=>{const c={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Fe(BR,this,r,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=hR(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){fR(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new sR(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),Number.isInteger(a)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;return n=n||r,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}g(et,"defaultProps",YR);g(et,"layerName","Layer");const ZR="compositeLayer.renderLayers";class ql extends et{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:w,extensions:x,fetch:y,operation:m,_subLayerProps:_}=this.props,T={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:w,extensions:x,fetch:y,operation:m},P=_&&e.id&&_[e.id],b=P&&P.updateTriggers,C=e.id||"sublayer";if(P){const M=this.constructor._propTypes,R=e.type?e.type._propTypes:{};for(const O in P){const U=R[O]||M[O];U&&U.type==="accessor"&&(P[O]=this.getSubLayerAccessor(P[O]))}}Object.assign(T,e,P),T.id="".concat(this.props.id,"-").concat(C),T.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...b};for(const M of x){const R=M.getSubLayerProps.call(this,M);R&&Object.assign(T,R,{updateTriggers:Object.assign(T.updateTriggers,R.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=fd(s,Boolean),this.internalState.subLayers=i}Fe(ZR,this,r,i);for(const s of i)s.parent=this}}g(ql,"layerName","CompositeLayer");class P1{constructor(e){g(this,"opts",void 0),g(this,"typedArrayManager",void 0),g(this,"indexStarts",[0]),g(this,"vertexStarts",[0]),g(this,"vertexCount",0),g(this,"instanceCount",0),g(this,"attributes",void 0),g(this,"_attributeDefs",void 0),g(this,"data",void 0),g(this,"getGeometry",void 0),g(this,"geometryBuffer",void 0),g(this,"buffers",void 0),g(this,"positionSize",void 0),g(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Rr,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Pe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?m1(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=_o(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const d=f&&this.normalizeGeometry(f);c[h]=d,i[h+1]=i[h]+(d?this.getGeometrySize(d):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof J){const f=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;r=r||f.length/h}this._allocate(r,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((f,h)=>{const d=c[h]||f;u.vertexStart=i[h],u.indexStart=n[h];const p=h<i.length-1?i[h+1]:r;u.geometrySize=p-i[h],u.geometryIndex=h,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const $R=typeof window<"u"?k.exports.useLayoutEffect:k.exports.useEffect;function _l(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const KR={position:"absolute",zIndex:-1};function b1(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>b1(n,e));if(Ql(t)){if(qR(t))return e.style=KR,k.exports.cloneElement(t,e);if(QR(t))return k.exports.cloneElement(t,e)}return t}function Ql(t){return t&&typeof t=="object"&&"type"in t||!1}function qR(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function QR(t){const e=t.type;return e&&e.deckGLViewProps}function Vf(t){if(typeof t=="function")return k.exports.createElement(Li,{},t);if(Array.isArray(t))return t.map(Vf);if(Ql(t)){if(t.type===k.exports.Fragment)return Vf(t.props.children);if(_l(t.type,Li))return t}return t}function JR({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return k.exports.Children.forEach(Vf(t),o=>{if(Ql(o)){const a=o.type;if(_l(a,et)){const l=eO(a,o.props);r.push(l)}else i.push(o);if(_l(a,Li)&&a!==Li&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function eO(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function tO({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of t){let a=s,l=o;Ql(o)&&_l(o.type,Li)&&(a=o.props.id||s,l=o.props.children);const c=i.getViewport(a),u=i.getViewState(a);if(c){const{x:f,y:h,width:d,height:p}=c;l=b1(l,{x:f,y:h,width:d,height:p,viewport:c,viewState:u}),r[a]||(r[a]={viewport:c,children:[]}),r[a].children.push(l)}}return Object.keys(r).map(o=>{const{viewport:a,children:l}=r[o],{x:c,y:u,width:f,height:h}=a,d={position:"absolute",left:c,top:u,width:f,height:h},p="view-".concat(o),w=k.exports.createElement("div",{key:p,id:p,style:d},...l);if(n){const x={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:y=>{y.viewId=o,e._onViewStateChange(y)}};return k.exports.createElement(n,{key:p,value:x},w)}return w})}const nO={mixBlendMode:null};function iO({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in nO?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function rO(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function A1(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function sO(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():A1(t)}});return i}const C1=k.exports.forwardRef((t,e)=>{const[n,i]=k.exports.useState(0),s=k.exports.useRef({control:null,version:n,forceUpdate:()=>i(P=>P+1)}).current,o=k.exports.useRef(null),a=k.exports.useRef(null),l=k.exports.useMemo(()=>JR(t),[t.layers,t.views,t.children]);let c=!0;const u=P=>{var b;return c&&t.viewState?(s.viewStateUpdateRequested=P,null):(s.viewStateUpdateRequested=null,(b=t.onViewStateChange)===null||b===void 0?void 0:b.call(t,P))},f=P=>{if(c)s.interactionStateUpdateRequested=P;else{var b;s.interactionStateUpdateRequested=null,(b=t.onInteractionStateChange)===null||b===void 0||b.call(t,P)}},h=k.exports.useMemo(()=>{const P={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete P._customRender,s.deck&&s.deck.setProps(P),P},[t]);k.exports.useEffect(()=>{const P=t.Deck||Kl;return s.deck=sO(s,P,{...h,parent:o.current,canvas:a.current}),()=>{var b;return(b=s.deck)===null||b===void 0?void 0:b.finalize()}},[]),$R(()=>{A1(s);const{viewStateUpdateRequested:P,interactionStateUpdateRequested:b}=s;P&&u(P),b&&f(b)}),k.exports.useImperativeHandle(e,()=>rO(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:w,height:x,id:y,style:m}=t,{containerStyle:_,canvasStyle:T}=k.exports.useMemo(()=>iO({width:w,height:x,style:m}),[w,x,m]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const P=tO({children:l.children,deck:s.deck,ContextProvider:p}),b=k.exports.createElement("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:T});s.control=k.exports.createElement("div",{id:"".concat(y||"deckgl","-wrapper"),ref:o,style:_},[b,P])}return c=!1,s.control});C1.defaultProps=Kl.defaultProps;const oO=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  // d: distance on the xy plane
  // r: ratio of the current point
  // p: ratio of the peak of the arc
  // h: height multiplier
  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h
  // f(0) = 0
  // f(1) = dz

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;

  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}

/* Great circle interpolation
 * http://www.movable-type.co.uk/scripts/latlong.html
 */
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;

  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

/* END GREAT CIRCLE */

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));

  // if it's the first point, use next - current as direction
  // otherwise use current - prev
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      // split at the 180th meridian
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);

    // common x at longitude=-180
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }

  // Multiply out width and clamp to limits
  // mercator pixels are interpreted as screen pixels
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aO=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,wl=[0,0,0,255],lO={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:wl},getTargetColor:{type:"accessor",value:wl},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class L1 extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:oO,fs:aO,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:wl},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:wl},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){let n=[];for(let s=0;s<50;s++)n=n.concat([s,1,0,s,-1,0]);const r=new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return r.setUniforms({numSegments:50}),r}}g(L1,"layerName","ArcLayer");g(L1,"defaultProps",lO);const cO=new Uint16Array([0,2,1,0,3,2]),uO=new Float32Array([0,1,0,0,1,0,1,1]);function fO(t,e){if(!e)return hO(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),c=new Float64Array(r*s*3);let u=0,f=0;for(let h=0;h<r;h++){const d=h/(r-1);for(let p=0;p<s;p++){const w=p/(s-1),x=dO(t,d,w);c[u*3+0]=x[0],c[u*3+1]=x[1],c[u*3+2]=x[2]||0,l[u*2+0]=d,l[u*2+1]=1-w,h>0&&p>0&&(a[f++]=u-s,a[f++]=u-s-1,a[f++]=u-1,a[f++]=u-s,a[f++]=u-1,a[f++]=u),u++}}return{vertexCount:o,positions:c,indices:a,texCoords:l}}function hO(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:cO,texCoords:uO}}function dO(t,e,n){return wi(wi(t[0],t[1],n),wi(t[3],t[2],n),e)}const gO=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,pO=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,mO=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(pO,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),vO={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:$.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class M1 extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:gO,fs:mO,modules:[tn,nn]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:i}){const r=this.getAttributeManager();if(i.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),r.invalidateAll()}if(e.bounds!==n.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const l in a)o&&o[l]!==a[l]&&r.invalidate(l);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,i=e.info;if(!i.color||!n)return i.bitmap=null,i;const{width:r,height:s}=n;i.index=0;const o=yO(i.color),a=[Math.floor(o[0]*r),Math.floor(o[1]*s)];return i.bitmap={size:{width:r,height:s},uv:o,pixel:a},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return Km(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),fO(n,this.context.viewport.resolution)}_getModel(e){return e?new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:r,coordinateConversion:s,bounds:o,disablePicking:a}=this.state,{image:l,desaturate:c,transparentColor:u,tintColor:f}=this.props;i.pickingActive&&a||l&&r&&r.setUniforms(n).setUniforms({bitmapTexture:l,desaturate:c,transparentColor:u.map(h=>h/255),tintColor:f.slice(0,3).map(h=>h/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=$;let{_imageCoordinateSystem:r}=this.props;if(r!==i){const{bounds:s}=this.props;if(!Km(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(r=r===e?e:n,r===e&&o===n)return{coordinateConversion:-1,bounds:s};if(r===n&&o===e){const a=Mr([s[0],s[1]]),l=Mr([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}g(M1,"layerName","BitmapLayer");g(M1,"defaultProps",vO);function yO(t){const[e,n,i]=t,r=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+r)/256]}function Km(t){return Number.isFinite(t[0])}const _O=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,wO=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,EO=1024,xO=4,qm=()=>{},Qm={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function TO(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function SO(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function Qs(t){return t&&(t.id||t.url)}function PO(t,e,n,i){const r=t.width,s=t.height,o=new We(t.gl,{width:e,height:n,parameters:i});return Kb(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function Jm(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Qs(r);t[o]={...r,x:s,y:n}}}function bO({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Qs(c);if(!n[u]){const{height:f,width:h}=c;i+h+e>o&&(Jm(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+h+e,s=Math.max(s,f)}}return a.length>0&&Jm(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:TO(s+r+e)}}function AO(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=_o(t);for(const o of r){s.index++;const a=e(o,s),l=Qs(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class CO{constructor(e,{onUpdate:n=qm,onError:i=qm}){g(this,"gl",void 0),g(this,"onUpdate",void 0),g(this,"onError",void 0),g(this,"_loadOptions",null),g(this,"_texture",null),g(this,"_externalTexture",null),g(this,"_mapping",{}),g(this,"_textureParameters",null),g(this,"_pendingCount",0),g(this,"_autoPacking",!1),g(this,"_xOffset",0),g(this,"_yOffset",0),g(this,"_rowHeight",0),g(this,"_buffer",xO),g(this,"_canvasWidth",EO),g(this,"_canvasHeight",0),g(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Qs(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(AO(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=bO({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new We(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Qm})),this._texture.height!==this._canvasHeight&&(this._texture=PO(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Qm)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,ll(i.url,t_,this._loadOptions).then(r=>{const s=Qs(i),{x:o,y:a,width:l,height:c}=this._mapping[s],u=SO(n,r,l,c);this._texture.setSubImageData({data:u,x:o,y:a,width:l,height:c}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const I1=[0,0,0,255],LO={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:I1},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Jl extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:_O,fs:wO,modules:[tn,nn]})}initializeState(){this.state={iconManager:new CO(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:I1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state,h=o||this.internalState.isAsyncPropLoading("iconAtlas");if(f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&f.packIcons(l,c),r.extensionsChanged){var d;const{gl:p}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:ht[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):H.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}g(Jl,"defaultProps",LO);g(Jl,"layerName","IconLayer");const MO=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      // Line is not split, abort
      gl_Position = vec4(0.);
      return;
    }
  }

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Multiply out width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,IO=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,RO=[0,0,0,255],OO={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:RO},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class R1 extends et{getShaders(){return super.getShaders({vs:MO,fs:IO,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}g(R1,"layerName","LineLayer");g(R1,"defaultProps",OO);const kO=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  // Find the center of the point and add the current vertex
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply lighting
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,NO=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,O1=[0,0,0,255],k1=[0,0,1],FO={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:k1},getColor:{type:"accessor",value:O1},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function DO(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class N1 extends et{getShaders(){return super.getShaders({vs:kO,fs:NO,modules:[tn,od,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:k1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:O1}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:s}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&DO(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ht[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}g(N1,"layerName","PointCloudLayer");g(N1,"defaultProps",FO);const zO=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,UO=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,e0=[0,0,0,255],BO={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:e0},getLineColor:{type:"accessor",value:e0},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ec extends et{getShaders(){return super.getShaders({vs:zO,fs:UO,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ht[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ht[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}g(ec,"defaultProps",BO);g(ec,"layerName","ScatterplotLayer");const yd={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function _d(t,e,n={}){return VO(t,n)!==e?(GO(t,n),!0):!1}function VO(t,e={}){return Math.sign(jO(t,e))}function jO(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function GO(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function kt(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function jf(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Js(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Gf(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function Ia(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function F1(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=Js(t,0,n,o);let h,d;const p=z1(f,r,s,[]),w=[];kt(c,f);for(let x=1;x<l;x++){for(h=Js(t,x,n,o,h),d=Ia(h,p);d;){Gf(f,h,d,p,w);const y=Ia(w,p);y&&(Gf(f,w,y,p,w),d=y),kt(c,w),jf(f,w),HO(p,r,d),i&&c.length>n&&(c=[],u.push(c),kt(c,f)),d=Ia(h,p)}kt(c,h),jf(f,h)}return i?u:u[0]}const t0=0,WO=1;function sa(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function D1(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(WO):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:d}=l.shift();XO(f,i,d[0]||f.length,c),u=z1(c[0],r,s,u);const p=Ia(c[1],u);if(p){let w=n0(f,h,i,0,d[0]||f.length,u,p);const x={pos:w[0].pos,types:w[0].types,holes:[]},y={pos:w[1].pos,types:w[1].types,holes:[]};l.push(x,y);for(let m=0;m<d.length;m++)w=n0(f,h,i,d[m],d[m+1]||f.length,u,p),w[0]&&(x.holes.push(x.pos.length),x.pos=sa(x.pos,w[0].pos),o&&(x.types=sa(x.types,w[0].types))),w[1]&&(y.holes.push(y.pos.length),y.pos=sa(y.pos,w[1].pos),o&&(y.types=sa(y.types,w[1].types)))}else{const w={positions:f};o&&(w.edgeTypes=h),d.length&&(w.holeIndices=d),a.push(w)}}return a}function n0(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],f=[],h=[];let d,p,w;const x=Js(t,a-1,n,i);let y=Math.sign(o&8?x[1]-s[3]:x[0]-s[2]),m=e&&e[a-1],_=0,T=0;for(let P=0;P<a;P++)d=Js(t,P,n,i,d),p=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),w=e&&e[i/n+P],p&&y&&y!==p&&(Gf(x,d,o,s,h),kt(l,h)&&u.push(m),kt(c,h)&&f.push(m)),p<=0?(kt(l,d)&&u.push(w),_-=p):u.length&&(u[u.length-1]=t0),p>=0?(kt(c,d)&&f.push(w),T+=p):f.length&&(f[f.length-1]=t0),jf(x,d),y=p,m=w;return[_?{pos:l,types:e&&u}:null,T?{pos:c,types:e&&f}:null]}function z1(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function HO(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function XO(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const YO=85.051129;function ZO(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);U1(o,n,0,r-i);const a=F1(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)B1(l,n);return a}function $O(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,d=c,p=KO(t,i,l,h);for(let w=p;w<h;w++)o[c++]=t[w];for(let w=l;w<p;w++)o[c++]=t[w];U1(o,i,d,c),qO(o,i,d,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=D1(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const f of u)B1(f.positions,i);return u}function KO(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function qO(t,e,n,i,r=YO){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=Js(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,kt(t,a),a[1]=Math.sign(a[1])*r,kt(t,a),a[0]=s,kt(t,a)}}function U1(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function B1(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}class QO extends Ut{constructor(e){const{id:n=Jt("column-geometry")}=e,{indices:i,attributes:r}=JO(e);super({...e,id:n,indices:i,attributes:r})}}function JO(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(H.assert(r.length>=i),r=r.flatMap(d=>[d[0],d[1]]),_d(r,yd.COUNTER_CLOCKWISE));const s=n>0,o=i+1,a=s?o*3+1:i,l=Math.PI*2/i,c=new Uint16Array(s?i*3*2:0),u=new Float32Array(a*3),f=new Float32Array(a*3);let h=0;if(s){for(let d=0;d<o;d++){const p=d*l,w=d%i,x=Math.sin(p),y=Math.cos(p);for(let m=0;m<2;m++)u[h+0]=r?r[w*2]:y*e,u[h+1]=r?r[w*2+1]:x*e,u[h+2]=(1/2-m)*n,f[h+0]=r?r[w*2]:y,f[h+1]=r?r[w*2+1]:x,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let d=s?0:1;d<o;d++){const p=Math.floor(d/2)*Math.sign(.5-d%2),w=p*l,x=(p+i)%i,y=Math.sin(w),m=Math.cos(w);u[h+0]=r?r[x*2]:m*e,u[h+1]=r?r[x*2+1]:y*e,u[h+2]=n/2,f[h+2]=1,h+=3}if(s){let d=0;for(let p=0;p<i;p++)c[d++]=p*2+0,c[d++]=p*2+2,c[d++]=p*2+0,c[d++]=p*2+1,c[d++]=p*2+1,c[d++]=p*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:f}}}}const ek=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;

// Custom uniforms
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;

// Result
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  // rotate primitive position and normal
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));

  // calculate elevation, if 3d not enabled set to 0
  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1
  float elevation = 0.0;
  // calculate stroke offset
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }

  // if alpha == 0.0 or z < 0.0, do not render element
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;

  // project center of column
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Light calculations
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tk=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,El=[0,0,0,255],nk={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:El},getLineColor:{type:"accessor",value:El},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class wd extends et{getShaders(){const{gl:e}=this.context,n=!Z(e),i={},r=this.props.flatShading&&v_(e,te.GLSL_DERIVATIVES);return r&&(i.FLAT_SHADING=1),super.getShaders({vs:ek,fs:tk,defines:i,transpileToGLSL100:n,modules:[tn,r?p2:od,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:El},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:El},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;if(s){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,n,i){const r=new QO({radius:1,height:i?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o];s+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),r}_getModel(e){return new bt(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:i,stroked:r}){const s=this.getGeometry(e,n,i||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:f,offset:h,coverage:d,radius:p,angle:w}=this.props,{model:x,fillVertexCount:y,wireframeVertexCount:m,edgeDistance:_}=this.state;x.setUniforms(e).setUniforms({radius:p,angle:w/180*Math.PI,offset:h,extruded:l,stroked:u,coverage:d,elevationScale:a,edgeDistance:_,radiusUnits:ht[o],widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s}),l&&f&&(x.setProps({isIndexed:!0}),x.setVertexCount(m).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(x.setProps({isIndexed:!1}),x.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&u&&(x.setProps({isIndexed:!1}),x.setVertexCount(y*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}g(wd,"layerName","ColumnLayer");g(wd,"defaultProps",nk);const ik={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class V1 extends wd{getGeometry(e){return new G2}draw({uniforms:e}){const{elevationScale:n,extruded:i,offset:r,coverage:s,cellSize:o,angle:a,radiusUnits:l}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ht[l],angle:a,offset:r,extruded:i,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}g(V1,"layerName","GridCellLayer");g(V1,"defaultProps",ik);function rk(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?F1(r,{size:e,gridResolution:n}):i?ZO(r,{size:e}):r}const sk=1,ok=2,vu=4;class ak extends P1{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?rk(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(i0(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&i0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=vu,i[s+o-2]=vu):(i[s]+=sk,i[s+o-2]+=ok),i[s+o-1]=vu}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function i0(t){return Array.isArray(t[0])}const lk=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ck=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,j1=[0,0,0,255],uk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:j1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},yu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class tc extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:lk,fs:ck,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:yu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:yu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:yu,defaultValue:j1},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new ak({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ht[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}g(tc,"defaultProps",uk);g(tc,"layerName","PathLayer");var Ed={exports:{}};Ed.exports=nc;Ed.exports.default=nc;function nc(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=G1(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,d;if(i&&(s=pk(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<r;p+=n)f=t[p],h=t[p+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return eo(s,o,n,a,l,d,0),o}function G1(t,e,n,i,r){var s,o;if(r===Xf(t,e,n,i)>0)for(s=e;s<n;s+=i)o=r0(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=r0(s,t[s],t[s+1],o);return o&&ic(o,o.next)&&(no(o),o=o.next),o}function Mi(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(ic(n,n.next)||ue(n.prev,n,n.next)===0)){if(no(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function eo(t,e,n,i,r,s,o){if(!!t){!o&&s&&wk(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?hk(t,i,r,s):fk(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),no(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=dk(Mi(t),e,n),eo(t,e,n,i,r,s,2)):o===2&&gk(t,e,n,i,r,s):eo(Mi(t),e,n,i,r,s,1);break}}}}function fk(t){var e=t.prev,n=t,i=t.next;if(ue(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,p=i.next;p!==e;){if(p.x>=u&&p.x<=h&&p.y>=f&&p.y<=d&&or(r,a,s,l,o,c,p.x,p.y)&&ue(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function hk(t,e,n,i){var r=t.prev,s=t,o=t.next;if(ue(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,f=s.y,h=o.y,d=a<l?a<c?a:c:l<c?l:c,p=u<f?u<h?u:h:f<h?f:h,w=a>l?a>c?a:c:l>c?l:c,x=u>f?u>h?u:h:f>h?f:h,y=Wf(d,p,e,n,i),m=Wf(w,x,e,n,i),_=t.prevZ,T=t.nextZ;_&&_.z>=y&&T&&T.z<=m;){if(_.x>=d&&_.x<=w&&_.y>=p&&_.y<=x&&_!==r&&_!==o&&or(a,u,l,f,c,h,_.x,_.y)&&ue(_.prev,_,_.next)>=0||(_=_.prevZ,T.x>=d&&T.x<=w&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&or(a,u,l,f,c,h,T.x,T.y)&&ue(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=w&&_.y>=p&&_.y<=x&&_!==r&&_!==o&&or(a,u,l,f,c,h,_.x,_.y)&&ue(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;T&&T.z<=m;){if(T.x>=d&&T.x<=w&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&or(a,u,l,f,c,h,T.x,T.y)&&ue(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function dk(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!ic(r,s)&&W1(r,i,i.next,s)&&to(r,s)&&to(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),no(i),no(i.next),i=t=s),i=i.next}while(i!==t);return Mi(i)}function gk(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Tk(o,a)){var l=H1(o,a);o=Mi(o,o.next),l=Mi(l,l.next),eo(o,e,n,i,r,s,0),eo(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function pk(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=G1(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(xk(c));for(r.sort(mk),s=0;s<r.length;s++)n=vk(r[s],n);return n}function mk(t,e){return t.x-e.x}function vk(t,e){var n=yk(t,e);if(!n)return e;var i=H1(n,t);return Mi(i,i.next),Mi(n,n.next)}function yk(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&or(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),to(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&_k(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function _k(t,e){return ue(t.prev,t,e.prev)<0&&ue(e.next,t,t.next)<0}function wk(t,e,n,i){var r=t;do r.z===0&&(r.z=Wf(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Ek(r)}function Ek(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function Wf(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function xk(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function or(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function Tk(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Sk(t,e)&&(to(t,e)&&to(e,t)&&Pk(t,e)&&(ue(t.prev,t,e.prev)||ue(t,e.prev,e))||ic(t,e)&&ue(t.prev,t,t.next)>0&&ue(e.prev,e,e.next)>0)}function ue(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ic(t,e){return t.x===e.x&&t.y===e.y}function W1(t,e,n,i){var r=aa(ue(t,e,n)),s=aa(ue(t,e,i)),o=aa(ue(n,i,t)),a=aa(ue(n,i,e));return!!(r!==s&&o!==a||r===0&&oa(t,n,e)||s===0&&oa(t,i,e)||o===0&&oa(n,t,i)||a===0&&oa(n,e,i))}function oa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function aa(t){return t>0?1:t<0?-1:0}function Sk(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&W1(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function to(t,e){return ue(t.prev,t,t.next)<0?ue(t,e,t.next)>=0&&ue(t,t.prev,e)>=0:ue(t,e,t.prev)<0||ue(t,t.next,e)<0}function Pk(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function H1(t,e){var n=new Hf(t.i,t.x,t.y),i=new Hf(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function r0(t,e,n,i){var r=new Hf(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function no(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}nc.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Xf(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Xf(t,c,u,n))}var f=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,d=i[a+1]*n,p=i[a+2]*n;f+=Math.abs((t[h]-t[p])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[p+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Xf(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}nc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};const la=yd.CLOCKWISE,s0=yd.COUNTER_CLOCKWISE,Vn={isClosed:!0};function bk(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ps(t){return"positions"in t?t.positions:t}function Ra(t){return"holeIndices"in t?t.holeIndices:null}function Ak(t){return Array.isArray(t[0])}function Ck(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Lk(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function Mk(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function o0(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!Lk(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return Vn.start=e,Vn.end=s,Vn.size=i,_d(t,r,Vn),s}function a0(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!Mk(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return Vn.start=e,Vn.end=l,Vn.size=i,_d(t,o,Vn),l}function X1(t,e){bk(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=a0(n,o,r,e,s[a-1],s[a],a===0?la:s0),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!Ak(t))return a0(n,0,t,e,0,n.length,la),n;if(!Ck(t)){let r=0;for(const[s,o]of t.entries())r=o0(n,r,o,e,s===0?la:s0),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return o0(n,0,t,e,la),n}function Ik(t,e,n){let i=Ra(t);i&&(i=i.map(s=>s/e));let r=ps(t);if(n){const s=r.length;r=r.slice();const o=[];for(let a=0;a<s;a+=e){o[0]=r[a],o[1]=r[a+1];const l=n(o);r[a]=l[0],r[a+1]=l[1]}}return Ed.exports(r,i,e)}class Rk extends P1{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=X1(e,this.positionSize);return this.opts.resolution?D1(ps(n),Ra(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?$O(ps(n),Ra(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(l0(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return ps(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&l0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=Ik(e,this.positionSize,this.opts.preproject);l=a.allocate(l,r+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=ps(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&Ra(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function l0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Y1=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ok=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Y1,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),kk=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Y1,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),Nk=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xl=[0,0,0,255],Fk={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:xl},getLineColor:{type:"accessor",value:xl},material:!0},ca={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class rc extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?Ok:kk,fs:Nk,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[tn,od,nn]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===$.DEFAULT&&(i=$.LNGLAT),this.setState({numInstances:0,polygonTesselator:new Rk({preproject:i===$.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||td(e,te.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ca,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:ca,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ca,accessor:"getFillColor",defaultValue:xl,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ca,accessor:"getLineColor",defaultValue:xl,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,{index:a,target:l})=>this.encodePickingColor(o&&o.__source?o.__source.index:a,l),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:Boolean(n),elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new bt(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new bt(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Ut({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}g(rc,"defaultProps",Fk);g(rc,"layerName","SolidPolygonLayer");function Z1({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const d=e(t[h]);if(a>h&&d>=r&&(a=h),d>=s){l=h;break}}let c=a;const f=l-a!==i.length?t.slice(l):void 0;for(let h=0;h<i.length;h++)t[c++]=i[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+i.length}}const $1=[0,0,0,255],Dk=[0,0,0,255],zk={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:Dk},getLineColor:{type:"accessor",value:$1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class K1 extends ql{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&H.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),r=e.dataChanged.map(s=>Z1({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:r})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a=r==="XY"?2:3,{startRow:l,endRow:c}=e,{iterable:u,objectInfo:f}=_o(n,l,c);for(const h of u){f.index++;let d=i(h,f);s&&(d=X1(d,a));const{holeIndices:p}=d,w=d.positions||d;if(p)for(let x=0;x<=p.length;x++){const y=w.slice(p[x-1]||0,p[x]||w.length);o.push(this.getSubLayerRow({path:y},h,f.index))}else o.push(this.getSubLayerRow({path:w},h,f.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:c,transitions:u,positionFormat:f}=this.props,{lineWidthUnits:h,lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:w,lineJointRounded:x,lineMiterLimit:y,lineDashJustified:m}=this.props,{getFillColor:_,getLineColor:T,getLineWidth:P,getLineDashArray:b,getElevation:C,getPolygon:M,updateTriggers:R,material:O}=this.props,{paths:U,pathsDiff:G}=this.state,V=this.getSubLayerClass("fill",rc),X=this.getSubLayerClass("stroke",tc),Ye=this.shouldRenderSubLayer("fill",U)&&new V({_dataDiff:n,extruded:s,elevationScale:c,filled:r,wireframe:o,_normalize:a,_windingOrder:l,getElevation:C,getFillColor:_,getLineColor:s&&o?T:$1,material:O,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:R&&{getPolygon:R.getPolygon,getElevation:R.getElevation,getFillColor:R.getFillColor,lineColors:s&&o,getLineColor:R.getLineColor}}),{data:e,positionFormat:f,getPolygon:M}),ri=!s&&i&&this.shouldRenderSubLayer("stroke",U)&&new X({_dataDiff:G&&(()=>G),widthUnits:h,widthScale:d,widthMinPixels:p,widthMaxPixels:w,jointRounded:x,miterLimit:y,dashJustified:m,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(T),getWidth:this.getSubLayerAccessor(P),getDashArray:this.getSubLayerAccessor(b)},this.getSubLayerProps({id:"stroke",updateTriggers:R&&{getWidth:R.getLineWidth,getColor:R.getLineColor,getDashArray:R.getLineDashArray}}),{data:U,positionFormat:f,getPath:Pn=>Pn.path});return[!s&&Ye,ri,s&&Ye]}}g(K1,"layerName","PolygonLayer");g(K1,"defaultProps",zk);function Uk(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?Bk(t,i,n):null}function Bk(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function Vk(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const jk=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,c0=192/256,u0=[],Gk={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class xd extends Jl{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:jk}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&H.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:c0,outlineBuffer:r?Math.max(i,c0*(1-r)):-1,gamma:i,sdf:Boolean(n),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):u0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):u0}}g(xd,"defaultProps",Gk);g(xd,"layerName","MultiIconLayer");var Td={exports:{}};Td.exports=wo;Td.exports.default=wo;var pr=1e20;function wo(t,e,n,i,r,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,a=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Wk(t,e,n,i,r,s,o){s.fill(pr,0,e*n),o.fill(0,0,e*n);for(var a=(e-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+a)*e+c+a,f=t.data[4*(l*i+c)+3]/255;if(f===1)s[u]=0,o[u]=pr;else if(f===0)s[u]=pr,o[u]=0;else{var h=Math.max(0,.5-f),d=Math.max(0,f-.5);s[u]=h*h,o[u]=d*d}}}function Hk(t,e,n,i,r,s,o){for(var a=0;a<e*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/s+o))}}wo.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,r=2*this.buffer,s,o,a,l,c,u,f,h;e&&this.useMetrics?(c=Math.floor(n.actualBoundingBoxAscent),h=this.buffer+Math.ceil(n.actualBoundingBoxAscent),u=this.buffer,f=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),l=Math.min(this.size-u,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+r,a=l+r,this.ctx.textBaseline="alphabetic"):(s=o=this.size,a=l=this.size,c=19*this.fontSize/24,u=f=0,h=this.middle,this.ctx.textBaseline="middle");var d;o&&l&&(this.ctx.clearRect(f,u,o,l),this.ctx.fillText(t,this.buffer,h),d=this.ctx.getImageData(f,u,o,l));var p=new Uint8ClampedArray(s*a);return Wk(d,s,a,o,l,this.gridOuter,this.gridInner),f0(this.gridOuter,s,a,this.f,this.v,this.z),f0(this.gridInner,s,a,this.f,this.v,this.z),Hk(p,s,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:o,height:l,sdfWidth:s,sdfHeight:a,top:c,left:0,advance:i}}};wo.prototype.draw=function(t){return this._draw(t,!1).data};wo.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function f0(t,e,n,i,r,s){for(var o=0;o<e;o++)h0(t,o,e,n,i,r,s);for(var a=0;a<n;a++)h0(t,a*e,1,e,i,r,s)}function h0(t,e,n,i,r,s,o){var a,l,c,u;for(s[0]=0,o[0]=-pr,o[1]=pr,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,l=0,c=0;a<i;a++){do u=s[l],c=(r[a]-r[u]+a*a-u*u)/(a-u)/2;while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=pr}for(a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;u=s[l],t[e+a*n]=r[u]+(a-u)*(a-u)}}const Xk=32,Yk=[];function Zk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function $k({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;for(const f of t)if(!s[f]){const h=e(f);c+h+i*2>r&&(c=0,l++),s[f]={x:c+i,y:a+l*(n+i*2)+i,width:h,height:n},c+=h+i*2}const u=n+i*2;return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:Zk(a+(l+1)*u)}}function q1(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.width)||0}return r}function Q1(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=q1(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function Kk(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=q1(t,a,l,r);c+f>i&&(o<a&&(s.push(a),o=a,c=0),f>i&&(f=Q1(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=f}return c}function qk(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?Q1(t,r,s,n,i,o):Kk(t,r,s,n,i,o),o}function Qk(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.height),r[l]=o+u.width/2,o+=u.width):(H.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),r[l]=o,o+=Xk)}s[0]=o,s[1]=a}function d0(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,f=[0,0],h=[0,0];let d=0,p=0,w=0;for(let x=0;x<=o;x++){const y=s[x];if((y===`
`||x===o)&&(w=x),w>p){const m=u?qk(s,n,i,r,p,w):Yk;for(let _=0;_<=m.length;_++){const T=_===0?p:m[_-1],P=_<m.length?m[_]:w;Qk(s,T,P,r,a,h);for(let b=T;b<P;b++)l[b]=d+h[1]/2,c[b]=h[0];d=d+h[1]*e,f[0]=Math.max(f[0],h[0])}p=w}y===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return f[1]=d,{x:a,y:l,rowWidth:c,size:f}}function Jk({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const d=t.constructor;h=new d(c);for(let p=0;p<c;p++)h[p]=t[p*a+l]}for(let d=0;d<e;d++){const p=r[d],w=r[d+1]||c,x=h.subarray(p,w);f[d]=String.fromCodePoint.apply(null,x),u&&x.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:f,characterCount:c}}class J1{constructor(e=5){g(this,"limit",void 0),g(this,"_cache",{}),g(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function eN(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ls={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:eN(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},g0=1024,tN=.9,p0=1.2,ew=3;let Tl=new J1(ew);function nN(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Tl.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function iN(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function m0(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function rN(t){H.assert(Number.isFinite(t)&&t>=ew,"Invalid cache limit"),Tl=new J1(t)}class sN{constructor(){g(this,"props",{...Ls}),g(this,"_key",void 0),g(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return p0}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const i=nN(this._key,this.props.characterSet),r=Tl.get(this._key);if(r&&i.size===0){this._key!==n&&(this._atlas=r);return}const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,Tl.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:r,fontWeight:s,fontSize:o,buffer:a,sdf:l,radius:c,cutoff:u}=this.props;let f=i&&i.data;f||(f=document.createElement("canvas"),f.width=g0);const h=f.getContext("2d");m0(h,r,o,s);const{mapping:d,canvasHeight:p,xOffset:w,yOffset:x}=$k({getFontWidth:y=>h.measureText(y).width,fontHeight:o*p0,buffer:a,characterSet:n,maxCanvasWidth:g0,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(f.height!==p){const y=h.getImageData(0,0,f.width,f.height);f.height=p,h.putImageData(y,0,0)}if(m0(h,r,o,s),l){const y=new Td.exports(o,a,c,u,r,s),m=h.getImageData(0,0,y.size,y.size);for(const _ of n)iN(y.draw(_),m),h.putImageData(m,d[_].x-a,d[_].y+a)}else for(const y of n)h.fillText(y,d[y].x,d[y].y+o*tN);return{xOffset:w,yOffset:x,mapping:d,data:f,width:f.width,height:f.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}const oN=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,aN=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lN={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Sd extends et{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:oN,fs:aN,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:l,sizeUnits:ht[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Ut({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}g(Sd,"defaultProps",lN);g(Sd,"layerName","TextBackgroundLayer");const v0={start:1,middle:0,end:-1},y0={top:1,center:0,bottom:-1},_u=[0,0,0,255],cN=1,uN={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:_u},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ls.characterSet},fontFamily:Ls.fontFamily,fontWeight:Ls.fontWeight,lineHeight:cN,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:_u},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:_u},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Pd extends ql{constructor(...e){super(...e),g(this,"state",void 0),g(this,"getBoundingRect",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{size:[h,d]}=d0(f,l,o,a,r),p=v0[typeof c=="function"?c(n,i):c],w=y0[typeof u=="function"?u(n,i):u];return[(p-1)*h/2,(w-1)*d/2,h,d]}),g(this,"getIconOffsets",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{x:h,y:d,rowWidth:p,size:[w,x]}=d0(f,l,o,a,r),y=v0[typeof c=="function"?c(n,i):c],m=y0[typeof u=="function"?u(n,i):u],_=h.length,T=new Array(_*2);let P=0;for(let b=0;b<_;b++){const C=(1-y)*(w-p[b])/2;T[P++]=(y-1)*w/2+C+h[b],T[P++]=(m-1)*x/2+d[b]}return T})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new sN}}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:c,characterCount:u}=Jk({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=u,s=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=_o(n);o=[0],a=0;for(const f of c){u.index++;const h=Array.from(s(f,u)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:w,getBorderColor:x,getBorderWidth:y,backgroundPadding:m,background:_,billboard:T,fontSettings:P,outlineWidth:b,outlineColor:C,sizeScale:M,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:U,transitions:G,updateTriggers:V}=this.props,X=this.getSubLayerClass("characters",xd),Ye=this.getSubLayerClass("background",Sd);return[_&&new Ye({getFillColor:w,getLineColor:x,getLineWidth:y,padding:m,getPosition:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:M/this.state.fontAtlasManager.props.fontSize,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:U,transitions:G&&{getPosition:G.getPosition,getAngle:G.getAngle,getSize:G.getSize,getFillColor:G.getBackgroundColor,getLineColor:G.getBorderColor,getLineWidth:G.getBorderWidth,getPixelOffset:G.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:V.getPosition,getAngle:V.getAngle,getSize:V.getSize,getFillColor:V.getBackgroundColor,getLineColor:V.getBorderColor,getLineWidth:V.getBorderWidth,getPixelOffset:V.getPixelOffset,getBoundingRect:{getText:V.getText,getTextAnchor:V.getTextAnchor,getAlignmentBaseline:V.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new X({sdf:P.sdf,smoothing:Number.isFinite(P.smoothing)?P.smoothing:Ls.smoothing,outlineWidth:b,outlineColor:C,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:M*r,sizeUnits:R,sizeMinPixels:O*r,sizeMaxPixels:U*r,transitions:G&&{getPosition:G.getPosition,getAngle:G.getAngle,getColor:G.getColor,getSize:G.getSize,getPixelOffset:G.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:V.getText,getPosition:V.getPosition,getAngle:V.getAngle,getColor:V.getColor,getSize:V.getSize,getPixelOffset:V.getPixelOffset,getIconOffsets:{getText:V.getText,getTextAnchor:V.getTextAnchor,getAlignmentBaseline:V.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){rN(e)}}g(Pd,"defaultProps",uN);g(Pd,"layerName","TextLayer");const Oa={circle:{type:ec,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Jl,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Pd,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},ka={type:tc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Yf={type:rc,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ls({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function wu(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function fN(t){if(Array.isArray(t))return t;switch(H.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return H.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function _0(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o];H.assert(a&&a.geometry,"GeoJSON does not have geometry");const{geometry:l}=a;if(l.type==="GeometryCollection"){H.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];w0(f,i,e,a,o)}}else w0(l,i,e,a,o)}return i}function w0(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!dN(s,o)){H.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},i,r)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))})});break}}const hN={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function dN(t,e){let n=hN[t];for(H.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function tw(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ua(t){return t.geometry.coordinates}function gN(t,e){const n=tw(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ua,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ua,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ua,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ua,n}function pN(t,e){const n=tw(),{points:i,lines:r,polygons:s}=t,o=Vk(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const mN=["points","linestrings","polygons"],vN={...ls(Oa.circle),...ls(Oa.icon),...ls(Oa.text),...ls(ka),...ls(Yf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class nw extends ql{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=pN(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=fN(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=_0(i,r,c);for(const f in l)o[f].push(Z1({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=_0(i,r);const a=gN(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=mN.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Yf.type);if(s){const o=wu(this,Yf.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,ka.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,ka.type);if(o||a){const l=wu(this,ka.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=Oa[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const f=wu(this,c.props);let h=n.points;if(a==="text"&&i){const{instancePickingColors:d,...p}=h.data.attributes;h={...h,data:{...h.data,attributes:p}}}o.push(new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=Uk(s,o);return e(a,r)}}}g(nw,"layerName","GeoJsonLayer");g(nw,"defaultProps",vN);const yN="pk.eyJ1IjoibWF5cTA0MjIiLCJhIjoiY2phamMwOHV4MjllajMzbnFyeTMwcmZvYiJ9.aFMw4Aws5zY9Y4NwYqFMlQ",_N=new J_({color:[255,255,255],intensity:1}),wN=new cM({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),EN=new ud({ambientLight:_N,pointLight:wN}),xN={ambient:.1,diffuse:.6,shininess:32,specularColor:[60,64,70]},TN={buildingColor:[74,80,87],trailColor0:[253,128,93],trailColor1:[23,184,190],material:xN,effects:[EN]},SN={longitude:104.392,latitude:36.067,zoom:4,pitch:0,bearing:0},PN="mapbox://styles/mapbox/dark-v10";function bN(t,e="CN"){t.setFilter("admin-0-boundary-disputed",["all",["==",["get","disputed"],"true"],["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]]),t.setFilter("admin-0-boundary",["all",["==",["get","admin_level"],0],["==",["get","disputed"],"false"],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]]),t.setFilter("admin-0-boundary-bg",["all",["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all",e],!0,!1]])}const AN=[165921696e4,165928242e4];function CN({trailLength:t=1e7,initialViewState:e=SN,mapStyle:n=PN,theme:i=TN,animationSpeed:r=1e5,timeRange:s=AN}){const[o,a]=k.exports.useState(s[0]),[,l]=k.exports.useState(0),c=k.exports.useRef(!1),u=k.exports.useRef(0),f=k.exports.useRef(),h=k.exports.useRef([]),d=k.exports.useRef([]),p=k.exports.useCallback(()=>{const y=f.current.getMap();bN(y)},[]),w=()=>{c.current&&a(y=>{const m=y+r;return m>s[1]?s[0]:m}),u.current=window.requestAnimationFrame(w)};k.exports.useEffect(()=>(a(s[0]),u.current=window.requestAnimationFrame(w),()=>{window.cancelAnimationFrame(u.current),u.current=0}),[u,s[0],s[1]]),k.exports.useEffect(()=>{(async()=>{const y=await fetch("trips.json").then(m=>m.json());h.current=y,c.current=!0})()},[]),k.exports.useEffect(()=>{(async()=>{const y=await fetch("stations.json").then(m=>m.json());d.current=Object.entries(y).map(([m,_])=>({name:m,..._})),l(m=>m+1)})()});const x=[new ec({id:"scatterplot-layer",data:d.current,pickable:!0,autoHighlight:!0,highlightColor:[255,200,100],opacity:.8,stroked:!0,filled:!0,radiusScale:6,radiusMinPixels:2,radiusMaxPixels:10,lineWidthMinPixels:1,getPosition:y=>y.location,getRadius:500,getFillColor:[255,140,0],getLineColor:[100,100,100]})];return Jn(C1,{layers:x,effects:i.effects,initialViewState:e,controller:!0,getTooltip:({object:y})=>y&&y.name,children:Jn(Gh,{reuseMaps:!0,ref:f,onLoad:p,mapStyle:n,mapboxAccessToken:yN})})}function LN(){return Jn(sT,{children:Jn(CN,{})})}Eu.createRoot(document.getElementById("root")).render(Jn(Yw.StrictMode,{children:Jn(LN,{})}));export{MN as c};
